
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../../Examples/data_analysis/">
      
      
        <link rel="next" href="../Tree/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.18">
    
    
      
        <title>Preprocessor - Elysia API</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.7e37652d.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
      
        <meta  property="og:type"  content="website" >
      
        <meta  property="og:title"  content="Preprocessor - Elysia API" >
      
        <meta  property="og:description"  content="None" >
      
        <meta  property="og:image"  content="./assets/images/social/Reference/Preprocessor.png" >
      
        <meta  property="og:image:type"  content="image/png" >
      
        <meta  property="og:image:width"  content="1200" >
      
        <meta  property="og:image:height"  content="630" >
      
        <meta  property="og:url"  content="None" >
      
        <meta  name="twitter:card"  content="summary_large_image" >
      
        <meta  name="twitter:title"  content="Preprocessor - Elysia API" >
      
        <meta  name="twitter:description"  content="None" >
      
        <meta  name="twitter:image"  content="./assets/images/social/Reference/Preprocessor.png" >
      
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="purple">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#elysia.preprocessing.collection" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Elysia API" class="md-header__button md-logo" aria-label="Elysia API" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Elysia API
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Preprocessor
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="purple"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6m0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4M7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="teal" data-md-color-accent="lime"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
  
    
  
  Getting Started

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../setting_up/" class="md-tabs__link">
        
  
  
    
  
  Setting Up

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../basic/" class="md-tabs__link">
        
  
  
    
  
  Basic Usage

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../advanced_usage/" class="md-tabs__link">
        
  
  
    
  
  Customising Elysia

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../creating_tools/" class="md-tabs__link">
        
  
  
    
  
  Creating a Tool

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../Advanced/" class="md-tabs__link">
          
  
  
  Advanced

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../API/" class="md-tabs__link">
          
  
  
  API

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../Examples/" class="md-tabs__link">
          
  
  
  Examples

        </a>
      </li>
    
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="./" class="md-tabs__link">
          
  
  
  Reference

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Elysia API" class="md-nav__button md-logo" aria-label="Elysia API" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Elysia API
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Getting Started
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../setting_up/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Setting Up
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../basic/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Basic Usage
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../advanced_usage/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Customising Elysia
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../creating_tools/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Creating a Tool
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Advanced
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Advanced
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Advanced/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Advanced/technical_overview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Technical Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Advanced/advanced_tool_construction/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Tool Construction
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Advanced/custom_objects/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Custom Objects
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Advanced/environment/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Environment
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    API
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            API
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../API/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../API/user_and_tree_managers/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    User Management
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../API/payload_formats/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Payload Formats
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" >
        
          
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Examples
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            Examples
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Examples/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Index
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Examples/query_weaviate/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Querying Weaviate
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Examples/data_analysis/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Basic Linear Regression
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9" checked>
        
          
          <label class="md-nav__link" for="__nav_9" id="__nav_9_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Reference
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_9_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_9">
            <span class="md-nav__icon md-icon"></span>
            Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Preprocessor
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Preprocessor
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#elysia.preprocessing.collection" class="md-nav__link">
    <span class="md-ellipsis">
      collection
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#elysia.preprocessing.collection.delete_preprocessed_collection" class="md-nav__link">
    <span class="md-ellipsis">
      delete_preprocessed_collection
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#elysia.preprocessing.collection.delete_preprocessed_collection_async" class="md-nav__link">
    <span class="md-ellipsis">
      delete_preprocessed_collection_async
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#elysia.preprocessing.collection.edit_preprocessed_collection" class="md-nav__link">
    <span class="md-ellipsis">
      edit_preprocessed_collection
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#elysia.preprocessing.collection.edit_preprocessed_collection_async" class="md-nav__link">
    <span class="md-ellipsis">
      edit_preprocessed_collection_async
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#elysia.preprocessing.collection.preprocess" class="md-nav__link">
    <span class="md-ellipsis">
      preprocess
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#elysia.preprocessing.collection.preprocess_async" class="md-nav__link">
    <span class="md-ellipsis">
      preprocess_async
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#elysia.preprocessing.collection.preprocessed_collection_exists" class="md-nav__link">
    <span class="md-ellipsis">
      preprocessed_collection_exists
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#elysia.preprocessing.collection.preprocessed_collection_exists_async" class="md-nav__link">
    <span class="md-ellipsis">
      preprocessed_collection_exists_async
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#elysia.preprocessing.collection.view_preprocessed_collection" class="md-nav__link">
    <span class="md-ellipsis">
      view_preprocessed_collection
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#elysia.preprocessing.collection.view_preprocessed_collection_async" class="md-nav__link">
    <span class="md-ellipsis">
      view_preprocessed_collection_async
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Tree/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Tree
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Client/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    WeaviateClient
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Managers/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Managers
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Settings/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Settings
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Objects/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Objects
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../PayloadTypes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Payload Types
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Util/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Util
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



  <h1>Preprocessor</h1>

<div class="doc doc-object doc-module">



<a id="elysia.preprocessing.collection"></a>
    <div class="doc doc-contents first">










  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h2 id="elysia.preprocessing.collection.delete_preprocessed_collection" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">delete_preprocessed_collection</span><span class="p">(</span><span class="n">collection_name</span><span class="p">,</span> <span class="n">client_manager</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Delete a preprocessed collection.
This function allows you to delete the preprocessing done for a particular collection.
It does so by deleting the object in the ELYSIA_METADATA__ collection with the name of the collection.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>collection_name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The name of the collection to delete.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>client_manager</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="ClientManager (elysia.util.client.ClientManager)" href="../Client/#elysia.util.client.ClientManager">ClientManager</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The client manager to use.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>elysia/preprocessing/collection.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1007">1007</a></span>
<span class="normal"><a href="#__codelineno-0-1008">1008</a></span>
<span class="normal"><a href="#__codelineno-0-1009">1009</a></span>
<span class="normal"><a href="#__codelineno-0-1010">1010</a></span>
<span class="normal"><a href="#__codelineno-0-1011">1011</a></span>
<span class="normal"><a href="#__codelineno-0-1012">1012</a></span>
<span class="normal"><a href="#__codelineno-0-1013">1013</a></span>
<span class="normal"><a href="#__codelineno-0-1014">1014</a></span>
<span class="normal"><a href="#__codelineno-0-1015">1015</a></span>
<span class="normal"><a href="#__codelineno-0-1016">1016</a></span>
<span class="normal"><a href="#__codelineno-0-1017">1017</a></span>
<span class="normal"><a href="#__codelineno-0-1018">1018</a></span>
<span class="normal"><a href="#__codelineno-0-1019">1019</a></span>
<span class="normal"><a href="#__codelineno-0-1020">1020</a></span>
<span class="normal"><a href="#__codelineno-0-1021">1021</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1007" name="__codelineno-0-1007"></a><span class="k">def</span><span class="w"> </span><span class="nf">delete_preprocessed_collection</span><span class="p">(</span>
<a id="__codelineno-0-1008" name="__codelineno-0-1008"></a>    <span class="n">collection_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">client_manager</span><span class="p">:</span> <span class="n">ClientManager</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-1009" name="__codelineno-0-1009"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1010" name="__codelineno-0-1010"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1011" name="__codelineno-0-1011"></a><span class="sd">    Delete a preprocessed collection.</span>
<a id="__codelineno-0-1012" name="__codelineno-0-1012"></a><span class="sd">    This function allows you to delete the preprocessing done for a particular collection.</span>
<a id="__codelineno-0-1013" name="__codelineno-0-1013"></a><span class="sd">    It does so by deleting the object in the ELYSIA_METADATA__ collection with the name of the collection.</span>
<a id="__codelineno-0-1014" name="__codelineno-0-1014"></a>
<a id="__codelineno-0-1015" name="__codelineno-0-1015"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-1016" name="__codelineno-0-1016"></a><span class="sd">        collection_name (str): The name of the collection to delete.</span>
<a id="__codelineno-0-1017" name="__codelineno-0-1017"></a><span class="sd">        client_manager (ClientManager): The client manager to use.</span>
<a id="__codelineno-0-1018" name="__codelineno-0-1018"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1019" name="__codelineno-0-1019"></a>    <span class="k">return</span> <span class="n">asyncio_run</span><span class="p">(</span>
<a id="__codelineno-0-1020" name="__codelineno-0-1020"></a>        <span class="n">delete_preprocessed_collection_async</span><span class="p">(</span><span class="n">collection_name</span><span class="p">,</span> <span class="n">client_manager</span><span class="p">)</span>
<a id="__codelineno-0-1021" name="__codelineno-0-1021"></a>    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="elysia.preprocessing.collection.delete_preprocessed_collection_async" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">delete_preprocessed_collection_async</span><span class="p">(</span><span class="n">collection_name</span><span class="p">,</span> <span class="n">client_manager</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h2>


    <div class="doc doc-contents ">

        <p>Delete the preprocessed collection from the Weaviate cluster.
This function simply deletes the cached preprocessed metadata from the Weaviate cluster.
It does so by deleting the object in the collection ELYSIA_METADATA__ with the name of the collection.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>collection_name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The name of the collection to delete the preprocessed metadata for.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>client_manager</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="ClientManager (elysia.util.client.ClientManager)" href="../Client/#elysia.util.client.ClientManager">ClientManager</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The client manager to use.
If not provided, a new ClientManager will be created using the environment variables/configured settings.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>elysia/preprocessing/collection.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-972"> 972</a></span>
<span class="normal"><a href="#__codelineno-0-973"> 973</a></span>
<span class="normal"><a href="#__codelineno-0-974"> 974</a></span>
<span class="normal"><a href="#__codelineno-0-975"> 975</a></span>
<span class="normal"><a href="#__codelineno-0-976"> 976</a></span>
<span class="normal"><a href="#__codelineno-0-977"> 977</a></span>
<span class="normal"><a href="#__codelineno-0-978"> 978</a></span>
<span class="normal"><a href="#__codelineno-0-979"> 979</a></span>
<span class="normal"><a href="#__codelineno-0-980"> 980</a></span>
<span class="normal"><a href="#__codelineno-0-981"> 981</a></span>
<span class="normal"><a href="#__codelineno-0-982"> 982</a></span>
<span class="normal"><a href="#__codelineno-0-983"> 983</a></span>
<span class="normal"><a href="#__codelineno-0-984"> 984</a></span>
<span class="normal"><a href="#__codelineno-0-985"> 985</a></span>
<span class="normal"><a href="#__codelineno-0-986"> 986</a></span>
<span class="normal"><a href="#__codelineno-0-987"> 987</a></span>
<span class="normal"><a href="#__codelineno-0-988"> 988</a></span>
<span class="normal"><a href="#__codelineno-0-989"> 989</a></span>
<span class="normal"><a href="#__codelineno-0-990"> 990</a></span>
<span class="normal"><a href="#__codelineno-0-991"> 991</a></span>
<span class="normal"><a href="#__codelineno-0-992"> 992</a></span>
<span class="normal"><a href="#__codelineno-0-993"> 993</a></span>
<span class="normal"><a href="#__codelineno-0-994"> 994</a></span>
<span class="normal"><a href="#__codelineno-0-995"> 995</a></span>
<span class="normal"><a href="#__codelineno-0-996"> 996</a></span>
<span class="normal"><a href="#__codelineno-0-997"> 997</a></span>
<span class="normal"><a href="#__codelineno-0-998"> 998</a></span>
<span class="normal"><a href="#__codelineno-0-999"> 999</a></span>
<span class="normal"><a href="#__codelineno-0-1000">1000</a></span>
<span class="normal"><a href="#__codelineno-0-1001">1001</a></span>
<span class="normal"><a href="#__codelineno-0-1002">1002</a></span>
<span class="normal"><a href="#__codelineno-0-1003">1003</a></span>
<span class="normal"><a href="#__codelineno-0-1004">1004</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-972" name="__codelineno-0-972"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">delete_preprocessed_collection_async</span><span class="p">(</span>
<a id="__codelineno-0-973" name="__codelineno-0-973"></a>    <span class="n">collection_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">client_manager</span><span class="p">:</span> <span class="n">ClientManager</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-974" name="__codelineno-0-974"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-975" name="__codelineno-0-975"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-976" name="__codelineno-0-976"></a><span class="sd">    Delete the preprocessed collection from the Weaviate cluster.</span>
<a id="__codelineno-0-977" name="__codelineno-0-977"></a><span class="sd">    This function simply deletes the cached preprocessed metadata from the Weaviate cluster.</span>
<a id="__codelineno-0-978" name="__codelineno-0-978"></a><span class="sd">    It does so by deleting the object in the collection ELYSIA_METADATA__ with the name of the collection.</span>
<a id="__codelineno-0-979" name="__codelineno-0-979"></a>
<a id="__codelineno-0-980" name="__codelineno-0-980"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-981" name="__codelineno-0-981"></a><span class="sd">        collection_name (str): The name of the collection to delete the preprocessed metadata for.</span>
<a id="__codelineno-0-982" name="__codelineno-0-982"></a><span class="sd">        client_manager (ClientManager): The client manager to use.</span>
<a id="__codelineno-0-983" name="__codelineno-0-983"></a><span class="sd">            If not provided, a new ClientManager will be created using the environment variables/configured settings.</span>
<a id="__codelineno-0-984" name="__codelineno-0-984"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-985" name="__codelineno-0-985"></a>    <span class="k">if</span> <span class="n">client_manager</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-986" name="__codelineno-0-986"></a>        <span class="n">client_manager</span> <span class="o">=</span> <span class="n">ClientManager</span><span class="p">()</span>
<a id="__codelineno-0-987" name="__codelineno-0-987"></a>        <span class="n">close_clients_after_completion</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-988" name="__codelineno-0-988"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-989" name="__codelineno-0-989"></a>        <span class="n">close_clients_after_completion</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-990" name="__codelineno-0-990"></a>
<a id="__codelineno-0-991" name="__codelineno-0-991"></a>    <span class="k">async</span> <span class="k">with</span> <span class="n">client_manager</span><span class="o">.</span><span class="n">connect_to_async_client</span><span class="p">()</span> <span class="k">as</span> <span class="n">client</span><span class="p">:</span>
<a id="__codelineno-0-992" name="__codelineno-0-992"></a>        <span class="k">if</span> <span class="k">await</span> <span class="n">client</span><span class="o">.</span><span class="n">collections</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ELYSIA_METADATA__&quot;</span><span class="p">):</span>
<a id="__codelineno-0-993" name="__codelineno-0-993"></a>            <span class="n">metadata_collection</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">collections</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;ELYSIA_METADATA__&quot;</span><span class="p">)</span>
<a id="__codelineno-0-994" name="__codelineno-0-994"></a>            <span class="n">metadata</span> <span class="o">=</span> <span class="k">await</span> <span class="n">metadata_collection</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">fetch_objects</span><span class="p">(</span>
<a id="__codelineno-0-995" name="__codelineno-0-995"></a>                <span class="n">filters</span><span class="o">=</span><span class="n">Filter</span><span class="o">.</span><span class="n">by_property</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">equal</span><span class="p">(</span><span class="n">collection_name</span><span class="p">),</span>
<a id="__codelineno-0-996" name="__codelineno-0-996"></a>                <span class="n">limit</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-0-997" name="__codelineno-0-997"></a>            <span class="p">)</span>
<a id="__codelineno-0-998" name="__codelineno-0-998"></a>            <span class="k">if</span> <span class="n">metadata</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">metadata</span><span class="o">.</span><span class="n">objects</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-999" name="__codelineno-0-999"></a>                <span class="k">await</span> <span class="n">metadata_collection</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">delete_by_id</span><span class="p">(</span><span class="n">metadata</span><span class="o">.</span><span class="n">objects</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">uuid</span><span class="p">)</span>
<a id="__codelineno-0-1000" name="__codelineno-0-1000"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1001" name="__codelineno-0-1001"></a>                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Metadata for </span><span class="si">{</span><span class="n">collection_name</span><span class="si">}</span><span class="s2"> does not exist&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1002" name="__codelineno-0-1002"></a>
<a id="__codelineno-0-1003" name="__codelineno-0-1003"></a>    <span class="k">if</span> <span class="n">close_clients_after_completion</span><span class="p">:</span>
<a id="__codelineno-0-1004" name="__codelineno-0-1004"></a>        <span class="k">await</span> <span class="n">client_manager</span><span class="o">.</span><span class="n">close_clients</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="elysia.preprocessing.collection.edit_preprocessed_collection" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">edit_preprocessed_collection</span><span class="p">(</span><span class="n">collection_name</span><span class="p">,</span> <span class="n">client_manager</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">named_vectors</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">summary</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mappings</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fields</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Edit a preprocessed collection.
This function allows you to edit the named vectors, summary, mappings, and fields of a preprocessed collection.
It does so by updating the ELYSIA_METADATA__ collection.
Find available mappings in the <code>elysia.util.return_types</code> module.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>collection_name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The name of the collection to edit.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>client_manager</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="ClientManager (elysia.util.client.ClientManager)" href="../Client/#elysia.util.client.ClientManager">ClientManager</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The client manager to use.
If not provided, a new ClientManager will be created using the environment variables/configured settings.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>named_vectors</code>
            </td>
            <td>
                  <code><span title="list">list</span>[<span title="dict">dict</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The named vectors to update. This has fields "name", "enabled", and "description".
The "name" is used to identify the named vector to change (the name will not change).
Set "enabled" to True/False to enable/disable the named vector.
Set "description" to describe the named vector.
The description of named vectors is not automatically generated by the LLM.
Any named vectors that are not provided will not be updated.
If None or not provided, the named vectors will not be updated.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>summary</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The summary to update.
The summary is a short description of the collection, generated by the LLM.
This will replace the existing summary of the collection.
If None or not provided, the summary will not be updated.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>mappings</code>
            </td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The mappings to update.
The mappings are what the frontend will use to display the collection, and the associated fields.
I.e., which fields correspond to which output fields on the frontend.
The keys of the outer level of the dictionary are the mapping names, the values are dictionaries with the mappings.
The inner dictionary has the keys as the collection fields, and the values as the frontend fields.
If None or not provided, the mappings will not be updated.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>fields</code>
            </td>
            <td>
                  <code><span title="list">list</span>[<span title="dict">dict</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The fields to update.
Each element in the list is a dictionary with the following fields:
- "name": The name of the field. (This is used to identify the field to change, the name will not change).
- "description": The description of the field to update.
Any fields that are not provided will not be updated.
If None or not provided, the fields will not be updated.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>dict</code></td>            <td>
                  <code>None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The updated preprocessed collection.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>elysia/preprocessing/collection.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1024">1024</a></span>
<span class="normal"><a href="#__codelineno-0-1025">1025</a></span>
<span class="normal"><a href="#__codelineno-0-1026">1026</a></span>
<span class="normal"><a href="#__codelineno-0-1027">1027</a></span>
<span class="normal"><a href="#__codelineno-0-1028">1028</a></span>
<span class="normal"><a href="#__codelineno-0-1029">1029</a></span>
<span class="normal"><a href="#__codelineno-0-1030">1030</a></span>
<span class="normal"><a href="#__codelineno-0-1031">1031</a></span>
<span class="normal"><a href="#__codelineno-0-1032">1032</a></span>
<span class="normal"><a href="#__codelineno-0-1033">1033</a></span>
<span class="normal"><a href="#__codelineno-0-1034">1034</a></span>
<span class="normal"><a href="#__codelineno-0-1035">1035</a></span>
<span class="normal"><a href="#__codelineno-0-1036">1036</a></span>
<span class="normal"><a href="#__codelineno-0-1037">1037</a></span>
<span class="normal"><a href="#__codelineno-0-1038">1038</a></span>
<span class="normal"><a href="#__codelineno-0-1039">1039</a></span>
<span class="normal"><a href="#__codelineno-0-1040">1040</a></span>
<span class="normal"><a href="#__codelineno-0-1041">1041</a></span>
<span class="normal"><a href="#__codelineno-0-1042">1042</a></span>
<span class="normal"><a href="#__codelineno-0-1043">1043</a></span>
<span class="normal"><a href="#__codelineno-0-1044">1044</a></span>
<span class="normal"><a href="#__codelineno-0-1045">1045</a></span>
<span class="normal"><a href="#__codelineno-0-1046">1046</a></span>
<span class="normal"><a href="#__codelineno-0-1047">1047</a></span>
<span class="normal"><a href="#__codelineno-0-1048">1048</a></span>
<span class="normal"><a href="#__codelineno-0-1049">1049</a></span>
<span class="normal"><a href="#__codelineno-0-1050">1050</a></span>
<span class="normal"><a href="#__codelineno-0-1051">1051</a></span>
<span class="normal"><a href="#__codelineno-0-1052">1052</a></span>
<span class="normal"><a href="#__codelineno-0-1053">1053</a></span>
<span class="normal"><a href="#__codelineno-0-1054">1054</a></span>
<span class="normal"><a href="#__codelineno-0-1055">1055</a></span>
<span class="normal"><a href="#__codelineno-0-1056">1056</a></span>
<span class="normal"><a href="#__codelineno-0-1057">1057</a></span>
<span class="normal"><a href="#__codelineno-0-1058">1058</a></span>
<span class="normal"><a href="#__codelineno-0-1059">1059</a></span>
<span class="normal"><a href="#__codelineno-0-1060">1060</a></span>
<span class="normal"><a href="#__codelineno-0-1061">1061</a></span>
<span class="normal"><a href="#__codelineno-0-1062">1062</a></span>
<span class="normal"><a href="#__codelineno-0-1063">1063</a></span>
<span class="normal"><a href="#__codelineno-0-1064">1064</a></span>
<span class="normal"><a href="#__codelineno-0-1065">1065</a></span>
<span class="normal"><a href="#__codelineno-0-1066">1066</a></span>
<span class="normal"><a href="#__codelineno-0-1067">1067</a></span>
<span class="normal"><a href="#__codelineno-0-1068">1068</a></span>
<span class="normal"><a href="#__codelineno-0-1069">1069</a></span>
<span class="normal"><a href="#__codelineno-0-1070">1070</a></span>
<span class="normal"><a href="#__codelineno-0-1071">1071</a></span>
<span class="normal"><a href="#__codelineno-0-1072">1072</a></span>
<span class="normal"><a href="#__codelineno-0-1073">1073</a></span>
<span class="normal"><a href="#__codelineno-0-1074">1074</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1024" name="__codelineno-0-1024"></a><span class="k">def</span><span class="w"> </span><span class="nf">edit_preprocessed_collection</span><span class="p">(</span>
<a id="__codelineno-0-1025" name="__codelineno-0-1025"></a>    <span class="n">collection_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-1026" name="__codelineno-0-1026"></a>    <span class="n">client_manager</span><span class="p">:</span> <span class="n">ClientManager</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1027" name="__codelineno-0-1027"></a>    <span class="n">named_vectors</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1028" name="__codelineno-0-1028"></a>    <span class="n">summary</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1029" name="__codelineno-0-1029"></a>    <span class="n">mappings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1030" name="__codelineno-0-1030"></a>    <span class="n">fields</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1031" name="__codelineno-0-1031"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1032" name="__codelineno-0-1032"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1033" name="__codelineno-0-1033"></a><span class="sd">    Edit a preprocessed collection.</span>
<a id="__codelineno-0-1034" name="__codelineno-0-1034"></a><span class="sd">    This function allows you to edit the named vectors, summary, mappings, and fields of a preprocessed collection.</span>
<a id="__codelineno-0-1035" name="__codelineno-0-1035"></a><span class="sd">    It does so by updating the ELYSIA_METADATA__ collection.</span>
<a id="__codelineno-0-1036" name="__codelineno-0-1036"></a><span class="sd">    Find available mappings in the `elysia.util.return_types` module.</span>
<a id="__codelineno-0-1037" name="__codelineno-0-1037"></a>
<a id="__codelineno-0-1038" name="__codelineno-0-1038"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-1039" name="__codelineno-0-1039"></a><span class="sd">        collection_name (str): The name of the collection to edit.</span>
<a id="__codelineno-0-1040" name="__codelineno-0-1040"></a><span class="sd">        client_manager (ClientManager): The client manager to use.</span>
<a id="__codelineno-0-1041" name="__codelineno-0-1041"></a><span class="sd">            If not provided, a new ClientManager will be created using the environment variables/configured settings.</span>
<a id="__codelineno-0-1042" name="__codelineno-0-1042"></a><span class="sd">        named_vectors (list[dict]): The named vectors to update. This has fields &quot;name&quot;, &quot;enabled&quot;, and &quot;description&quot;.</span>
<a id="__codelineno-0-1043" name="__codelineno-0-1043"></a><span class="sd">            The &quot;name&quot; is used to identify the named vector to change (the name will not change).</span>
<a id="__codelineno-0-1044" name="__codelineno-0-1044"></a><span class="sd">            Set &quot;enabled&quot; to True/False to enable/disable the named vector.</span>
<a id="__codelineno-0-1045" name="__codelineno-0-1045"></a><span class="sd">            Set &quot;description&quot; to describe the named vector.</span>
<a id="__codelineno-0-1046" name="__codelineno-0-1046"></a><span class="sd">            The description of named vectors is not automatically generated by the LLM.</span>
<a id="__codelineno-0-1047" name="__codelineno-0-1047"></a><span class="sd">            Any named vectors that are not provided will not be updated.</span>
<a id="__codelineno-0-1048" name="__codelineno-0-1048"></a><span class="sd">            If None or not provided, the named vectors will not be updated.</span>
<a id="__codelineno-0-1049" name="__codelineno-0-1049"></a><span class="sd">        summary (str): The summary to update.</span>
<a id="__codelineno-0-1050" name="__codelineno-0-1050"></a><span class="sd">            The summary is a short description of the collection, generated by the LLM.</span>
<a id="__codelineno-0-1051" name="__codelineno-0-1051"></a><span class="sd">            This will replace the existing summary of the collection.</span>
<a id="__codelineno-0-1052" name="__codelineno-0-1052"></a><span class="sd">            If None or not provided, the summary will not be updated.</span>
<a id="__codelineno-0-1053" name="__codelineno-0-1053"></a><span class="sd">        mappings (dict): The mappings to update.</span>
<a id="__codelineno-0-1054" name="__codelineno-0-1054"></a><span class="sd">            The mappings are what the frontend will use to display the collection, and the associated fields.</span>
<a id="__codelineno-0-1055" name="__codelineno-0-1055"></a><span class="sd">            I.e., which fields correspond to which output fields on the frontend.</span>
<a id="__codelineno-0-1056" name="__codelineno-0-1056"></a><span class="sd">            The keys of the outer level of the dictionary are the mapping names, the values are dictionaries with the mappings.</span>
<a id="__codelineno-0-1057" name="__codelineno-0-1057"></a><span class="sd">            The inner dictionary has the keys as the collection fields, and the values as the frontend fields.</span>
<a id="__codelineno-0-1058" name="__codelineno-0-1058"></a><span class="sd">            If None or not provided, the mappings will not be updated.</span>
<a id="__codelineno-0-1059" name="__codelineno-0-1059"></a><span class="sd">        fields (list[dict]): The fields to update.</span>
<a id="__codelineno-0-1060" name="__codelineno-0-1060"></a><span class="sd">            Each element in the list is a dictionary with the following fields:</span>
<a id="__codelineno-0-1061" name="__codelineno-0-1061"></a><span class="sd">            - &quot;name&quot;: The name of the field. (This is used to identify the field to change, the name will not change).</span>
<a id="__codelineno-0-1062" name="__codelineno-0-1062"></a><span class="sd">            - &quot;description&quot;: The description of the field to update.</span>
<a id="__codelineno-0-1063" name="__codelineno-0-1063"></a><span class="sd">            Any fields that are not provided will not be updated.</span>
<a id="__codelineno-0-1064" name="__codelineno-0-1064"></a><span class="sd">            If None or not provided, the fields will not be updated.</span>
<a id="__codelineno-0-1065" name="__codelineno-0-1065"></a>
<a id="__codelineno-0-1066" name="__codelineno-0-1066"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-1067" name="__codelineno-0-1067"></a><span class="sd">        dict: The updated preprocessed collection.</span>
<a id="__codelineno-0-1068" name="__codelineno-0-1068"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1069" name="__codelineno-0-1069"></a>
<a id="__codelineno-0-1070" name="__codelineno-0-1070"></a>    <span class="k">return</span> <span class="n">asyncio_run</span><span class="p">(</span>
<a id="__codelineno-0-1071" name="__codelineno-0-1071"></a>        <span class="n">edit_preprocessed_collection_async</span><span class="p">(</span>
<a id="__codelineno-0-1072" name="__codelineno-0-1072"></a>            <span class="n">collection_name</span><span class="p">,</span> <span class="n">client_manager</span><span class="p">,</span> <span class="n">named_vectors</span><span class="p">,</span> <span class="n">summary</span><span class="p">,</span> <span class="n">mappings</span><span class="p">,</span> <span class="n">fields</span>
<a id="__codelineno-0-1073" name="__codelineno-0-1073"></a>        <span class="p">)</span>
<a id="__codelineno-0-1074" name="__codelineno-0-1074"></a>    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="elysia.preprocessing.collection.edit_preprocessed_collection_async" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">edit_preprocessed_collection_async</span><span class="p">(</span><span class="n">collection_name</span><span class="p">,</span> <span class="n">client_manager</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">named_vectors</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">summary</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mappings</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fields</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h2>


    <div class="doc doc-contents ">

        <p>Async version of <code>edit_preprocessed_collection</code>.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>collection_name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The name of the collection to edit.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>client_manager</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="ClientManager (elysia.util.client.ClientManager)" href="../Client/#elysia.util.client.ClientManager">ClientManager</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The client manager to use.
If not provided, a new ClientManager will be created using the environment variables/configured settings.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>named_vectors</code>
            </td>
            <td>
                  <code><span title="list">list</span>[<span title="dict">dict</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The named vectors to update. This has fields "name", "enabled", and "description".
The "name" is used to identify the named vector to change (the name will not change).
Set "enabled" to True/False to enable/disable the named vector.
Set "description" to describe the named vector.
The description of named vectors is not automatically generated by the LLM.
Any named vectors that are not provided will not be updated.
If None or not provided, the named vectors will not be updated.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>summary</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The summary to update.
The summary is a short description of the collection, generated by the LLM.
This will replace the existing summary of the collection.
If None or not provided, the summary will not be updated.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>mappings</code>
            </td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The mappings to update.
The mappings are what the frontend will use to display the collection, and the associated fields.
I.e., which fields correspond to which output fields on the frontend.
The keys of the outer level of the dictionary are the mapping names, the values are dictionaries with the mappings.
The inner dictionary has the keys as the collection fields, and the values as the frontend fields.
If None or not provided, the mappings will not be updated.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>fields</code>
            </td>
            <td>
                  <code><span title="list">list</span>[<span title="dict">dict</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The fields to update.
Each element in the list is a dictionary with the following fields:
- "name": The name of the field. (This is used to identify the field to change, the name will not change).
- "description": The description of the field to update.
Any fields that are not provided will not be updated.
If None or not provided, the fields will not be updated.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>dict</code></td>            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The updated preprocessed collection.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>elysia/preprocessing/collection.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1077">1077</a></span>
<span class="normal"><a href="#__codelineno-0-1078">1078</a></span>
<span class="normal"><a href="#__codelineno-0-1079">1079</a></span>
<span class="normal"><a href="#__codelineno-0-1080">1080</a></span>
<span class="normal"><a href="#__codelineno-0-1081">1081</a></span>
<span class="normal"><a href="#__codelineno-0-1082">1082</a></span>
<span class="normal"><a href="#__codelineno-0-1083">1083</a></span>
<span class="normal"><a href="#__codelineno-0-1084">1084</a></span>
<span class="normal"><a href="#__codelineno-0-1085">1085</a></span>
<span class="normal"><a href="#__codelineno-0-1086">1086</a></span>
<span class="normal"><a href="#__codelineno-0-1087">1087</a></span>
<span class="normal"><a href="#__codelineno-0-1088">1088</a></span>
<span class="normal"><a href="#__codelineno-0-1089">1089</a></span>
<span class="normal"><a href="#__codelineno-0-1090">1090</a></span>
<span class="normal"><a href="#__codelineno-0-1091">1091</a></span>
<span class="normal"><a href="#__codelineno-0-1092">1092</a></span>
<span class="normal"><a href="#__codelineno-0-1093">1093</a></span>
<span class="normal"><a href="#__codelineno-0-1094">1094</a></span>
<span class="normal"><a href="#__codelineno-0-1095">1095</a></span>
<span class="normal"><a href="#__codelineno-0-1096">1096</a></span>
<span class="normal"><a href="#__codelineno-0-1097">1097</a></span>
<span class="normal"><a href="#__codelineno-0-1098">1098</a></span>
<span class="normal"><a href="#__codelineno-0-1099">1099</a></span>
<span class="normal"><a href="#__codelineno-0-1100">1100</a></span>
<span class="normal"><a href="#__codelineno-0-1101">1101</a></span>
<span class="normal"><a href="#__codelineno-0-1102">1102</a></span>
<span class="normal"><a href="#__codelineno-0-1103">1103</a></span>
<span class="normal"><a href="#__codelineno-0-1104">1104</a></span>
<span class="normal"><a href="#__codelineno-0-1105">1105</a></span>
<span class="normal"><a href="#__codelineno-0-1106">1106</a></span>
<span class="normal"><a href="#__codelineno-0-1107">1107</a></span>
<span class="normal"><a href="#__codelineno-0-1108">1108</a></span>
<span class="normal"><a href="#__codelineno-0-1109">1109</a></span>
<span class="normal"><a href="#__codelineno-0-1110">1110</a></span>
<span class="normal"><a href="#__codelineno-0-1111">1111</a></span>
<span class="normal"><a href="#__codelineno-0-1112">1112</a></span>
<span class="normal"><a href="#__codelineno-0-1113">1113</a></span>
<span class="normal"><a href="#__codelineno-0-1114">1114</a></span>
<span class="normal"><a href="#__codelineno-0-1115">1115</a></span>
<span class="normal"><a href="#__codelineno-0-1116">1116</a></span>
<span class="normal"><a href="#__codelineno-0-1117">1117</a></span>
<span class="normal"><a href="#__codelineno-0-1118">1118</a></span>
<span class="normal"><a href="#__codelineno-0-1119">1119</a></span>
<span class="normal"><a href="#__codelineno-0-1120">1120</a></span>
<span class="normal"><a href="#__codelineno-0-1121">1121</a></span>
<span class="normal"><a href="#__codelineno-0-1122">1122</a></span>
<span class="normal"><a href="#__codelineno-0-1123">1123</a></span>
<span class="normal"><a href="#__codelineno-0-1124">1124</a></span>
<span class="normal"><a href="#__codelineno-0-1125">1125</a></span>
<span class="normal"><a href="#__codelineno-0-1126">1126</a></span>
<span class="normal"><a href="#__codelineno-0-1127">1127</a></span>
<span class="normal"><a href="#__codelineno-0-1128">1128</a></span>
<span class="normal"><a href="#__codelineno-0-1129">1129</a></span>
<span class="normal"><a href="#__codelineno-0-1130">1130</a></span>
<span class="normal"><a href="#__codelineno-0-1131">1131</a></span>
<span class="normal"><a href="#__codelineno-0-1132">1132</a></span>
<span class="normal"><a href="#__codelineno-0-1133">1133</a></span>
<span class="normal"><a href="#__codelineno-0-1134">1134</a></span>
<span class="normal"><a href="#__codelineno-0-1135">1135</a></span>
<span class="normal"><a href="#__codelineno-0-1136">1136</a></span>
<span class="normal"><a href="#__codelineno-0-1137">1137</a></span>
<span class="normal"><a href="#__codelineno-0-1138">1138</a></span>
<span class="normal"><a href="#__codelineno-0-1139">1139</a></span>
<span class="normal"><a href="#__codelineno-0-1140">1140</a></span>
<span class="normal"><a href="#__codelineno-0-1141">1141</a></span>
<span class="normal"><a href="#__codelineno-0-1142">1142</a></span>
<span class="normal"><a href="#__codelineno-0-1143">1143</a></span>
<span class="normal"><a href="#__codelineno-0-1144">1144</a></span>
<span class="normal"><a href="#__codelineno-0-1145">1145</a></span>
<span class="normal"><a href="#__codelineno-0-1146">1146</a></span>
<span class="normal"><a href="#__codelineno-0-1147">1147</a></span>
<span class="normal"><a href="#__codelineno-0-1148">1148</a></span>
<span class="normal"><a href="#__codelineno-0-1149">1149</a></span>
<span class="normal"><a href="#__codelineno-0-1150">1150</a></span>
<span class="normal"><a href="#__codelineno-0-1151">1151</a></span>
<span class="normal"><a href="#__codelineno-0-1152">1152</a></span>
<span class="normal"><a href="#__codelineno-0-1153">1153</a></span>
<span class="normal"><a href="#__codelineno-0-1154">1154</a></span>
<span class="normal"><a href="#__codelineno-0-1155">1155</a></span>
<span class="normal"><a href="#__codelineno-0-1156">1156</a></span>
<span class="normal"><a href="#__codelineno-0-1157">1157</a></span>
<span class="normal"><a href="#__codelineno-0-1158">1158</a></span>
<span class="normal"><a href="#__codelineno-0-1159">1159</a></span>
<span class="normal"><a href="#__codelineno-0-1160">1160</a></span>
<span class="normal"><a href="#__codelineno-0-1161">1161</a></span>
<span class="normal"><a href="#__codelineno-0-1162">1162</a></span>
<span class="normal"><a href="#__codelineno-0-1163">1163</a></span>
<span class="normal"><a href="#__codelineno-0-1164">1164</a></span>
<span class="normal"><a href="#__codelineno-0-1165">1165</a></span>
<span class="normal"><a href="#__codelineno-0-1166">1166</a></span>
<span class="normal"><a href="#__codelineno-0-1167">1167</a></span>
<span class="normal"><a href="#__codelineno-0-1168">1168</a></span>
<span class="normal"><a href="#__codelineno-0-1169">1169</a></span>
<span class="normal"><a href="#__codelineno-0-1170">1170</a></span>
<span class="normal"><a href="#__codelineno-0-1171">1171</a></span>
<span class="normal"><a href="#__codelineno-0-1172">1172</a></span>
<span class="normal"><a href="#__codelineno-0-1173">1173</a></span>
<span class="normal"><a href="#__codelineno-0-1174">1174</a></span>
<span class="normal"><a href="#__codelineno-0-1175">1175</a></span>
<span class="normal"><a href="#__codelineno-0-1176">1176</a></span>
<span class="normal"><a href="#__codelineno-0-1177">1177</a></span>
<span class="normal"><a href="#__codelineno-0-1178">1178</a></span>
<span class="normal"><a href="#__codelineno-0-1179">1179</a></span>
<span class="normal"><a href="#__codelineno-0-1180">1180</a></span>
<span class="normal"><a href="#__codelineno-0-1181">1181</a></span>
<span class="normal"><a href="#__codelineno-0-1182">1182</a></span>
<span class="normal"><a href="#__codelineno-0-1183">1183</a></span>
<span class="normal"><a href="#__codelineno-0-1184">1184</a></span>
<span class="normal"><a href="#__codelineno-0-1185">1185</a></span>
<span class="normal"><a href="#__codelineno-0-1186">1186</a></span>
<span class="normal"><a href="#__codelineno-0-1187">1187</a></span>
<span class="normal"><a href="#__codelineno-0-1188">1188</a></span>
<span class="normal"><a href="#__codelineno-0-1189">1189</a></span>
<span class="normal"><a href="#__codelineno-0-1190">1190</a></span>
<span class="normal"><a href="#__codelineno-0-1191">1191</a></span>
<span class="normal"><a href="#__codelineno-0-1192">1192</a></span>
<span class="normal"><a href="#__codelineno-0-1193">1193</a></span>
<span class="normal"><a href="#__codelineno-0-1194">1194</a></span>
<span class="normal"><a href="#__codelineno-0-1195">1195</a></span>
<span class="normal"><a href="#__codelineno-0-1196">1196</a></span>
<span class="normal"><a href="#__codelineno-0-1197">1197</a></span>
<span class="normal"><a href="#__codelineno-0-1198">1198</a></span>
<span class="normal"><a href="#__codelineno-0-1199">1199</a></span>
<span class="normal"><a href="#__codelineno-0-1200">1200</a></span>
<span class="normal"><a href="#__codelineno-0-1201">1201</a></span>
<span class="normal"><a href="#__codelineno-0-1202">1202</a></span>
<span class="normal"><a href="#__codelineno-0-1203">1203</a></span>
<span class="normal"><a href="#__codelineno-0-1204">1204</a></span>
<span class="normal"><a href="#__codelineno-0-1205">1205</a></span>
<span class="normal"><a href="#__codelineno-0-1206">1206</a></span>
<span class="normal"><a href="#__codelineno-0-1207">1207</a></span>
<span class="normal"><a href="#__codelineno-0-1208">1208</a></span>
<span class="normal"><a href="#__codelineno-0-1209">1209</a></span>
<span class="normal"><a href="#__codelineno-0-1210">1210</a></span>
<span class="normal"><a href="#__codelineno-0-1211">1211</a></span>
<span class="normal"><a href="#__codelineno-0-1212">1212</a></span>
<span class="normal"><a href="#__codelineno-0-1213">1213</a></span>
<span class="normal"><a href="#__codelineno-0-1214">1214</a></span>
<span class="normal"><a href="#__codelineno-0-1215">1215</a></span>
<span class="normal"><a href="#__codelineno-0-1216">1216</a></span>
<span class="normal"><a href="#__codelineno-0-1217">1217</a></span>
<span class="normal"><a href="#__codelineno-0-1218">1218</a></span>
<span class="normal"><a href="#__codelineno-0-1219">1219</a></span>
<span class="normal"><a href="#__codelineno-0-1220">1220</a></span>
<span class="normal"><a href="#__codelineno-0-1221">1221</a></span>
<span class="normal"><a href="#__codelineno-0-1222">1222</a></span>
<span class="normal"><a href="#__codelineno-0-1223">1223</a></span>
<span class="normal"><a href="#__codelineno-0-1224">1224</a></span>
<span class="normal"><a href="#__codelineno-0-1225">1225</a></span>
<span class="normal"><a href="#__codelineno-0-1226">1226</a></span>
<span class="normal"><a href="#__codelineno-0-1227">1227</a></span>
<span class="normal"><a href="#__codelineno-0-1228">1228</a></span>
<span class="normal"><a href="#__codelineno-0-1229">1229</a></span>
<span class="normal"><a href="#__codelineno-0-1230">1230</a></span>
<span class="normal"><a href="#__codelineno-0-1231">1231</a></span>
<span class="normal"><a href="#__codelineno-0-1232">1232</a></span>
<span class="normal"><a href="#__codelineno-0-1233">1233</a></span>
<span class="normal"><a href="#__codelineno-0-1234">1234</a></span>
<span class="normal"><a href="#__codelineno-0-1235">1235</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1077" name="__codelineno-0-1077"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">edit_preprocessed_collection_async</span><span class="p">(</span>
<a id="__codelineno-0-1078" name="__codelineno-0-1078"></a>    <span class="n">collection_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-1079" name="__codelineno-0-1079"></a>    <span class="n">client_manager</span><span class="p">:</span> <span class="n">ClientManager</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1080" name="__codelineno-0-1080"></a>    <span class="n">named_vectors</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1081" name="__codelineno-0-1081"></a>    <span class="n">summary</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1082" name="__codelineno-0-1082"></a>    <span class="n">mappings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1083" name="__codelineno-0-1083"></a>    <span class="n">fields</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1084" name="__codelineno-0-1084"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<a id="__codelineno-0-1085" name="__codelineno-0-1085"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1086" name="__codelineno-0-1086"></a><span class="sd">    Async version of `edit_preprocessed_collection`.</span>
<a id="__codelineno-0-1087" name="__codelineno-0-1087"></a>
<a id="__codelineno-0-1088" name="__codelineno-0-1088"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-1089" name="__codelineno-0-1089"></a><span class="sd">        collection_name (str): The name of the collection to edit.</span>
<a id="__codelineno-0-1090" name="__codelineno-0-1090"></a><span class="sd">        client_manager (ClientManager): The client manager to use.</span>
<a id="__codelineno-0-1091" name="__codelineno-0-1091"></a><span class="sd">            If not provided, a new ClientManager will be created using the environment variables/configured settings.</span>
<a id="__codelineno-0-1092" name="__codelineno-0-1092"></a><span class="sd">        named_vectors (list[dict]): The named vectors to update. This has fields &quot;name&quot;, &quot;enabled&quot;, and &quot;description&quot;.</span>
<a id="__codelineno-0-1093" name="__codelineno-0-1093"></a><span class="sd">            The &quot;name&quot; is used to identify the named vector to change (the name will not change).</span>
<a id="__codelineno-0-1094" name="__codelineno-0-1094"></a><span class="sd">            Set &quot;enabled&quot; to True/False to enable/disable the named vector.</span>
<a id="__codelineno-0-1095" name="__codelineno-0-1095"></a><span class="sd">            Set &quot;description&quot; to describe the named vector.</span>
<a id="__codelineno-0-1096" name="__codelineno-0-1096"></a><span class="sd">            The description of named vectors is not automatically generated by the LLM.</span>
<a id="__codelineno-0-1097" name="__codelineno-0-1097"></a><span class="sd">            Any named vectors that are not provided will not be updated.</span>
<a id="__codelineno-0-1098" name="__codelineno-0-1098"></a><span class="sd">            If None or not provided, the named vectors will not be updated.</span>
<a id="__codelineno-0-1099" name="__codelineno-0-1099"></a><span class="sd">        summary (str): The summary to update.</span>
<a id="__codelineno-0-1100" name="__codelineno-0-1100"></a><span class="sd">            The summary is a short description of the collection, generated by the LLM.</span>
<a id="__codelineno-0-1101" name="__codelineno-0-1101"></a><span class="sd">            This will replace the existing summary of the collection.</span>
<a id="__codelineno-0-1102" name="__codelineno-0-1102"></a><span class="sd">            If None or not provided, the summary will not be updated.</span>
<a id="__codelineno-0-1103" name="__codelineno-0-1103"></a><span class="sd">        mappings (dict): The mappings to update.</span>
<a id="__codelineno-0-1104" name="__codelineno-0-1104"></a><span class="sd">            The mappings are what the frontend will use to display the collection, and the associated fields.</span>
<a id="__codelineno-0-1105" name="__codelineno-0-1105"></a><span class="sd">            I.e., which fields correspond to which output fields on the frontend.</span>
<a id="__codelineno-0-1106" name="__codelineno-0-1106"></a><span class="sd">            The keys of the outer level of the dictionary are the mapping names, the values are dictionaries with the mappings.</span>
<a id="__codelineno-0-1107" name="__codelineno-0-1107"></a><span class="sd">            The inner dictionary has the keys as the collection fields, and the values as the frontend fields.</span>
<a id="__codelineno-0-1108" name="__codelineno-0-1108"></a><span class="sd">            If None or not provided, the mappings will not be updated.</span>
<a id="__codelineno-0-1109" name="__codelineno-0-1109"></a><span class="sd">        fields (list[dict]): The fields to update.</span>
<a id="__codelineno-0-1110" name="__codelineno-0-1110"></a><span class="sd">            Each element in the list is a dictionary with the following fields:</span>
<a id="__codelineno-0-1111" name="__codelineno-0-1111"></a><span class="sd">            - &quot;name&quot;: The name of the field. (This is used to identify the field to change, the name will not change).</span>
<a id="__codelineno-0-1112" name="__codelineno-0-1112"></a><span class="sd">            - &quot;description&quot;: The description of the field to update.</span>
<a id="__codelineno-0-1113" name="__codelineno-0-1113"></a><span class="sd">            Any fields that are not provided will not be updated.</span>
<a id="__codelineno-0-1114" name="__codelineno-0-1114"></a><span class="sd">            If None or not provided, the fields will not be updated.</span>
<a id="__codelineno-0-1115" name="__codelineno-0-1115"></a>
<a id="__codelineno-0-1116" name="__codelineno-0-1116"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-1117" name="__codelineno-0-1117"></a><span class="sd">        dict: The updated preprocessed collection.</span>
<a id="__codelineno-0-1118" name="__codelineno-0-1118"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1119" name="__codelineno-0-1119"></a>
<a id="__codelineno-0-1120" name="__codelineno-0-1120"></a>    <span class="k">if</span> <span class="n">client_manager</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1121" name="__codelineno-0-1121"></a>        <span class="n">client_manager</span> <span class="o">=</span> <span class="n">ClientManager</span><span class="p">()</span>
<a id="__codelineno-0-1122" name="__codelineno-0-1122"></a>        <span class="n">close_clients_after_completion</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-1123" name="__codelineno-0-1123"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1124" name="__codelineno-0-1124"></a>        <span class="n">close_clients_after_completion</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-1125" name="__codelineno-0-1125"></a>
<a id="__codelineno-0-1126" name="__codelineno-0-1126"></a>    <span class="k">async</span> <span class="k">with</span> <span class="n">client_manager</span><span class="o">.</span><span class="n">connect_to_async_client</span><span class="p">()</span> <span class="k">as</span> <span class="n">client</span><span class="p">:</span>
<a id="__codelineno-0-1127" name="__codelineno-0-1127"></a>        <span class="n">metadata_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;ELYSIA_METADATA__&quot;</span>
<a id="__codelineno-0-1128" name="__codelineno-0-1128"></a>
<a id="__codelineno-0-1129" name="__codelineno-0-1129"></a>        <span class="c1"># check if the collection itself exists</span>
<a id="__codelineno-0-1130" name="__codelineno-0-1130"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="k">await</span> <span class="n">client</span><span class="o">.</span><span class="n">collections</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">collection_name</span><span class="p">):</span>
<a id="__codelineno-0-1131" name="__codelineno-0-1131"></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Collection </span><span class="si">{</span><span class="n">collection_name</span><span class="si">}</span><span class="s2"> does not exist&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1132" name="__codelineno-0-1132"></a>
<a id="__codelineno-0-1133" name="__codelineno-0-1133"></a>        <span class="c1"># check if the metadata collection exists</span>
<a id="__codelineno-0-1134" name="__codelineno-0-1134"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="k">await</span> <span class="n">client</span><span class="o">.</span><span class="n">collections</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">metadata_name</span><span class="p">):</span>
<a id="__codelineno-0-1135" name="__codelineno-0-1135"></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Metadata collection does not exist&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1136" name="__codelineno-0-1136"></a>
<a id="__codelineno-0-1137" name="__codelineno-0-1137"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1138" name="__codelineno-0-1138"></a>            <span class="n">metadata_collection</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">collections</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">metadata_name</span><span class="p">)</span>
<a id="__codelineno-0-1139" name="__codelineno-0-1139"></a>            <span class="n">metadata</span> <span class="o">=</span> <span class="k">await</span> <span class="n">metadata_collection</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">fetch_objects</span><span class="p">(</span>
<a id="__codelineno-0-1140" name="__codelineno-0-1140"></a>                <span class="n">filters</span><span class="o">=</span><span class="n">Filter</span><span class="o">.</span><span class="n">by_property</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">equal</span><span class="p">(</span><span class="n">collection_name</span><span class="p">),</span>
<a id="__codelineno-0-1141" name="__codelineno-0-1141"></a>                <span class="n">limit</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-0-1142" name="__codelineno-0-1142"></a>            <span class="p">)</span>
<a id="__codelineno-0-1143" name="__codelineno-0-1143"></a>            <span class="n">uuid</span> <span class="o">=</span> <span class="n">metadata</span><span class="o">.</span><span class="n">objects</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">uuid</span>
<a id="__codelineno-0-1144" name="__codelineno-0-1144"></a>            <span class="n">properties</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="n">metadata</span><span class="o">.</span><span class="n">objects</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">properties</span>  <span class="c1"># type: ignore</span>
<a id="__codelineno-0-1145" name="__codelineno-0-1145"></a>
<a id="__codelineno-0-1146" name="__codelineno-0-1146"></a>        <span class="c1"># update the named vectors</span>
<a id="__codelineno-0-1147" name="__codelineno-0-1147"></a>        <span class="k">if</span> <span class="n">named_vectors</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1148" name="__codelineno-0-1148"></a>            <span class="k">for</span> <span class="n">named_vector</span> <span class="ow">in</span> <span class="n">named_vectors</span><span class="p">:</span>
<a id="__codelineno-0-1149" name="__codelineno-0-1149"></a>                <span class="k">for</span> <span class="n">property_named_vector</span> <span class="ow">in</span> <span class="n">properties</span><span class="p">[</span><span class="s2">&quot;named_vectors&quot;</span><span class="p">]:</span>
<a id="__codelineno-0-1150" name="__codelineno-0-1150"></a>                    <span class="k">if</span> <span class="n">property_named_vector</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">named_vector</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]:</span>
<a id="__codelineno-0-1151" name="__codelineno-0-1151"></a>
<a id="__codelineno-0-1152" name="__codelineno-0-1152"></a>                        <span class="k">if</span> <span class="n">named_vector</span><span class="p">[</span><span class="s2">&quot;enabled&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1153" name="__codelineno-0-1153"></a>                            <span class="n">property_named_vector</span><span class="p">[</span><span class="s2">&quot;enabled&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">named_vector</span><span class="p">[</span><span class="s2">&quot;enabled&quot;</span><span class="p">]</span>
<a id="__codelineno-0-1154" name="__codelineno-0-1154"></a>
<a id="__codelineno-0-1155" name="__codelineno-0-1155"></a>                        <span class="k">if</span> <span class="n">named_vector</span><span class="p">[</span><span class="s2">&quot;description&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1156" name="__codelineno-0-1156"></a>                            <span class="n">property_named_vector</span><span class="p">[</span><span class="s2">&quot;description&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">named_vector</span><span class="p">[</span>
<a id="__codelineno-0-1157" name="__codelineno-0-1157"></a>                                <span class="s2">&quot;description&quot;</span>
<a id="__codelineno-0-1158" name="__codelineno-0-1158"></a>                            <span class="p">]</span>
<a id="__codelineno-0-1159" name="__codelineno-0-1159"></a>
<a id="__codelineno-0-1160" name="__codelineno-0-1160"></a>        <span class="c1"># update the summary</span>
<a id="__codelineno-0-1161" name="__codelineno-0-1161"></a>        <span class="k">if</span> <span class="n">summary</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1162" name="__codelineno-0-1162"></a>            <span class="n">properties</span><span class="p">[</span><span class="s2">&quot;summary&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">summary</span>
<a id="__codelineno-0-1163" name="__codelineno-0-1163"></a>
<a id="__codelineno-0-1164" name="__codelineno-0-1164"></a>        <span class="c1"># update the mappings</span>
<a id="__codelineno-0-1165" name="__codelineno-0-1165"></a>        <span class="k">if</span> <span class="n">mappings</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1166" name="__codelineno-0-1166"></a>            <span class="k">if</span> <span class="s2">&quot;table&quot;</span> <span class="ow">in</span> <span class="n">mappings</span><span class="p">:</span>
<a id="__codelineno-0-1167" name="__codelineno-0-1167"></a>                <span class="n">mappings</span><span class="p">[</span><span class="s2">&quot;table&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-1168" name="__codelineno-0-1168"></a>                    <span class="n">field</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]:</span> <span class="n">field</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">properties</span><span class="p">[</span><span class="s2">&quot;fields&quot;</span><span class="p">]</span>
<a id="__codelineno-0-1169" name="__codelineno-0-1169"></a>                <span class="p">}</span>
<a id="__codelineno-0-1170" name="__codelineno-0-1170"></a>
<a id="__codelineno-0-1171" name="__codelineno-0-1171"></a>            <span class="c1"># format all mappings</span>
<a id="__codelineno-0-1172" name="__codelineno-0-1172"></a>            <span class="k">for</span> <span class="n">mapping_type</span><span class="p">,</span> <span class="n">mapping</span> <span class="ow">in</span> <span class="n">mappings</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a id="__codelineno-0-1173" name="__codelineno-0-1173"></a>                <span class="k">if</span> <span class="n">mapping_type</span> <span class="o">==</span> <span class="s2">&quot;table&quot;</span><span class="p">:</span>
<a id="__codelineno-0-1174" name="__codelineno-0-1174"></a>                    <span class="k">continue</span>
<a id="__codelineno-0-1175" name="__codelineno-0-1175"></a>
<a id="__codelineno-0-1176" name="__codelineno-0-1176"></a>                <span class="c1"># check if the mapping_type is valid</span>
<a id="__codelineno-0-1177" name="__codelineno-0-1177"></a>                <span class="k">if</span> <span class="n">mapping_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">rt</span><span class="o">.</span><span class="n">types_dict</span><span class="p">:</span>
<a id="__codelineno-0-1178" name="__codelineno-0-1178"></a>                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<a id="__codelineno-0-1179" name="__codelineno-0-1179"></a>                        <span class="sa">f</span><span class="s2">&quot;Invalid mapping type: </span><span class="si">{</span><span class="n">mapping_type</span><span class="si">}</span><span class="s2">. Valid mapping types are: </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="n">rt</span><span class="o">.</span><span class="n">types_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-1180" name="__codelineno-0-1180"></a>                    <span class="p">)</span>
<a id="__codelineno-0-1181" name="__codelineno-0-1181"></a>
<a id="__codelineno-0-1182" name="__codelineno-0-1182"></a>                <span class="c1"># check if the mapping is valid</span>
<a id="__codelineno-0-1183" name="__codelineno-0-1183"></a>                <span class="k">for</span> <span class="n">field_name</span><span class="p">,</span> <span class="n">field_value</span> <span class="ow">in</span> <span class="n">mapping</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a id="__codelineno-0-1184" name="__codelineno-0-1184"></a>                    <span class="k">if</span> <span class="n">field_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">rt</span><span class="o">.</span><span class="n">types_dict</span><span class="p">[</span><span class="n">mapping_type</span><span class="p">]:</span>
<a id="__codelineno-0-1185" name="__codelineno-0-1185"></a>                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<a id="__codelineno-0-1186" name="__codelineno-0-1186"></a>                            <span class="sa">f</span><span class="s2">&quot;Invalid field name: </span><span class="si">{</span><span class="n">field_name</span><span class="si">}</span><span class="s2"> for mapping type: </span><span class="si">{</span><span class="n">mapping_type</span><span class="si">}</span><span class="s2">. &quot;</span>
<a id="__codelineno-0-1187" name="__codelineno-0-1187"></a>                            <span class="sa">f</span><span class="s2">&quot;Valid fields are: </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="n">rt</span><span class="o">.</span><span class="n">types_dict</span><span class="p">[</span><span class="n">mapping_type</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-1188" name="__codelineno-0-1188"></a>                        <span class="p">)</span>
<a id="__codelineno-0-1189" name="__codelineno-0-1189"></a>
<a id="__codelineno-0-1190" name="__codelineno-0-1190"></a>                <span class="c1"># add empty fields</span>
<a id="__codelineno-0-1191" name="__codelineno-0-1191"></a>                <span class="k">for</span> <span class="n">true_field</span> <span class="ow">in</span> <span class="n">rt</span><span class="o">.</span><span class="n">types_dict</span><span class="p">[</span><span class="n">mapping_type</span><span class="p">]:</span>
<a id="__codelineno-0-1192" name="__codelineno-0-1192"></a>                    <span class="k">if</span> <span class="n">true_field</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">mapping</span><span class="p">:</span>
<a id="__codelineno-0-1193" name="__codelineno-0-1193"></a>                        <span class="n">mapping</span><span class="p">[</span><span class="n">true_field</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
<a id="__codelineno-0-1194" name="__codelineno-0-1194"></a>
<a id="__codelineno-0-1195" name="__codelineno-0-1195"></a>            <span class="n">properties</span><span class="p">[</span><span class="s2">&quot;mappings&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mappings</span>
<a id="__codelineno-0-1196" name="__codelineno-0-1196"></a>
<a id="__codelineno-0-1197" name="__codelineno-0-1197"></a>            <span class="c1"># check if the `conversation_id` field is in the mapping (required for conversation type)</span>
<a id="__codelineno-0-1198" name="__codelineno-0-1198"></a>            <span class="k">if</span> <span class="s2">&quot;conversation&quot;</span> <span class="ow">in</span> <span class="n">mappings</span> <span class="ow">and</span> <span class="p">(</span>
<a id="__codelineno-0-1199" name="__codelineno-0-1199"></a>                <span class="n">mappings</span><span class="p">[</span><span class="s2">&quot;conversation&quot;</span><span class="p">][</span><span class="s2">&quot;conversation_id&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span>
<a id="__codelineno-0-1200" name="__codelineno-0-1200"></a>                <span class="ow">or</span> <span class="n">mappings</span><span class="p">[</span><span class="s2">&quot;conversation&quot;</span><span class="p">][</span><span class="s2">&quot;conversation_id&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span>
<a id="__codelineno-0-1201" name="__codelineno-0-1201"></a>            <span class="p">):</span>
<a id="__codelineno-0-1202" name="__codelineno-0-1202"></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<a id="__codelineno-0-1203" name="__codelineno-0-1203"></a>                    <span class="s2">&quot;Conversation type requires a conversation_id field, but none was found in the mappings for conversation. &quot;</span>
<a id="__codelineno-0-1204" name="__codelineno-0-1204"></a>                <span class="p">)</span>
<a id="__codelineno-0-1205" name="__codelineno-0-1205"></a>
<a id="__codelineno-0-1206" name="__codelineno-0-1206"></a>            <span class="k">if</span> <span class="s2">&quot;conversation&quot;</span> <span class="ow">in</span> <span class="n">mappings</span> <span class="ow">and</span> <span class="p">(</span>
<a id="__codelineno-0-1207" name="__codelineno-0-1207"></a>                <span class="n">mappings</span><span class="p">[</span><span class="s2">&quot;conversation&quot;</span><span class="p">][</span><span class="s2">&quot;message_id&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span>
<a id="__codelineno-0-1208" name="__codelineno-0-1208"></a>                <span class="ow">or</span> <span class="n">mappings</span><span class="p">[</span><span class="s2">&quot;conversation&quot;</span><span class="p">][</span><span class="s2">&quot;message_id&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span>
<a id="__codelineno-0-1209" name="__codelineno-0-1209"></a>            <span class="p">):</span>
<a id="__codelineno-0-1210" name="__codelineno-0-1210"></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<a id="__codelineno-0-1211" name="__codelineno-0-1211"></a>                    <span class="s2">&quot;Conversation type requires a message_id field, but none was found in the mappings for conversation. &quot;</span>
<a id="__codelineno-0-1212" name="__codelineno-0-1212"></a>                <span class="p">)</span>
<a id="__codelineno-0-1213" name="__codelineno-0-1213"></a>
<a id="__codelineno-0-1214" name="__codelineno-0-1214"></a>            <span class="c1"># check if there is a message type as well as conversation</span>
<a id="__codelineno-0-1215" name="__codelineno-0-1215"></a>            <span class="k">if</span> <span class="s2">&quot;message&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">mappings</span> <span class="ow">and</span> <span class="s2">&quot;conversation&quot;</span> <span class="ow">in</span> <span class="n">mappings</span><span class="p">:</span>
<a id="__codelineno-0-1216" name="__codelineno-0-1216"></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<a id="__codelineno-0-1217" name="__codelineno-0-1217"></a>                    <span class="s2">&quot;Conversation type requires message type to also be set as a fallback.&quot;</span>
<a id="__codelineno-0-1218" name="__codelineno-0-1218"></a>                <span class="p">)</span>
<a id="__codelineno-0-1219" name="__codelineno-0-1219"></a>
<a id="__codelineno-0-1220" name="__codelineno-0-1220"></a>        <span class="c1"># update the fields</span>
<a id="__codelineno-0-1221" name="__codelineno-0-1221"></a>        <span class="k">if</span> <span class="n">fields</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1222" name="__codelineno-0-1222"></a>            <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">fields</span><span class="p">:</span>
<a id="__codelineno-0-1223" name="__codelineno-0-1223"></a>                <span class="k">for</span> <span class="n">property_field</span> <span class="ow">in</span> <span class="n">properties</span><span class="p">[</span><span class="s2">&quot;fields&quot;</span><span class="p">]:</span>
<a id="__codelineno-0-1224" name="__codelineno-0-1224"></a>                    <span class="k">if</span> <span class="n">field</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">property_field</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">field</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]:</span>
<a id="__codelineno-0-1225" name="__codelineno-0-1225"></a>                        <span class="n">property_field</span><span class="p">[</span><span class="s2">&quot;description&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">[</span><span class="s2">&quot;description&quot;</span><span class="p">]</span>
<a id="__codelineno-0-1226" name="__codelineno-0-1226"></a>
<a id="__codelineno-0-1227" name="__codelineno-0-1227"></a>        <span class="n">format_dict_to_serialisable</span><span class="p">(</span><span class="n">properties</span><span class="p">)</span>
<a id="__codelineno-0-1228" name="__codelineno-0-1228"></a>
<a id="__codelineno-0-1229" name="__codelineno-0-1229"></a>        <span class="c1"># update the collection</span>
<a id="__codelineno-0-1230" name="__codelineno-0-1230"></a>        <span class="k">await</span> <span class="n">metadata_collection</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">uuid</span><span class="o">=</span><span class="n">uuid</span><span class="p">,</span> <span class="n">properties</span><span class="o">=</span><span class="n">properties</span><span class="p">)</span>
<a id="__codelineno-0-1231" name="__codelineno-0-1231"></a>
<a id="__codelineno-0-1232" name="__codelineno-0-1232"></a>    <span class="k">if</span> <span class="n">close_clients_after_completion</span><span class="p">:</span>
<a id="__codelineno-0-1233" name="__codelineno-0-1233"></a>        <span class="k">await</span> <span class="n">client_manager</span><span class="o">.</span><span class="n">close_clients</span><span class="p">()</span>
<a id="__codelineno-0-1234" name="__codelineno-0-1234"></a>
<a id="__codelineno-0-1235" name="__codelineno-0-1235"></a>    <span class="k">return</span> <span class="n">properties</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="elysia.preprocessing.collection.preprocess" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">preprocess</span><span class="p">(</span><span class="n">collection_names</span><span class="p">,</span> <span class="n">client_manager</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">min_sample_size</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">max_sample_size</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">num_sample_tokens</span><span class="o">=</span><span class="mi">30000</span><span class="p">,</span> <span class="n">settings</span><span class="o">=</span><span class="n">environment_settings</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Preprocess a collection, obtain a LLM-generated summary of the collection,
a set of statistics for each field (such as unique categories), and a set of mappings
from the fields to the frontend-specific fields in Elysia.</p>
<p>In order:
1. Evaluate all the data fields and groups/statistics of the data fields as a whole
2. Write a summary of the collection via an LLM
3. Evaluate what return types are available for this collection
4. For each data field in the collection, evaluate what corresponding entry goes to what field in the return type (mapping)
5. Save as a ELYSIA_METADATA__ collection</p>
<p>Depending on the size of objects in the collection, you can choose the minimum and maximum sample size,
which will be used to create a sample of objects for the LLM to create a collection summary.
If your objects are particularly large, you can set the sample size to be smaller, to use less tokens and speed up the LLM processing.
If your objects are small, you can set the sample size to be larger, to get a more accurate summary.
This is a trade-off between speed/compute and accuracy.</p>
<p>But note that the pre-processing step only needs to be done once for each collection.
The output of this function is cached, so that if you run it again, it will not re-process the collection (unless the force flag is set to True).</p>
<p>This function saves the output into a collection called ELYSIA_METADATA__, which is automatically called by Elysia.
This is saved to whatever Weaviate cluster URL/API key you have configured, or in your environment variables.
You can change this by setting the <code>wcd_url</code> and <code>wcd_api_key</code> in the settings, and pass this Settings object to this function.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>collection_names</code>
            </td>
            <td>
                  <code><span title="str">str</span> | <span title="list">list</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The name(s) of the collections to preprocess.
Can supply either a single string for one collection, or a list of strings for multiple collections.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>client_manager</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="ClientManager (elysia.util.client.ClientManager)" href="../Client/#elysia.util.client.ClientManager">ClientManager</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The client manager to use.
If not provided, a new ClientManager will be created using the environment variables/configured settings.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>min_sample_size</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The minimum number of objects to sample from the collection to evaluate the statistics/summary. Optional, defaults to 10.</p>
              </div>
            </td>
            <td>
                  <code>5</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>max_sample_size</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The maximum number of objects to sample from the collection to evaluate the statistics/summary. Optional, defaults to 20.</p>
              </div>
            </td>
            <td>
                  <code>100</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>num_sample_tokens</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The maximum number of tokens in the sample objects used to evaluate the summary. Optional, defaults to 30000.</p>
              </div>
            </td>
            <td>
                  <code>30000</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>settings</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="Settings (elysia.config.Settings)" href="../Settings/#elysia.config.Settings">Settings</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The settings to use. Optional, defaults to the environment variables/configured settings.</p>
              </div>
            </td>
            <td>
                  <code><span title="elysia.config.settings">settings</span></code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>force</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to force the preprocessor to run even if the collection already exists. Optional, defaults to False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>elysia/preprocessing/collection.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-860">860</a></span>
<span class="normal"><a href="#__codelineno-0-861">861</a></span>
<span class="normal"><a href="#__codelineno-0-862">862</a></span>
<span class="normal"><a href="#__codelineno-0-863">863</a></span>
<span class="normal"><a href="#__codelineno-0-864">864</a></span>
<span class="normal"><a href="#__codelineno-0-865">865</a></span>
<span class="normal"><a href="#__codelineno-0-866">866</a></span>
<span class="normal"><a href="#__codelineno-0-867">867</a></span>
<span class="normal"><a href="#__codelineno-0-868">868</a></span>
<span class="normal"><a href="#__codelineno-0-869">869</a></span>
<span class="normal"><a href="#__codelineno-0-870">870</a></span>
<span class="normal"><a href="#__codelineno-0-871">871</a></span>
<span class="normal"><a href="#__codelineno-0-872">872</a></span>
<span class="normal"><a href="#__codelineno-0-873">873</a></span>
<span class="normal"><a href="#__codelineno-0-874">874</a></span>
<span class="normal"><a href="#__codelineno-0-875">875</a></span>
<span class="normal"><a href="#__codelineno-0-876">876</a></span>
<span class="normal"><a href="#__codelineno-0-877">877</a></span>
<span class="normal"><a href="#__codelineno-0-878">878</a></span>
<span class="normal"><a href="#__codelineno-0-879">879</a></span>
<span class="normal"><a href="#__codelineno-0-880">880</a></span>
<span class="normal"><a href="#__codelineno-0-881">881</a></span>
<span class="normal"><a href="#__codelineno-0-882">882</a></span>
<span class="normal"><a href="#__codelineno-0-883">883</a></span>
<span class="normal"><a href="#__codelineno-0-884">884</a></span>
<span class="normal"><a href="#__codelineno-0-885">885</a></span>
<span class="normal"><a href="#__codelineno-0-886">886</a></span>
<span class="normal"><a href="#__codelineno-0-887">887</a></span>
<span class="normal"><a href="#__codelineno-0-888">888</a></span>
<span class="normal"><a href="#__codelineno-0-889">889</a></span>
<span class="normal"><a href="#__codelineno-0-890">890</a></span>
<span class="normal"><a href="#__codelineno-0-891">891</a></span>
<span class="normal"><a href="#__codelineno-0-892">892</a></span>
<span class="normal"><a href="#__codelineno-0-893">893</a></span>
<span class="normal"><a href="#__codelineno-0-894">894</a></span>
<span class="normal"><a href="#__codelineno-0-895">895</a></span>
<span class="normal"><a href="#__codelineno-0-896">896</a></span>
<span class="normal"><a href="#__codelineno-0-897">897</a></span>
<span class="normal"><a href="#__codelineno-0-898">898</a></span>
<span class="normal"><a href="#__codelineno-0-899">899</a></span>
<span class="normal"><a href="#__codelineno-0-900">900</a></span>
<span class="normal"><a href="#__codelineno-0-901">901</a></span>
<span class="normal"><a href="#__codelineno-0-902">902</a></span>
<span class="normal"><a href="#__codelineno-0-903">903</a></span>
<span class="normal"><a href="#__codelineno-0-904">904</a></span>
<span class="normal"><a href="#__codelineno-0-905">905</a></span>
<span class="normal"><a href="#__codelineno-0-906">906</a></span>
<span class="normal"><a href="#__codelineno-0-907">907</a></span>
<span class="normal"><a href="#__codelineno-0-908">908</a></span>
<span class="normal"><a href="#__codelineno-0-909">909</a></span>
<span class="normal"><a href="#__codelineno-0-910">910</a></span>
<span class="normal"><a href="#__codelineno-0-911">911</a></span>
<span class="normal"><a href="#__codelineno-0-912">912</a></span>
<span class="normal"><a href="#__codelineno-0-913">913</a></span>
<span class="normal"><a href="#__codelineno-0-914">914</a></span>
<span class="normal"><a href="#__codelineno-0-915">915</a></span>
<span class="normal"><a href="#__codelineno-0-916">916</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-860" name="__codelineno-0-860"></a><span class="k">def</span><span class="w"> </span><span class="nf">preprocess</span><span class="p">(</span>
<a id="__codelineno-0-861" name="__codelineno-0-861"></a>    <span class="n">collection_names</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
<a id="__codelineno-0-862" name="__codelineno-0-862"></a>    <span class="n">client_manager</span><span class="p">:</span> <span class="n">ClientManager</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-863" name="__codelineno-0-863"></a>    <span class="n">min_sample_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
<a id="__codelineno-0-864" name="__codelineno-0-864"></a>    <span class="n">max_sample_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>
<a id="__codelineno-0-865" name="__codelineno-0-865"></a>    <span class="n">num_sample_tokens</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">30000</span><span class="p">,</span>
<a id="__codelineno-0-866" name="__codelineno-0-866"></a>    <span class="n">settings</span><span class="p">:</span> <span class="n">Settings</span> <span class="o">=</span> <span class="n">environment_settings</span><span class="p">,</span>
<a id="__codelineno-0-867" name="__codelineno-0-867"></a>    <span class="n">force</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-868" name="__codelineno-0-868"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-869" name="__codelineno-0-869"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-870" name="__codelineno-0-870"></a><span class="sd">    Preprocess a collection, obtain a LLM-generated summary of the collection,</span>
<a id="__codelineno-0-871" name="__codelineno-0-871"></a><span class="sd">    a set of statistics for each field (such as unique categories), and a set of mappings</span>
<a id="__codelineno-0-872" name="__codelineno-0-872"></a><span class="sd">    from the fields to the frontend-specific fields in Elysia.</span>
<a id="__codelineno-0-873" name="__codelineno-0-873"></a>
<a id="__codelineno-0-874" name="__codelineno-0-874"></a><span class="sd">    In order:</span>
<a id="__codelineno-0-875" name="__codelineno-0-875"></a><span class="sd">    1. Evaluate all the data fields and groups/statistics of the data fields as a whole</span>
<a id="__codelineno-0-876" name="__codelineno-0-876"></a><span class="sd">    2. Write a summary of the collection via an LLM</span>
<a id="__codelineno-0-877" name="__codelineno-0-877"></a><span class="sd">    3. Evaluate what return types are available for this collection</span>
<a id="__codelineno-0-878" name="__codelineno-0-878"></a><span class="sd">    4. For each data field in the collection, evaluate what corresponding entry goes to what field in the return type (mapping)</span>
<a id="__codelineno-0-879" name="__codelineno-0-879"></a><span class="sd">    5. Save as a ELYSIA_METADATA__ collection</span>
<a id="__codelineno-0-880" name="__codelineno-0-880"></a>
<a id="__codelineno-0-881" name="__codelineno-0-881"></a><span class="sd">    Depending on the size of objects in the collection, you can choose the minimum and maximum sample size,</span>
<a id="__codelineno-0-882" name="__codelineno-0-882"></a><span class="sd">    which will be used to create a sample of objects for the LLM to create a collection summary.</span>
<a id="__codelineno-0-883" name="__codelineno-0-883"></a><span class="sd">    If your objects are particularly large, you can set the sample size to be smaller, to use less tokens and speed up the LLM processing.</span>
<a id="__codelineno-0-884" name="__codelineno-0-884"></a><span class="sd">    If your objects are small, you can set the sample size to be larger, to get a more accurate summary.</span>
<a id="__codelineno-0-885" name="__codelineno-0-885"></a><span class="sd">    This is a trade-off between speed/compute and accuracy.</span>
<a id="__codelineno-0-886" name="__codelineno-0-886"></a>
<a id="__codelineno-0-887" name="__codelineno-0-887"></a><span class="sd">    But note that the pre-processing step only needs to be done once for each collection.</span>
<a id="__codelineno-0-888" name="__codelineno-0-888"></a><span class="sd">    The output of this function is cached, so that if you run it again, it will not re-process the collection (unless the force flag is set to True).</span>
<a id="__codelineno-0-889" name="__codelineno-0-889"></a>
<a id="__codelineno-0-890" name="__codelineno-0-890"></a><span class="sd">    This function saves the output into a collection called ELYSIA_METADATA__, which is automatically called by Elysia.</span>
<a id="__codelineno-0-891" name="__codelineno-0-891"></a><span class="sd">    This is saved to whatever Weaviate cluster URL/API key you have configured, or in your environment variables.</span>
<a id="__codelineno-0-892" name="__codelineno-0-892"></a><span class="sd">    You can change this by setting the `wcd_url` and `wcd_api_key` in the settings, and pass this Settings object to this function.</span>
<a id="__codelineno-0-893" name="__codelineno-0-893"></a>
<a id="__codelineno-0-894" name="__codelineno-0-894"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-895" name="__codelineno-0-895"></a><span class="sd">        collection_names (str | list[str]): The name(s) of the collections to preprocess.</span>
<a id="__codelineno-0-896" name="__codelineno-0-896"></a><span class="sd">            Can supply either a single string for one collection, or a list of strings for multiple collections.</span>
<a id="__codelineno-0-897" name="__codelineno-0-897"></a><span class="sd">        client_manager (ClientManager): The client manager to use.</span>
<a id="__codelineno-0-898" name="__codelineno-0-898"></a><span class="sd">            If not provided, a new ClientManager will be created using the environment variables/configured settings.</span>
<a id="__codelineno-0-899" name="__codelineno-0-899"></a><span class="sd">        min_sample_size (int): The minimum number of objects to sample from the collection to evaluate the statistics/summary. Optional, defaults to 10.</span>
<a id="__codelineno-0-900" name="__codelineno-0-900"></a><span class="sd">        max_sample_size (int): The maximum number of objects to sample from the collection to evaluate the statistics/summary. Optional, defaults to 20.</span>
<a id="__codelineno-0-901" name="__codelineno-0-901"></a><span class="sd">        num_sample_tokens (int): The maximum number of tokens in the sample objects used to evaluate the summary. Optional, defaults to 30000.</span>
<a id="__codelineno-0-902" name="__codelineno-0-902"></a><span class="sd">        settings (Settings): The settings to use. Optional, defaults to the environment variables/configured settings.</span>
<a id="__codelineno-0-903" name="__codelineno-0-903"></a><span class="sd">        force (bool): Whether to force the preprocessor to run even if the collection already exists. Optional, defaults to False.</span>
<a id="__codelineno-0-904" name="__codelineno-0-904"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-905" name="__codelineno-0-905"></a>
<a id="__codelineno-0-906" name="__codelineno-0-906"></a>    <span class="n">asyncio_run</span><span class="p">(</span>
<a id="__codelineno-0-907" name="__codelineno-0-907"></a>        <span class="n">_preprocess_async</span><span class="p">(</span>
<a id="__codelineno-0-908" name="__codelineno-0-908"></a>            <span class="n">collection_names</span><span class="p">,</span>
<a id="__codelineno-0-909" name="__codelineno-0-909"></a>            <span class="n">client_manager</span><span class="p">,</span>
<a id="__codelineno-0-910" name="__codelineno-0-910"></a>            <span class="n">min_sample_size</span><span class="p">,</span>
<a id="__codelineno-0-911" name="__codelineno-0-911"></a>            <span class="n">max_sample_size</span><span class="p">,</span>
<a id="__codelineno-0-912" name="__codelineno-0-912"></a>            <span class="n">num_sample_tokens</span><span class="p">,</span>
<a id="__codelineno-0-913" name="__codelineno-0-913"></a>            <span class="n">settings</span><span class="p">,</span>
<a id="__codelineno-0-914" name="__codelineno-0-914"></a>            <span class="n">force</span><span class="p">,</span>
<a id="__codelineno-0-915" name="__codelineno-0-915"></a>        <span class="p">)</span>
<a id="__codelineno-0-916" name="__codelineno-0-916"></a>    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="elysia.preprocessing.collection.preprocess_async" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">preprocess_async</span><span class="p">(</span><span class="n">collection_name</span><span class="p">,</span> <span class="n">client_manager</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">min_sample_size</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">max_sample_size</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">num_sample_tokens</span><span class="o">=</span><span class="mi">30000</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">percentage_correct_threshold</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">settings</span><span class="o">=</span><span class="n">environment_settings</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h2>


    <div class="doc doc-contents ">

        <p>Preprocess a collection, obtain a LLM-generated summary of the collection,
a set of statistics for each field (such as unique categories), and a set of mappings
from the fields to the frontend-specific fields in Elysia.</p>
<p>In order:</p>
<ol>
<li>Evaluate all the data fields and groups/statistics of the data fields as a whole</li>
<li>Write a summary of the collection via an LLM</li>
<li>Evaluate what return types are available for this collection</li>
<li>For each data field in the collection, evaluate what corresponding entry goes to what field in the return type (mapping)</li>
<li>Save as a ELYSIA_METADATA__ collection</li>
</ol>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>collection_name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The name of the collection to preprocess.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>client_manager</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="ClientManager (elysia.util.client.ClientManager)" href="../Client/#elysia.util.client.ClientManager">ClientManager</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The client manager to use.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>min_sample_size</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The minimum number of objects to sample from the collection to evaluate the statistics/summary. Optional, defaults to 10.</p>
              </div>
            </td>
            <td>
                  <code>10</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>max_sample_size</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The maximum number of objects to sample from the collection to evaluate the statistics/summary. Optional, defaults to 20.</p>
              </div>
            </td>
            <td>
                  <code>20</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>num_sample_tokens</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The number of tokens to approximately sample from the collection to evaluate the summary.
The preprocessor will aim to use this many tokens in the sample objects to evaluate the summary.
But will not exceed the maximum number of objects specified by <code>max_sample_size</code>, and always use at least <code>min_sample_size</code> objects.</p>
              </div>
            </td>
            <td>
                  <code>30000</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>force</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to force the preprocessor to run even if the collection already exists. Optional, defaults to False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>threshold_for_missing_fields</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The threshold for the number of missing fields in the data mapping. Optional, defaults to 0.1.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>settings</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="Settings (elysia.config.Settings)" href="../Settings/#elysia.config.Settings">Settings</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The settings to use. Optional, defaults to the environment variables/configured settings.</p>
              </div>
            </td>
            <td>
                  <code><span title="elysia.config.settings">settings</span></code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.AsyncGenerator">AsyncGenerator</span>[<span title="dict">dict</span>, None]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>AsyncGenerator[dict, None]: A generator that yields dictionaries with the status updates and progress of the preprocessor.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>elysia/preprocessing/collection.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-367">367</a></span>
<span class="normal"><a href="#__codelineno-0-368">368</a></span>
<span class="normal"><a href="#__codelineno-0-369">369</a></span>
<span class="normal"><a href="#__codelineno-0-370">370</a></span>
<span class="normal"><a href="#__codelineno-0-371">371</a></span>
<span class="normal"><a href="#__codelineno-0-372">372</a></span>
<span class="normal"><a href="#__codelineno-0-373">373</a></span>
<span class="normal"><a href="#__codelineno-0-374">374</a></span>
<span class="normal"><a href="#__codelineno-0-375">375</a></span>
<span class="normal"><a href="#__codelineno-0-376">376</a></span>
<span class="normal"><a href="#__codelineno-0-377">377</a></span>
<span class="normal"><a href="#__codelineno-0-378">378</a></span>
<span class="normal"><a href="#__codelineno-0-379">379</a></span>
<span class="normal"><a href="#__codelineno-0-380">380</a></span>
<span class="normal"><a href="#__codelineno-0-381">381</a></span>
<span class="normal"><a href="#__codelineno-0-382">382</a></span>
<span class="normal"><a href="#__codelineno-0-383">383</a></span>
<span class="normal"><a href="#__codelineno-0-384">384</a></span>
<span class="normal"><a href="#__codelineno-0-385">385</a></span>
<span class="normal"><a href="#__codelineno-0-386">386</a></span>
<span class="normal"><a href="#__codelineno-0-387">387</a></span>
<span class="normal"><a href="#__codelineno-0-388">388</a></span>
<span class="normal"><a href="#__codelineno-0-389">389</a></span>
<span class="normal"><a href="#__codelineno-0-390">390</a></span>
<span class="normal"><a href="#__codelineno-0-391">391</a></span>
<span class="normal"><a href="#__codelineno-0-392">392</a></span>
<span class="normal"><a href="#__codelineno-0-393">393</a></span>
<span class="normal"><a href="#__codelineno-0-394">394</a></span>
<span class="normal"><a href="#__codelineno-0-395">395</a></span>
<span class="normal"><a href="#__codelineno-0-396">396</a></span>
<span class="normal"><a href="#__codelineno-0-397">397</a></span>
<span class="normal"><a href="#__codelineno-0-398">398</a></span>
<span class="normal"><a href="#__codelineno-0-399">399</a></span>
<span class="normal"><a href="#__codelineno-0-400">400</a></span>
<span class="normal"><a href="#__codelineno-0-401">401</a></span>
<span class="normal"><a href="#__codelineno-0-402">402</a></span>
<span class="normal"><a href="#__codelineno-0-403">403</a></span>
<span class="normal"><a href="#__codelineno-0-404">404</a></span>
<span class="normal"><a href="#__codelineno-0-405">405</a></span>
<span class="normal"><a href="#__codelineno-0-406">406</a></span>
<span class="normal"><a href="#__codelineno-0-407">407</a></span>
<span class="normal"><a href="#__codelineno-0-408">408</a></span>
<span class="normal"><a href="#__codelineno-0-409">409</a></span>
<span class="normal"><a href="#__codelineno-0-410">410</a></span>
<span class="normal"><a href="#__codelineno-0-411">411</a></span>
<span class="normal"><a href="#__codelineno-0-412">412</a></span>
<span class="normal"><a href="#__codelineno-0-413">413</a></span>
<span class="normal"><a href="#__codelineno-0-414">414</a></span>
<span class="normal"><a href="#__codelineno-0-415">415</a></span>
<span class="normal"><a href="#__codelineno-0-416">416</a></span>
<span class="normal"><a href="#__codelineno-0-417">417</a></span>
<span class="normal"><a href="#__codelineno-0-418">418</a></span>
<span class="normal"><a href="#__codelineno-0-419">419</a></span>
<span class="normal"><a href="#__codelineno-0-420">420</a></span>
<span class="normal"><a href="#__codelineno-0-421">421</a></span>
<span class="normal"><a href="#__codelineno-0-422">422</a></span>
<span class="normal"><a href="#__codelineno-0-423">423</a></span>
<span class="normal"><a href="#__codelineno-0-424">424</a></span>
<span class="normal"><a href="#__codelineno-0-425">425</a></span>
<span class="normal"><a href="#__codelineno-0-426">426</a></span>
<span class="normal"><a href="#__codelineno-0-427">427</a></span>
<span class="normal"><a href="#__codelineno-0-428">428</a></span>
<span class="normal"><a href="#__codelineno-0-429">429</a></span>
<span class="normal"><a href="#__codelineno-0-430">430</a></span>
<span class="normal"><a href="#__codelineno-0-431">431</a></span>
<span class="normal"><a href="#__codelineno-0-432">432</a></span>
<span class="normal"><a href="#__codelineno-0-433">433</a></span>
<span class="normal"><a href="#__codelineno-0-434">434</a></span>
<span class="normal"><a href="#__codelineno-0-435">435</a></span>
<span class="normal"><a href="#__codelineno-0-436">436</a></span>
<span class="normal"><a href="#__codelineno-0-437">437</a></span>
<span class="normal"><a href="#__codelineno-0-438">438</a></span>
<span class="normal"><a href="#__codelineno-0-439">439</a></span>
<span class="normal"><a href="#__codelineno-0-440">440</a></span>
<span class="normal"><a href="#__codelineno-0-441">441</a></span>
<span class="normal"><a href="#__codelineno-0-442">442</a></span>
<span class="normal"><a href="#__codelineno-0-443">443</a></span>
<span class="normal"><a href="#__codelineno-0-444">444</a></span>
<span class="normal"><a href="#__codelineno-0-445">445</a></span>
<span class="normal"><a href="#__codelineno-0-446">446</a></span>
<span class="normal"><a href="#__codelineno-0-447">447</a></span>
<span class="normal"><a href="#__codelineno-0-448">448</a></span>
<span class="normal"><a href="#__codelineno-0-449">449</a></span>
<span class="normal"><a href="#__codelineno-0-450">450</a></span>
<span class="normal"><a href="#__codelineno-0-451">451</a></span>
<span class="normal"><a href="#__codelineno-0-452">452</a></span>
<span class="normal"><a href="#__codelineno-0-453">453</a></span>
<span class="normal"><a href="#__codelineno-0-454">454</a></span>
<span class="normal"><a href="#__codelineno-0-455">455</a></span>
<span class="normal"><a href="#__codelineno-0-456">456</a></span>
<span class="normal"><a href="#__codelineno-0-457">457</a></span>
<span class="normal"><a href="#__codelineno-0-458">458</a></span>
<span class="normal"><a href="#__codelineno-0-459">459</a></span>
<span class="normal"><a href="#__codelineno-0-460">460</a></span>
<span class="normal"><a href="#__codelineno-0-461">461</a></span>
<span class="normal"><a href="#__codelineno-0-462">462</a></span>
<span class="normal"><a href="#__codelineno-0-463">463</a></span>
<span class="normal"><a href="#__codelineno-0-464">464</a></span>
<span class="normal"><a href="#__codelineno-0-465">465</a></span>
<span class="normal"><a href="#__codelineno-0-466">466</a></span>
<span class="normal"><a href="#__codelineno-0-467">467</a></span>
<span class="normal"><a href="#__codelineno-0-468">468</a></span>
<span class="normal"><a href="#__codelineno-0-469">469</a></span>
<span class="normal"><a href="#__codelineno-0-470">470</a></span>
<span class="normal"><a href="#__codelineno-0-471">471</a></span>
<span class="normal"><a href="#__codelineno-0-472">472</a></span>
<span class="normal"><a href="#__codelineno-0-473">473</a></span>
<span class="normal"><a href="#__codelineno-0-474">474</a></span>
<span class="normal"><a href="#__codelineno-0-475">475</a></span>
<span class="normal"><a href="#__codelineno-0-476">476</a></span>
<span class="normal"><a href="#__codelineno-0-477">477</a></span>
<span class="normal"><a href="#__codelineno-0-478">478</a></span>
<span class="normal"><a href="#__codelineno-0-479">479</a></span>
<span class="normal"><a href="#__codelineno-0-480">480</a></span>
<span class="normal"><a href="#__codelineno-0-481">481</a></span>
<span class="normal"><a href="#__codelineno-0-482">482</a></span>
<span class="normal"><a href="#__codelineno-0-483">483</a></span>
<span class="normal"><a href="#__codelineno-0-484">484</a></span>
<span class="normal"><a href="#__codelineno-0-485">485</a></span>
<span class="normal"><a href="#__codelineno-0-486">486</a></span>
<span class="normal"><a href="#__codelineno-0-487">487</a></span>
<span class="normal"><a href="#__codelineno-0-488">488</a></span>
<span class="normal"><a href="#__codelineno-0-489">489</a></span>
<span class="normal"><a href="#__codelineno-0-490">490</a></span>
<span class="normal"><a href="#__codelineno-0-491">491</a></span>
<span class="normal"><a href="#__codelineno-0-492">492</a></span>
<span class="normal"><a href="#__codelineno-0-493">493</a></span>
<span class="normal"><a href="#__codelineno-0-494">494</a></span>
<span class="normal"><a href="#__codelineno-0-495">495</a></span>
<span class="normal"><a href="#__codelineno-0-496">496</a></span>
<span class="normal"><a href="#__codelineno-0-497">497</a></span>
<span class="normal"><a href="#__codelineno-0-498">498</a></span>
<span class="normal"><a href="#__codelineno-0-499">499</a></span>
<span class="normal"><a href="#__codelineno-0-500">500</a></span>
<span class="normal"><a href="#__codelineno-0-501">501</a></span>
<span class="normal"><a href="#__codelineno-0-502">502</a></span>
<span class="normal"><a href="#__codelineno-0-503">503</a></span>
<span class="normal"><a href="#__codelineno-0-504">504</a></span>
<span class="normal"><a href="#__codelineno-0-505">505</a></span>
<span class="normal"><a href="#__codelineno-0-506">506</a></span>
<span class="normal"><a href="#__codelineno-0-507">507</a></span>
<span class="normal"><a href="#__codelineno-0-508">508</a></span>
<span class="normal"><a href="#__codelineno-0-509">509</a></span>
<span class="normal"><a href="#__codelineno-0-510">510</a></span>
<span class="normal"><a href="#__codelineno-0-511">511</a></span>
<span class="normal"><a href="#__codelineno-0-512">512</a></span>
<span class="normal"><a href="#__codelineno-0-513">513</a></span>
<span class="normal"><a href="#__codelineno-0-514">514</a></span>
<span class="normal"><a href="#__codelineno-0-515">515</a></span>
<span class="normal"><a href="#__codelineno-0-516">516</a></span>
<span class="normal"><a href="#__codelineno-0-517">517</a></span>
<span class="normal"><a href="#__codelineno-0-518">518</a></span>
<span class="normal"><a href="#__codelineno-0-519">519</a></span>
<span class="normal"><a href="#__codelineno-0-520">520</a></span>
<span class="normal"><a href="#__codelineno-0-521">521</a></span>
<span class="normal"><a href="#__codelineno-0-522">522</a></span>
<span class="normal"><a href="#__codelineno-0-523">523</a></span>
<span class="normal"><a href="#__codelineno-0-524">524</a></span>
<span class="normal"><a href="#__codelineno-0-525">525</a></span>
<span class="normal"><a href="#__codelineno-0-526">526</a></span>
<span class="normal"><a href="#__codelineno-0-527">527</a></span>
<span class="normal"><a href="#__codelineno-0-528">528</a></span>
<span class="normal"><a href="#__codelineno-0-529">529</a></span>
<span class="normal"><a href="#__codelineno-0-530">530</a></span>
<span class="normal"><a href="#__codelineno-0-531">531</a></span>
<span class="normal"><a href="#__codelineno-0-532">532</a></span>
<span class="normal"><a href="#__codelineno-0-533">533</a></span>
<span class="normal"><a href="#__codelineno-0-534">534</a></span>
<span class="normal"><a href="#__codelineno-0-535">535</a></span>
<span class="normal"><a href="#__codelineno-0-536">536</a></span>
<span class="normal"><a href="#__codelineno-0-537">537</a></span>
<span class="normal"><a href="#__codelineno-0-538">538</a></span>
<span class="normal"><a href="#__codelineno-0-539">539</a></span>
<span class="normal"><a href="#__codelineno-0-540">540</a></span>
<span class="normal"><a href="#__codelineno-0-541">541</a></span>
<span class="normal"><a href="#__codelineno-0-542">542</a></span>
<span class="normal"><a href="#__codelineno-0-543">543</a></span>
<span class="normal"><a href="#__codelineno-0-544">544</a></span>
<span class="normal"><a href="#__codelineno-0-545">545</a></span>
<span class="normal"><a href="#__codelineno-0-546">546</a></span>
<span class="normal"><a href="#__codelineno-0-547">547</a></span>
<span class="normal"><a href="#__codelineno-0-548">548</a></span>
<span class="normal"><a href="#__codelineno-0-549">549</a></span>
<span class="normal"><a href="#__codelineno-0-550">550</a></span>
<span class="normal"><a href="#__codelineno-0-551">551</a></span>
<span class="normal"><a href="#__codelineno-0-552">552</a></span>
<span class="normal"><a href="#__codelineno-0-553">553</a></span>
<span class="normal"><a href="#__codelineno-0-554">554</a></span>
<span class="normal"><a href="#__codelineno-0-555">555</a></span>
<span class="normal"><a href="#__codelineno-0-556">556</a></span>
<span class="normal"><a href="#__codelineno-0-557">557</a></span>
<span class="normal"><a href="#__codelineno-0-558">558</a></span>
<span class="normal"><a href="#__codelineno-0-559">559</a></span>
<span class="normal"><a href="#__codelineno-0-560">560</a></span>
<span class="normal"><a href="#__codelineno-0-561">561</a></span>
<span class="normal"><a href="#__codelineno-0-562">562</a></span>
<span class="normal"><a href="#__codelineno-0-563">563</a></span>
<span class="normal"><a href="#__codelineno-0-564">564</a></span>
<span class="normal"><a href="#__codelineno-0-565">565</a></span>
<span class="normal"><a href="#__codelineno-0-566">566</a></span>
<span class="normal"><a href="#__codelineno-0-567">567</a></span>
<span class="normal"><a href="#__codelineno-0-568">568</a></span>
<span class="normal"><a href="#__codelineno-0-569">569</a></span>
<span class="normal"><a href="#__codelineno-0-570">570</a></span>
<span class="normal"><a href="#__codelineno-0-571">571</a></span>
<span class="normal"><a href="#__codelineno-0-572">572</a></span>
<span class="normal"><a href="#__codelineno-0-573">573</a></span>
<span class="normal"><a href="#__codelineno-0-574">574</a></span>
<span class="normal"><a href="#__codelineno-0-575">575</a></span>
<span class="normal"><a href="#__codelineno-0-576">576</a></span>
<span class="normal"><a href="#__codelineno-0-577">577</a></span>
<span class="normal"><a href="#__codelineno-0-578">578</a></span>
<span class="normal"><a href="#__codelineno-0-579">579</a></span>
<span class="normal"><a href="#__codelineno-0-580">580</a></span>
<span class="normal"><a href="#__codelineno-0-581">581</a></span>
<span class="normal"><a href="#__codelineno-0-582">582</a></span>
<span class="normal"><a href="#__codelineno-0-583">583</a></span>
<span class="normal"><a href="#__codelineno-0-584">584</a></span>
<span class="normal"><a href="#__codelineno-0-585">585</a></span>
<span class="normal"><a href="#__codelineno-0-586">586</a></span>
<span class="normal"><a href="#__codelineno-0-587">587</a></span>
<span class="normal"><a href="#__codelineno-0-588">588</a></span>
<span class="normal"><a href="#__codelineno-0-589">589</a></span>
<span class="normal"><a href="#__codelineno-0-590">590</a></span>
<span class="normal"><a href="#__codelineno-0-591">591</a></span>
<span class="normal"><a href="#__codelineno-0-592">592</a></span>
<span class="normal"><a href="#__codelineno-0-593">593</a></span>
<span class="normal"><a href="#__codelineno-0-594">594</a></span>
<span class="normal"><a href="#__codelineno-0-595">595</a></span>
<span class="normal"><a href="#__codelineno-0-596">596</a></span>
<span class="normal"><a href="#__codelineno-0-597">597</a></span>
<span class="normal"><a href="#__codelineno-0-598">598</a></span>
<span class="normal"><a href="#__codelineno-0-599">599</a></span>
<span class="normal"><a href="#__codelineno-0-600">600</a></span>
<span class="normal"><a href="#__codelineno-0-601">601</a></span>
<span class="normal"><a href="#__codelineno-0-602">602</a></span>
<span class="normal"><a href="#__codelineno-0-603">603</a></span>
<span class="normal"><a href="#__codelineno-0-604">604</a></span>
<span class="normal"><a href="#__codelineno-0-605">605</a></span>
<span class="normal"><a href="#__codelineno-0-606">606</a></span>
<span class="normal"><a href="#__codelineno-0-607">607</a></span>
<span class="normal"><a href="#__codelineno-0-608">608</a></span>
<span class="normal"><a href="#__codelineno-0-609">609</a></span>
<span class="normal"><a href="#__codelineno-0-610">610</a></span>
<span class="normal"><a href="#__codelineno-0-611">611</a></span>
<span class="normal"><a href="#__codelineno-0-612">612</a></span>
<span class="normal"><a href="#__codelineno-0-613">613</a></span>
<span class="normal"><a href="#__codelineno-0-614">614</a></span>
<span class="normal"><a href="#__codelineno-0-615">615</a></span>
<span class="normal"><a href="#__codelineno-0-616">616</a></span>
<span class="normal"><a href="#__codelineno-0-617">617</a></span>
<span class="normal"><a href="#__codelineno-0-618">618</a></span>
<span class="normal"><a href="#__codelineno-0-619">619</a></span>
<span class="normal"><a href="#__codelineno-0-620">620</a></span>
<span class="normal"><a href="#__codelineno-0-621">621</a></span>
<span class="normal"><a href="#__codelineno-0-622">622</a></span>
<span class="normal"><a href="#__codelineno-0-623">623</a></span>
<span class="normal"><a href="#__codelineno-0-624">624</a></span>
<span class="normal"><a href="#__codelineno-0-625">625</a></span>
<span class="normal"><a href="#__codelineno-0-626">626</a></span>
<span class="normal"><a href="#__codelineno-0-627">627</a></span>
<span class="normal"><a href="#__codelineno-0-628">628</a></span>
<span class="normal"><a href="#__codelineno-0-629">629</a></span>
<span class="normal"><a href="#__codelineno-0-630">630</a></span>
<span class="normal"><a href="#__codelineno-0-631">631</a></span>
<span class="normal"><a href="#__codelineno-0-632">632</a></span>
<span class="normal"><a href="#__codelineno-0-633">633</a></span>
<span class="normal"><a href="#__codelineno-0-634">634</a></span>
<span class="normal"><a href="#__codelineno-0-635">635</a></span>
<span class="normal"><a href="#__codelineno-0-636">636</a></span>
<span class="normal"><a href="#__codelineno-0-637">637</a></span>
<span class="normal"><a href="#__codelineno-0-638">638</a></span>
<span class="normal"><a href="#__codelineno-0-639">639</a></span>
<span class="normal"><a href="#__codelineno-0-640">640</a></span>
<span class="normal"><a href="#__codelineno-0-641">641</a></span>
<span class="normal"><a href="#__codelineno-0-642">642</a></span>
<span class="normal"><a href="#__codelineno-0-643">643</a></span>
<span class="normal"><a href="#__codelineno-0-644">644</a></span>
<span class="normal"><a href="#__codelineno-0-645">645</a></span>
<span class="normal"><a href="#__codelineno-0-646">646</a></span>
<span class="normal"><a href="#__codelineno-0-647">647</a></span>
<span class="normal"><a href="#__codelineno-0-648">648</a></span>
<span class="normal"><a href="#__codelineno-0-649">649</a></span>
<span class="normal"><a href="#__codelineno-0-650">650</a></span>
<span class="normal"><a href="#__codelineno-0-651">651</a></span>
<span class="normal"><a href="#__codelineno-0-652">652</a></span>
<span class="normal"><a href="#__codelineno-0-653">653</a></span>
<span class="normal"><a href="#__codelineno-0-654">654</a></span>
<span class="normal"><a href="#__codelineno-0-655">655</a></span>
<span class="normal"><a href="#__codelineno-0-656">656</a></span>
<span class="normal"><a href="#__codelineno-0-657">657</a></span>
<span class="normal"><a href="#__codelineno-0-658">658</a></span>
<span class="normal"><a href="#__codelineno-0-659">659</a></span>
<span class="normal"><a href="#__codelineno-0-660">660</a></span>
<span class="normal"><a href="#__codelineno-0-661">661</a></span>
<span class="normal"><a href="#__codelineno-0-662">662</a></span>
<span class="normal"><a href="#__codelineno-0-663">663</a></span>
<span class="normal"><a href="#__codelineno-0-664">664</a></span>
<span class="normal"><a href="#__codelineno-0-665">665</a></span>
<span class="normal"><a href="#__codelineno-0-666">666</a></span>
<span class="normal"><a href="#__codelineno-0-667">667</a></span>
<span class="normal"><a href="#__codelineno-0-668">668</a></span>
<span class="normal"><a href="#__codelineno-0-669">669</a></span>
<span class="normal"><a href="#__codelineno-0-670">670</a></span>
<span class="normal"><a href="#__codelineno-0-671">671</a></span>
<span class="normal"><a href="#__codelineno-0-672">672</a></span>
<span class="normal"><a href="#__codelineno-0-673">673</a></span>
<span class="normal"><a href="#__codelineno-0-674">674</a></span>
<span class="normal"><a href="#__codelineno-0-675">675</a></span>
<span class="normal"><a href="#__codelineno-0-676">676</a></span>
<span class="normal"><a href="#__codelineno-0-677">677</a></span>
<span class="normal"><a href="#__codelineno-0-678">678</a></span>
<span class="normal"><a href="#__codelineno-0-679">679</a></span>
<span class="normal"><a href="#__codelineno-0-680">680</a></span>
<span class="normal"><a href="#__codelineno-0-681">681</a></span>
<span class="normal"><a href="#__codelineno-0-682">682</a></span>
<span class="normal"><a href="#__codelineno-0-683">683</a></span>
<span class="normal"><a href="#__codelineno-0-684">684</a></span>
<span class="normal"><a href="#__codelineno-0-685">685</a></span>
<span class="normal"><a href="#__codelineno-0-686">686</a></span>
<span class="normal"><a href="#__codelineno-0-687">687</a></span>
<span class="normal"><a href="#__codelineno-0-688">688</a></span>
<span class="normal"><a href="#__codelineno-0-689">689</a></span>
<span class="normal"><a href="#__codelineno-0-690">690</a></span>
<span class="normal"><a href="#__codelineno-0-691">691</a></span>
<span class="normal"><a href="#__codelineno-0-692">692</a></span>
<span class="normal"><a href="#__codelineno-0-693">693</a></span>
<span class="normal"><a href="#__codelineno-0-694">694</a></span>
<span class="normal"><a href="#__codelineno-0-695">695</a></span>
<span class="normal"><a href="#__codelineno-0-696">696</a></span>
<span class="normal"><a href="#__codelineno-0-697">697</a></span>
<span class="normal"><a href="#__codelineno-0-698">698</a></span>
<span class="normal"><a href="#__codelineno-0-699">699</a></span>
<span class="normal"><a href="#__codelineno-0-700">700</a></span>
<span class="normal"><a href="#__codelineno-0-701">701</a></span>
<span class="normal"><a href="#__codelineno-0-702">702</a></span>
<span class="normal"><a href="#__codelineno-0-703">703</a></span>
<span class="normal"><a href="#__codelineno-0-704">704</a></span>
<span class="normal"><a href="#__codelineno-0-705">705</a></span>
<span class="normal"><a href="#__codelineno-0-706">706</a></span>
<span class="normal"><a href="#__codelineno-0-707">707</a></span>
<span class="normal"><a href="#__codelineno-0-708">708</a></span>
<span class="normal"><a href="#__codelineno-0-709">709</a></span>
<span class="normal"><a href="#__codelineno-0-710">710</a></span>
<span class="normal"><a href="#__codelineno-0-711">711</a></span>
<span class="normal"><a href="#__codelineno-0-712">712</a></span>
<span class="normal"><a href="#__codelineno-0-713">713</a></span>
<span class="normal"><a href="#__codelineno-0-714">714</a></span>
<span class="normal"><a href="#__codelineno-0-715">715</a></span>
<span class="normal"><a href="#__codelineno-0-716">716</a></span>
<span class="normal"><a href="#__codelineno-0-717">717</a></span>
<span class="normal"><a href="#__codelineno-0-718">718</a></span>
<span class="normal"><a href="#__codelineno-0-719">719</a></span>
<span class="normal"><a href="#__codelineno-0-720">720</a></span>
<span class="normal"><a href="#__codelineno-0-721">721</a></span>
<span class="normal"><a href="#__codelineno-0-722">722</a></span>
<span class="normal"><a href="#__codelineno-0-723">723</a></span>
<span class="normal"><a href="#__codelineno-0-724">724</a></span>
<span class="normal"><a href="#__codelineno-0-725">725</a></span>
<span class="normal"><a href="#__codelineno-0-726">726</a></span>
<span class="normal"><a href="#__codelineno-0-727">727</a></span>
<span class="normal"><a href="#__codelineno-0-728">728</a></span>
<span class="normal"><a href="#__codelineno-0-729">729</a></span>
<span class="normal"><a href="#__codelineno-0-730">730</a></span>
<span class="normal"><a href="#__codelineno-0-731">731</a></span>
<span class="normal"><a href="#__codelineno-0-732">732</a></span>
<span class="normal"><a href="#__codelineno-0-733">733</a></span>
<span class="normal"><a href="#__codelineno-0-734">734</a></span>
<span class="normal"><a href="#__codelineno-0-735">735</a></span>
<span class="normal"><a href="#__codelineno-0-736">736</a></span>
<span class="normal"><a href="#__codelineno-0-737">737</a></span>
<span class="normal"><a href="#__codelineno-0-738">738</a></span>
<span class="normal"><a href="#__codelineno-0-739">739</a></span>
<span class="normal"><a href="#__codelineno-0-740">740</a></span>
<span class="normal"><a href="#__codelineno-0-741">741</a></span>
<span class="normal"><a href="#__codelineno-0-742">742</a></span>
<span class="normal"><a href="#__codelineno-0-743">743</a></span>
<span class="normal"><a href="#__codelineno-0-744">744</a></span>
<span class="normal"><a href="#__codelineno-0-745">745</a></span>
<span class="normal"><a href="#__codelineno-0-746">746</a></span>
<span class="normal"><a href="#__codelineno-0-747">747</a></span>
<span class="normal"><a href="#__codelineno-0-748">748</a></span>
<span class="normal"><a href="#__codelineno-0-749">749</a></span>
<span class="normal"><a href="#__codelineno-0-750">750</a></span>
<span class="normal"><a href="#__codelineno-0-751">751</a></span>
<span class="normal"><a href="#__codelineno-0-752">752</a></span>
<span class="normal"><a href="#__codelineno-0-753">753</a></span>
<span class="normal"><a href="#__codelineno-0-754">754</a></span>
<span class="normal"><a href="#__codelineno-0-755">755</a></span>
<span class="normal"><a href="#__codelineno-0-756">756</a></span>
<span class="normal"><a href="#__codelineno-0-757">757</a></span>
<span class="normal"><a href="#__codelineno-0-758">758</a></span>
<span class="normal"><a href="#__codelineno-0-759">759</a></span>
<span class="normal"><a href="#__codelineno-0-760">760</a></span>
<span class="normal"><a href="#__codelineno-0-761">761</a></span>
<span class="normal"><a href="#__codelineno-0-762">762</a></span>
<span class="normal"><a href="#__codelineno-0-763">763</a></span>
<span class="normal"><a href="#__codelineno-0-764">764</a></span>
<span class="normal"><a href="#__codelineno-0-765">765</a></span>
<span class="normal"><a href="#__codelineno-0-766">766</a></span>
<span class="normal"><a href="#__codelineno-0-767">767</a></span>
<span class="normal"><a href="#__codelineno-0-768">768</a></span>
<span class="normal"><a href="#__codelineno-0-769">769</a></span>
<span class="normal"><a href="#__codelineno-0-770">770</a></span>
<span class="normal"><a href="#__codelineno-0-771">771</a></span>
<span class="normal"><a href="#__codelineno-0-772">772</a></span>
<span class="normal"><a href="#__codelineno-0-773">773</a></span>
<span class="normal"><a href="#__codelineno-0-774">774</a></span>
<span class="normal"><a href="#__codelineno-0-775">775</a></span>
<span class="normal"><a href="#__codelineno-0-776">776</a></span>
<span class="normal"><a href="#__codelineno-0-777">777</a></span>
<span class="normal"><a href="#__codelineno-0-778">778</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-367" name="__codelineno-0-367"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">preprocess_async</span><span class="p">(</span>
<a id="__codelineno-0-368" name="__codelineno-0-368"></a>    <span class="n">collection_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-369" name="__codelineno-0-369"></a>    <span class="n">client_manager</span><span class="p">:</span> <span class="n">ClientManager</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-370" name="__codelineno-0-370"></a>    <span class="n">min_sample_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
<a id="__codelineno-0-371" name="__codelineno-0-371"></a>    <span class="n">max_sample_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">20</span><span class="p">,</span>
<a id="__codelineno-0-372" name="__codelineno-0-372"></a>    <span class="n">num_sample_tokens</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">30000</span><span class="p">,</span>
<a id="__codelineno-0-373" name="__codelineno-0-373"></a>    <span class="n">force</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-374" name="__codelineno-0-374"></a>    <span class="n">percentage_correct_threshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.3</span><span class="p">,</span>
<a id="__codelineno-0-375" name="__codelineno-0-375"></a>    <span class="n">settings</span><span class="p">:</span> <span class="n">Settings</span> <span class="o">=</span> <span class="n">environment_settings</span><span class="p">,</span>
<a id="__codelineno-0-376" name="__codelineno-0-376"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AsyncGenerator</span><span class="p">[</span><span class="nb">dict</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
<a id="__codelineno-0-377" name="__codelineno-0-377"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-378" name="__codelineno-0-378"></a><span class="sd">    Preprocess a collection, obtain a LLM-generated summary of the collection,</span>
<a id="__codelineno-0-379" name="__codelineno-0-379"></a><span class="sd">    a set of statistics for each field (such as unique categories), and a set of mappings</span>
<a id="__codelineno-0-380" name="__codelineno-0-380"></a><span class="sd">    from the fields to the frontend-specific fields in Elysia.</span>
<a id="__codelineno-0-381" name="__codelineno-0-381"></a>
<a id="__codelineno-0-382" name="__codelineno-0-382"></a><span class="sd">    In order:</span>
<a id="__codelineno-0-383" name="__codelineno-0-383"></a>
<a id="__codelineno-0-384" name="__codelineno-0-384"></a><span class="sd">    1. Evaluate all the data fields and groups/statistics of the data fields as a whole</span>
<a id="__codelineno-0-385" name="__codelineno-0-385"></a><span class="sd">    2. Write a summary of the collection via an LLM</span>
<a id="__codelineno-0-386" name="__codelineno-0-386"></a><span class="sd">    3. Evaluate what return types are available for this collection</span>
<a id="__codelineno-0-387" name="__codelineno-0-387"></a><span class="sd">    4. For each data field in the collection, evaluate what corresponding entry goes to what field in the return type (mapping)</span>
<a id="__codelineno-0-388" name="__codelineno-0-388"></a><span class="sd">    5. Save as a ELYSIA_METADATA__ collection</span>
<a id="__codelineno-0-389" name="__codelineno-0-389"></a>
<a id="__codelineno-0-390" name="__codelineno-0-390"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-391" name="__codelineno-0-391"></a><span class="sd">        collection_name (str): The name of the collection to preprocess.</span>
<a id="__codelineno-0-392" name="__codelineno-0-392"></a><span class="sd">        client_manager (ClientManager): The client manager to use.</span>
<a id="__codelineno-0-393" name="__codelineno-0-393"></a><span class="sd">        min_sample_size (int): The minimum number of objects to sample from the collection to evaluate the statistics/summary. Optional, defaults to 10.</span>
<a id="__codelineno-0-394" name="__codelineno-0-394"></a><span class="sd">        max_sample_size (int): The maximum number of objects to sample from the collection to evaluate the statistics/summary. Optional, defaults to 20.</span>
<a id="__codelineno-0-395" name="__codelineno-0-395"></a><span class="sd">        num_sample_tokens (int): The number of tokens to approximately sample from the collection to evaluate the summary.</span>
<a id="__codelineno-0-396" name="__codelineno-0-396"></a><span class="sd">            The preprocessor will aim to use this many tokens in the sample objects to evaluate the summary.</span>
<a id="__codelineno-0-397" name="__codelineno-0-397"></a><span class="sd">            But will not exceed the maximum number of objects specified by `max_sample_size`, and always use at least `min_sample_size` objects.</span>
<a id="__codelineno-0-398" name="__codelineno-0-398"></a><span class="sd">        force (bool): Whether to force the preprocessor to run even if the collection already exists. Optional, defaults to False.</span>
<a id="__codelineno-0-399" name="__codelineno-0-399"></a><span class="sd">        threshold_for_missing_fields (float): The threshold for the number of missing fields in the data mapping. Optional, defaults to 0.1.</span>
<a id="__codelineno-0-400" name="__codelineno-0-400"></a><span class="sd">        settings (Settings): The settings to use. Optional, defaults to the environment variables/configured settings.</span>
<a id="__codelineno-0-401" name="__codelineno-0-401"></a>
<a id="__codelineno-0-402" name="__codelineno-0-402"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-403" name="__codelineno-0-403"></a><span class="sd">        AsyncGenerator[dict, None]: A generator that yields dictionaries with the status updates and progress of the preprocessor.</span>
<a id="__codelineno-0-404" name="__codelineno-0-404"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-405" name="__codelineno-0-405"></a>
<a id="__codelineno-0-406" name="__codelineno-0-406"></a>    <span class="n">collection_summariser_prompt</span> <span class="o">=</span> <span class="n">dspy</span><span class="o">.</span><span class="n">ChainOfThought</span><span class="p">(</span><span class="n">CollectionSummariserPrompt</span><span class="p">)</span>
<a id="__codelineno-0-407" name="__codelineno-0-407"></a>    <span class="n">return_type_prompt</span> <span class="o">=</span> <span class="n">dspy</span><span class="o">.</span><span class="n">ChainOfThought</span><span class="p">(</span><span class="n">ReturnTypePrompt</span><span class="p">)</span>
<a id="__codelineno-0-408" name="__codelineno-0-408"></a>    <span class="n">data_mapping_prompt</span> <span class="o">=</span> <span class="n">dspy</span><span class="o">.</span><span class="n">ChainOfThought</span><span class="p">(</span><span class="n">DataMappingPrompt</span><span class="p">)</span>
<a id="__codelineno-0-409" name="__codelineno-0-409"></a>    <span class="n">prompt_suggestor_prompt</span> <span class="o">=</span> <span class="n">dspy</span><span class="o">.</span><span class="n">ChainOfThought</span><span class="p">(</span><span class="n">PromptSuggestorPrompt</span><span class="p">)</span>
<a id="__codelineno-0-410" name="__codelineno-0-410"></a>
<a id="__codelineno-0-411" name="__codelineno-0-411"></a>    <span class="n">lm</span> <span class="o">=</span> <span class="n">load_base_lm</span><span class="p">(</span><span class="n">settings</span><span class="p">)</span>
<a id="__codelineno-0-412" name="__codelineno-0-412"></a>    <span class="n">logger</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">logger</span>
<a id="__codelineno-0-413" name="__codelineno-0-413"></a>    <span class="n">process_update</span> <span class="o">=</span> <span class="n">ProcessUpdate</span><span class="p">(</span><span class="n">collection_name</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">rt</span><span class="o">.</span><span class="n">specific_return_types</span><span class="p">)</span> <span class="o">+</span> <span class="mi">5</span><span class="p">)</span>
<a id="__codelineno-0-414" name="__codelineno-0-414"></a>
<a id="__codelineno-0-415" name="__codelineno-0-415"></a>    <span class="k">if</span> <span class="n">client_manager</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-416" name="__codelineno-0-416"></a>        <span class="n">client_manager</span> <span class="o">=</span> <span class="n">ClientManager</span><span class="p">(</span>
<a id="__codelineno-0-417" name="__codelineno-0-417"></a>            <span class="n">wcd_url</span><span class="o">=</span><span class="n">settings</span><span class="o">.</span><span class="n">WCD_URL</span><span class="p">,</span> <span class="n">wcd_api_key</span><span class="o">=</span><span class="n">settings</span><span class="o">.</span><span class="n">WCD_API_KEY</span>
<a id="__codelineno-0-418" name="__codelineno-0-418"></a>        <span class="p">)</span>
<a id="__codelineno-0-419" name="__codelineno-0-419"></a>        <span class="n">close_clients_after_completion</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-420" name="__codelineno-0-420"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-421" name="__codelineno-0-421"></a>        <span class="n">close_clients_after_completion</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-422" name="__codelineno-0-422"></a>
<a id="__codelineno-0-423" name="__codelineno-0-423"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-424" name="__codelineno-0-424"></a>        <span class="c1"># Check if the collection exists</span>
<a id="__codelineno-0-425" name="__codelineno-0-425"></a>        <span class="k">async</span> <span class="k">with</span> <span class="n">client_manager</span><span class="o">.</span><span class="n">connect_to_async_client</span><span class="p">()</span> <span class="k">as</span> <span class="n">client</span><span class="p">:</span>
<a id="__codelineno-0-426" name="__codelineno-0-426"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="k">await</span> <span class="n">client</span><span class="o">.</span><span class="n">collections</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">collection_name</span><span class="p">):</span>
<a id="__codelineno-0-427" name="__codelineno-0-427"></a>                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Collection </span><span class="si">{</span><span class="n">collection_name</span><span class="si">}</span><span class="s2"> does not exist!&quot;</span><span class="p">)</span>
<a id="__codelineno-0-428" name="__codelineno-0-428"></a>
<a id="__codelineno-0-429" name="__codelineno-0-429"></a>        <span class="c1"># Check if the preprocessed collection exists</span>
<a id="__codelineno-0-430" name="__codelineno-0-430"></a>        <span class="k">if</span> <span class="p">(</span>
<a id="__codelineno-0-431" name="__codelineno-0-431"></a>            <span class="k">await</span> <span class="n">preprocessed_collection_exists_async</span><span class="p">(</span><span class="n">collection_name</span><span class="p">,</span> <span class="n">client_manager</span><span class="p">)</span>
<a id="__codelineno-0-432" name="__codelineno-0-432"></a>            <span class="ow">and</span> <span class="ow">not</span> <span class="n">force</span>
<a id="__codelineno-0-433" name="__codelineno-0-433"></a>        <span class="p">):</span>
<a id="__codelineno-0-434" name="__codelineno-0-434"></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Preprocessed metadata for </span><span class="si">{</span><span class="n">collection_name</span><span class="si">}</span><span class="s2"> already exists!&quot;</span><span class="p">)</span>
<a id="__codelineno-0-435" name="__codelineno-0-435"></a>            <span class="k">return</span>
<a id="__codelineno-0-436" name="__codelineno-0-436"></a>
<a id="__codelineno-0-437" name="__codelineno-0-437"></a>        <span class="c1"># Get the collection and its properties</span>
<a id="__codelineno-0-438" name="__codelineno-0-438"></a>        <span class="k">async</span> <span class="k">with</span> <span class="n">client_manager</span><span class="o">.</span><span class="n">connect_to_async_client</span><span class="p">()</span> <span class="k">as</span> <span class="n">client</span><span class="p">:</span>
<a id="__codelineno-0-439" name="__codelineno-0-439"></a>            <span class="n">collection</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">collections</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">collection_name</span><span class="p">)</span>
<a id="__codelineno-0-440" name="__codelineno-0-440"></a>            <span class="n">properties</span> <span class="o">=</span> <span class="k">await</span> <span class="n">async_get_collection_data_types</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">collection_name</span><span class="p">)</span>
<a id="__codelineno-0-441" name="__codelineno-0-441"></a>
<a id="__codelineno-0-442" name="__codelineno-0-442"></a>        <span class="c1"># get number of items in collection</span>
<a id="__codelineno-0-443" name="__codelineno-0-443"></a>        <span class="n">agg</span> <span class="o">=</span> <span class="k">await</span> <span class="n">collection</span><span class="o">.</span><span class="n">aggregate</span><span class="o">.</span><span class="n">over_all</span><span class="p">(</span><span class="n">total_count</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-444" name="__codelineno-0-444"></a>        <span class="n">len_collection</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">agg</span><span class="o">.</span><span class="n">total_count</span>  <span class="c1"># type: ignore</span>
<a id="__codelineno-0-445" name="__codelineno-0-445"></a>
<a id="__codelineno-0-446" name="__codelineno-0-446"></a>        <span class="c1"># Randomly sample sample_size objects for the summary</span>
<a id="__codelineno-0-447" name="__codelineno-0-447"></a>        <span class="n">indices</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span>
<a id="__codelineno-0-448" name="__codelineno-0-448"></a>            <span class="nb">range</span><span class="p">(</span><span class="n">len_collection</span><span class="p">),</span>
<a id="__codelineno-0-449" name="__codelineno-0-449"></a>            <span class="nb">max</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">max_sample_size</span><span class="p">,</span> <span class="n">len_collection</span><span class="p">),</span> <span class="mi">1</span><span class="p">),</span>
<a id="__codelineno-0-450" name="__codelineno-0-450"></a>        <span class="p">)</span>
<a id="__codelineno-0-451" name="__codelineno-0-451"></a>
<a id="__codelineno-0-452" name="__codelineno-0-452"></a>        <span class="c1"># Get first object to estimate token count</span>
<a id="__codelineno-0-453" name="__codelineno-0-453"></a>        <span class="n">obj</span> <span class="o">=</span> <span class="k">await</span> <span class="n">collection</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">fetch_objects</span><span class="p">(</span><span class="n">limit</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="n">indices</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<a id="__codelineno-0-454" name="__codelineno-0-454"></a>        <span class="n">token_count_0</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">nlp</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">objects</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">properties</span><span class="p">)))</span>
<a id="__codelineno-0-455" name="__codelineno-0-455"></a>        <span class="n">subset_objects</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">obj</span><span class="o">.</span><span class="n">objects</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">properties</span><span class="p">]</span>  <span class="c1"># type: ignore</span>
<a id="__codelineno-0-456" name="__codelineno-0-456"></a>
<a id="__codelineno-0-457" name="__codelineno-0-457"></a>        <span class="c1"># Get number of objects to sample to get close to num_sample_tokens</span>
<a id="__codelineno-0-458" name="__codelineno-0-458"></a>        <span class="n">num_sample_objects</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">min_sample_size</span><span class="p">,</span> <span class="n">num_sample_tokens</span> <span class="o">//</span> <span class="n">token_count_0</span><span class="p">)</span>
<a id="__codelineno-0-459" name="__codelineno-0-459"></a>
<a id="__codelineno-0-460" name="__codelineno-0-460"></a>        <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">indices</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="n">num_sample_objects</span><span class="p">]:</span>
<a id="__codelineno-0-461" name="__codelineno-0-461"></a>            <span class="n">obj</span> <span class="o">=</span> <span class="k">await</span> <span class="n">collection</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">fetch_objects</span><span class="p">(</span><span class="n">limit</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="n">index</span><span class="p">)</span>
<a id="__codelineno-0-462" name="__codelineno-0-462"></a>            <span class="n">subset_objects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">objects</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">properties</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
<a id="__codelineno-0-463" name="__codelineno-0-463"></a>
<a id="__codelineno-0-464" name="__codelineno-0-464"></a>        <span class="c1"># Estimate number of tokens</span>
<a id="__codelineno-0-465" name="__codelineno-0-465"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
<a id="__codelineno-0-466" name="__codelineno-0-466"></a>            <span class="sa">f</span><span class="s2">&quot;Estimated token count of sample: </span><span class="si">{</span><span class="n">token_count_0</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">subset_objects</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-467" name="__codelineno-0-467"></a>        <span class="p">)</span>
<a id="__codelineno-0-468" name="__codelineno-0-468"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of objects in sample: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">subset_objects</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-469" name="__codelineno-0-469"></a>
<a id="__codelineno-0-470" name="__codelineno-0-470"></a>        <span class="c1"># Summarise the collection using LLM and the subset of the data</span>
<a id="__codelineno-0-471" name="__codelineno-0-471"></a>        <span class="n">summary</span><span class="p">,</span> <span class="n">field_descriptions</span> <span class="o">=</span> <span class="k">await</span> <span class="n">_summarise_collection</span><span class="p">(</span>
<a id="__codelineno-0-472" name="__codelineno-0-472"></a>            <span class="n">collection_summariser_prompt</span><span class="p">,</span>
<a id="__codelineno-0-473" name="__codelineno-0-473"></a>            <span class="n">properties</span><span class="p">,</span>
<a id="__codelineno-0-474" name="__codelineno-0-474"></a>            <span class="n">subset_objects</span><span class="p">,</span>
<a id="__codelineno-0-475" name="__codelineno-0-475"></a>            <span class="n">len_collection</span><span class="p">,</span>
<a id="__codelineno-0-476" name="__codelineno-0-476"></a>            <span class="n">settings</span><span class="p">,</span>
<a id="__codelineno-0-477" name="__codelineno-0-477"></a>            <span class="n">lm</span><span class="p">,</span>
<a id="__codelineno-0-478" name="__codelineno-0-478"></a>        <span class="p">)</span>
<a id="__codelineno-0-479" name="__codelineno-0-479"></a>
<a id="__codelineno-0-480" name="__codelineno-0-480"></a>        <span class="k">yield</span> <span class="k">await</span> <span class="n">process_update</span><span class="p">(</span>
<a id="__codelineno-0-481" name="__codelineno-0-481"></a>            <span class="n">message</span><span class="o">=</span><span class="s2">&quot;Generated summary of collection&quot;</span><span class="p">,</span>
<a id="__codelineno-0-482" name="__codelineno-0-482"></a>        <span class="p">)</span>
<a id="__codelineno-0-483" name="__codelineno-0-483"></a>
<a id="__codelineno-0-484" name="__codelineno-0-484"></a>        <span class="k">if</span> <span class="n">len_collection</span> <span class="o">&gt;</span> <span class="n">max_sample_size</span><span class="p">:</span>
<a id="__codelineno-0-485" name="__codelineno-0-485"></a>            <span class="n">full_response</span> <span class="o">=</span> <span class="n">subset_objects</span>
<a id="__codelineno-0-486" name="__codelineno-0-486"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-487" name="__codelineno-0-487"></a>            <span class="n">weaviate_resp</span> <span class="o">=</span> <span class="k">await</span> <span class="n">collection</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">fetch_objects</span><span class="p">(</span><span class="n">limit</span><span class="o">=</span><span class="n">len_collection</span><span class="p">)</span>
<a id="__codelineno-0-488" name="__codelineno-0-488"></a>            <span class="n">full_response</span> <span class="o">=</span> <span class="p">[</span><span class="n">obj</span><span class="o">.</span><span class="n">properties</span> <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">weaviate_resp</span><span class="o">.</span><span class="n">objects</span><span class="p">]</span>
<a id="__codelineno-0-489" name="__codelineno-0-489"></a>
<a id="__codelineno-0-490" name="__codelineno-0-490"></a>        <span class="c1"># Initialise the output</span>
<a id="__codelineno-0-491" name="__codelineno-0-491"></a>        <span class="n">named_vectors</span><span class="p">,</span> <span class="n">vectoriser</span> <span class="o">=</span> <span class="k">await</span> <span class="n">_find_vectorisers</span><span class="p">(</span><span class="n">collection</span><span class="p">)</span>
<a id="__codelineno-0-492" name="__codelineno-0-492"></a>        <span class="n">out</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-493" name="__codelineno-0-493"></a>            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">collection_name</span><span class="p">,</span>
<a id="__codelineno-0-494" name="__codelineno-0-494"></a>            <span class="s2">&quot;length&quot;</span><span class="p">:</span> <span class="n">len_collection</span><span class="p">,</span>
<a id="__codelineno-0-495" name="__codelineno-0-495"></a>            <span class="s2">&quot;summary&quot;</span><span class="p">:</span> <span class="n">summary</span><span class="p">,</span>
<a id="__codelineno-0-496" name="__codelineno-0-496"></a>            <span class="s2">&quot;index_properties&quot;</span><span class="p">:</span> <span class="k">await</span> <span class="n">_evaluate_index_properties</span><span class="p">(</span><span class="n">collection</span><span class="p">),</span>
<a id="__codelineno-0-497" name="__codelineno-0-497"></a>            <span class="s2">&quot;named_vectors&quot;</span><span class="p">:</span> <span class="n">named_vectors</span><span class="p">,</span>
<a id="__codelineno-0-498" name="__codelineno-0-498"></a>            <span class="s2">&quot;vectorizer&quot;</span><span class="p">:</span> <span class="n">vectoriser</span><span class="p">,</span>
<a id="__codelineno-0-499" name="__codelineno-0-499"></a>            <span class="s2">&quot;fields&quot;</span><span class="p">:</span> <span class="p">[],</span>
<a id="__codelineno-0-500" name="__codelineno-0-500"></a>            <span class="s2">&quot;mappings&quot;</span><span class="p">:</span> <span class="p">{},</span>
<a id="__codelineno-0-501" name="__codelineno-0-501"></a>        <span class="p">}</span>
<a id="__codelineno-0-502" name="__codelineno-0-502"></a>
<a id="__codelineno-0-503" name="__codelineno-0-503"></a>        <span class="c1"># Evaluate the summary statistics of each field</span>
<a id="__codelineno-0-504" name="__codelineno-0-504"></a>        <span class="k">for</span> <span class="nb">property</span> <span class="ow">in</span> <span class="n">properties</span><span class="p">:</span>
<a id="__codelineno-0-505" name="__codelineno-0-505"></a>            <span class="n">out</span><span class="p">[</span><span class="s2">&quot;fields&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
<a id="__codelineno-0-506" name="__codelineno-0-506"></a>                <span class="k">await</span> <span class="n">_evaluate_field_statistics</span><span class="p">(</span>
<a id="__codelineno-0-507" name="__codelineno-0-507"></a>                    <span class="n">collection</span><span class="p">,</span> <span class="n">properties</span><span class="p">,</span> <span class="nb">property</span><span class="p">,</span> <span class="n">len_collection</span><span class="p">,</span> <span class="n">full_response</span>
<a id="__codelineno-0-508" name="__codelineno-0-508"></a>                <span class="p">)</span>
<a id="__codelineno-0-509" name="__codelineno-0-509"></a>            <span class="p">)</span>
<a id="__codelineno-0-510" name="__codelineno-0-510"></a>            <span class="k">if</span> <span class="nb">property</span> <span class="ow">in</span> <span class="n">field_descriptions</span><span class="p">:</span>
<a id="__codelineno-0-511" name="__codelineno-0-511"></a>                <span class="n">out</span><span class="p">[</span><span class="s2">&quot;fields&quot;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;description&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">field_descriptions</span><span class="p">[</span><span class="nb">property</span><span class="p">]</span>
<a id="__codelineno-0-512" name="__codelineno-0-512"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-513" name="__codelineno-0-513"></a>                <span class="n">out</span><span class="p">[</span><span class="s2">&quot;fields&quot;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;description&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
<a id="__codelineno-0-514" name="__codelineno-0-514"></a>
<a id="__codelineno-0-515" name="__codelineno-0-515"></a>        <span class="k">yield</span> <span class="k">await</span> <span class="n">process_update</span><span class="p">(</span>
<a id="__codelineno-0-516" name="__codelineno-0-516"></a>            <span class="n">message</span><span class="o">=</span><span class="s2">&quot;Evaluated field statistics&quot;</span><span class="p">,</span>
<a id="__codelineno-0-517" name="__codelineno-0-517"></a>        <span class="p">)</span>
<a id="__codelineno-0-518" name="__codelineno-0-518"></a>
<a id="__codelineno-0-519" name="__codelineno-0-519"></a>        <span class="n">return_types</span> <span class="o">=</span> <span class="k">await</span> <span class="n">_evaluate_return_types</span><span class="p">(</span>
<a id="__codelineno-0-520" name="__codelineno-0-520"></a>            <span class="n">return_type_prompt</span><span class="p">,</span>
<a id="__codelineno-0-521" name="__codelineno-0-521"></a>            <span class="n">summary</span><span class="p">,</span>
<a id="__codelineno-0-522" name="__codelineno-0-522"></a>            <span class="n">properties</span><span class="p">,</span>
<a id="__codelineno-0-523" name="__codelineno-0-523"></a>            <span class="n">subset_objects</span><span class="p">,</span>
<a id="__codelineno-0-524" name="__codelineno-0-524"></a>            <span class="n">settings</span><span class="p">,</span>
<a id="__codelineno-0-525" name="__codelineno-0-525"></a>            <span class="n">lm</span><span class="p">,</span>
<a id="__codelineno-0-526" name="__codelineno-0-526"></a>        <span class="p">)</span>
<a id="__codelineno-0-527" name="__codelineno-0-527"></a>
<a id="__codelineno-0-528" name="__codelineno-0-528"></a>        <span class="k">yield</span> <span class="k">await</span> <span class="n">process_update</span><span class="p">(</span>
<a id="__codelineno-0-529" name="__codelineno-0-529"></a>            <span class="n">message</span><span class="o">=</span><span class="s2">&quot;Evaluated return types&quot;</span><span class="p">,</span>
<a id="__codelineno-0-530" name="__codelineno-0-530"></a>        <span class="p">)</span>
<a id="__codelineno-0-531" name="__codelineno-0-531"></a>        <span class="n">process_update</span><span class="o">.</span><span class="n">update_total</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">return_types</span><span class="p">)</span> <span class="o">+</span> <span class="mi">5</span><span class="p">)</span>
<a id="__codelineno-0-532" name="__codelineno-0-532"></a>
<a id="__codelineno-0-533" name="__codelineno-0-533"></a>        <span class="c1"># suggest prompts</span>
<a id="__codelineno-0-534" name="__codelineno-0-534"></a>        <span class="n">out</span><span class="p">[</span><span class="s2">&quot;prompts&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="k">await</span> <span class="n">_suggest_prompts</span><span class="p">(</span>
<a id="__codelineno-0-535" name="__codelineno-0-535"></a>            <span class="n">prompt_suggestor_prompt</span><span class="p">,</span>
<a id="__codelineno-0-536" name="__codelineno-0-536"></a>            <span class="n">out</span><span class="p">,</span>
<a id="__codelineno-0-537" name="__codelineno-0-537"></a>            <span class="n">subset_objects</span><span class="p">,</span>
<a id="__codelineno-0-538" name="__codelineno-0-538"></a>            <span class="n">settings</span><span class="p">,</span>
<a id="__codelineno-0-539" name="__codelineno-0-539"></a>            <span class="n">lm</span><span class="p">,</span>
<a id="__codelineno-0-540" name="__codelineno-0-540"></a>        <span class="p">)</span>
<a id="__codelineno-0-541" name="__codelineno-0-541"></a>
<a id="__codelineno-0-542" name="__codelineno-0-542"></a>        <span class="k">yield</span> <span class="k">await</span> <span class="n">process_update</span><span class="p">(</span>
<a id="__codelineno-0-543" name="__codelineno-0-543"></a>            <span class="n">message</span><span class="o">=</span><span class="s2">&quot;Created suggestions for prompts&quot;</span><span class="p">,</span>
<a id="__codelineno-0-544" name="__codelineno-0-544"></a>        <span class="p">)</span>
<a id="__codelineno-0-545" name="__codelineno-0-545"></a>
<a id="__codelineno-0-546" name="__codelineno-0-546"></a>        <span class="c1"># For each return type created above, define the mappings from the properties to the frontend types</span>
<a id="__codelineno-0-547" name="__codelineno-0-547"></a>        <span class="n">mappings</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-548" name="__codelineno-0-548"></a>        <span class="k">for</span> <span class="n">return_type</span> <span class="ow">in</span> <span class="n">return_types</span><span class="p">:</span>
<a id="__codelineno-0-549" name="__codelineno-0-549"></a>            <span class="n">fields</span> <span class="o">=</span> <span class="n">rt</span><span class="o">.</span><span class="n">types_dict</span><span class="p">[</span><span class="n">return_type</span><span class="p">]</span>
<a id="__codelineno-0-550" name="__codelineno-0-550"></a>
<a id="__codelineno-0-551" name="__codelineno-0-551"></a>            <span class="n">mapping</span> <span class="o">=</span> <span class="k">await</span> <span class="n">_define_mappings</span><span class="p">(</span>
<a id="__codelineno-0-552" name="__codelineno-0-552"></a>                <span class="n">data_mapping_prompt</span><span class="p">,</span>
<a id="__codelineno-0-553" name="__codelineno-0-553"></a>                <span class="n">mapping_type</span><span class="o">=</span><span class="n">return_type</span><span class="p">,</span>
<a id="__codelineno-0-554" name="__codelineno-0-554"></a>                <span class="n">input_fields</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">fields</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span>
<a id="__codelineno-0-555" name="__codelineno-0-555"></a>                <span class="n">output_fields</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">properties</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span>
<a id="__codelineno-0-556" name="__codelineno-0-556"></a>                <span class="n">properties</span><span class="o">=</span><span class="n">properties</span><span class="p">,</span>
<a id="__codelineno-0-557" name="__codelineno-0-557"></a>                <span class="n">collection_information</span><span class="o">=</span><span class="n">out</span><span class="p">,</span>
<a id="__codelineno-0-558" name="__codelineno-0-558"></a>                <span class="n">example_objects</span><span class="o">=</span><span class="n">subset_objects</span><span class="p">,</span>
<a id="__codelineno-0-559" name="__codelineno-0-559"></a>                <span class="n">settings</span><span class="o">=</span><span class="n">settings</span><span class="p">,</span>
<a id="__codelineno-0-560" name="__codelineno-0-560"></a>                <span class="n">lm</span><span class="o">=</span><span class="n">lm</span><span class="p">,</span>
<a id="__codelineno-0-561" name="__codelineno-0-561"></a>            <span class="p">)</span>
<a id="__codelineno-0-562" name="__codelineno-0-562"></a>
<a id="__codelineno-0-563" name="__codelineno-0-563"></a>            <span class="c1"># remove any extra fields the model may have added</span>
<a id="__codelineno-0-564" name="__codelineno-0-564"></a>            <span class="n">mapping</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">mapping</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">fields</span><span class="o">.</span><span class="n">keys</span><span class="p">())}</span>
<a id="__codelineno-0-565" name="__codelineno-0-565"></a>
<a id="__codelineno-0-566" name="__codelineno-0-566"></a>            <span class="k">yield</span> <span class="k">await</span> <span class="n">process_update</span><span class="p">(</span>
<a id="__codelineno-0-567" name="__codelineno-0-567"></a>                <span class="n">message</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Defined mappings for </span><span class="si">{</span><span class="n">return_type</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-0-568" name="__codelineno-0-568"></a>            <span class="p">)</span>
<a id="__codelineno-0-569" name="__codelineno-0-569"></a>
<a id="__codelineno-0-570" name="__codelineno-0-570"></a>            <span class="n">mappings</span><span class="p">[</span><span class="n">return_type</span><span class="p">]</span> <span class="o">=</span> <span class="n">mapping</span>
<a id="__codelineno-0-571" name="__codelineno-0-571"></a>
<a id="__codelineno-0-572" name="__codelineno-0-572"></a>        <span class="n">new_return_types</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-573" name="__codelineno-0-573"></a>        <span class="k">for</span> <span class="n">return_type</span> <span class="ow">in</span> <span class="n">return_types</span><span class="p">:</span>
<a id="__codelineno-0-574" name="__codelineno-0-574"></a>
<a id="__codelineno-0-575" name="__codelineno-0-575"></a>            <span class="c1"># check if the `conversation_id` field is in the mapping (required for conversation type)</span>
<a id="__codelineno-0-576" name="__codelineno-0-576"></a>            <span class="k">if</span> <span class="n">return_type</span> <span class="o">==</span> <span class="s2">&quot;conversation&quot;</span> <span class="ow">and</span> <span class="p">(</span>
<a id="__codelineno-0-577" name="__codelineno-0-577"></a>                <span class="p">(</span>
<a id="__codelineno-0-578" name="__codelineno-0-578"></a>                    <span class="n">mappings</span><span class="p">[</span><span class="n">return_type</span><span class="p">][</span><span class="s2">&quot;conversation_id&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span>
<a id="__codelineno-0-579" name="__codelineno-0-579"></a>                    <span class="ow">or</span> <span class="n">mappings</span><span class="p">[</span><span class="n">return_type</span><span class="p">][</span><span class="s2">&quot;conversation_id&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span>
<a id="__codelineno-0-580" name="__codelineno-0-580"></a>                <span class="p">)</span>
<a id="__codelineno-0-581" name="__codelineno-0-581"></a>                <span class="ow">or</span> <span class="p">(</span>
<a id="__codelineno-0-582" name="__codelineno-0-582"></a>                    <span class="n">mappings</span><span class="p">[</span><span class="n">return_type</span><span class="p">][</span><span class="s2">&quot;message_id&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span>
<a id="__codelineno-0-583" name="__codelineno-0-583"></a>                    <span class="ow">or</span> <span class="n">mappings</span><span class="p">[</span><span class="n">return_type</span><span class="p">][</span><span class="s2">&quot;message_id&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span>
<a id="__codelineno-0-584" name="__codelineno-0-584"></a>                <span class="p">)</span>
<a id="__codelineno-0-585" name="__codelineno-0-585"></a>            <span class="p">):</span>
<a id="__codelineno-0-586" name="__codelineno-0-586"></a>                <span class="k">continue</span>
<a id="__codelineno-0-587" name="__codelineno-0-587"></a>
<a id="__codelineno-0-588" name="__codelineno-0-588"></a>            <span class="c1"># If less than threshold_for_missing_fields%, keep the return type</span>
<a id="__codelineno-0-589" name="__codelineno-0-589"></a>            <span class="n">num_missing</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="n">m</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">mappings</span><span class="p">[</span><span class="n">return_type</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">())])</span>
<a id="__codelineno-0-590" name="__codelineno-0-590"></a>            <span class="n">perc_correct</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="n">num_missing</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">mappings</span><span class="p">[</span><span class="n">return_type</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
<a id="__codelineno-0-591" name="__codelineno-0-591"></a>            <span class="k">if</span> <span class="n">perc_correct</span> <span class="o">&gt;=</span> <span class="n">percentage_correct_threshold</span><span class="p">:</span>
<a id="__codelineno-0-592" name="__codelineno-0-592"></a>                <span class="n">new_return_types</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">return_type</span><span class="p">)</span>
<a id="__codelineno-0-593" name="__codelineno-0-593"></a>
<a id="__codelineno-0-594" name="__codelineno-0-594"></a>        <span class="c1"># If no return types are left, fall-back to generic</span>
<a id="__codelineno-0-595" name="__codelineno-0-595"></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_return_types</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-596" name="__codelineno-0-596"></a>
<a id="__codelineno-0-597" name="__codelineno-0-597"></a>            <span class="c1"># Map for generic</span>
<a id="__codelineno-0-598" name="__codelineno-0-598"></a>            <span class="n">mapping</span> <span class="o">=</span> <span class="k">await</span> <span class="n">_define_mappings</span><span class="p">(</span>
<a id="__codelineno-0-599" name="__codelineno-0-599"></a>                <span class="n">data_mapping_prompt</span><span class="p">,</span>
<a id="__codelineno-0-600" name="__codelineno-0-600"></a>                <span class="n">mapping_type</span><span class="o">=</span><span class="s2">&quot;generic&quot;</span><span class="p">,</span>
<a id="__codelineno-0-601" name="__codelineno-0-601"></a>                <span class="n">input_fields</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">rt</span><span class="o">.</span><span class="n">generic</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span>
<a id="__codelineno-0-602" name="__codelineno-0-602"></a>                <span class="n">output_fields</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">properties</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span>
<a id="__codelineno-0-603" name="__codelineno-0-603"></a>                <span class="n">properties</span><span class="o">=</span><span class="n">properties</span><span class="p">,</span>
<a id="__codelineno-0-604" name="__codelineno-0-604"></a>                <span class="n">collection_information</span><span class="o">=</span><span class="n">out</span><span class="p">,</span>
<a id="__codelineno-0-605" name="__codelineno-0-605"></a>                <span class="n">example_objects</span><span class="o">=</span><span class="n">subset_objects</span><span class="p">,</span>
<a id="__codelineno-0-606" name="__codelineno-0-606"></a>                <span class="n">settings</span><span class="o">=</span><span class="n">settings</span><span class="p">,</span>
<a id="__codelineno-0-607" name="__codelineno-0-607"></a>                <span class="n">lm</span><span class="o">=</span><span class="n">lm</span><span class="p">,</span>
<a id="__codelineno-0-608" name="__codelineno-0-608"></a>            <span class="p">)</span>
<a id="__codelineno-0-609" name="__codelineno-0-609"></a>            <span class="k">yield</span> <span class="k">await</span> <span class="n">process_update</span><span class="p">(</span>
<a id="__codelineno-0-610" name="__codelineno-0-610"></a>                <span class="n">message</span><span class="o">=</span><span class="s2">&quot;No display types found, defined mappings for generic&quot;</span><span class="p">,</span>
<a id="__codelineno-0-611" name="__codelineno-0-611"></a>            <span class="p">)</span>
<a id="__codelineno-0-612" name="__codelineno-0-612"></a>
<a id="__codelineno-0-613" name="__codelineno-0-613"></a>            <span class="c1"># remove any extra fields the model may have added</span>
<a id="__codelineno-0-614" name="__codelineno-0-614"></a>            <span class="n">mapping</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">mapping</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">rt</span><span class="o">.</span><span class="n">generic</span><span class="o">.</span><span class="n">keys</span><span class="p">())}</span>
<a id="__codelineno-0-615" name="__codelineno-0-615"></a>            <span class="n">mappings</span><span class="p">[</span><span class="s2">&quot;generic&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mapping</span>
<a id="__codelineno-0-616" name="__codelineno-0-616"></a>
<a id="__codelineno-0-617" name="__codelineno-0-617"></a>            <span class="c1"># re-check the threshold for missing fields on generic</span>
<a id="__codelineno-0-618" name="__codelineno-0-618"></a>            <span class="n">num_missing</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="n">m</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">mappings</span><span class="p">[</span><span class="n">return_type</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">())])</span>
<a id="__codelineno-0-619" name="__codelineno-0-619"></a>            <span class="n">perc_correct</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="n">num_missing</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">mappings</span><span class="p">[</span><span class="n">return_type</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
<a id="__codelineno-0-620" name="__codelineno-0-620"></a>            <span class="k">if</span> <span class="n">perc_correct</span> <span class="o">&gt;=</span> <span class="n">percentage_correct_threshold</span><span class="p">:</span>
<a id="__codelineno-0-621" name="__codelineno-0-621"></a>                <span class="n">new_return_types</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;generic&quot;</span><span class="p">]</span>
<a id="__codelineno-0-622" name="__codelineno-0-622"></a>
<a id="__codelineno-0-623" name="__codelineno-0-623"></a>        <span class="c1"># Add the mappings to the output</span>
<a id="__codelineno-0-624" name="__codelineno-0-624"></a>        <span class="n">out</span><span class="p">[</span><span class="s2">&quot;mappings&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-625" name="__codelineno-0-625"></a>            <span class="n">return_type</span><span class="p">:</span> <span class="n">mappings</span><span class="p">[</span><span class="n">return_type</span><span class="p">]</span> <span class="k">for</span> <span class="n">return_type</span> <span class="ow">in</span> <span class="n">new_return_types</span>
<a id="__codelineno-0-626" name="__codelineno-0-626"></a>        <span class="p">}</span>
<a id="__codelineno-0-627" name="__codelineno-0-627"></a>
<a id="__codelineno-0-628" name="__codelineno-0-628"></a>        <span class="c1"># always include the table return type</span>
<a id="__codelineno-0-629" name="__codelineno-0-629"></a>        <span class="n">out</span><span class="p">[</span><span class="s2">&quot;mappings&quot;</span><span class="p">][</span><span class="s2">&quot;table&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">field</span><span class="p">:</span> <span class="n">field</span> <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">properties</span><span class="o">.</span><span class="n">keys</span><span class="p">()}</span>
<a id="__codelineno-0-630" name="__codelineno-0-630"></a>
<a id="__codelineno-0-631" name="__codelineno-0-631"></a>        <span class="c1"># Delete existing metadata if it exists</span>
<a id="__codelineno-0-632" name="__codelineno-0-632"></a>        <span class="k">if</span> <span class="k">await</span> <span class="n">preprocessed_collection_exists_async</span><span class="p">(</span><span class="n">collection_name</span><span class="p">,</span> <span class="n">client_manager</span><span class="p">):</span>
<a id="__codelineno-0-633" name="__codelineno-0-633"></a>            <span class="k">await</span> <span class="n">delete_preprocessed_collection_async</span><span class="p">(</span><span class="n">collection_name</span><span class="p">,</span> <span class="n">client_manager</span><span class="p">)</span>
<a id="__codelineno-0-634" name="__codelineno-0-634"></a>
<a id="__codelineno-0-635" name="__codelineno-0-635"></a>        <span class="c1"># Save final metadata to a collection</span>
<a id="__codelineno-0-636" name="__codelineno-0-636"></a>        <span class="k">async</span> <span class="k">with</span> <span class="n">client_manager</span><span class="o">.</span><span class="n">connect_to_async_client</span><span class="p">()</span> <span class="k">as</span> <span class="n">client</span><span class="p">:</span>
<a id="__codelineno-0-637" name="__codelineno-0-637"></a>            <span class="k">if</span> <span class="k">await</span> <span class="n">client</span><span class="o">.</span><span class="n">collections</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ELYSIA_METADATA__&quot;</span><span class="p">):</span>
<a id="__codelineno-0-638" name="__codelineno-0-638"></a>                <span class="n">metadata_collection</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">collections</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;ELYSIA_METADATA__&quot;</span><span class="p">)</span>
<a id="__codelineno-0-639" name="__codelineno-0-639"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-640" name="__codelineno-0-640"></a>                <span class="n">metadata_collection</span> <span class="o">=</span> <span class="k">await</span> <span class="n">client</span><span class="o">.</span><span class="n">collections</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
<a id="__codelineno-0-641" name="__codelineno-0-641"></a>                    <span class="sa">f</span><span class="s2">&quot;ELYSIA_METADATA__&quot;</span><span class="p">,</span>
<a id="__codelineno-0-642" name="__codelineno-0-642"></a>                    <span class="n">vectorizer_config</span><span class="o">=</span><span class="n">Configure</span><span class="o">.</span><span class="n">Vectorizer</span><span class="o">.</span><span class="n">none</span><span class="p">(),</span>
<a id="__codelineno-0-643" name="__codelineno-0-643"></a>                    <span class="n">properties</span><span class="o">=</span><span class="p">[</span>
<a id="__codelineno-0-644" name="__codelineno-0-644"></a>                        <span class="n">Property</span><span class="p">(</span>
<a id="__codelineno-0-645" name="__codelineno-0-645"></a>                            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;name&quot;</span><span class="p">,</span>
<a id="__codelineno-0-646" name="__codelineno-0-646"></a>                            <span class="n">data_type</span><span class="o">=</span><span class="n">DataType</span><span class="o">.</span><span class="n">TEXT</span><span class="p">,</span>
<a id="__codelineno-0-647" name="__codelineno-0-647"></a>                            <span class="n">tokenization</span><span class="o">=</span><span class="n">Tokenization</span><span class="o">.</span><span class="n">FIELD</span><span class="p">,</span>
<a id="__codelineno-0-648" name="__codelineno-0-648"></a>                        <span class="p">),</span>
<a id="__codelineno-0-649" name="__codelineno-0-649"></a>                        <span class="n">Property</span><span class="p">(</span>
<a id="__codelineno-0-650" name="__codelineno-0-650"></a>                            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;length&quot;</span><span class="p">,</span>
<a id="__codelineno-0-651" name="__codelineno-0-651"></a>                            <span class="n">data_type</span><span class="o">=</span><span class="n">DataType</span><span class="o">.</span><span class="n">NUMBER</span><span class="p">,</span>
<a id="__codelineno-0-652" name="__codelineno-0-652"></a>                        <span class="p">),</span>
<a id="__codelineno-0-653" name="__codelineno-0-653"></a>                        <span class="n">Property</span><span class="p">(</span>
<a id="__codelineno-0-654" name="__codelineno-0-654"></a>                            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;summary&quot;</span><span class="p">,</span>
<a id="__codelineno-0-655" name="__codelineno-0-655"></a>                            <span class="n">data_type</span><span class="o">=</span><span class="n">DataType</span><span class="o">.</span><span class="n">TEXT</span><span class="p">,</span>
<a id="__codelineno-0-656" name="__codelineno-0-656"></a>                        <span class="p">),</span>
<a id="__codelineno-0-657" name="__codelineno-0-657"></a>                        <span class="n">Property</span><span class="p">(</span>
<a id="__codelineno-0-658" name="__codelineno-0-658"></a>                            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;index_properties&quot;</span><span class="p">,</span>
<a id="__codelineno-0-659" name="__codelineno-0-659"></a>                            <span class="n">data_type</span><span class="o">=</span><span class="n">DataType</span><span class="o">.</span><span class="n">OBJECT</span><span class="p">,</span>
<a id="__codelineno-0-660" name="__codelineno-0-660"></a>                            <span class="n">nested_properties</span><span class="o">=</span><span class="p">[</span>
<a id="__codelineno-0-661" name="__codelineno-0-661"></a>                                <span class="n">Property</span><span class="p">(</span>
<a id="__codelineno-0-662" name="__codelineno-0-662"></a>                                    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;isNullIndexed&quot;</span><span class="p">,</span>
<a id="__codelineno-0-663" name="__codelineno-0-663"></a>                                    <span class="n">data_type</span><span class="o">=</span><span class="n">DataType</span><span class="o">.</span><span class="n">BOOL</span><span class="p">,</span>
<a id="__codelineno-0-664" name="__codelineno-0-664"></a>                                <span class="p">),</span>
<a id="__codelineno-0-665" name="__codelineno-0-665"></a>                                <span class="n">Property</span><span class="p">(</span>
<a id="__codelineno-0-666" name="__codelineno-0-666"></a>                                    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;isLengthIndexed&quot;</span><span class="p">,</span>
<a id="__codelineno-0-667" name="__codelineno-0-667"></a>                                    <span class="n">data_type</span><span class="o">=</span><span class="n">DataType</span><span class="o">.</span><span class="n">BOOL</span><span class="p">,</span>
<a id="__codelineno-0-668" name="__codelineno-0-668"></a>                                <span class="p">),</span>
<a id="__codelineno-0-669" name="__codelineno-0-669"></a>                                <span class="n">Property</span><span class="p">(</span>
<a id="__codelineno-0-670" name="__codelineno-0-670"></a>                                    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;isTimestampIndexed&quot;</span><span class="p">,</span>
<a id="__codelineno-0-671" name="__codelineno-0-671"></a>                                    <span class="n">data_type</span><span class="o">=</span><span class="n">DataType</span><span class="o">.</span><span class="n">BOOL</span><span class="p">,</span>
<a id="__codelineno-0-672" name="__codelineno-0-672"></a>                                <span class="p">),</span>
<a id="__codelineno-0-673" name="__codelineno-0-673"></a>                            <span class="p">],</span>
<a id="__codelineno-0-674" name="__codelineno-0-674"></a>                        <span class="p">),</span>
<a id="__codelineno-0-675" name="__codelineno-0-675"></a>                        <span class="n">Property</span><span class="p">(</span>
<a id="__codelineno-0-676" name="__codelineno-0-676"></a>                            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;named_vectors&quot;</span><span class="p">,</span>
<a id="__codelineno-0-677" name="__codelineno-0-677"></a>                            <span class="n">data_type</span><span class="o">=</span><span class="n">DataType</span><span class="o">.</span><span class="n">OBJECT_ARRAY</span><span class="p">,</span>
<a id="__codelineno-0-678" name="__codelineno-0-678"></a>                            <span class="n">nested_properties</span><span class="o">=</span><span class="p">[</span>
<a id="__codelineno-0-679" name="__codelineno-0-679"></a>                                <span class="n">Property</span><span class="p">(</span>
<a id="__codelineno-0-680" name="__codelineno-0-680"></a>                                    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;name&quot;</span><span class="p">,</span>
<a id="__codelineno-0-681" name="__codelineno-0-681"></a>                                    <span class="n">data_type</span><span class="o">=</span><span class="n">DataType</span><span class="o">.</span><span class="n">TEXT</span><span class="p">,</span>
<a id="__codelineno-0-682" name="__codelineno-0-682"></a>                                <span class="p">),</span>
<a id="__codelineno-0-683" name="__codelineno-0-683"></a>                                <span class="n">Property</span><span class="p">(</span>
<a id="__codelineno-0-684" name="__codelineno-0-684"></a>                                    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;vectorizer&quot;</span><span class="p">,</span>
<a id="__codelineno-0-685" name="__codelineno-0-685"></a>                                    <span class="n">data_type</span><span class="o">=</span><span class="n">DataType</span><span class="o">.</span><span class="n">TEXT</span><span class="p">,</span>
<a id="__codelineno-0-686" name="__codelineno-0-686"></a>                                <span class="p">),</span>
<a id="__codelineno-0-687" name="__codelineno-0-687"></a>                                <span class="n">Property</span><span class="p">(</span>
<a id="__codelineno-0-688" name="__codelineno-0-688"></a>                                    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;model&quot;</span><span class="p">,</span>
<a id="__codelineno-0-689" name="__codelineno-0-689"></a>                                    <span class="n">data_type</span><span class="o">=</span><span class="n">DataType</span><span class="o">.</span><span class="n">TEXT</span><span class="p">,</span>
<a id="__codelineno-0-690" name="__codelineno-0-690"></a>                                <span class="p">),</span>
<a id="__codelineno-0-691" name="__codelineno-0-691"></a>                                <span class="n">Property</span><span class="p">(</span>
<a id="__codelineno-0-692" name="__codelineno-0-692"></a>                                    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;source_properties&quot;</span><span class="p">,</span>
<a id="__codelineno-0-693" name="__codelineno-0-693"></a>                                    <span class="n">data_type</span><span class="o">=</span><span class="n">DataType</span><span class="o">.</span><span class="n">TEXT_ARRAY</span><span class="p">,</span>
<a id="__codelineno-0-694" name="__codelineno-0-694"></a>                                <span class="p">),</span>
<a id="__codelineno-0-695" name="__codelineno-0-695"></a>                                <span class="n">Property</span><span class="p">(</span>
<a id="__codelineno-0-696" name="__codelineno-0-696"></a>                                    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;enabled&quot;</span><span class="p">,</span>
<a id="__codelineno-0-697" name="__codelineno-0-697"></a>                                    <span class="n">data_type</span><span class="o">=</span><span class="n">DataType</span><span class="o">.</span><span class="n">BOOL</span><span class="p">,</span>
<a id="__codelineno-0-698" name="__codelineno-0-698"></a>                                <span class="p">),</span>
<a id="__codelineno-0-699" name="__codelineno-0-699"></a>                                <span class="n">Property</span><span class="p">(</span>
<a id="__codelineno-0-700" name="__codelineno-0-700"></a>                                    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;description&quot;</span><span class="p">,</span>
<a id="__codelineno-0-701" name="__codelineno-0-701"></a>                                    <span class="n">data_type</span><span class="o">=</span><span class="n">DataType</span><span class="o">.</span><span class="n">TEXT</span><span class="p">,</span>
<a id="__codelineno-0-702" name="__codelineno-0-702"></a>                                <span class="p">),</span>
<a id="__codelineno-0-703" name="__codelineno-0-703"></a>                            <span class="p">],</span>
<a id="__codelineno-0-704" name="__codelineno-0-704"></a>                        <span class="p">),</span>
<a id="__codelineno-0-705" name="__codelineno-0-705"></a>                        <span class="n">Property</span><span class="p">(</span>
<a id="__codelineno-0-706" name="__codelineno-0-706"></a>                            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;vectorizer&quot;</span><span class="p">,</span>
<a id="__codelineno-0-707" name="__codelineno-0-707"></a>                            <span class="n">data_type</span><span class="o">=</span><span class="n">DataType</span><span class="o">.</span><span class="n">OBJECT</span><span class="p">,</span>
<a id="__codelineno-0-708" name="__codelineno-0-708"></a>                            <span class="n">nested_properties</span><span class="o">=</span><span class="p">[</span>
<a id="__codelineno-0-709" name="__codelineno-0-709"></a>                                <span class="n">Property</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;vectorizer&quot;</span><span class="p">,</span> <span class="n">data_type</span><span class="o">=</span><span class="n">DataType</span><span class="o">.</span><span class="n">TEXT</span><span class="p">),</span>
<a id="__codelineno-0-710" name="__codelineno-0-710"></a>                                <span class="n">Property</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;model&quot;</span><span class="p">,</span> <span class="n">data_type</span><span class="o">=</span><span class="n">DataType</span><span class="o">.</span><span class="n">TEXT</span><span class="p">),</span>
<a id="__codelineno-0-711" name="__codelineno-0-711"></a>                            <span class="p">],</span>
<a id="__codelineno-0-712" name="__codelineno-0-712"></a>                        <span class="p">),</span>
<a id="__codelineno-0-713" name="__codelineno-0-713"></a>                        <span class="n">Property</span><span class="p">(</span>
<a id="__codelineno-0-714" name="__codelineno-0-714"></a>                            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;fields&quot;</span><span class="p">,</span>
<a id="__codelineno-0-715" name="__codelineno-0-715"></a>                            <span class="n">data_type</span><span class="o">=</span><span class="n">DataType</span><span class="o">.</span><span class="n">OBJECT_ARRAY</span><span class="p">,</span>
<a id="__codelineno-0-716" name="__codelineno-0-716"></a>                            <span class="n">nested_properties</span><span class="o">=</span><span class="p">[</span>
<a id="__codelineno-0-717" name="__codelineno-0-717"></a>                                <span class="n">Property</span><span class="p">(</span>
<a id="__codelineno-0-718" name="__codelineno-0-718"></a>                                    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;name&quot;</span><span class="p">,</span>
<a id="__codelineno-0-719" name="__codelineno-0-719"></a>                                    <span class="n">data_type</span><span class="o">=</span><span class="n">DataType</span><span class="o">.</span><span class="n">TEXT</span><span class="p">,</span>
<a id="__codelineno-0-720" name="__codelineno-0-720"></a>                                <span class="p">),</span>
<a id="__codelineno-0-721" name="__codelineno-0-721"></a>                                <span class="n">Property</span><span class="p">(</span>
<a id="__codelineno-0-722" name="__codelineno-0-722"></a>                                    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;type&quot;</span><span class="p">,</span>
<a id="__codelineno-0-723" name="__codelineno-0-723"></a>                                    <span class="n">data_type</span><span class="o">=</span><span class="n">DataType</span><span class="o">.</span><span class="n">TEXT</span><span class="p">,</span>
<a id="__codelineno-0-724" name="__codelineno-0-724"></a>                                <span class="p">),</span>
<a id="__codelineno-0-725" name="__codelineno-0-725"></a>                                <span class="n">Property</span><span class="p">(</span>
<a id="__codelineno-0-726" name="__codelineno-0-726"></a>                                    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;description&quot;</span><span class="p">,</span>
<a id="__codelineno-0-727" name="__codelineno-0-727"></a>                                    <span class="n">data_type</span><span class="o">=</span><span class="n">DataType</span><span class="o">.</span><span class="n">TEXT</span><span class="p">,</span>
<a id="__codelineno-0-728" name="__codelineno-0-728"></a>                                <span class="p">),</span>
<a id="__codelineno-0-729" name="__codelineno-0-729"></a>                                <span class="n">Property</span><span class="p">(</span>
<a id="__codelineno-0-730" name="__codelineno-0-730"></a>                                    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;range&quot;</span><span class="p">,</span>
<a id="__codelineno-0-731" name="__codelineno-0-731"></a>                                    <span class="n">data_type</span><span class="o">=</span><span class="n">DataType</span><span class="o">.</span><span class="n">NUMBER_ARRAY</span><span class="p">,</span>
<a id="__codelineno-0-732" name="__codelineno-0-732"></a>                                <span class="p">),</span>
<a id="__codelineno-0-733" name="__codelineno-0-733"></a>                                <span class="n">Property</span><span class="p">(</span>
<a id="__codelineno-0-734" name="__codelineno-0-734"></a>                                    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;date_range&quot;</span><span class="p">,</span>
<a id="__codelineno-0-735" name="__codelineno-0-735"></a>                                    <span class="n">data_type</span><span class="o">=</span><span class="n">DataType</span><span class="o">.</span><span class="n">DATE_ARRAY</span><span class="p">,</span>
<a id="__codelineno-0-736" name="__codelineno-0-736"></a>                                <span class="p">),</span>
<a id="__codelineno-0-737" name="__codelineno-0-737"></a>                                <span class="n">Property</span><span class="p">(</span>
<a id="__codelineno-0-738" name="__codelineno-0-738"></a>                                    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;groups&quot;</span><span class="p">,</span>
<a id="__codelineno-0-739" name="__codelineno-0-739"></a>                                    <span class="n">data_type</span><span class="o">=</span><span class="n">DataType</span><span class="o">.</span><span class="n">OBJECT_ARRAY</span><span class="p">,</span>
<a id="__codelineno-0-740" name="__codelineno-0-740"></a>                                    <span class="n">nested_properties</span><span class="o">=</span><span class="p">[</span>
<a id="__codelineno-0-741" name="__codelineno-0-741"></a>                                        <span class="n">Property</span><span class="p">(</span>
<a id="__codelineno-0-742" name="__codelineno-0-742"></a>                                            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;value&quot;</span><span class="p">,</span>
<a id="__codelineno-0-743" name="__codelineno-0-743"></a>                                            <span class="n">data_type</span><span class="o">=</span><span class="n">DataType</span><span class="o">.</span><span class="n">TEXT</span><span class="p">,</span>
<a id="__codelineno-0-744" name="__codelineno-0-744"></a>                                        <span class="p">),</span>
<a id="__codelineno-0-745" name="__codelineno-0-745"></a>                                        <span class="n">Property</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;count&quot;</span><span class="p">,</span> <span class="n">data_type</span><span class="o">=</span><span class="n">DataType</span><span class="o">.</span><span class="n">INT</span><span class="p">),</span>
<a id="__codelineno-0-746" name="__codelineno-0-746"></a>                                    <span class="p">],</span>
<a id="__codelineno-0-747" name="__codelineno-0-747"></a>                                <span class="p">),</span>
<a id="__codelineno-0-748" name="__codelineno-0-748"></a>                                <span class="n">Property</span><span class="p">(</span>
<a id="__codelineno-0-749" name="__codelineno-0-749"></a>                                    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;date_median&quot;</span><span class="p">,</span>
<a id="__codelineno-0-750" name="__codelineno-0-750"></a>                                    <span class="n">data_type</span><span class="o">=</span><span class="n">DataType</span><span class="o">.</span><span class="n">DATE</span><span class="p">,</span>
<a id="__codelineno-0-751" name="__codelineno-0-751"></a>                                <span class="p">),</span>
<a id="__codelineno-0-752" name="__codelineno-0-752"></a>                                <span class="n">Property</span><span class="p">(</span>
<a id="__codelineno-0-753" name="__codelineno-0-753"></a>                                    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;mean&quot;</span><span class="p">,</span>
<a id="__codelineno-0-754" name="__codelineno-0-754"></a>                                    <span class="n">data_type</span><span class="o">=</span><span class="n">DataType</span><span class="o">.</span><span class="n">NUMBER</span><span class="p">,</span>
<a id="__codelineno-0-755" name="__codelineno-0-755"></a>                                <span class="p">),</span>
<a id="__codelineno-0-756" name="__codelineno-0-756"></a>                            <span class="p">],</span>
<a id="__codelineno-0-757" name="__codelineno-0-757"></a>                        <span class="p">),</span>
<a id="__codelineno-0-758" name="__codelineno-0-758"></a>                        <span class="c1"># leave mappings for auto-schema generation</span>
<a id="__codelineno-0-759" name="__codelineno-0-759"></a>                    <span class="p">],</span>
<a id="__codelineno-0-760" name="__codelineno-0-760"></a>                    <span class="n">inverted_index_config</span><span class="o">=</span><span class="n">Configure</span><span class="o">.</span><span class="n">inverted_index</span><span class="p">(</span>
<a id="__codelineno-0-761" name="__codelineno-0-761"></a>                        <span class="n">index_null_state</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-762" name="__codelineno-0-762"></a>                    <span class="p">),</span>
<a id="__codelineno-0-763" name="__codelineno-0-763"></a>                <span class="p">)</span>
<a id="__codelineno-0-764" name="__codelineno-0-764"></a>            <span class="k">await</span> <span class="n">metadata_collection</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
<a id="__codelineno-0-765" name="__codelineno-0-765"></a>
<a id="__codelineno-0-766" name="__codelineno-0-766"></a>        <span class="k">yield</span> <span class="k">await</span> <span class="n">process_update</span><span class="p">(</span>
<a id="__codelineno-0-767" name="__codelineno-0-767"></a>            <span class="n">completed</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-768" name="__codelineno-0-768"></a>            <span class="n">message</span><span class="o">=</span><span class="s2">&quot;Saved metadata to Weaviate&quot;</span><span class="p">,</span>
<a id="__codelineno-0-769" name="__codelineno-0-769"></a>        <span class="p">)</span>
<a id="__codelineno-0-770" name="__codelineno-0-770"></a>
<a id="__codelineno-0-771" name="__codelineno-0-771"></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-772" name="__codelineno-0-772"></a>        <span class="k">yield</span> <span class="k">await</span> <span class="n">process_update</span><span class="p">(</span>
<a id="__codelineno-0-773" name="__codelineno-0-773"></a>            <span class="n">error</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Error preprocessing collection: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-0-774" name="__codelineno-0-774"></a>        <span class="p">)</span>
<a id="__codelineno-0-775" name="__codelineno-0-775"></a>
<a id="__codelineno-0-776" name="__codelineno-0-776"></a>    <span class="k">finally</span><span class="p">:</span>
<a id="__codelineno-0-777" name="__codelineno-0-777"></a>        <span class="k">if</span> <span class="n">close_clients_after_completion</span><span class="p">:</span>
<a id="__codelineno-0-778" name="__codelineno-0-778"></a>            <span class="k">await</span> <span class="n">client_manager</span><span class="o">.</span><span class="n">close_clients</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="elysia.preprocessing.collection.preprocessed_collection_exists" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">preprocessed_collection_exists</span><span class="p">(</span><span class="n">collection_name</span><span class="p">,</span> <span class="n">client_manager</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Check if the preprocessed collection exists in the Weaviate cluster.
This function simply checks if the cached preprocessed metadata exists in the Weaviate cluster.
It does so by checking if the collection name exists in the ELYSIA_METADATA__ collection.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>collection_name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The name of the collection to check.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>client_manager</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="ClientManager (elysia.util.client.ClientManager)" href="../Client/#elysia.util.client.ClientManager">ClientManager</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The client manager to use.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>elysia/preprocessing/collection.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-955">955</a></span>
<span class="normal"><a href="#__codelineno-0-956">956</a></span>
<span class="normal"><a href="#__codelineno-0-957">957</a></span>
<span class="normal"><a href="#__codelineno-0-958">958</a></span>
<span class="normal"><a href="#__codelineno-0-959">959</a></span>
<span class="normal"><a href="#__codelineno-0-960">960</a></span>
<span class="normal"><a href="#__codelineno-0-961">961</a></span>
<span class="normal"><a href="#__codelineno-0-962">962</a></span>
<span class="normal"><a href="#__codelineno-0-963">963</a></span>
<span class="normal"><a href="#__codelineno-0-964">964</a></span>
<span class="normal"><a href="#__codelineno-0-965">965</a></span>
<span class="normal"><a href="#__codelineno-0-966">966</a></span>
<span class="normal"><a href="#__codelineno-0-967">967</a></span>
<span class="normal"><a href="#__codelineno-0-968">968</a></span>
<span class="normal"><a href="#__codelineno-0-969">969</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-955" name="__codelineno-0-955"></a><span class="k">def</span><span class="w"> </span><span class="nf">preprocessed_collection_exists</span><span class="p">(</span>
<a id="__codelineno-0-956" name="__codelineno-0-956"></a>    <span class="n">collection_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">client_manager</span><span class="p">:</span> <span class="n">ClientManager</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-957" name="__codelineno-0-957"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<a id="__codelineno-0-958" name="__codelineno-0-958"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-959" name="__codelineno-0-959"></a><span class="sd">    Check if the preprocessed collection exists in the Weaviate cluster.</span>
<a id="__codelineno-0-960" name="__codelineno-0-960"></a><span class="sd">    This function simply checks if the cached preprocessed metadata exists in the Weaviate cluster.</span>
<a id="__codelineno-0-961" name="__codelineno-0-961"></a><span class="sd">    It does so by checking if the collection name exists in the ELYSIA_METADATA__ collection.</span>
<a id="__codelineno-0-962" name="__codelineno-0-962"></a>
<a id="__codelineno-0-963" name="__codelineno-0-963"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-964" name="__codelineno-0-964"></a><span class="sd">        collection_name (str): The name of the collection to check.</span>
<a id="__codelineno-0-965" name="__codelineno-0-965"></a><span class="sd">        client_manager (ClientManager): The client manager to use.</span>
<a id="__codelineno-0-966" name="__codelineno-0-966"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-967" name="__codelineno-0-967"></a>    <span class="k">return</span> <span class="n">asyncio_run</span><span class="p">(</span>
<a id="__codelineno-0-968" name="__codelineno-0-968"></a>        <span class="n">preprocessed_collection_exists_async</span><span class="p">(</span><span class="n">collection_name</span><span class="p">,</span> <span class="n">client_manager</span><span class="p">)</span>
<a id="__codelineno-0-969" name="__codelineno-0-969"></a>    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="elysia.preprocessing.collection.preprocessed_collection_exists_async" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">preprocessed_collection_exists_async</span><span class="p">(</span><span class="n">collection_name</span><span class="p">,</span> <span class="n">client_manager</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h2>


    <div class="doc doc-contents ">

        <p>Async version of <code>preprocessed_collection_exists</code>.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>collection_name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The name of the collection to check.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>client_manager</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="ClientManager (elysia.util.client.ClientManager)" href="../Client/#elysia.util.client.ClientManager">ClientManager</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The client manager to use.
If not provided, a new ClientManager will be created using the environment variables/configured settings.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>bool</code></td>            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True if the collection exists, False otherwise.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>elysia/preprocessing/collection.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-919">919</a></span>
<span class="normal"><a href="#__codelineno-0-920">920</a></span>
<span class="normal"><a href="#__codelineno-0-921">921</a></span>
<span class="normal"><a href="#__codelineno-0-922">922</a></span>
<span class="normal"><a href="#__codelineno-0-923">923</a></span>
<span class="normal"><a href="#__codelineno-0-924">924</a></span>
<span class="normal"><a href="#__codelineno-0-925">925</a></span>
<span class="normal"><a href="#__codelineno-0-926">926</a></span>
<span class="normal"><a href="#__codelineno-0-927">927</a></span>
<span class="normal"><a href="#__codelineno-0-928">928</a></span>
<span class="normal"><a href="#__codelineno-0-929">929</a></span>
<span class="normal"><a href="#__codelineno-0-930">930</a></span>
<span class="normal"><a href="#__codelineno-0-931">931</a></span>
<span class="normal"><a href="#__codelineno-0-932">932</a></span>
<span class="normal"><a href="#__codelineno-0-933">933</a></span>
<span class="normal"><a href="#__codelineno-0-934">934</a></span>
<span class="normal"><a href="#__codelineno-0-935">935</a></span>
<span class="normal"><a href="#__codelineno-0-936">936</a></span>
<span class="normal"><a href="#__codelineno-0-937">937</a></span>
<span class="normal"><a href="#__codelineno-0-938">938</a></span>
<span class="normal"><a href="#__codelineno-0-939">939</a></span>
<span class="normal"><a href="#__codelineno-0-940">940</a></span>
<span class="normal"><a href="#__codelineno-0-941">941</a></span>
<span class="normal"><a href="#__codelineno-0-942">942</a></span>
<span class="normal"><a href="#__codelineno-0-943">943</a></span>
<span class="normal"><a href="#__codelineno-0-944">944</a></span>
<span class="normal"><a href="#__codelineno-0-945">945</a></span>
<span class="normal"><a href="#__codelineno-0-946">946</a></span>
<span class="normal"><a href="#__codelineno-0-947">947</a></span>
<span class="normal"><a href="#__codelineno-0-948">948</a></span>
<span class="normal"><a href="#__codelineno-0-949">949</a></span>
<span class="normal"><a href="#__codelineno-0-950">950</a></span>
<span class="normal"><a href="#__codelineno-0-951">951</a></span>
<span class="normal"><a href="#__codelineno-0-952">952</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-919" name="__codelineno-0-919"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">preprocessed_collection_exists_async</span><span class="p">(</span>
<a id="__codelineno-0-920" name="__codelineno-0-920"></a>    <span class="n">collection_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">client_manager</span><span class="p">:</span> <span class="n">ClientManager</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-921" name="__codelineno-0-921"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<a id="__codelineno-0-922" name="__codelineno-0-922"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-923" name="__codelineno-0-923"></a><span class="sd">    Async version of `preprocessed_collection_exists`.</span>
<a id="__codelineno-0-924" name="__codelineno-0-924"></a>
<a id="__codelineno-0-925" name="__codelineno-0-925"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-926" name="__codelineno-0-926"></a><span class="sd">        collection_name (str): The name of the collection to check.</span>
<a id="__codelineno-0-927" name="__codelineno-0-927"></a><span class="sd">        client_manager (ClientManager): The client manager to use.</span>
<a id="__codelineno-0-928" name="__codelineno-0-928"></a><span class="sd">            If not provided, a new ClientManager will be created using the environment variables/configured settings.</span>
<a id="__codelineno-0-929" name="__codelineno-0-929"></a>
<a id="__codelineno-0-930" name="__codelineno-0-930"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-931" name="__codelineno-0-931"></a><span class="sd">        bool: True if the collection exists, False otherwise.</span>
<a id="__codelineno-0-932" name="__codelineno-0-932"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-933" name="__codelineno-0-933"></a>    <span class="k">if</span> <span class="n">client_manager</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-934" name="__codelineno-0-934"></a>        <span class="n">client_manager</span> <span class="o">=</span> <span class="n">ClientManager</span><span class="p">()</span>
<a id="__codelineno-0-935" name="__codelineno-0-935"></a>        <span class="n">close_clients_after_completion</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-936" name="__codelineno-0-936"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-937" name="__codelineno-0-937"></a>        <span class="n">close_clients_after_completion</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-938" name="__codelineno-0-938"></a>
<a id="__codelineno-0-939" name="__codelineno-0-939"></a>    <span class="k">async</span> <span class="k">with</span> <span class="n">client_manager</span><span class="o">.</span><span class="n">connect_to_async_client</span><span class="p">()</span> <span class="k">as</span> <span class="n">client</span><span class="p">:</span>
<a id="__codelineno-0-940" name="__codelineno-0-940"></a>        <span class="n">metadata_exists</span> <span class="o">=</span> <span class="k">await</span> <span class="n">client</span><span class="o">.</span><span class="n">collections</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ELYSIA_METADATA__&quot;</span><span class="p">)</span>
<a id="__codelineno-0-941" name="__codelineno-0-941"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">metadata_exists</span><span class="p">:</span>
<a id="__codelineno-0-942" name="__codelineno-0-942"></a>            <span class="k">return</span> <span class="kc">False</span>
<a id="__codelineno-0-943" name="__codelineno-0-943"></a>
<a id="__codelineno-0-944" name="__codelineno-0-944"></a>        <span class="n">metadata_collection</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">collections</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;ELYSIA_METADATA__&quot;</span><span class="p">)</span>
<a id="__codelineno-0-945" name="__codelineno-0-945"></a>        <span class="n">metadata</span> <span class="o">=</span> <span class="k">await</span> <span class="n">metadata_collection</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">fetch_objects</span><span class="p">(</span>
<a id="__codelineno-0-946" name="__codelineno-0-946"></a>            <span class="n">filters</span><span class="o">=</span><span class="n">Filter</span><span class="o">.</span><span class="n">by_property</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">equal</span><span class="p">(</span><span class="n">collection_name</span><span class="p">)</span>
<a id="__codelineno-0-947" name="__codelineno-0-947"></a>        <span class="p">)</span>
<a id="__codelineno-0-948" name="__codelineno-0-948"></a>
<a id="__codelineno-0-949" name="__codelineno-0-949"></a>    <span class="k">if</span> <span class="n">close_clients_after_completion</span><span class="p">:</span>
<a id="__codelineno-0-950" name="__codelineno-0-950"></a>        <span class="k">await</span> <span class="n">client_manager</span><span class="o">.</span><span class="n">close_clients</span><span class="p">()</span>
<a id="__codelineno-0-951" name="__codelineno-0-951"></a>
<a id="__codelineno-0-952" name="__codelineno-0-952"></a>    <span class="k">return</span> <span class="n">metadata</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">metadata</span><span class="o">.</span><span class="n">objects</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="elysia.preprocessing.collection.view_preprocessed_collection" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">view_preprocessed_collection</span><span class="p">(</span><span class="n">collection_name</span><span class="p">,</span> <span class="n">client_manager</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>View a preprocessed collection.
This function allows you to view the preprocessed collection generated by the preprocess function.
It does so by querying the ELYSIA_METADATA__ collection.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>collection_name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The name of the collection to view.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>client_manager</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="ClientManager (elysia.util.client.ClientManager)" href="../Client/#elysia.util.client.ClientManager">ClientManager</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The client manager to use.
If not provided, a new ClientManager will be created using the environment variables/configured settings.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>dict</code></td>            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The preprocessed collection.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>elysia/preprocessing/collection.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1238">1238</a></span>
<span class="normal"><a href="#__codelineno-0-1239">1239</a></span>
<span class="normal"><a href="#__codelineno-0-1240">1240</a></span>
<span class="normal"><a href="#__codelineno-0-1241">1241</a></span>
<span class="normal"><a href="#__codelineno-0-1242">1242</a></span>
<span class="normal"><a href="#__codelineno-0-1243">1243</a></span>
<span class="normal"><a href="#__codelineno-0-1244">1244</a></span>
<span class="normal"><a href="#__codelineno-0-1245">1245</a></span>
<span class="normal"><a href="#__codelineno-0-1246">1246</a></span>
<span class="normal"><a href="#__codelineno-0-1247">1247</a></span>
<span class="normal"><a href="#__codelineno-0-1248">1248</a></span>
<span class="normal"><a href="#__codelineno-0-1249">1249</a></span>
<span class="normal"><a href="#__codelineno-0-1250">1250</a></span>
<span class="normal"><a href="#__codelineno-0-1251">1251</a></span>
<span class="normal"><a href="#__codelineno-0-1252">1252</a></span>
<span class="normal"><a href="#__codelineno-0-1253">1253</a></span>
<span class="normal"><a href="#__codelineno-0-1254">1254</a></span>
<span class="normal"><a href="#__codelineno-0-1255">1255</a></span>
<span class="normal"><a href="#__codelineno-0-1256">1256</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1238" name="__codelineno-0-1238"></a><span class="k">def</span><span class="w"> </span><span class="nf">view_preprocessed_collection</span><span class="p">(</span>
<a id="__codelineno-0-1239" name="__codelineno-0-1239"></a>    <span class="n">collection_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">client_manager</span><span class="p">:</span> <span class="n">ClientManager</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-1240" name="__codelineno-0-1240"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<a id="__codelineno-0-1241" name="__codelineno-0-1241"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1242" name="__codelineno-0-1242"></a><span class="sd">    View a preprocessed collection.</span>
<a id="__codelineno-0-1243" name="__codelineno-0-1243"></a><span class="sd">    This function allows you to view the preprocessed collection generated by the preprocess function.</span>
<a id="__codelineno-0-1244" name="__codelineno-0-1244"></a><span class="sd">    It does so by querying the ELYSIA_METADATA__ collection.</span>
<a id="__codelineno-0-1245" name="__codelineno-0-1245"></a>
<a id="__codelineno-0-1246" name="__codelineno-0-1246"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-1247" name="__codelineno-0-1247"></a><span class="sd">        collection_name (str): The name of the collection to view.</span>
<a id="__codelineno-0-1248" name="__codelineno-0-1248"></a><span class="sd">        client_manager (ClientManager): The client manager to use.</span>
<a id="__codelineno-0-1249" name="__codelineno-0-1249"></a><span class="sd">            If not provided, a new ClientManager will be created using the environment variables/configured settings.</span>
<a id="__codelineno-0-1250" name="__codelineno-0-1250"></a>
<a id="__codelineno-0-1251" name="__codelineno-0-1251"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-1252" name="__codelineno-0-1252"></a><span class="sd">        dict: The preprocessed collection.</span>
<a id="__codelineno-0-1253" name="__codelineno-0-1253"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1254" name="__codelineno-0-1254"></a>    <span class="k">return</span> <span class="n">asyncio_run</span><span class="p">(</span>
<a id="__codelineno-0-1255" name="__codelineno-0-1255"></a>        <span class="n">view_preprocessed_collection_async</span><span class="p">(</span><span class="n">collection_name</span><span class="p">,</span> <span class="n">client_manager</span><span class="p">)</span>
<a id="__codelineno-0-1256" name="__codelineno-0-1256"></a>    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="elysia.preprocessing.collection.view_preprocessed_collection_async" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">view_preprocessed_collection_async</span><span class="p">(</span><span class="n">collection_name</span><span class="p">,</span> <span class="n">client_manager</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h2>


    <div class="doc doc-contents ">

        <p>Async version of <code>view_preprocessed_collection</code>.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>collection_name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The name of the collection to view.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>client_manager</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="ClientManager (elysia.util.client.ClientManager)" href="../Client/#elysia.util.client.ClientManager">ClientManager</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The client manager to use.
If not provided, a new ClientManager will be created using the environment variables/configured settings.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>dict</code></td>            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The preprocessed collection.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>elysia/preprocessing/collection.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1259">1259</a></span>
<span class="normal"><a href="#__codelineno-0-1260">1260</a></span>
<span class="normal"><a href="#__codelineno-0-1261">1261</a></span>
<span class="normal"><a href="#__codelineno-0-1262">1262</a></span>
<span class="normal"><a href="#__codelineno-0-1263">1263</a></span>
<span class="normal"><a href="#__codelineno-0-1264">1264</a></span>
<span class="normal"><a href="#__codelineno-0-1265">1265</a></span>
<span class="normal"><a href="#__codelineno-0-1266">1266</a></span>
<span class="normal"><a href="#__codelineno-0-1267">1267</a></span>
<span class="normal"><a href="#__codelineno-0-1268">1268</a></span>
<span class="normal"><a href="#__codelineno-0-1269">1269</a></span>
<span class="normal"><a href="#__codelineno-0-1270">1270</a></span>
<span class="normal"><a href="#__codelineno-0-1271">1271</a></span>
<span class="normal"><a href="#__codelineno-0-1272">1272</a></span>
<span class="normal"><a href="#__codelineno-0-1273">1273</a></span>
<span class="normal"><a href="#__codelineno-0-1274">1274</a></span>
<span class="normal"><a href="#__codelineno-0-1275">1275</a></span>
<span class="normal"><a href="#__codelineno-0-1276">1276</a></span>
<span class="normal"><a href="#__codelineno-0-1277">1277</a></span>
<span class="normal"><a href="#__codelineno-0-1278">1278</a></span>
<span class="normal"><a href="#__codelineno-0-1279">1279</a></span>
<span class="normal"><a href="#__codelineno-0-1280">1280</a></span>
<span class="normal"><a href="#__codelineno-0-1281">1281</a></span>
<span class="normal"><a href="#__codelineno-0-1282">1282</a></span>
<span class="normal"><a href="#__codelineno-0-1283">1283</a></span>
<span class="normal"><a href="#__codelineno-0-1284">1284</a></span>
<span class="normal"><a href="#__codelineno-0-1285">1285</a></span>
<span class="normal"><a href="#__codelineno-0-1286">1286</a></span>
<span class="normal"><a href="#__codelineno-0-1287">1287</a></span>
<span class="normal"><a href="#__codelineno-0-1288">1288</a></span>
<span class="normal"><a href="#__codelineno-0-1289">1289</a></span>
<span class="normal"><a href="#__codelineno-0-1290">1290</a></span>
<span class="normal"><a href="#__codelineno-0-1291">1291</a></span>
<span class="normal"><a href="#__codelineno-0-1292">1292</a></span>
<span class="normal"><a href="#__codelineno-0-1293">1293</a></span>
<span class="normal"><a href="#__codelineno-0-1294">1294</a></span>
<span class="normal"><a href="#__codelineno-0-1295">1295</a></span>
<span class="normal"><a href="#__codelineno-0-1296">1296</a></span>
<span class="normal"><a href="#__codelineno-0-1297">1297</a></span>
<span class="normal"><a href="#__codelineno-0-1298">1298</a></span>
<span class="normal"><a href="#__codelineno-0-1299">1299</a></span>
<span class="normal"><a href="#__codelineno-0-1300">1300</a></span>
<span class="normal"><a href="#__codelineno-0-1301">1301</a></span>
<span class="normal"><a href="#__codelineno-0-1302">1302</a></span>
<span class="normal"><a href="#__codelineno-0-1303">1303</a></span>
<span class="normal"><a href="#__codelineno-0-1304">1304</a></span>
<span class="normal"><a href="#__codelineno-0-1305">1305</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1259" name="__codelineno-0-1259"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">view_preprocessed_collection_async</span><span class="p">(</span>
<a id="__codelineno-0-1260" name="__codelineno-0-1260"></a>    <span class="n">collection_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">client_manager</span><span class="p">:</span> <span class="n">ClientManager</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-1261" name="__codelineno-0-1261"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<a id="__codelineno-0-1262" name="__codelineno-0-1262"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1263" name="__codelineno-0-1263"></a><span class="sd">    Async version of `view_preprocessed_collection`.</span>
<a id="__codelineno-0-1264" name="__codelineno-0-1264"></a>
<a id="__codelineno-0-1265" name="__codelineno-0-1265"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-1266" name="__codelineno-0-1266"></a><span class="sd">        collection_name (str): The name of the collection to view.</span>
<a id="__codelineno-0-1267" name="__codelineno-0-1267"></a><span class="sd">        client_manager (ClientManager): The client manager to use.</span>
<a id="__codelineno-0-1268" name="__codelineno-0-1268"></a><span class="sd">            If not provided, a new ClientManager will be created using the environment variables/configured settings.</span>
<a id="__codelineno-0-1269" name="__codelineno-0-1269"></a>
<a id="__codelineno-0-1270" name="__codelineno-0-1270"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-1271" name="__codelineno-0-1271"></a><span class="sd">        dict: The preprocessed collection.</span>
<a id="__codelineno-0-1272" name="__codelineno-0-1272"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1273" name="__codelineno-0-1273"></a>
<a id="__codelineno-0-1274" name="__codelineno-0-1274"></a>    <span class="k">if</span> <span class="n">client_manager</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1275" name="__codelineno-0-1275"></a>        <span class="n">client_manager</span> <span class="o">=</span> <span class="n">ClientManager</span><span class="p">()</span>
<a id="__codelineno-0-1276" name="__codelineno-0-1276"></a>        <span class="n">close_clients_after_completion</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-1277" name="__codelineno-0-1277"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1278" name="__codelineno-0-1278"></a>        <span class="n">close_clients_after_completion</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-1279" name="__codelineno-0-1279"></a>
<a id="__codelineno-0-1280" name="__codelineno-0-1280"></a>    <span class="k">async</span> <span class="k">with</span> <span class="n">client_manager</span><span class="o">.</span><span class="n">connect_to_async_client</span><span class="p">()</span> <span class="k">as</span> <span class="n">client</span><span class="p">:</span>
<a id="__codelineno-0-1281" name="__codelineno-0-1281"></a>        <span class="n">metadata_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;ELYSIA_METADATA__&quot;</span>
<a id="__codelineno-0-1282" name="__codelineno-0-1282"></a>
<a id="__codelineno-0-1283" name="__codelineno-0-1283"></a>        <span class="c1"># check if the collection itself exists</span>
<a id="__codelineno-0-1284" name="__codelineno-0-1284"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="k">await</span> <span class="n">client</span><span class="o">.</span><span class="n">collections</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">collection_name</span><span class="p">):</span>
<a id="__codelineno-0-1285" name="__codelineno-0-1285"></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Collection </span><span class="si">{</span><span class="n">collection_name</span><span class="si">}</span><span class="s2"> does not exist&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1286" name="__codelineno-0-1286"></a>
<a id="__codelineno-0-1287" name="__codelineno-0-1287"></a>        <span class="c1"># check if the metadata collection exists</span>
<a id="__codelineno-0-1288" name="__codelineno-0-1288"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="k">await</span> <span class="n">client</span><span class="o">.</span><span class="n">collections</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">metadata_name</span><span class="p">):</span>
<a id="__codelineno-0-1289" name="__codelineno-0-1289"></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Metadata collection does not exist&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1290" name="__codelineno-0-1290"></a>
<a id="__codelineno-0-1291" name="__codelineno-0-1291"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1292" name="__codelineno-0-1292"></a>            <span class="n">metadata_collection</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">collections</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">metadata_name</span><span class="p">)</span>
<a id="__codelineno-0-1293" name="__codelineno-0-1293"></a>            <span class="n">metadata</span> <span class="o">=</span> <span class="k">await</span> <span class="n">metadata_collection</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">fetch_objects</span><span class="p">(</span>
<a id="__codelineno-0-1294" name="__codelineno-0-1294"></a>                <span class="n">filters</span><span class="o">=</span><span class="n">Filter</span><span class="o">.</span><span class="n">by_property</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">equal</span><span class="p">(</span><span class="n">collection_name</span><span class="p">),</span>
<a id="__codelineno-0-1295" name="__codelineno-0-1295"></a>                <span class="n">limit</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-0-1296" name="__codelineno-0-1296"></a>            <span class="p">)</span>
<a id="__codelineno-0-1297" name="__codelineno-0-1297"></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">metadata</span><span class="o">.</span><span class="n">objects</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-1298" name="__codelineno-0-1298"></a>                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Metadata for </span><span class="si">{</span><span class="n">collection_name</span><span class="si">}</span><span class="s2"> does not exist&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1299" name="__codelineno-0-1299"></a>
<a id="__codelineno-0-1300" name="__codelineno-0-1300"></a>            <span class="n">properties</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="n">metadata</span><span class="o">.</span><span class="n">objects</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">properties</span>  <span class="c1"># type: ignore</span>
<a id="__codelineno-0-1301" name="__codelineno-0-1301"></a>
<a id="__codelineno-0-1302" name="__codelineno-0-1302"></a>    <span class="k">if</span> <span class="n">close_clients_after_completion</span><span class="p">:</span>
<a id="__codelineno-0-1303" name="__codelineno-0-1303"></a>        <span class="k">await</span> <span class="n">client_manager</span><span class="o">.</span><span class="n">close_clients</span><span class="p">()</span>
<a id="__codelineno-0-1304" name="__codelineno-0-1304"></a>
<a id="__codelineno-0-1305" name="__codelineno-0-1305"></a>    <span class="k">return</span> <span class="n">properties</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>







  
  






                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        
<div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/weaviate/elysia" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://github.com/weaviate/elysia-frontend" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://github.com/dannyjameswilliams" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M202.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1M496 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2m-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3m-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://github.com/thomashacker" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M202.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1M496 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2m-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3m-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://www.linkedin.com/in/dannyjameswilliams/" target="_blank" rel="noopener" title="www.linkedin.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3M135.4 416H69V202.2h66.5V416zM102.2 96a38.5 38.5 0 1 1 0 77 38.5 38.5 0 1 1 0-77m282.1 320h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://www.linkedin.com/in/edwardschmuhl/" target="_blank" rel="noopener" title="www.linkedin.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3M135.4 416H69V202.2h66.5V416zM102.2 96a38.5 38.5 0 1 1 0 77 38.5 38.5 0 1 1 0-77m282.1 320h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.tabs", "navigation.sections", "toc.integrate", "navigation.top", "search.suggest", "search.highlight", "content.tabs.link", "content.code.annotation", "content.code.copy"], "search": "../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.92b07e13.min.js"></script>
      
        <script src="../../javascripts/mathjax.js"></script>
      
        <script src="https://unpkg.com/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>