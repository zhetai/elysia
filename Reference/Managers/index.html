
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../Client/">
      
      
        <link rel="next" href="../Settings/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.18">
    
    
      
        <title>Managers - Elysia API</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.7e37652d.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
      
        <meta  property="og:type"  content="website" >
      
        <meta  property="og:title"  content="Managers - Elysia API" >
      
        <meta  property="og:description"  content="None" >
      
        <meta  property="og:image"  content="./assets/images/social/Reference/Managers.png" >
      
        <meta  property="og:image:type"  content="image/png" >
      
        <meta  property="og:image:width"  content="1200" >
      
        <meta  property="og:image:height"  content="630" >
      
        <meta  property="og:url"  content="None" >
      
        <meta  name="twitter:card"  content="summary_large_image" >
      
        <meta  name="twitter:title"  content="Managers - Elysia API" >
      
        <meta  name="twitter:description"  content="None" >
      
        <meta  name="twitter:image"  content="./assets/images/social/Reference/Managers.png" >
      
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="purple">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#elysia.api.services.user" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Elysia API" class="md-header__button md-logo" aria-label="Elysia API" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Elysia API
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Managers
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="purple"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6m0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4M7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="teal" data-md-color-accent="lime"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
  
    
  
  Getting Started

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../setting_up/" class="md-tabs__link">
        
  
  
    
  
  Setting Up

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../basic/" class="md-tabs__link">
        
  
  
    
  
  Basic Usage

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../advanced_usage/" class="md-tabs__link">
        
  
  
    
  
  Customising Elysia

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../creating_tools/" class="md-tabs__link">
        
  
  
    
  
  Creating a Tool

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../Advanced/" class="md-tabs__link">
          
  
  
  Advanced

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../API/" class="md-tabs__link">
          
  
  
  API

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../Examples/" class="md-tabs__link">
          
  
  
  Examples

        </a>
      </li>
    
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../Preprocessor/" class="md-tabs__link">
          
  
  
  Reference

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Elysia API" class="md-nav__button md-logo" aria-label="Elysia API" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Elysia API
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Getting Started
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../setting_up/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Setting Up
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../basic/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Basic Usage
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../advanced_usage/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Customising Elysia
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../creating_tools/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Creating a Tool
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Advanced
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Advanced
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Advanced/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Advanced/technical_overview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Technical Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Advanced/advanced_tool_construction/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Tool Construction
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Advanced/custom_objects/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Custom Objects
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Advanced/environment/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Environment
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    API
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            API
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../API/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../API/user_and_tree_managers/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    User Management
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../API/payload_formats/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Payload Formats
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" >
        
          
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Examples
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            Examples
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Examples/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Index
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Examples/query_weaviate/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Querying Weaviate
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Examples/data_analysis/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Basic Linear Regression
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9" checked>
        
          
          <label class="md-nav__link" for="__nav_9" id="__nav_9_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Reference
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_9_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_9">
            <span class="md-nav__icon md-icon"></span>
            Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Preprocessor/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Preprocessor
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Tree/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Tree
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Client/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    WeaviateClient
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Managers
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Managers
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#elysia.api.services.user" class="md-nav__link">
    <span class="md-ellipsis">
      user
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#elysia.api.services.user.UserManager" class="md-nav__link">
    <span class="md-ellipsis">
      UserManager
    </span>
  </a>
  
    <nav class="md-nav" aria-label="UserManager">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#elysia.api.services.user.UserManager.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elysia.api.services.user.UserManager.add_user_local" class="md-nav__link">
    <span class="md-ellipsis">
      add_user_local
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elysia.api.services.user.UserManager.check_all_trees_timeout" class="md-nav__link">
    <span class="md-ellipsis">
      check_all_trees_timeout
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elysia.api.services.user.UserManager.check_all_users_timeout" class="md-nav__link">
    <span class="md-ellipsis">
      check_all_users_timeout
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elysia.api.services.user.UserManager.check_restart_clients" class="md-nav__link">
    <span class="md-ellipsis">
      check_restart_clients
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elysia.api.services.user.UserManager.check_tree_exists_weaviate" class="md-nav__link">
    <span class="md-ellipsis">
      check_tree_exists_weaviate
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elysia.api.services.user.UserManager.check_user_timeout" class="md-nav__link">
    <span class="md-ellipsis">
      check_user_timeout
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elysia.api.services.user.UserManager.close_all_clients" class="md-nav__link">
    <span class="md-ellipsis">
      close_all_clients
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elysia.api.services.user.UserManager.delete_tree" class="md-nav__link">
    <span class="md-ellipsis">
      delete_tree
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elysia.api.services.user.UserManager.get_saved_trees" class="md-nav__link">
    <span class="md-ellipsis">
      get_saved_trees
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elysia.api.services.user.UserManager.get_tree" class="md-nav__link">
    <span class="md-ellipsis">
      get_tree
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elysia.api.services.user.UserManager.get_user_local" class="md-nav__link">
    <span class="md-ellipsis">
      get_user_local
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elysia.api.services.user.UserManager.initialise_tree" class="md-nav__link">
    <span class="md-ellipsis">
      initialise_tree
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elysia.api.services.user.UserManager.load_tree" class="md-nav__link">
    <span class="md-ellipsis">
      load_tree
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elysia.api.services.user.UserManager.process_tree" class="md-nav__link">
    <span class="md-ellipsis">
      process_tree
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elysia.api.services.user.UserManager.save_tree" class="md-nav__link">
    <span class="md-ellipsis">
      save_tree
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#elysia.api.services.tree" class="md-nav__link">
    <span class="md-ellipsis">
      tree
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#elysia.api.services.tree.TreeManager" class="md-nav__link">
    <span class="md-ellipsis">
      TreeManager
    </span>
  </a>
  
    <nav class="md-nav" aria-label="TreeManager">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#elysia.api.services.tree.TreeManager.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elysia.api.services.tree.TreeManager.add_tree" class="md-nav__link">
    <span class="md-ellipsis">
      add_tree
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elysia.api.services.tree.TreeManager.change_agent_description" class="md-nav__link">
    <span class="md-ellipsis">
      change_agent_description
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elysia.api.services.tree.TreeManager.change_branch_initialisation" class="md-nav__link">
    <span class="md-ellipsis">
      change_branch_initialisation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elysia.api.services.tree.TreeManager.change_end_goal" class="md-nav__link">
    <span class="md-ellipsis">
      change_end_goal
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elysia.api.services.tree.TreeManager.change_style" class="md-nav__link">
    <span class="md-ellipsis">
      change_style
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elysia.api.services.tree.TreeManager.check_all_trees_timeout" class="md-nav__link">
    <span class="md-ellipsis">
      check_all_trees_timeout
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elysia.api.services.tree.TreeManager.check_tree_exists_weaviate" class="md-nav__link">
    <span class="md-ellipsis">
      check_tree_exists_weaviate
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elysia.api.services.tree.TreeManager.check_tree_timeout" class="md-nav__link">
    <span class="md-ellipsis">
      check_tree_timeout
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elysia.api.services.tree.TreeManager.configure" class="md-nav__link">
    <span class="md-ellipsis">
      configure
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elysia.api.services.tree.TreeManager.delete_tree_local" class="md-nav__link">
    <span class="md-ellipsis">
      delete_tree_local
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elysia.api.services.tree.TreeManager.delete_tree_weaviate" class="md-nav__link">
    <span class="md-ellipsis">
      delete_tree_weaviate
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elysia.api.services.tree.TreeManager.get_event" class="md-nav__link">
    <span class="md-ellipsis">
      get_event
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elysia.api.services.tree.TreeManager.get_tree" class="md-nav__link">
    <span class="md-ellipsis">
      get_tree
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elysia.api.services.tree.TreeManager.load_tree_weaviate" class="md-nav__link">
    <span class="md-ellipsis">
      load_tree_weaviate
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elysia.api.services.tree.TreeManager.process_tree" class="md-nav__link">
    <span class="md-ellipsis">
      process_tree
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elysia.api.services.tree.TreeManager.save_tree_weaviate" class="md-nav__link">
    <span class="md-ellipsis">
      save_tree_weaviate
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elysia.api.services.tree.TreeManager.tree_exists" class="md-nav__link">
    <span class="md-ellipsis">
      tree_exists
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Settings/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Settings
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Objects/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Objects
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../PayloadTypes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Payload Types
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Util/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Util
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



  <h1>Managers</h1>

<div class="doc doc-object doc-module">



<a id="elysia.api.services.user"></a>
    <div class="doc doc-contents first">










  <div class="doc doc-children">









<div class="doc doc-object doc-class">



<h2 id="elysia.api.services.user.UserManager" class="doc doc-heading">
            <code>UserManager</code>


</h2>


    <div class="doc doc-contents ">


        <p>The UserManager is designed to manage, for each user:</p>
<ul>
<li>TreeManager</li>
<li>ClientManager</li>
<li>FrontendConfig</li>
</ul>
<p>It contains methods for creating and updating these objects across a range of users, stored in a dictionary.
It can be used as a dependency injection container for FastAPI.
The user manager/tree manager is decoupled from the core of the Elysia package functionality.
It is designed to be used to manage separate Elysia instances, set of trees (via tree managers), configs, etc.</p>








              <details class="quote">
                <summary>Source code in <code>elysia/api/services/user.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-0-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-0-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-0-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-0-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-0-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-0-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-0-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-0-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-0-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-0-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-0-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-0-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-0-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-0-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-0-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-0-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-0-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-0-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-0-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-0-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-0-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-0-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-0-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-0-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-0-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-0-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-0-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-0-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span>
<span class="normal"><a href="#__codelineno-0-149">149</a></span>
<span class="normal"><a href="#__codelineno-0-150">150</a></span>
<span class="normal"><a href="#__codelineno-0-151">151</a></span>
<span class="normal"><a href="#__codelineno-0-152">152</a></span>
<span class="normal"><a href="#__codelineno-0-153">153</a></span>
<span class="normal"><a href="#__codelineno-0-154">154</a></span>
<span class="normal"><a href="#__codelineno-0-155">155</a></span>
<span class="normal"><a href="#__codelineno-0-156">156</a></span>
<span class="normal"><a href="#__codelineno-0-157">157</a></span>
<span class="normal"><a href="#__codelineno-0-158">158</a></span>
<span class="normal"><a href="#__codelineno-0-159">159</a></span>
<span class="normal"><a href="#__codelineno-0-160">160</a></span>
<span class="normal"><a href="#__codelineno-0-161">161</a></span>
<span class="normal"><a href="#__codelineno-0-162">162</a></span>
<span class="normal"><a href="#__codelineno-0-163">163</a></span>
<span class="normal"><a href="#__codelineno-0-164">164</a></span>
<span class="normal"><a href="#__codelineno-0-165">165</a></span>
<span class="normal"><a href="#__codelineno-0-166">166</a></span>
<span class="normal"><a href="#__codelineno-0-167">167</a></span>
<span class="normal"><a href="#__codelineno-0-168">168</a></span>
<span class="normal"><a href="#__codelineno-0-169">169</a></span>
<span class="normal"><a href="#__codelineno-0-170">170</a></span>
<span class="normal"><a href="#__codelineno-0-171">171</a></span>
<span class="normal"><a href="#__codelineno-0-172">172</a></span>
<span class="normal"><a href="#__codelineno-0-173">173</a></span>
<span class="normal"><a href="#__codelineno-0-174">174</a></span>
<span class="normal"><a href="#__codelineno-0-175">175</a></span>
<span class="normal"><a href="#__codelineno-0-176">176</a></span>
<span class="normal"><a href="#__codelineno-0-177">177</a></span>
<span class="normal"><a href="#__codelineno-0-178">178</a></span>
<span class="normal"><a href="#__codelineno-0-179">179</a></span>
<span class="normal"><a href="#__codelineno-0-180">180</a></span>
<span class="normal"><a href="#__codelineno-0-181">181</a></span>
<span class="normal"><a href="#__codelineno-0-182">182</a></span>
<span class="normal"><a href="#__codelineno-0-183">183</a></span>
<span class="normal"><a href="#__codelineno-0-184">184</a></span>
<span class="normal"><a href="#__codelineno-0-185">185</a></span>
<span class="normal"><a href="#__codelineno-0-186">186</a></span>
<span class="normal"><a href="#__codelineno-0-187">187</a></span>
<span class="normal"><a href="#__codelineno-0-188">188</a></span>
<span class="normal"><a href="#__codelineno-0-189">189</a></span>
<span class="normal"><a href="#__codelineno-0-190">190</a></span>
<span class="normal"><a href="#__codelineno-0-191">191</a></span>
<span class="normal"><a href="#__codelineno-0-192">192</a></span>
<span class="normal"><a href="#__codelineno-0-193">193</a></span>
<span class="normal"><a href="#__codelineno-0-194">194</a></span>
<span class="normal"><a href="#__codelineno-0-195">195</a></span>
<span class="normal"><a href="#__codelineno-0-196">196</a></span>
<span class="normal"><a href="#__codelineno-0-197">197</a></span>
<span class="normal"><a href="#__codelineno-0-198">198</a></span>
<span class="normal"><a href="#__codelineno-0-199">199</a></span>
<span class="normal"><a href="#__codelineno-0-200">200</a></span>
<span class="normal"><a href="#__codelineno-0-201">201</a></span>
<span class="normal"><a href="#__codelineno-0-202">202</a></span>
<span class="normal"><a href="#__codelineno-0-203">203</a></span>
<span class="normal"><a href="#__codelineno-0-204">204</a></span>
<span class="normal"><a href="#__codelineno-0-205">205</a></span>
<span class="normal"><a href="#__codelineno-0-206">206</a></span>
<span class="normal"><a href="#__codelineno-0-207">207</a></span>
<span class="normal"><a href="#__codelineno-0-208">208</a></span>
<span class="normal"><a href="#__codelineno-0-209">209</a></span>
<span class="normal"><a href="#__codelineno-0-210">210</a></span>
<span class="normal"><a href="#__codelineno-0-211">211</a></span>
<span class="normal"><a href="#__codelineno-0-212">212</a></span>
<span class="normal"><a href="#__codelineno-0-213">213</a></span>
<span class="normal"><a href="#__codelineno-0-214">214</a></span>
<span class="normal"><a href="#__codelineno-0-215">215</a></span>
<span class="normal"><a href="#__codelineno-0-216">216</a></span>
<span class="normal"><a href="#__codelineno-0-217">217</a></span>
<span class="normal"><a href="#__codelineno-0-218">218</a></span>
<span class="normal"><a href="#__codelineno-0-219">219</a></span>
<span class="normal"><a href="#__codelineno-0-220">220</a></span>
<span class="normal"><a href="#__codelineno-0-221">221</a></span>
<span class="normal"><a href="#__codelineno-0-222">222</a></span>
<span class="normal"><a href="#__codelineno-0-223">223</a></span>
<span class="normal"><a href="#__codelineno-0-224">224</a></span>
<span class="normal"><a href="#__codelineno-0-225">225</a></span>
<span class="normal"><a href="#__codelineno-0-226">226</a></span>
<span class="normal"><a href="#__codelineno-0-227">227</a></span>
<span class="normal"><a href="#__codelineno-0-228">228</a></span>
<span class="normal"><a href="#__codelineno-0-229">229</a></span>
<span class="normal"><a href="#__codelineno-0-230">230</a></span>
<span class="normal"><a href="#__codelineno-0-231">231</a></span>
<span class="normal"><a href="#__codelineno-0-232">232</a></span>
<span class="normal"><a href="#__codelineno-0-233">233</a></span>
<span class="normal"><a href="#__codelineno-0-234">234</a></span>
<span class="normal"><a href="#__codelineno-0-235">235</a></span>
<span class="normal"><a href="#__codelineno-0-236">236</a></span>
<span class="normal"><a href="#__codelineno-0-237">237</a></span>
<span class="normal"><a href="#__codelineno-0-238">238</a></span>
<span class="normal"><a href="#__codelineno-0-239">239</a></span>
<span class="normal"><a href="#__codelineno-0-240">240</a></span>
<span class="normal"><a href="#__codelineno-0-241">241</a></span>
<span class="normal"><a href="#__codelineno-0-242">242</a></span>
<span class="normal"><a href="#__codelineno-0-243">243</a></span>
<span class="normal"><a href="#__codelineno-0-244">244</a></span>
<span class="normal"><a href="#__codelineno-0-245">245</a></span>
<span class="normal"><a href="#__codelineno-0-246">246</a></span>
<span class="normal"><a href="#__codelineno-0-247">247</a></span>
<span class="normal"><a href="#__codelineno-0-248">248</a></span>
<span class="normal"><a href="#__codelineno-0-249">249</a></span>
<span class="normal"><a href="#__codelineno-0-250">250</a></span>
<span class="normal"><a href="#__codelineno-0-251">251</a></span>
<span class="normal"><a href="#__codelineno-0-252">252</a></span>
<span class="normal"><a href="#__codelineno-0-253">253</a></span>
<span class="normal"><a href="#__codelineno-0-254">254</a></span>
<span class="normal"><a href="#__codelineno-0-255">255</a></span>
<span class="normal"><a href="#__codelineno-0-256">256</a></span>
<span class="normal"><a href="#__codelineno-0-257">257</a></span>
<span class="normal"><a href="#__codelineno-0-258">258</a></span>
<span class="normal"><a href="#__codelineno-0-259">259</a></span>
<span class="normal"><a href="#__codelineno-0-260">260</a></span>
<span class="normal"><a href="#__codelineno-0-261">261</a></span>
<span class="normal"><a href="#__codelineno-0-262">262</a></span>
<span class="normal"><a href="#__codelineno-0-263">263</a></span>
<span class="normal"><a href="#__codelineno-0-264">264</a></span>
<span class="normal"><a href="#__codelineno-0-265">265</a></span>
<span class="normal"><a href="#__codelineno-0-266">266</a></span>
<span class="normal"><a href="#__codelineno-0-267">267</a></span>
<span class="normal"><a href="#__codelineno-0-268">268</a></span>
<span class="normal"><a href="#__codelineno-0-269">269</a></span>
<span class="normal"><a href="#__codelineno-0-270">270</a></span>
<span class="normal"><a href="#__codelineno-0-271">271</a></span>
<span class="normal"><a href="#__codelineno-0-272">272</a></span>
<span class="normal"><a href="#__codelineno-0-273">273</a></span>
<span class="normal"><a href="#__codelineno-0-274">274</a></span>
<span class="normal"><a href="#__codelineno-0-275">275</a></span>
<span class="normal"><a href="#__codelineno-0-276">276</a></span>
<span class="normal"><a href="#__codelineno-0-277">277</a></span>
<span class="normal"><a href="#__codelineno-0-278">278</a></span>
<span class="normal"><a href="#__codelineno-0-279">279</a></span>
<span class="normal"><a href="#__codelineno-0-280">280</a></span>
<span class="normal"><a href="#__codelineno-0-281">281</a></span>
<span class="normal"><a href="#__codelineno-0-282">282</a></span>
<span class="normal"><a href="#__codelineno-0-283">283</a></span>
<span class="normal"><a href="#__codelineno-0-284">284</a></span>
<span class="normal"><a href="#__codelineno-0-285">285</a></span>
<span class="normal"><a href="#__codelineno-0-286">286</a></span>
<span class="normal"><a href="#__codelineno-0-287">287</a></span>
<span class="normal"><a href="#__codelineno-0-288">288</a></span>
<span class="normal"><a href="#__codelineno-0-289">289</a></span>
<span class="normal"><a href="#__codelineno-0-290">290</a></span>
<span class="normal"><a href="#__codelineno-0-291">291</a></span>
<span class="normal"><a href="#__codelineno-0-292">292</a></span>
<span class="normal"><a href="#__codelineno-0-293">293</a></span>
<span class="normal"><a href="#__codelineno-0-294">294</a></span>
<span class="normal"><a href="#__codelineno-0-295">295</a></span>
<span class="normal"><a href="#__codelineno-0-296">296</a></span>
<span class="normal"><a href="#__codelineno-0-297">297</a></span>
<span class="normal"><a href="#__codelineno-0-298">298</a></span>
<span class="normal"><a href="#__codelineno-0-299">299</a></span>
<span class="normal"><a href="#__codelineno-0-300">300</a></span>
<span class="normal"><a href="#__codelineno-0-301">301</a></span>
<span class="normal"><a href="#__codelineno-0-302">302</a></span>
<span class="normal"><a href="#__codelineno-0-303">303</a></span>
<span class="normal"><a href="#__codelineno-0-304">304</a></span>
<span class="normal"><a href="#__codelineno-0-305">305</a></span>
<span class="normal"><a href="#__codelineno-0-306">306</a></span>
<span class="normal"><a href="#__codelineno-0-307">307</a></span>
<span class="normal"><a href="#__codelineno-0-308">308</a></span>
<span class="normal"><a href="#__codelineno-0-309">309</a></span>
<span class="normal"><a href="#__codelineno-0-310">310</a></span>
<span class="normal"><a href="#__codelineno-0-311">311</a></span>
<span class="normal"><a href="#__codelineno-0-312">312</a></span>
<span class="normal"><a href="#__codelineno-0-313">313</a></span>
<span class="normal"><a href="#__codelineno-0-314">314</a></span>
<span class="normal"><a href="#__codelineno-0-315">315</a></span>
<span class="normal"><a href="#__codelineno-0-316">316</a></span>
<span class="normal"><a href="#__codelineno-0-317">317</a></span>
<span class="normal"><a href="#__codelineno-0-318">318</a></span>
<span class="normal"><a href="#__codelineno-0-319">319</a></span>
<span class="normal"><a href="#__codelineno-0-320">320</a></span>
<span class="normal"><a href="#__codelineno-0-321">321</a></span>
<span class="normal"><a href="#__codelineno-0-322">322</a></span>
<span class="normal"><a href="#__codelineno-0-323">323</a></span>
<span class="normal"><a href="#__codelineno-0-324">324</a></span>
<span class="normal"><a href="#__codelineno-0-325">325</a></span>
<span class="normal"><a href="#__codelineno-0-326">326</a></span>
<span class="normal"><a href="#__codelineno-0-327">327</a></span>
<span class="normal"><a href="#__codelineno-0-328">328</a></span>
<span class="normal"><a href="#__codelineno-0-329">329</a></span>
<span class="normal"><a href="#__codelineno-0-330">330</a></span>
<span class="normal"><a href="#__codelineno-0-331">331</a></span>
<span class="normal"><a href="#__codelineno-0-332">332</a></span>
<span class="normal"><a href="#__codelineno-0-333">333</a></span>
<span class="normal"><a href="#__codelineno-0-334">334</a></span>
<span class="normal"><a href="#__codelineno-0-335">335</a></span>
<span class="normal"><a href="#__codelineno-0-336">336</a></span>
<span class="normal"><a href="#__codelineno-0-337">337</a></span>
<span class="normal"><a href="#__codelineno-0-338">338</a></span>
<span class="normal"><a href="#__codelineno-0-339">339</a></span>
<span class="normal"><a href="#__codelineno-0-340">340</a></span>
<span class="normal"><a href="#__codelineno-0-341">341</a></span>
<span class="normal"><a href="#__codelineno-0-342">342</a></span>
<span class="normal"><a href="#__codelineno-0-343">343</a></span>
<span class="normal"><a href="#__codelineno-0-344">344</a></span>
<span class="normal"><a href="#__codelineno-0-345">345</a></span>
<span class="normal"><a href="#__codelineno-0-346">346</a></span>
<span class="normal"><a href="#__codelineno-0-347">347</a></span>
<span class="normal"><a href="#__codelineno-0-348">348</a></span>
<span class="normal"><a href="#__codelineno-0-349">349</a></span>
<span class="normal"><a href="#__codelineno-0-350">350</a></span>
<span class="normal"><a href="#__codelineno-0-351">351</a></span>
<span class="normal"><a href="#__codelineno-0-352">352</a></span>
<span class="normal"><a href="#__codelineno-0-353">353</a></span>
<span class="normal"><a href="#__codelineno-0-354">354</a></span>
<span class="normal"><a href="#__codelineno-0-355">355</a></span>
<span class="normal"><a href="#__codelineno-0-356">356</a></span>
<span class="normal"><a href="#__codelineno-0-357">357</a></span>
<span class="normal"><a href="#__codelineno-0-358">358</a></span>
<span class="normal"><a href="#__codelineno-0-359">359</a></span>
<span class="normal"><a href="#__codelineno-0-360">360</a></span>
<span class="normal"><a href="#__codelineno-0-361">361</a></span>
<span class="normal"><a href="#__codelineno-0-362">362</a></span>
<span class="normal"><a href="#__codelineno-0-363">363</a></span>
<span class="normal"><a href="#__codelineno-0-364">364</a></span>
<span class="normal"><a href="#__codelineno-0-365">365</a></span>
<span class="normal"><a href="#__codelineno-0-366">366</a></span>
<span class="normal"><a href="#__codelineno-0-367">367</a></span>
<span class="normal"><a href="#__codelineno-0-368">368</a></span>
<span class="normal"><a href="#__codelineno-0-369">369</a></span>
<span class="normal"><a href="#__codelineno-0-370">370</a></span>
<span class="normal"><a href="#__codelineno-0-371">371</a></span>
<span class="normal"><a href="#__codelineno-0-372">372</a></span>
<span class="normal"><a href="#__codelineno-0-373">373</a></span>
<span class="normal"><a href="#__codelineno-0-374">374</a></span>
<span class="normal"><a href="#__codelineno-0-375">375</a></span>
<span class="normal"><a href="#__codelineno-0-376">376</a></span>
<span class="normal"><a href="#__codelineno-0-377">377</a></span>
<span class="normal"><a href="#__codelineno-0-378">378</a></span>
<span class="normal"><a href="#__codelineno-0-379">379</a></span>
<span class="normal"><a href="#__codelineno-0-380">380</a></span>
<span class="normal"><a href="#__codelineno-0-381">381</a></span>
<span class="normal"><a href="#__codelineno-0-382">382</a></span>
<span class="normal"><a href="#__codelineno-0-383">383</a></span>
<span class="normal"><a href="#__codelineno-0-384">384</a></span>
<span class="normal"><a href="#__codelineno-0-385">385</a></span>
<span class="normal"><a href="#__codelineno-0-386">386</a></span>
<span class="normal"><a href="#__codelineno-0-387">387</a></span>
<span class="normal"><a href="#__codelineno-0-388">388</a></span>
<span class="normal"><a href="#__codelineno-0-389">389</a></span>
<span class="normal"><a href="#__codelineno-0-390">390</a></span>
<span class="normal"><a href="#__codelineno-0-391">391</a></span>
<span class="normal"><a href="#__codelineno-0-392">392</a></span>
<span class="normal"><a href="#__codelineno-0-393">393</a></span>
<span class="normal"><a href="#__codelineno-0-394">394</a></span>
<span class="normal"><a href="#__codelineno-0-395">395</a></span>
<span class="normal"><a href="#__codelineno-0-396">396</a></span>
<span class="normal"><a href="#__codelineno-0-397">397</a></span>
<span class="normal"><a href="#__codelineno-0-398">398</a></span>
<span class="normal"><a href="#__codelineno-0-399">399</a></span>
<span class="normal"><a href="#__codelineno-0-400">400</a></span>
<span class="normal"><a href="#__codelineno-0-401">401</a></span>
<span class="normal"><a href="#__codelineno-0-402">402</a></span>
<span class="normal"><a href="#__codelineno-0-403">403</a></span>
<span class="normal"><a href="#__codelineno-0-404">404</a></span>
<span class="normal"><a href="#__codelineno-0-405">405</a></span>
<span class="normal"><a href="#__codelineno-0-406">406</a></span>
<span class="normal"><a href="#__codelineno-0-407">407</a></span>
<span class="normal"><a href="#__codelineno-0-408">408</a></span>
<span class="normal"><a href="#__codelineno-0-409">409</a></span>
<span class="normal"><a href="#__codelineno-0-410">410</a></span>
<span class="normal"><a href="#__codelineno-0-411">411</a></span>
<span class="normal"><a href="#__codelineno-0-412">412</a></span>
<span class="normal"><a href="#__codelineno-0-413">413</a></span>
<span class="normal"><a href="#__codelineno-0-414">414</a></span>
<span class="normal"><a href="#__codelineno-0-415">415</a></span>
<span class="normal"><a href="#__codelineno-0-416">416</a></span>
<span class="normal"><a href="#__codelineno-0-417">417</a></span>
<span class="normal"><a href="#__codelineno-0-418">418</a></span>
<span class="normal"><a href="#__codelineno-0-419">419</a></span>
<span class="normal"><a href="#__codelineno-0-420">420</a></span>
<span class="normal"><a href="#__codelineno-0-421">421</a></span>
<span class="normal"><a href="#__codelineno-0-422">422</a></span>
<span class="normal"><a href="#__codelineno-0-423">423</a></span>
<span class="normal"><a href="#__codelineno-0-424">424</a></span>
<span class="normal"><a href="#__codelineno-0-425">425</a></span>
<span class="normal"><a href="#__codelineno-0-426">426</a></span>
<span class="normal"><a href="#__codelineno-0-427">427</a></span>
<span class="normal"><a href="#__codelineno-0-428">428</a></span>
<span class="normal"><a href="#__codelineno-0-429">429</a></span>
<span class="normal"><a href="#__codelineno-0-430">430</a></span>
<span class="normal"><a href="#__codelineno-0-431">431</a></span>
<span class="normal"><a href="#__codelineno-0-432">432</a></span>
<span class="normal"><a href="#__codelineno-0-433">433</a></span>
<span class="normal"><a href="#__codelineno-0-434">434</a></span>
<span class="normal"><a href="#__codelineno-0-435">435</a></span>
<span class="normal"><a href="#__codelineno-0-436">436</a></span>
<span class="normal"><a href="#__codelineno-0-437">437</a></span>
<span class="normal"><a href="#__codelineno-0-438">438</a></span>
<span class="normal"><a href="#__codelineno-0-439">439</a></span>
<span class="normal"><a href="#__codelineno-0-440">440</a></span>
<span class="normal"><a href="#__codelineno-0-441">441</a></span>
<span class="normal"><a href="#__codelineno-0-442">442</a></span>
<span class="normal"><a href="#__codelineno-0-443">443</a></span>
<span class="normal"><a href="#__codelineno-0-444">444</a></span>
<span class="normal"><a href="#__codelineno-0-445">445</a></span>
<span class="normal"><a href="#__codelineno-0-446">446</a></span>
<span class="normal"><a href="#__codelineno-0-447">447</a></span>
<span class="normal"><a href="#__codelineno-0-448">448</a></span>
<span class="normal"><a href="#__codelineno-0-449">449</a></span>
<span class="normal"><a href="#__codelineno-0-450">450</a></span>
<span class="normal"><a href="#__codelineno-0-451">451</a></span>
<span class="normal"><a href="#__codelineno-0-452">452</a></span>
<span class="normal"><a href="#__codelineno-0-453">453</a></span>
<span class="normal"><a href="#__codelineno-0-454">454</a></span>
<span class="normal"><a href="#__codelineno-0-455">455</a></span>
<span class="normal"><a href="#__codelineno-0-456">456</a></span>
<span class="normal"><a href="#__codelineno-0-457">457</a></span>
<span class="normal"><a href="#__codelineno-0-458">458</a></span>
<span class="normal"><a href="#__codelineno-0-459">459</a></span>
<span class="normal"><a href="#__codelineno-0-460">460</a></span>
<span class="normal"><a href="#__codelineno-0-461">461</a></span>
<span class="normal"><a href="#__codelineno-0-462">462</a></span>
<span class="normal"><a href="#__codelineno-0-463">463</a></span>
<span class="normal"><a href="#__codelineno-0-464">464</a></span>
<span class="normal"><a href="#__codelineno-0-465">465</a></span>
<span class="normal"><a href="#__codelineno-0-466">466</a></span>
<span class="normal"><a href="#__codelineno-0-467">467</a></span>
<span class="normal"><a href="#__codelineno-0-468">468</a></span>
<span class="normal"><a href="#__codelineno-0-469">469</a></span>
<span class="normal"><a href="#__codelineno-0-470">470</a></span>
<span class="normal"><a href="#__codelineno-0-471">471</a></span>
<span class="normal"><a href="#__codelineno-0-472">472</a></span>
<span class="normal"><a href="#__codelineno-0-473">473</a></span>
<span class="normal"><a href="#__codelineno-0-474">474</a></span>
<span class="normal"><a href="#__codelineno-0-475">475</a></span>
<span class="normal"><a href="#__codelineno-0-476">476</a></span>
<span class="normal"><a href="#__codelineno-0-477">477</a></span>
<span class="normal"><a href="#__codelineno-0-478">478</a></span>
<span class="normal"><a href="#__codelineno-0-479">479</a></span>
<span class="normal"><a href="#__codelineno-0-480">480</a></span>
<span class="normal"><a href="#__codelineno-0-481">481</a></span>
<span class="normal"><a href="#__codelineno-0-482">482</a></span>
<span class="normal"><a href="#__codelineno-0-483">483</a></span>
<span class="normal"><a href="#__codelineno-0-484">484</a></span>
<span class="normal"><a href="#__codelineno-0-485">485</a></span>
<span class="normal"><a href="#__codelineno-0-486">486</a></span>
<span class="normal"><a href="#__codelineno-0-487">487</a></span>
<span class="normal"><a href="#__codelineno-0-488">488</a></span>
<span class="normal"><a href="#__codelineno-0-489">489</a></span>
<span class="normal"><a href="#__codelineno-0-490">490</a></span>
<span class="normal"><a href="#__codelineno-0-491">491</a></span>
<span class="normal"><a href="#__codelineno-0-492">492</a></span>
<span class="normal"><a href="#__codelineno-0-493">493</a></span>
<span class="normal"><a href="#__codelineno-0-494">494</a></span>
<span class="normal"><a href="#__codelineno-0-495">495</a></span>
<span class="normal"><a href="#__codelineno-0-496">496</a></span>
<span class="normal"><a href="#__codelineno-0-497">497</a></span>
<span class="normal"><a href="#__codelineno-0-498">498</a></span>
<span class="normal"><a href="#__codelineno-0-499">499</a></span>
<span class="normal"><a href="#__codelineno-0-500">500</a></span>
<span class="normal"><a href="#__codelineno-0-501">501</a></span>
<span class="normal"><a href="#__codelineno-0-502">502</a></span>
<span class="normal"><a href="#__codelineno-0-503">503</a></span>
<span class="normal"><a href="#__codelineno-0-504">504</a></span>
<span class="normal"><a href="#__codelineno-0-505">505</a></span>
<span class="normal"><a href="#__codelineno-0-506">506</a></span>
<span class="normal"><a href="#__codelineno-0-507">507</a></span>
<span class="normal"><a href="#__codelineno-0-508">508</a></span>
<span class="normal"><a href="#__codelineno-0-509">509</a></span>
<span class="normal"><a href="#__codelineno-0-510">510</a></span>
<span class="normal"><a href="#__codelineno-0-511">511</a></span>
<span class="normal"><a href="#__codelineno-0-512">512</a></span>
<span class="normal"><a href="#__codelineno-0-513">513</a></span>
<span class="normal"><a href="#__codelineno-0-514">514</a></span>
<span class="normal"><a href="#__codelineno-0-515">515</a></span>
<span class="normal"><a href="#__codelineno-0-516">516</a></span>
<span class="normal"><a href="#__codelineno-0-517">517</a></span>
<span class="normal"><a href="#__codelineno-0-518">518</a></span>
<span class="normal"><a href="#__codelineno-0-519">519</a></span>
<span class="normal"><a href="#__codelineno-0-520">520</a></span>
<span class="normal"><a href="#__codelineno-0-521">521</a></span>
<span class="normal"><a href="#__codelineno-0-522">522</a></span>
<span class="normal"><a href="#__codelineno-0-523">523</a></span>
<span class="normal"><a href="#__codelineno-0-524">524</a></span>
<span class="normal"><a href="#__codelineno-0-525">525</a></span>
<span class="normal"><a href="#__codelineno-0-526">526</a></span>
<span class="normal"><a href="#__codelineno-0-527">527</a></span>
<span class="normal"><a href="#__codelineno-0-528">528</a></span>
<span class="normal"><a href="#__codelineno-0-529">529</a></span>
<span class="normal"><a href="#__codelineno-0-530">530</a></span>
<span class="normal"><a href="#__codelineno-0-531">531</a></span>
<span class="normal"><a href="#__codelineno-0-532">532</a></span>
<span class="normal"><a href="#__codelineno-0-533">533</a></span>
<span class="normal"><a href="#__codelineno-0-534">534</a></span>
<span class="normal"><a href="#__codelineno-0-535">535</a></span>
<span class="normal"><a href="#__codelineno-0-536">536</a></span>
<span class="normal"><a href="#__codelineno-0-537">537</a></span>
<span class="normal"><a href="#__codelineno-0-538">538</a></span>
<span class="normal"><a href="#__codelineno-0-539">539</a></span>
<span class="normal"><a href="#__codelineno-0-540">540</a></span>
<span class="normal"><a href="#__codelineno-0-541">541</a></span>
<span class="normal"><a href="#__codelineno-0-542">542</a></span>
<span class="normal"><a href="#__codelineno-0-543">543</a></span>
<span class="normal"><a href="#__codelineno-0-544">544</a></span>
<span class="normal"><a href="#__codelineno-0-545">545</a></span>
<span class="normal"><a href="#__codelineno-0-546">546</a></span>
<span class="normal"><a href="#__codelineno-0-547">547</a></span>
<span class="normal"><a href="#__codelineno-0-548">548</a></span>
<span class="normal"><a href="#__codelineno-0-549">549</a></span>
<span class="normal"><a href="#__codelineno-0-550">550</a></span>
<span class="normal"><a href="#__codelineno-0-551">551</a></span>
<span class="normal"><a href="#__codelineno-0-552">552</a></span>
<span class="normal"><a href="#__codelineno-0-553">553</a></span>
<span class="normal"><a href="#__codelineno-0-554">554</a></span>
<span class="normal"><a href="#__codelineno-0-555">555</a></span>
<span class="normal"><a href="#__codelineno-0-556">556</a></span>
<span class="normal"><a href="#__codelineno-0-557">557</a></span>
<span class="normal"><a href="#__codelineno-0-558">558</a></span>
<span class="normal"><a href="#__codelineno-0-559">559</a></span>
<span class="normal"><a href="#__codelineno-0-560">560</a></span>
<span class="normal"><a href="#__codelineno-0-561">561</a></span>
<span class="normal"><a href="#__codelineno-0-562">562</a></span>
<span class="normal"><a href="#__codelineno-0-563">563</a></span>
<span class="normal"><a href="#__codelineno-0-564">564</a></span>
<span class="normal"><a href="#__codelineno-0-565">565</a></span>
<span class="normal"><a href="#__codelineno-0-566">566</a></span>
<span class="normal"><a href="#__codelineno-0-567">567</a></span>
<span class="normal"><a href="#__codelineno-0-568">568</a></span>
<span class="normal"><a href="#__codelineno-0-569">569</a></span>
<span class="normal"><a href="#__codelineno-0-570">570</a></span>
<span class="normal"><a href="#__codelineno-0-571">571</a></span>
<span class="normal"><a href="#__codelineno-0-572">572</a></span>
<span class="normal"><a href="#__codelineno-0-573">573</a></span>
<span class="normal"><a href="#__codelineno-0-574">574</a></span>
<span class="normal"><a href="#__codelineno-0-575">575</a></span>
<span class="normal"><a href="#__codelineno-0-576">576</a></span>
<span class="normal"><a href="#__codelineno-0-577">577</a></span>
<span class="normal"><a href="#__codelineno-0-578">578</a></span>
<span class="normal"><a href="#__codelineno-0-579">579</a></span>
<span class="normal"><a href="#__codelineno-0-580">580</a></span>
<span class="normal"><a href="#__codelineno-0-581">581</a></span>
<span class="normal"><a href="#__codelineno-0-582">582</a></span>
<span class="normal"><a href="#__codelineno-0-583">583</a></span>
<span class="normal"><a href="#__codelineno-0-584">584</a></span>
<span class="normal"><a href="#__codelineno-0-585">585</a></span>
<span class="normal"><a href="#__codelineno-0-586">586</a></span>
<span class="normal"><a href="#__codelineno-0-587">587</a></span>
<span class="normal"><a href="#__codelineno-0-588">588</a></span>
<span class="normal"><a href="#__codelineno-0-589">589</a></span>
<span class="normal"><a href="#__codelineno-0-590">590</a></span>
<span class="normal"><a href="#__codelineno-0-591">591</a></span>
<span class="normal"><a href="#__codelineno-0-592">592</a></span>
<span class="normal"><a href="#__codelineno-0-593">593</a></span>
<span class="normal"><a href="#__codelineno-0-594">594</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-63" name="__codelineno-0-63"></a><span class="k">class</span><span class="w"> </span><span class="nc">UserManager</span><span class="p">:</span>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a><span class="sd">    The UserManager is designed to manage, for each user:</span>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a><span class="sd">    - TreeManager</span>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a><span class="sd">    - ClientManager</span>
<a id="__codelineno-0-69" name="__codelineno-0-69"></a><span class="sd">    - FrontendConfig</span>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a><span class="sd">    It contains methods for creating and updating these objects across a range of users, stored in a dictionary.</span>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a><span class="sd">    It can be used as a dependency injection container for FastAPI.</span>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a><span class="sd">    The user manager/tree manager is decoupled from the core of the Elysia package functionality.</span>
<a id="__codelineno-0-74" name="__codelineno-0-74"></a><span class="sd">    It is designed to be used to manage separate Elysia instances, set of trees (via tree managers), configs, etc.</span>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
<a id="__codelineno-0-78" name="__codelineno-0-78"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a>        <span class="n">user_timeout</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a>    <span class="p">):</span>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a><span class="sd">            user_timeout (datetime.timedelta | int | None): Optional.</span>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a><span class="sd">                The length of time a user can be idle before being timed out.</span>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a><span class="sd">                Defaults to 20 minutes or the value of the USER_TIMEOUT environment variable.</span>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a><span class="sd">                If an integer is provided, it is interpreted as the number of minutes.</span>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a>        <span class="k">if</span> <span class="n">user_timeout</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">user_timeout</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a>                <span class="n">minutes</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;USER_TIMEOUT&quot;</span><span class="p">,</span> <span class="mi">20</span><span class="p">))</span>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a>            <span class="p">)</span>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">user_timeout</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">user_timeout</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">minutes</span><span class="o">=</span><span class="n">user_timeout</span><span class="p">)</span>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">user_timeout</span> <span class="o">=</span> <span class="n">user_timeout</span>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">manager_id</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1000000</span><span class="p">)</span>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">date_of_reset</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">users</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">user_exists</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a>        <span class="k">return</span> <span class="n">user_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">users</span>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">update_config</span><span class="p">(</span>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a>        <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a>        <span class="n">conversation_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a>        <span class="n">config_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a>        <span class="n">config_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a>        <span class="n">settings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a>        <span class="n">style</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a>        <span class="n">agent_description</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a>        <span class="n">end_goal</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a>        <span class="n">branch_initialisation</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-115" name="__codelineno-0-115"></a>    <span class="p">):</span>
<a id="__codelineno-0-116" name="__codelineno-0-116"></a>        <span class="n">local_user</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_user_local</span><span class="p">(</span><span class="n">user_id</span><span class="p">)</span>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a>        <span class="n">local_user</span><span class="p">[</span><span class="s2">&quot;tree_manager&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">update_config</span><span class="p">(</span>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a>            <span class="n">conversation_id</span><span class="p">,</span>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a>            <span class="n">config_id</span><span class="p">,</span>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a>            <span class="n">config_name</span><span class="p">,</span>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a>            <span class="n">settings</span><span class="p">,</span>
<a id="__codelineno-0-122" name="__codelineno-0-122"></a>            <span class="n">style</span><span class="p">,</span>
<a id="__codelineno-0-123" name="__codelineno-0-123"></a>            <span class="n">agent_description</span><span class="p">,</span>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a>            <span class="n">end_goal</span><span class="p">,</span>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a>            <span class="n">branch_initialisation</span><span class="p">,</span>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a>        <span class="p">)</span>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a>        <span class="k">await</span> <span class="n">local_user</span><span class="p">[</span><span class="s2">&quot;client_manager&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">reset_keys</span><span class="p">(</span>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a>            <span class="n">wcd_url</span><span class="o">=</span><span class="n">local_user</span><span class="p">[</span><span class="s2">&quot;tree_manager&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">WCD_URL</span><span class="p">,</span>
<a id="__codelineno-0-130" name="__codelineno-0-130"></a>            <span class="n">wcd_api_key</span><span class="o">=</span><span class="n">local_user</span><span class="p">[</span><span class="s2">&quot;tree_manager&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">WCD_API_KEY</span><span class="p">,</span>
<a id="__codelineno-0-131" name="__codelineno-0-131"></a>            <span class="n">api_keys</span><span class="o">=</span><span class="n">local_user</span><span class="p">[</span><span class="s2">&quot;tree_manager&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">API_KEYS</span><span class="p">,</span>
<a id="__codelineno-0-132" name="__codelineno-0-132"></a>        <span class="p">)</span>
<a id="__codelineno-0-133" name="__codelineno-0-133"></a>
<a id="__codelineno-0-134" name="__codelineno-0-134"></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">update_frontend_config</span><span class="p">(</span>
<a id="__codelineno-0-135" name="__codelineno-0-135"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a>        <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-137" name="__codelineno-0-137"></a>        <span class="n">config</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
<a id="__codelineno-0-138" name="__codelineno-0-138"></a>    <span class="p">):</span>
<a id="__codelineno-0-139" name="__codelineno-0-139"></a>        <span class="n">local_user</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_user_local</span><span class="p">(</span><span class="n">user_id</span><span class="p">)</span>
<a id="__codelineno-0-140" name="__codelineno-0-140"></a>        <span class="n">frontend_config</span><span class="p">:</span> <span class="n">FrontendConfig</span> <span class="o">=</span> <span class="n">local_user</span><span class="p">[</span><span class="s2">&quot;frontend_config&quot;</span><span class="p">]</span>
<a id="__codelineno-0-141" name="__codelineno-0-141"></a>        <span class="k">await</span> <span class="n">frontend_config</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="o">**</span><span class="n">config</span><span class="p">)</span>
<a id="__codelineno-0-142" name="__codelineno-0-142"></a>
<a id="__codelineno-0-143" name="__codelineno-0-143"></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">add_user_local</span><span class="p">(</span>
<a id="__codelineno-0-144" name="__codelineno-0-144"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-145" name="__codelineno-0-145"></a>        <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-146" name="__codelineno-0-146"></a>        <span class="n">config</span><span class="p">:</span> <span class="n">Config</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-147" name="__codelineno-0-147"></a>    <span class="p">):</span>
<a id="__codelineno-0-148" name="__codelineno-0-148"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-149" name="__codelineno-0-149"></a><span class="sd">        Add a user to the UserManager.</span>
<a id="__codelineno-0-150" name="__codelineno-0-150"></a>
<a id="__codelineno-0-151" name="__codelineno-0-151"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-152" name="__codelineno-0-152"></a><span class="sd">            user_id (str): Required. The unique identifier for the user.</span>
<a id="__codelineno-0-153" name="__codelineno-0-153"></a><span class="sd">            config (Config): Required. The config for the user.</span>
<a id="__codelineno-0-154" name="__codelineno-0-154"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-155" name="__codelineno-0-155"></a>
<a id="__codelineno-0-156" name="__codelineno-0-156"></a>        <span class="c1"># add user if it doesn&#39;t exist</span>
<a id="__codelineno-0-157" name="__codelineno-0-157"></a>        <span class="k">if</span> <span class="n">user_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">users</span><span class="p">:</span>
<a id="__codelineno-0-158" name="__codelineno-0-158"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">users</span><span class="p">[</span><span class="n">user_id</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-159" name="__codelineno-0-159"></a>
<a id="__codelineno-0-160" name="__codelineno-0-160"></a>            <span class="n">fe_config</span> <span class="o">=</span> <span class="k">await</span> <span class="n">load_frontend_config_from_file</span><span class="p">(</span><span class="n">user_id</span><span class="p">,</span> <span class="n">logger</span><span class="p">)</span>
<a id="__codelineno-0-161" name="__codelineno-0-161"></a>
<a id="__codelineno-0-162" name="__codelineno-0-162"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">users</span><span class="p">[</span><span class="n">user_id</span><span class="p">][</span><span class="s2">&quot;frontend_config&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fe_config</span>
<a id="__codelineno-0-163" name="__codelineno-0-163"></a>
<a id="__codelineno-0-164" name="__codelineno-0-164"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">users</span><span class="p">[</span><span class="n">user_id</span><span class="p">][</span><span class="s2">&quot;tree_manager&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">TreeManager</span><span class="p">(</span>
<a id="__codelineno-0-165" name="__codelineno-0-165"></a>                <span class="n">user_id</span><span class="o">=</span><span class="n">user_id</span><span class="p">,</span>
<a id="__codelineno-0-166" name="__codelineno-0-166"></a>                <span class="n">config</span><span class="o">=</span><span class="n">config</span><span class="p">,</span>
<a id="__codelineno-0-167" name="__codelineno-0-167"></a>                <span class="n">tree_timeout</span><span class="o">=</span><span class="n">fe_config</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;tree_timeout&quot;</span><span class="p">],</span>
<a id="__codelineno-0-168" name="__codelineno-0-168"></a>            <span class="p">)</span>
<a id="__codelineno-0-169" name="__codelineno-0-169"></a>
<a id="__codelineno-0-170" name="__codelineno-0-170"></a>            <span class="c1"># client manager starts with env variables, when config is updated, api keys are updated</span>
<a id="__codelineno-0-171" name="__codelineno-0-171"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">users</span><span class="p">[</span><span class="n">user_id</span><span class="p">][</span><span class="s2">&quot;client_manager&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ClientManager</span><span class="p">(</span>
<a id="__codelineno-0-172" name="__codelineno-0-172"></a>                <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">,</span>
<a id="__codelineno-0-173" name="__codelineno-0-173"></a>                <span class="n">client_timeout</span><span class="o">=</span><span class="n">fe_config</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;client_timeout&quot;</span><span class="p">],</span>
<a id="__codelineno-0-174" name="__codelineno-0-174"></a>                <span class="n">settings</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">users</span><span class="p">[</span><span class="n">user_id</span><span class="p">][</span><span class="s2">&quot;tree_manager&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">settings</span><span class="p">,</span>
<a id="__codelineno-0-175" name="__codelineno-0-175"></a>            <span class="p">)</span>
<a id="__codelineno-0-176" name="__codelineno-0-176"></a>
<a id="__codelineno-0-177" name="__codelineno-0-177"></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">get_user_local</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-0-178" name="__codelineno-0-178"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-179" name="__codelineno-0-179"></a><span class="sd">        Return a local user object.</span>
<a id="__codelineno-0-180" name="__codelineno-0-180"></a><span class="sd">        Will raise a ValueError if the user is not found.</span>
<a id="__codelineno-0-181" name="__codelineno-0-181"></a>
<a id="__codelineno-0-182" name="__codelineno-0-182"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-183" name="__codelineno-0-183"></a><span class="sd">            user_id (str): Required. The unique identifier for the user.</span>
<a id="__codelineno-0-184" name="__codelineno-0-184"></a>
<a id="__codelineno-0-185" name="__codelineno-0-185"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-186" name="__codelineno-0-186"></a><span class="sd">            (dict): A local user object, containing a TreeManager (&quot;tree_manager&quot;),</span>
<a id="__codelineno-0-187" name="__codelineno-0-187"></a><span class="sd">                Frontend Config (&quot;frontend_config&quot;) and ClientManager (&quot;client_manager&quot;).</span>
<a id="__codelineno-0-188" name="__codelineno-0-188"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-189" name="__codelineno-0-189"></a>
<a id="__codelineno-0-190" name="__codelineno-0-190"></a>        <span class="k">if</span> <span class="n">user_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">users</span><span class="p">:</span>
<a id="__codelineno-0-191" name="__codelineno-0-191"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<a id="__codelineno-0-192" name="__codelineno-0-192"></a>                <span class="sa">f</span><span class="s2">&quot;User </span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2"> not found. Please initialise a user first (by calling `add_user_local`).&quot;</span>
<a id="__codelineno-0-193" name="__codelineno-0-193"></a>            <span class="p">)</span>
<a id="__codelineno-0-194" name="__codelineno-0-194"></a>
<a id="__codelineno-0-195" name="__codelineno-0-195"></a>        <span class="c1"># update last request (adds last_request to user)</span>
<a id="__codelineno-0-196" name="__codelineno-0-196"></a>        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_user_last_request</span><span class="p">(</span><span class="n">user_id</span><span class="p">)</span>
<a id="__codelineno-0-197" name="__codelineno-0-197"></a>
<a id="__codelineno-0-198" name="__codelineno-0-198"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">users</span><span class="p">[</span><span class="n">user_id</span><span class="p">]</span>
<a id="__codelineno-0-199" name="__codelineno-0-199"></a>
<a id="__codelineno-0-200" name="__codelineno-0-200"></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">get_tree</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">conversation_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-0-201" name="__codelineno-0-201"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-202" name="__codelineno-0-202"></a><span class="sd">        Get a tree for a user.</span>
<a id="__codelineno-0-203" name="__codelineno-0-203"></a><span class="sd">        Will raise a ValueError if the user is not found, or the tree is not found.</span>
<a id="__codelineno-0-204" name="__codelineno-0-204"></a>
<a id="__codelineno-0-205" name="__codelineno-0-205"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-206" name="__codelineno-0-206"></a><span class="sd">            user_id (str): Required. The unique identifier for the user.</span>
<a id="__codelineno-0-207" name="__codelineno-0-207"></a><span class="sd">            conversation_id (str): Required. The unique identifier for the conversation.</span>
<a id="__codelineno-0-208" name="__codelineno-0-208"></a>
<a id="__codelineno-0-209" name="__codelineno-0-209"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-210" name="__codelineno-0-210"></a><span class="sd">            (Tree): The tree.</span>
<a id="__codelineno-0-211" name="__codelineno-0-211"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-212" name="__codelineno-0-212"></a>        <span class="n">local_user</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_user_local</span><span class="p">(</span><span class="n">user_id</span><span class="p">)</span>
<a id="__codelineno-0-213" name="__codelineno-0-213"></a>        <span class="k">return</span> <span class="n">local_user</span><span class="p">[</span><span class="s2">&quot;tree_manager&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get_tree</span><span class="p">(</span><span class="n">conversation_id</span><span class="p">)</span>
<a id="__codelineno-0-214" name="__codelineno-0-214"></a>
<a id="__codelineno-0-215" name="__codelineno-0-215"></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">check_all_trees_timeout</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-216" name="__codelineno-0-216"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-217" name="__codelineno-0-217"></a><span class="sd">        Check all trees in all TreeManagers across all users and remove any that have not been active in the last tree_timeout.</span>
<a id="__codelineno-0-218" name="__codelineno-0-218"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-219" name="__codelineno-0-219"></a>        <span class="k">for</span> <span class="n">user_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">users</span><span class="p">:</span>
<a id="__codelineno-0-220" name="__codelineno-0-220"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">users</span><span class="p">[</span><span class="n">user_id</span><span class="p">][</span><span class="s2">&quot;tree_manager&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">check_all_trees_timeout</span><span class="p">()</span>
<a id="__codelineno-0-221" name="__codelineno-0-221"></a>
<a id="__codelineno-0-222" name="__codelineno-0-222"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">check_user_timeout</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-0-223" name="__codelineno-0-223"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-224" name="__codelineno-0-224"></a><span class="sd">        Check if a user has been idle for the last user_timeout.</span>
<a id="__codelineno-0-225" name="__codelineno-0-225"></a>
<a id="__codelineno-0-226" name="__codelineno-0-226"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-227" name="__codelineno-0-227"></a><span class="sd">            user_id (str): The user ID which contains the user.</span>
<a id="__codelineno-0-228" name="__codelineno-0-228"></a>
<a id="__codelineno-0-229" name="__codelineno-0-229"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-230" name="__codelineno-0-230"></a><span class="sd">            (bool): True if the user has been idle for the last user_timeout, False otherwise.</span>
<a id="__codelineno-0-231" name="__codelineno-0-231"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-232" name="__codelineno-0-232"></a>        <span class="c1"># if user not found, return True</span>
<a id="__codelineno-0-233" name="__codelineno-0-233"></a>        <span class="k">if</span> <span class="n">user_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">users</span><span class="p">:</span>
<a id="__codelineno-0-234" name="__codelineno-0-234"></a>            <span class="k">return</span> <span class="kc">True</span>
<a id="__codelineno-0-235" name="__codelineno-0-235"></a>
<a id="__codelineno-0-236" name="__codelineno-0-236"></a>        <span class="c1"># Remove any trees that have not been active in the last user_timeout</span>
<a id="__codelineno-0-237" name="__codelineno-0-237"></a>        <span class="c1"># if (</span>
<a id="__codelineno-0-238" name="__codelineno-0-238"></a>        <span class="c1">#     &quot;last_request&quot; in self.users[user_id]</span>
<a id="__codelineno-0-239" name="__codelineno-0-239"></a>        <span class="c1">#     and datetime.datetime.now() - self.users[user_id][&quot;last_request&quot;]</span>
<a id="__codelineno-0-240" name="__codelineno-0-240"></a>        <span class="c1">#     &gt; self.user_timeout</span>
<a id="__codelineno-0-241" name="__codelineno-0-241"></a>        <span class="c1"># ):</span>
<a id="__codelineno-0-242" name="__codelineno-0-242"></a>        <span class="c1">#     return True</span>
<a id="__codelineno-0-243" name="__codelineno-0-243"></a>
<a id="__codelineno-0-244" name="__codelineno-0-244"></a>        <span class="k">return</span> <span class="kc">False</span>
<a id="__codelineno-0-245" name="__codelineno-0-245"></a>
<a id="__codelineno-0-246" name="__codelineno-0-246"></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">check_all_users_timeout</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-247" name="__codelineno-0-247"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-248" name="__codelineno-0-248"></a><span class="sd">        Check all users in the UserManager and remove any that have not been active in the last user_timeout.</span>
<a id="__codelineno-0-249" name="__codelineno-0-249"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-250" name="__codelineno-0-250"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_timeout</span> <span class="o">==</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">minutes</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
<a id="__codelineno-0-251" name="__codelineno-0-251"></a>            <span class="k">return</span>
<a id="__codelineno-0-252" name="__codelineno-0-252"></a>
<a id="__codelineno-0-253" name="__codelineno-0-253"></a>        <span class="k">for</span> <span class="n">user_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">users</span><span class="p">:</span>
<a id="__codelineno-0-254" name="__codelineno-0-254"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_user_timeout</span><span class="p">(</span><span class="n">user_id</span><span class="p">):</span>
<a id="__codelineno-0-255" name="__codelineno-0-255"></a>                <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">users</span><span class="p">[</span><span class="n">user_id</span><span class="p">]</span>
<a id="__codelineno-0-256" name="__codelineno-0-256"></a>
<a id="__codelineno-0-257" name="__codelineno-0-257"></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">check_restart_clients</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-258" name="__codelineno-0-258"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-259" name="__codelineno-0-259"></a><span class="sd">        Check all clients in all ClientManagers across all users and run the restart_client() method (for sync and async clients).</span>
<a id="__codelineno-0-260" name="__codelineno-0-260"></a><span class="sd">        The restart_client() methods will check if the client has been inactive for the last client_timeout minutes (set in init).</span>
<a id="__codelineno-0-261" name="__codelineno-0-261"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-262" name="__codelineno-0-262"></a>        <span class="k">for</span> <span class="n">user_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">users</span><span class="p">:</span>
<a id="__codelineno-0-263" name="__codelineno-0-263"></a>            <span class="k">if</span> <span class="p">(</span>
<a id="__codelineno-0-264" name="__codelineno-0-264"></a>                <span class="s2">&quot;client_manager&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">users</span><span class="p">[</span><span class="n">user_id</span><span class="p">]</span>
<a id="__codelineno-0-265" name="__codelineno-0-265"></a>                <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">users</span><span class="p">[</span><span class="n">user_id</span><span class="p">][</span><span class="s2">&quot;client_manager&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">is_client</span>
<a id="__codelineno-0-266" name="__codelineno-0-266"></a>            <span class="p">):</span>
<a id="__codelineno-0-267" name="__codelineno-0-267"></a>                <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">users</span><span class="p">[</span><span class="n">user_id</span><span class="p">][</span><span class="s2">&quot;client_manager&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">restart_client</span><span class="p">()</span>
<a id="__codelineno-0-268" name="__codelineno-0-268"></a>                <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">users</span><span class="p">[</span><span class="n">user_id</span><span class="p">][</span><span class="s2">&quot;client_manager&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">restart_async_client</span><span class="p">()</span>
<a id="__codelineno-0-269" name="__codelineno-0-269"></a>
<a id="__codelineno-0-270" name="__codelineno-0-270"></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">close_all_clients</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-271" name="__codelineno-0-271"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-272" name="__codelineno-0-272"></a><span class="sd">        Close all clients in all ClientManagers across all users.</span>
<a id="__codelineno-0-273" name="__codelineno-0-273"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-274" name="__codelineno-0-274"></a>        <span class="k">for</span> <span class="n">user_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">users</span><span class="p">:</span>
<a id="__codelineno-0-275" name="__codelineno-0-275"></a>            <span class="k">if</span> <span class="s2">&quot;client_manager&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">users</span><span class="p">[</span><span class="n">user_id</span><span class="p">]:</span>
<a id="__codelineno-0-276" name="__codelineno-0-276"></a>                <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">users</span><span class="p">[</span><span class="n">user_id</span><span class="p">][</span><span class="s2">&quot;client_manager&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">close_clients</span><span class="p">()</span>
<a id="__codelineno-0-277" name="__codelineno-0-277"></a>
<a id="__codelineno-0-278" name="__codelineno-0-278"></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">initialise_tree</span><span class="p">(</span>
<a id="__codelineno-0-279" name="__codelineno-0-279"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-280" name="__codelineno-0-280"></a>        <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-281" name="__codelineno-0-281"></a>        <span class="n">conversation_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-282" name="__codelineno-0-282"></a>        <span class="n">low_memory</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-283" name="__codelineno-0-283"></a>    <span class="p">):</span>
<a id="__codelineno-0-284" name="__codelineno-0-284"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-285" name="__codelineno-0-285"></a><span class="sd">        Initialises a tree for a user for an existing user at user_id.</span>
<a id="__codelineno-0-286" name="__codelineno-0-286"></a><span class="sd">        Requires a user to already exist in the UserManager, via `add_user_local`.</span>
<a id="__codelineno-0-287" name="__codelineno-0-287"></a><span class="sd">        This is a wrapper for the TreeManager.add_tree() method.</span>
<a id="__codelineno-0-288" name="__codelineno-0-288"></a>
<a id="__codelineno-0-289" name="__codelineno-0-289"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-290" name="__codelineno-0-290"></a><span class="sd">            user_id (str): Required. The unique identifier for the user.</span>
<a id="__codelineno-0-291" name="__codelineno-0-291"></a><span class="sd">            conversation_id (str): Required. The unique identifier for a new conversation within the tree manager.</span>
<a id="__codelineno-0-292" name="__codelineno-0-292"></a><span class="sd">            low_memory (bool): Optional. Whether to use low memory mode for the tree.</span>
<a id="__codelineno-0-293" name="__codelineno-0-293"></a><span class="sd">                Controls the LM history being saved in the tree, and some other variables.</span>
<a id="__codelineno-0-294" name="__codelineno-0-294"></a><span class="sd">                Defaults to False.</span>
<a id="__codelineno-0-295" name="__codelineno-0-295"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-296" name="__codelineno-0-296"></a>        <span class="c1"># self.add_user_local(user_id)</span>
<a id="__codelineno-0-297" name="__codelineno-0-297"></a>        <span class="n">local_user</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_user_local</span><span class="p">(</span><span class="n">user_id</span><span class="p">)</span>
<a id="__codelineno-0-298" name="__codelineno-0-298"></a>        <span class="n">tree_manager</span><span class="p">:</span> <span class="n">TreeManager</span> <span class="o">=</span> <span class="n">local_user</span><span class="p">[</span><span class="s2">&quot;tree_manager&quot;</span><span class="p">]</span>
<a id="__codelineno-0-299" name="__codelineno-0-299"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">tree_manager</span><span class="o">.</span><span class="n">tree_exists</span><span class="p">(</span><span class="n">conversation_id</span><span class="p">):</span>
<a id="__codelineno-0-300" name="__codelineno-0-300"></a>            <span class="n">tree_manager</span><span class="o">.</span><span class="n">add_tree</span><span class="p">(</span>
<a id="__codelineno-0-301" name="__codelineno-0-301"></a>                <span class="n">conversation_id</span><span class="p">,</span>
<a id="__codelineno-0-302" name="__codelineno-0-302"></a>                <span class="n">low_memory</span><span class="p">,</span>
<a id="__codelineno-0-303" name="__codelineno-0-303"></a>            <span class="p">)</span>
<a id="__codelineno-0-304" name="__codelineno-0-304"></a>        <span class="k">return</span> <span class="n">tree_manager</span><span class="o">.</span><span class="n">get_tree</span><span class="p">(</span><span class="n">conversation_id</span><span class="p">)</span>
<a id="__codelineno-0-305" name="__codelineno-0-305"></a>
<a id="__codelineno-0-306" name="__codelineno-0-306"></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">save_tree</span><span class="p">(</span>
<a id="__codelineno-0-307" name="__codelineno-0-307"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-308" name="__codelineno-0-308"></a>        <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-309" name="__codelineno-0-309"></a>        <span class="n">conversation_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-310" name="__codelineno-0-310"></a>        <span class="n">wcd_url</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-311" name="__codelineno-0-311"></a>        <span class="n">wcd_api_key</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-312" name="__codelineno-0-312"></a>    <span class="p">):</span>
<a id="__codelineno-0-313" name="__codelineno-0-313"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-314" name="__codelineno-0-314"></a><span class="sd">        Save a tree to a Weaviate instance (set in the frontend config).</span>
<a id="__codelineno-0-315" name="__codelineno-0-315"></a><span class="sd">        This is a wrapper for the TreeManager.save_tree_weaviate() method.</span>
<a id="__codelineno-0-316" name="__codelineno-0-316"></a>
<a id="__codelineno-0-317" name="__codelineno-0-317"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-318" name="__codelineno-0-318"></a><span class="sd">            user_id (str): Required. The unique identifier for the user stored in the UserManager.</span>
<a id="__codelineno-0-319" name="__codelineno-0-319"></a><span class="sd">            conversation_id (str): Required. The unique identifier for the conversation for the user.</span>
<a id="__codelineno-0-320" name="__codelineno-0-320"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-321" name="__codelineno-0-321"></a>
<a id="__codelineno-0-322" name="__codelineno-0-322"></a>        <span class="n">local_user</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_user_local</span><span class="p">(</span><span class="n">user_id</span><span class="p">)</span>
<a id="__codelineno-0-323" name="__codelineno-0-323"></a>        <span class="n">tree_manager</span><span class="p">:</span> <span class="n">TreeManager</span> <span class="o">=</span> <span class="n">local_user</span><span class="p">[</span><span class="s2">&quot;tree_manager&quot;</span><span class="p">]</span>
<a id="__codelineno-0-324" name="__codelineno-0-324"></a>
<a id="__codelineno-0-325" name="__codelineno-0-325"></a>        <span class="k">if</span> <span class="n">wcd_url</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">wcd_api_key</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-326" name="__codelineno-0-326"></a>            <span class="n">save_location_client_manager</span> <span class="o">=</span> <span class="n">local_user</span><span class="p">[</span>
<a id="__codelineno-0-327" name="__codelineno-0-327"></a>                <span class="s2">&quot;frontend_config&quot;</span>
<a id="__codelineno-0-328" name="__codelineno-0-328"></a>            <span class="p">]</span><span class="o">.</span><span class="n">save_location_client_manager</span>
<a id="__codelineno-0-329" name="__codelineno-0-329"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-330" name="__codelineno-0-330"></a>            <span class="n">save_location_client_manager</span> <span class="o">=</span> <span class="n">ClientManager</span><span class="p">(</span>
<a id="__codelineno-0-331" name="__codelineno-0-331"></a>                <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">,</span>
<a id="__codelineno-0-332" name="__codelineno-0-332"></a>                <span class="n">wcd_url</span><span class="o">=</span><span class="n">wcd_url</span><span class="p">,</span>
<a id="__codelineno-0-333" name="__codelineno-0-333"></a>                <span class="n">wcd_api_key</span><span class="o">=</span><span class="n">wcd_api_key</span><span class="p">,</span>
<a id="__codelineno-0-334" name="__codelineno-0-334"></a>            <span class="p">)</span>
<a id="__codelineno-0-335" name="__codelineno-0-335"></a>
<a id="__codelineno-0-336" name="__codelineno-0-336"></a>        <span class="k">await</span> <span class="n">tree_manager</span><span class="o">.</span><span class="n">save_tree_weaviate</span><span class="p">(</span>
<a id="__codelineno-0-337" name="__codelineno-0-337"></a>            <span class="n">conversation_id</span><span class="p">,</span> <span class="n">save_location_client_manager</span>
<a id="__codelineno-0-338" name="__codelineno-0-338"></a>        <span class="p">)</span>
<a id="__codelineno-0-339" name="__codelineno-0-339"></a>
<a id="__codelineno-0-340" name="__codelineno-0-340"></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">check_tree_exists_weaviate</span><span class="p">(</span>
<a id="__codelineno-0-341" name="__codelineno-0-341"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-342" name="__codelineno-0-342"></a>        <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-343" name="__codelineno-0-343"></a>        <span class="n">conversation_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-344" name="__codelineno-0-344"></a>        <span class="n">wcd_url</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-345" name="__codelineno-0-345"></a>        <span class="n">wcd_api_key</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-346" name="__codelineno-0-346"></a>    <span class="p">):</span>
<a id="__codelineno-0-347" name="__codelineno-0-347"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-348" name="__codelineno-0-348"></a><span class="sd">        Check if a tree exists in a Weaviate instance (set in the frontend config).</span>
<a id="__codelineno-0-349" name="__codelineno-0-349"></a>
<a id="__codelineno-0-350" name="__codelineno-0-350"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-351" name="__codelineno-0-351"></a><span class="sd">            user_id (str): Required. The unique identifier for the user stored in the UserManager.</span>
<a id="__codelineno-0-352" name="__codelineno-0-352"></a><span class="sd">            conversation_id (str): Required. The unique identifier for the conversation for the user.</span>
<a id="__codelineno-0-353" name="__codelineno-0-353"></a><span class="sd">            wcd_url (str | None): Required. The URL of the Weaviate Cloud Database instance used to save the tree.</span>
<a id="__codelineno-0-354" name="__codelineno-0-354"></a><span class="sd">                Defaults to the value of the `wcd_url` setting in the frontend config.</span>
<a id="__codelineno-0-355" name="__codelineno-0-355"></a><span class="sd">            wcd_api_key (str | None): Required. The API key for the Weaviate Cloud Database instance used to save the tree.</span>
<a id="__codelineno-0-356" name="__codelineno-0-356"></a><span class="sd">                Defaults to the value of the `wcd_api_key` setting in the frontend config.</span>
<a id="__codelineno-0-357" name="__codelineno-0-357"></a>
<a id="__codelineno-0-358" name="__codelineno-0-358"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-359" name="__codelineno-0-359"></a><span class="sd">            (bool): True if the tree exists in the Weaviate instance, False otherwise.</span>
<a id="__codelineno-0-360" name="__codelineno-0-360"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-361" name="__codelineno-0-361"></a>
<a id="__codelineno-0-362" name="__codelineno-0-362"></a>        <span class="n">local_user</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_user_local</span><span class="p">(</span><span class="n">user_id</span><span class="p">)</span>
<a id="__codelineno-0-363" name="__codelineno-0-363"></a>        <span class="n">tree_manager</span><span class="p">:</span> <span class="n">TreeManager</span> <span class="o">=</span> <span class="n">local_user</span><span class="p">[</span><span class="s2">&quot;tree_manager&quot;</span><span class="p">]</span>
<a id="__codelineno-0-364" name="__codelineno-0-364"></a>
<a id="__codelineno-0-365" name="__codelineno-0-365"></a>        <span class="k">if</span> <span class="n">wcd_url</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">wcd_api_key</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-366" name="__codelineno-0-366"></a>            <span class="n">save_location_client_manager</span> <span class="o">=</span> <span class="n">local_user</span><span class="p">[</span>
<a id="__codelineno-0-367" name="__codelineno-0-367"></a>                <span class="s2">&quot;frontend_config&quot;</span>
<a id="__codelineno-0-368" name="__codelineno-0-368"></a>            <span class="p">]</span><span class="o">.</span><span class="n">save_location_client_manager</span>
<a id="__codelineno-0-369" name="__codelineno-0-369"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-370" name="__codelineno-0-370"></a>            <span class="n">save_location_client_manager</span> <span class="o">=</span> <span class="n">ClientManager</span><span class="p">(</span>
<a id="__codelineno-0-371" name="__codelineno-0-371"></a>                <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">,</span>
<a id="__codelineno-0-372" name="__codelineno-0-372"></a>                <span class="n">wcd_url</span><span class="o">=</span><span class="n">wcd_url</span><span class="p">,</span>
<a id="__codelineno-0-373" name="__codelineno-0-373"></a>                <span class="n">wcd_api_key</span><span class="o">=</span><span class="n">wcd_api_key</span><span class="p">,</span>
<a id="__codelineno-0-374" name="__codelineno-0-374"></a>            <span class="p">)</span>
<a id="__codelineno-0-375" name="__codelineno-0-375"></a>
<a id="__codelineno-0-376" name="__codelineno-0-376"></a>        <span class="k">return</span> <span class="k">await</span> <span class="n">tree_manager</span><span class="o">.</span><span class="n">check_tree_exists_weaviate</span><span class="p">(</span>
<a id="__codelineno-0-377" name="__codelineno-0-377"></a>            <span class="n">conversation_id</span><span class="p">,</span> <span class="n">save_location_client_manager</span>
<a id="__codelineno-0-378" name="__codelineno-0-378"></a>        <span class="p">)</span>
<a id="__codelineno-0-379" name="__codelineno-0-379"></a>
<a id="__codelineno-0-380" name="__codelineno-0-380"></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">load_tree</span><span class="p">(</span>
<a id="__codelineno-0-381" name="__codelineno-0-381"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-382" name="__codelineno-0-382"></a>        <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-383" name="__codelineno-0-383"></a>        <span class="n">conversation_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-384" name="__codelineno-0-384"></a>        <span class="n">wcd_url</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-385" name="__codelineno-0-385"></a>        <span class="n">wcd_api_key</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-386" name="__codelineno-0-386"></a>    <span class="p">):</span>
<a id="__codelineno-0-387" name="__codelineno-0-387"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-388" name="__codelineno-0-388"></a><span class="sd">        Load a tree from a Weaviate instance (set in the frontend config).</span>
<a id="__codelineno-0-389" name="__codelineno-0-389"></a><span class="sd">        This is a wrapper for the TreeManager.load_tree_weaviate() method.</span>
<a id="__codelineno-0-390" name="__codelineno-0-390"></a>
<a id="__codelineno-0-391" name="__codelineno-0-391"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-392" name="__codelineno-0-392"></a><span class="sd">            user_id (str): Required. The unique identifier for the user stored in the UserManager.</span>
<a id="__codelineno-0-393" name="__codelineno-0-393"></a><span class="sd">            conversation_id (str): Required. The unique identifier for the conversation for the user.</span>
<a id="__codelineno-0-394" name="__codelineno-0-394"></a><span class="sd">            wcd_url (str | None): Required. The URL of the Weaviate Cloud Database instance used to save the tree.</span>
<a id="__codelineno-0-395" name="__codelineno-0-395"></a><span class="sd">                Defaults to the value of the `wcd_url` setting in the frontend config.</span>
<a id="__codelineno-0-396" name="__codelineno-0-396"></a><span class="sd">            wcd_api_key (str | None): Required. The API key for the Weaviate Cloud Database instance used to save the tree.</span>
<a id="__codelineno-0-397" name="__codelineno-0-397"></a><span class="sd">                Defaults to the value of the `wcd_api_key` setting in the frontend config.</span>
<a id="__codelineno-0-398" name="__codelineno-0-398"></a>
<a id="__codelineno-0-399" name="__codelineno-0-399"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-400" name="__codelineno-0-400"></a><span class="sd">            (list[dict]): A list of dictionaries, each containing a frontend payload that was used to generate the tree.</span>
<a id="__codelineno-0-401" name="__codelineno-0-401"></a><span class="sd">                The list is ordered by the time the payload was originally sent to the frontend (at the time it was saved).</span>
<a id="__codelineno-0-402" name="__codelineno-0-402"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-403" name="__codelineno-0-403"></a>
<a id="__codelineno-0-404" name="__codelineno-0-404"></a>        <span class="n">local_user</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_user_local</span><span class="p">(</span><span class="n">user_id</span><span class="p">)</span>
<a id="__codelineno-0-405" name="__codelineno-0-405"></a>        <span class="n">tree_manager</span><span class="p">:</span> <span class="n">TreeManager</span> <span class="o">=</span> <span class="n">local_user</span><span class="p">[</span><span class="s2">&quot;tree_manager&quot;</span><span class="p">]</span>
<a id="__codelineno-0-406" name="__codelineno-0-406"></a>
<a id="__codelineno-0-407" name="__codelineno-0-407"></a>        <span class="k">if</span> <span class="n">wcd_url</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">wcd_api_key</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-408" name="__codelineno-0-408"></a>            <span class="n">save_location_client_manager</span> <span class="o">=</span> <span class="n">local_user</span><span class="p">[</span>
<a id="__codelineno-0-409" name="__codelineno-0-409"></a>                <span class="s2">&quot;frontend_config&quot;</span>
<a id="__codelineno-0-410" name="__codelineno-0-410"></a>            <span class="p">]</span><span class="o">.</span><span class="n">save_location_client_manager</span>
<a id="__codelineno-0-411" name="__codelineno-0-411"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-412" name="__codelineno-0-412"></a>            <span class="n">save_location_client_manager</span> <span class="o">=</span> <span class="n">ClientManager</span><span class="p">(</span>
<a id="__codelineno-0-413" name="__codelineno-0-413"></a>                <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">,</span>
<a id="__codelineno-0-414" name="__codelineno-0-414"></a>                <span class="n">wcd_url</span><span class="o">=</span><span class="n">wcd_url</span><span class="p">,</span>
<a id="__codelineno-0-415" name="__codelineno-0-415"></a>                <span class="n">wcd_api_key</span><span class="o">=</span><span class="n">wcd_api_key</span><span class="p">,</span>
<a id="__codelineno-0-416" name="__codelineno-0-416"></a>            <span class="p">)</span>
<a id="__codelineno-0-417" name="__codelineno-0-417"></a>
<a id="__codelineno-0-418" name="__codelineno-0-418"></a>        <span class="k">return</span> <span class="k">await</span> <span class="n">tree_manager</span><span class="o">.</span><span class="n">load_tree_weaviate</span><span class="p">(</span>
<a id="__codelineno-0-419" name="__codelineno-0-419"></a>            <span class="n">conversation_id</span><span class="p">,</span> <span class="n">save_location_client_manager</span>
<a id="__codelineno-0-420" name="__codelineno-0-420"></a>        <span class="p">)</span>
<a id="__codelineno-0-421" name="__codelineno-0-421"></a>
<a id="__codelineno-0-422" name="__codelineno-0-422"></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">delete_tree</span><span class="p">(</span>
<a id="__codelineno-0-423" name="__codelineno-0-423"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-424" name="__codelineno-0-424"></a>        <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-425" name="__codelineno-0-425"></a>        <span class="n">conversation_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-426" name="__codelineno-0-426"></a>        <span class="n">wcd_url</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-427" name="__codelineno-0-427"></a>        <span class="n">wcd_api_key</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-428" name="__codelineno-0-428"></a>    <span class="p">):</span>
<a id="__codelineno-0-429" name="__codelineno-0-429"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-430" name="__codelineno-0-430"></a><span class="sd">        Delete a saved tree from a Weaviate instance (set in the frontend config).</span>
<a id="__codelineno-0-431" name="__codelineno-0-431"></a><span class="sd">        Also delete the tree from the local tree manager.</span>
<a id="__codelineno-0-432" name="__codelineno-0-432"></a><span class="sd">        This is a wrapper for the TreeManager.delete_tree_weaviate() method and the TreeManager.delete_tree_local() method.</span>
<a id="__codelineno-0-433" name="__codelineno-0-433"></a>
<a id="__codelineno-0-434" name="__codelineno-0-434"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-435" name="__codelineno-0-435"></a><span class="sd">            user_id (str): Required. The unique identifier for the user stored in the UserManager.</span>
<a id="__codelineno-0-436" name="__codelineno-0-436"></a><span class="sd">            conversation_id (str): Required. The unique identifier for the conversation for the user.</span>
<a id="__codelineno-0-437" name="__codelineno-0-437"></a><span class="sd">            wcd_url (str | None): Required. The URL of the Weaviate Cloud Database instance used to save the tree.</span>
<a id="__codelineno-0-438" name="__codelineno-0-438"></a><span class="sd">                Defaults to the value of the `wcd_url` setting in the frontend config.</span>
<a id="__codelineno-0-439" name="__codelineno-0-439"></a><span class="sd">            wcd_api_key (str | None): Required. The API key for the Weaviate Cloud Database instance used to save the tree.</span>
<a id="__codelineno-0-440" name="__codelineno-0-440"></a><span class="sd">                Defaults to the value of the `wcd_api_key` setting in the frontend config.</span>
<a id="__codelineno-0-441" name="__codelineno-0-441"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-442" name="__codelineno-0-442"></a>
<a id="__codelineno-0-443" name="__codelineno-0-443"></a>        <span class="n">local_user</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_user_local</span><span class="p">(</span><span class="n">user_id</span><span class="p">)</span>
<a id="__codelineno-0-444" name="__codelineno-0-444"></a>        <span class="n">tree_manager</span><span class="p">:</span> <span class="n">TreeManager</span> <span class="o">=</span> <span class="n">local_user</span><span class="p">[</span><span class="s2">&quot;tree_manager&quot;</span><span class="p">]</span>
<a id="__codelineno-0-445" name="__codelineno-0-445"></a>
<a id="__codelineno-0-446" name="__codelineno-0-446"></a>        <span class="k">if</span> <span class="n">wcd_url</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">wcd_api_key</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-447" name="__codelineno-0-447"></a>            <span class="n">save_location_client_manager</span> <span class="o">=</span> <span class="n">local_user</span><span class="p">[</span>
<a id="__codelineno-0-448" name="__codelineno-0-448"></a>                <span class="s2">&quot;frontend_config&quot;</span>
<a id="__codelineno-0-449" name="__codelineno-0-449"></a>            <span class="p">]</span><span class="o">.</span><span class="n">save_location_client_manager</span>
<a id="__codelineno-0-450" name="__codelineno-0-450"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-451" name="__codelineno-0-451"></a>            <span class="n">save_location_client_manager</span> <span class="o">=</span> <span class="n">ClientManager</span><span class="p">(</span>
<a id="__codelineno-0-452" name="__codelineno-0-452"></a>                <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">,</span>
<a id="__codelineno-0-453" name="__codelineno-0-453"></a>                <span class="n">wcd_url</span><span class="o">=</span><span class="n">wcd_url</span><span class="p">,</span>
<a id="__codelineno-0-454" name="__codelineno-0-454"></a>                <span class="n">wcd_api_key</span><span class="o">=</span><span class="n">wcd_api_key</span><span class="p">,</span>
<a id="__codelineno-0-455" name="__codelineno-0-455"></a>            <span class="p">)</span>
<a id="__codelineno-0-456" name="__codelineno-0-456"></a>
<a id="__codelineno-0-457" name="__codelineno-0-457"></a>        <span class="k">await</span> <span class="n">tree_manager</span><span class="o">.</span><span class="n">delete_tree_weaviate</span><span class="p">(</span>
<a id="__codelineno-0-458" name="__codelineno-0-458"></a>            <span class="n">conversation_id</span><span class="p">,</span> <span class="n">save_location_client_manager</span>
<a id="__codelineno-0-459" name="__codelineno-0-459"></a>        <span class="p">)</span>
<a id="__codelineno-0-460" name="__codelineno-0-460"></a>        <span class="n">tree_manager</span><span class="o">.</span><span class="n">delete_tree_local</span><span class="p">(</span><span class="n">conversation_id</span><span class="p">)</span>
<a id="__codelineno-0-461" name="__codelineno-0-461"></a>
<a id="__codelineno-0-462" name="__codelineno-0-462"></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">get_saved_trees</span><span class="p">(</span>
<a id="__codelineno-0-463" name="__codelineno-0-463"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-464" name="__codelineno-0-464"></a>        <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-465" name="__codelineno-0-465"></a>        <span class="n">wcd_url</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-466" name="__codelineno-0-466"></a>        <span class="n">wcd_api_key</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-467" name="__codelineno-0-467"></a>    <span class="p">):</span>
<a id="__codelineno-0-468" name="__codelineno-0-468"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-469" name="__codelineno-0-469"></a><span class="sd">        Get all saved trees from a Weaviate instance (set in the frontend config).</span>
<a id="__codelineno-0-470" name="__codelineno-0-470"></a>
<a id="__codelineno-0-471" name="__codelineno-0-471"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-472" name="__codelineno-0-472"></a><span class="sd">            user_id (str): Required. The unique identifier for the user stored in the UserManager.</span>
<a id="__codelineno-0-473" name="__codelineno-0-473"></a><span class="sd">            wcd_url (str | None): Required. The URL of the Weaviate Cloud Database instance used to save the tree.</span>
<a id="__codelineno-0-474" name="__codelineno-0-474"></a><span class="sd">                Defaults to the value of the `wcd_url` setting in the frontend config.</span>
<a id="__codelineno-0-475" name="__codelineno-0-475"></a><span class="sd">            wcd_api_key (str | None): Required. The API key for the Weaviate Cloud Database instance used to save the tree.</span>
<a id="__codelineno-0-476" name="__codelineno-0-476"></a><span class="sd">                Defaults to the value of the `wcd_api_key` setting in the frontend config.</span>
<a id="__codelineno-0-477" name="__codelineno-0-477"></a>
<a id="__codelineno-0-478" name="__codelineno-0-478"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-479" name="__codelineno-0-479"></a><span class="sd">            (dict): A dictionary whose keys are the conversation IDs and whose values are dictionaries containing the title and last update time of the tree.</span>
<a id="__codelineno-0-480" name="__codelineno-0-480"></a><span class="sd">                E.g.</span>
<a id="__codelineno-0-481" name="__codelineno-0-481"></a><span class="sd">                ```</span>
<a id="__codelineno-0-482" name="__codelineno-0-482"></a><span class="sd">                {</span>
<a id="__codelineno-0-483" name="__codelineno-0-483"></a><span class="sd">                    &quot;12345678-XXX-YYYY-ZZZZ&quot;: {</span>
<a id="__codelineno-0-484" name="__codelineno-0-484"></a><span class="sd">                        &quot;title&quot;: &quot;Query Request&quot;,</span>
<a id="__codelineno-0-485" name="__codelineno-0-485"></a><span class="sd">                        &quot;last_update_time&quot;: &quot;2025-06-07T10:06:47.376000Z&quot;</span>
<a id="__codelineno-0-486" name="__codelineno-0-486"></a><span class="sd">                    }</span>
<a id="__codelineno-0-487" name="__codelineno-0-487"></a><span class="sd">                }</span>
<a id="__codelineno-0-488" name="__codelineno-0-488"></a><span class="sd">                ```</span>
<a id="__codelineno-0-489" name="__codelineno-0-489"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-490" name="__codelineno-0-490"></a>        <span class="n">local_user</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_user_local</span><span class="p">(</span><span class="n">user_id</span><span class="p">)</span>
<a id="__codelineno-0-491" name="__codelineno-0-491"></a>
<a id="__codelineno-0-492" name="__codelineno-0-492"></a>        <span class="k">if</span> <span class="n">wcd_url</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">wcd_api_key</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-493" name="__codelineno-0-493"></a>            <span class="n">save_location_client_manager</span> <span class="o">=</span> <span class="n">local_user</span><span class="p">[</span>
<a id="__codelineno-0-494" name="__codelineno-0-494"></a>                <span class="s2">&quot;frontend_config&quot;</span>
<a id="__codelineno-0-495" name="__codelineno-0-495"></a>            <span class="p">]</span><span class="o">.</span><span class="n">save_location_client_manager</span>
<a id="__codelineno-0-496" name="__codelineno-0-496"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-497" name="__codelineno-0-497"></a>            <span class="n">save_location_client_manager</span> <span class="o">=</span> <span class="n">ClientManager</span><span class="p">(</span>
<a id="__codelineno-0-498" name="__codelineno-0-498"></a>                <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">,</span>
<a id="__codelineno-0-499" name="__codelineno-0-499"></a>                <span class="n">wcd_url</span><span class="o">=</span><span class="n">wcd_url</span><span class="p">,</span>
<a id="__codelineno-0-500" name="__codelineno-0-500"></a>                <span class="n">wcd_api_key</span><span class="o">=</span><span class="n">wcd_api_key</span><span class="p">,</span>
<a id="__codelineno-0-501" name="__codelineno-0-501"></a>            <span class="p">)</span>
<a id="__codelineno-0-502" name="__codelineno-0-502"></a>
<a id="__codelineno-0-503" name="__codelineno-0-503"></a>        <span class="k">return</span> <span class="k">await</span> <span class="n">get_saved_trees_weaviate</span><span class="p">(</span>
<a id="__codelineno-0-504" name="__codelineno-0-504"></a>            <span class="s2">&quot;ELYSIA_TREES__&quot;</span><span class="p">,</span> <span class="n">save_location_client_manager</span><span class="p">,</span> <span class="n">user_id</span>
<a id="__codelineno-0-505" name="__codelineno-0-505"></a>        <span class="p">)</span>
<a id="__codelineno-0-506" name="__codelineno-0-506"></a>
<a id="__codelineno-0-507" name="__codelineno-0-507"></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">update_user_last_request</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-0-508" name="__codelineno-0-508"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">users</span><span class="p">[</span><span class="n">user_id</span><span class="p">][</span><span class="s2">&quot;last_request&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
<a id="__codelineno-0-509" name="__codelineno-0-509"></a>
<a id="__codelineno-0-510" name="__codelineno-0-510"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">check_tree_timeout</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">conversation_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-0-511" name="__codelineno-0-511"></a>        <span class="k">if</span> <span class="n">user_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">users</span><span class="p">:</span>
<a id="__codelineno-0-512" name="__codelineno-0-512"></a>            <span class="k">return</span> <span class="kc">True</span>
<a id="__codelineno-0-513" name="__codelineno-0-513"></a>        <span class="k">elif</span> <span class="n">conversation_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">users</span><span class="p">[</span><span class="n">user_id</span><span class="p">][</span><span class="s2">&quot;tree_manager&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">trees</span><span class="p">:</span>
<a id="__codelineno-0-514" name="__codelineno-0-514"></a>            <span class="k">return</span> <span class="kc">True</span>
<a id="__codelineno-0-515" name="__codelineno-0-515"></a>        <span class="k">return</span> <span class="kc">False</span>
<a id="__codelineno-0-516" name="__codelineno-0-516"></a>
<a id="__codelineno-0-517" name="__codelineno-0-517"></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">process_tree</span><span class="p">(</span>
<a id="__codelineno-0-518" name="__codelineno-0-518"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-519" name="__codelineno-0-519"></a>        <span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-520" name="__codelineno-0-520"></a>        <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-521" name="__codelineno-0-521"></a>        <span class="n">conversation_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-522" name="__codelineno-0-522"></a>        <span class="n">query_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-523" name="__codelineno-0-523"></a>        <span class="n">training_route</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
<a id="__codelineno-0-524" name="__codelineno-0-524"></a>        <span class="n">collection_names</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[],</span>
<a id="__codelineno-0-525" name="__codelineno-0-525"></a>        <span class="n">save_trees_to_weaviate</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-526" name="__codelineno-0-526"></a>        <span class="n">wcd_url</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-527" name="__codelineno-0-527"></a>        <span class="n">wcd_api_key</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-528" name="__codelineno-0-528"></a>    <span class="p">):</span>
<a id="__codelineno-0-529" name="__codelineno-0-529"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-530" name="__codelineno-0-530"></a><span class="sd">        Wrapper for the TreeManager.process_tree() method.</span>
<a id="__codelineno-0-531" name="__codelineno-0-531"></a><span class="sd">        Which itself is a wrapper for the Tree.async_run() method.</span>
<a id="__codelineno-0-532" name="__codelineno-0-532"></a><span class="sd">        This is an async generator which yields results from the tree.async_run() method.</span>
<a id="__codelineno-0-533" name="__codelineno-0-533"></a><span class="sd">        Automatically sends error payloads if the user or tree has been timed out.</span>
<a id="__codelineno-0-534" name="__codelineno-0-534"></a>
<a id="__codelineno-0-535" name="__codelineno-0-535"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-536" name="__codelineno-0-536"></a><span class="sd">            query (str): Required. The user input/prompt to process in the decision tree.</span>
<a id="__codelineno-0-537" name="__codelineno-0-537"></a><span class="sd">            user_id (str): Required. The unique identifier for the user.</span>
<a id="__codelineno-0-538" name="__codelineno-0-538"></a><span class="sd">            conversation_id (str): Required. The conversation ID which contains the tree.</span>
<a id="__codelineno-0-539" name="__codelineno-0-539"></a><span class="sd">                This should be the same conversation ID as the one used to initialise the tree (see `initialise_tree`).</span>
<a id="__codelineno-0-540" name="__codelineno-0-540"></a><span class="sd">            query_id (str): Required. A unique identifier for the query.</span>
<a id="__codelineno-0-541" name="__codelineno-0-541"></a><span class="sd">            training_route (str): Optional. The training route, a string of the form &quot;tool1/tool2/tool1&quot; etc.</span>
<a id="__codelineno-0-542" name="__codelineno-0-542"></a><span class="sd">                See the `tree.async_run()` method for more details.</span>
<a id="__codelineno-0-543" name="__codelineno-0-543"></a><span class="sd">            collection_names (list[str]): Optional. A list of collection names to use in the query.</span>
<a id="__codelineno-0-544" name="__codelineno-0-544"></a><span class="sd">                If not supplied, all collections will be used.</span>
<a id="__codelineno-0-545" name="__codelineno-0-545"></a><span class="sd">            save_trees_to_weaviate (bool | None): Optional. Whether to save the trees to a Weaviate instance,</span>
<a id="__codelineno-0-546" name="__codelineno-0-546"></a><span class="sd">                after the process_tree() method has finished.</span>
<a id="__codelineno-0-547" name="__codelineno-0-547"></a><span class="sd">                Defaults to the value of the `save_trees_to_weaviate` setting in the frontend config.</span>
<a id="__codelineno-0-548" name="__codelineno-0-548"></a><span class="sd">            wcd_url (str | None): Required. The URL of the Weaviate Cloud Database instance used to save the tree.</span>
<a id="__codelineno-0-549" name="__codelineno-0-549"></a><span class="sd">                Defaults to the value of the `wcd_url` setting in the frontend config.</span>
<a id="__codelineno-0-550" name="__codelineno-0-550"></a><span class="sd">            wcd_api_key (str | None): Required. The API key for the Weaviate Cloud Database instance used to save the tree.</span>
<a id="__codelineno-0-551" name="__codelineno-0-551"></a><span class="sd">                Defaults to the value of the `wcd_api_key` setting in the frontend config.</span>
<a id="__codelineno-0-552" name="__codelineno-0-552"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-553" name="__codelineno-0-553"></a>
<a id="__codelineno-0-554" name="__codelineno-0-554"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_user_timeout</span><span class="p">(</span><span class="n">user_id</span><span class="p">):</span>
<a id="__codelineno-0-555" name="__codelineno-0-555"></a>            <span class="n">user_timeout_error</span> <span class="o">=</span> <span class="n">UserTimeoutError</span><span class="p">()</span>
<a id="__codelineno-0-556" name="__codelineno-0-556"></a>            <span class="n">error_payload</span> <span class="o">=</span> <span class="k">await</span> <span class="n">user_timeout_error</span><span class="o">.</span><span class="n">to_frontend</span><span class="p">(</span>
<a id="__codelineno-0-557" name="__codelineno-0-557"></a>                <span class="n">user_id</span><span class="p">,</span> <span class="n">conversation_id</span><span class="p">,</span> <span class="n">query_id</span>
<a id="__codelineno-0-558" name="__codelineno-0-558"></a>            <span class="p">)</span>
<a id="__codelineno-0-559" name="__codelineno-0-559"></a>            <span class="k">yield</span> <span class="n">error_payload</span>
<a id="__codelineno-0-560" name="__codelineno-0-560"></a>            <span class="k">return</span>
<a id="__codelineno-0-561" name="__codelineno-0-561"></a>
<a id="__codelineno-0-562" name="__codelineno-0-562"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_tree_timeout</span><span class="p">(</span><span class="n">user_id</span><span class="p">,</span> <span class="n">conversation_id</span><span class="p">):</span>
<a id="__codelineno-0-563" name="__codelineno-0-563"></a>            <span class="k">if</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_tree_exists_weaviate</span><span class="p">(</span><span class="n">user_id</span><span class="p">,</span> <span class="n">conversation_id</span><span class="p">):</span>
<a id="__codelineno-0-564" name="__codelineno-0-564"></a>                <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_tree</span><span class="p">(</span><span class="n">user_id</span><span class="p">,</span> <span class="n">conversation_id</span><span class="p">)</span>
<a id="__codelineno-0-565" name="__codelineno-0-565"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-566" name="__codelineno-0-566"></a>                <span class="n">tree_timeout_error</span> <span class="o">=</span> <span class="n">TreeTimeoutError</span><span class="p">()</span>
<a id="__codelineno-0-567" name="__codelineno-0-567"></a>                <span class="n">error_payload</span> <span class="o">=</span> <span class="k">await</span> <span class="n">tree_timeout_error</span><span class="o">.</span><span class="n">to_frontend</span><span class="p">(</span>
<a id="__codelineno-0-568" name="__codelineno-0-568"></a>                    <span class="n">user_id</span><span class="p">,</span> <span class="n">conversation_id</span><span class="p">,</span> <span class="n">query_id</span>
<a id="__codelineno-0-569" name="__codelineno-0-569"></a>                <span class="p">)</span>
<a id="__codelineno-0-570" name="__codelineno-0-570"></a>                <span class="k">yield</span> <span class="n">error_payload</span>
<a id="__codelineno-0-571" name="__codelineno-0-571"></a>                <span class="k">return</span>
<a id="__codelineno-0-572" name="__codelineno-0-572"></a>
<a id="__codelineno-0-573" name="__codelineno-0-573"></a>        <span class="n">local_user</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_user_local</span><span class="p">(</span><span class="n">user_id</span><span class="p">)</span>
<a id="__codelineno-0-574" name="__codelineno-0-574"></a>        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_user_last_request</span><span class="p">(</span><span class="n">user_id</span><span class="p">)</span>
<a id="__codelineno-0-575" name="__codelineno-0-575"></a>
<a id="__codelineno-0-576" name="__codelineno-0-576"></a>        <span class="n">tree_manager</span><span class="p">:</span> <span class="n">TreeManager</span> <span class="o">=</span> <span class="n">local_user</span><span class="p">[</span><span class="s2">&quot;tree_manager&quot;</span><span class="p">]</span>
<a id="__codelineno-0-577" name="__codelineno-0-577"></a>
<a id="__codelineno-0-578" name="__codelineno-0-578"></a>        <span class="k">async</span> <span class="k">for</span> <span class="n">yielded_result</span> <span class="ow">in</span> <span class="n">tree_manager</span><span class="o">.</span><span class="n">process_tree</span><span class="p">(</span>
<a id="__codelineno-0-579" name="__codelineno-0-579"></a>            <span class="n">query</span><span class="p">,</span>
<a id="__codelineno-0-580" name="__codelineno-0-580"></a>            <span class="n">conversation_id</span><span class="p">,</span>
<a id="__codelineno-0-581" name="__codelineno-0-581"></a>            <span class="n">query_id</span><span class="p">,</span>
<a id="__codelineno-0-582" name="__codelineno-0-582"></a>            <span class="n">training_route</span><span class="p">,</span>
<a id="__codelineno-0-583" name="__codelineno-0-583"></a>            <span class="n">collection_names</span><span class="p">,</span>
<a id="__codelineno-0-584" name="__codelineno-0-584"></a>            <span class="n">local_user</span><span class="p">[</span><span class="s2">&quot;client_manager&quot;</span><span class="p">],</span>
<a id="__codelineno-0-585" name="__codelineno-0-585"></a>        <span class="p">):</span>
<a id="__codelineno-0-586" name="__codelineno-0-586"></a>            <span class="k">yield</span> <span class="n">yielded_result</span>
<a id="__codelineno-0-587" name="__codelineno-0-587"></a>            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_user_last_request</span><span class="p">(</span><span class="n">user_id</span><span class="p">)</span>
<a id="__codelineno-0-588" name="__codelineno-0-588"></a>
<a id="__codelineno-0-589" name="__codelineno-0-589"></a>        <span class="k">if</span> <span class="n">save_trees_to_weaviate</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-590" name="__codelineno-0-590"></a>            <span class="n">frontend_config</span><span class="p">:</span> <span class="n">FrontendConfig</span> <span class="o">=</span> <span class="n">local_user</span><span class="p">[</span><span class="s2">&quot;frontend_config&quot;</span><span class="p">]</span>
<a id="__codelineno-0-591" name="__codelineno-0-591"></a>            <span class="n">save_trees_to_weaviate</span> <span class="o">=</span> <span class="n">frontend_config</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;save_trees_to_weaviate&quot;</span><span class="p">]</span>
<a id="__codelineno-0-592" name="__codelineno-0-592"></a>
<a id="__codelineno-0-593" name="__codelineno-0-593"></a>        <span class="k">if</span> <span class="n">save_trees_to_weaviate</span><span class="p">:</span>
<a id="__codelineno-0-594" name="__codelineno-0-594"></a>            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">save_tree</span><span class="p">(</span><span class="n">user_id</span><span class="p">,</span> <span class="n">conversation_id</span><span class="p">,</span> <span class="n">wcd_url</span><span class="p">,</span> <span class="n">wcd_api_key</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="elysia.api.services.user.UserManager.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">user_timeout</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">



<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>user_timeout</code>
            </td>
            <td>
                  <code><span title="datetime.timedelta">timedelta</span> | <span title="int">int</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional.
The length of time a user can be idle before being timed out.
Defaults to 20 minutes or the value of the USER_TIMEOUT environment variable.
If an integer is provided, it is interpreted as the number of minutes.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>elysia/api/services/user.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-77">77</a></span>
<span class="normal"><a href="#__codelineno-0-78">78</a></span>
<span class="normal"><a href="#__codelineno-0-79">79</a></span>
<span class="normal"><a href="#__codelineno-0-80">80</a></span>
<span class="normal"><a href="#__codelineno-0-81">81</a></span>
<span class="normal"><a href="#__codelineno-0-82">82</a></span>
<span class="normal"><a href="#__codelineno-0-83">83</a></span>
<span class="normal"><a href="#__codelineno-0-84">84</a></span>
<span class="normal"><a href="#__codelineno-0-85">85</a></span>
<span class="normal"><a href="#__codelineno-0-86">86</a></span>
<span class="normal"><a href="#__codelineno-0-87">87</a></span>
<span class="normal"><a href="#__codelineno-0-88">88</a></span>
<span class="normal"><a href="#__codelineno-0-89">89</a></span>
<span class="normal"><a href="#__codelineno-0-90">90</a></span>
<span class="normal"><a href="#__codelineno-0-91">91</a></span>
<span class="normal"><a href="#__codelineno-0-92">92</a></span>
<span class="normal"><a href="#__codelineno-0-93">93</a></span>
<span class="normal"><a href="#__codelineno-0-94">94</a></span>
<span class="normal"><a href="#__codelineno-0-95">95</a></span>
<span class="normal"><a href="#__codelineno-0-96">96</a></span>
<span class="normal"><a href="#__codelineno-0-97">97</a></span>
<span class="normal"><a href="#__codelineno-0-98">98</a></span>
<span class="normal"><a href="#__codelineno-0-99">99</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-77" name="__codelineno-0-77"></a><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
<a id="__codelineno-0-78" name="__codelineno-0-78"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a>    <span class="n">user_timeout</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a><span class="p">):</span>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a><span class="sd">        user_timeout (datetime.timedelta | int | None): Optional.</span>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a><span class="sd">            The length of time a user can be idle before being timed out.</span>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a><span class="sd">            Defaults to 20 minutes or the value of the USER_TIMEOUT environment variable.</span>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a><span class="sd">            If an integer is provided, it is interpreted as the number of minutes.</span>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a>    <span class="k">if</span> <span class="n">user_timeout</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">user_timeout</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a>            <span class="n">minutes</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;USER_TIMEOUT&quot;</span><span class="p">,</span> <span class="mi">20</span><span class="p">))</span>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a>        <span class="p">)</span>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a>    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">user_timeout</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">user_timeout</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">minutes</span><span class="o">=</span><span class="n">user_timeout</span><span class="p">)</span>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">user_timeout</span> <span class="o">=</span> <span class="n">user_timeout</span>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">manager_id</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1000000</span><span class="p">)</span>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">date_of_reset</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">users</span> <span class="o">=</span> <span class="p">{}</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="elysia.api.services.user.UserManager.add_user_local" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">add_user_local</span><span class="p">(</span><span class="n">user_id</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Add a user to the UserManager.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>user_id</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Required. The unique identifier for the user.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>config</code>
            </td>
            <td>
                  <code><span title="elysia.api.utils.config.Config">Config</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Required. The config for the user.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>elysia/api/services/user.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span>
<span class="normal"><a href="#__codelineno-0-149">149</a></span>
<span class="normal"><a href="#__codelineno-0-150">150</a></span>
<span class="normal"><a href="#__codelineno-0-151">151</a></span>
<span class="normal"><a href="#__codelineno-0-152">152</a></span>
<span class="normal"><a href="#__codelineno-0-153">153</a></span>
<span class="normal"><a href="#__codelineno-0-154">154</a></span>
<span class="normal"><a href="#__codelineno-0-155">155</a></span>
<span class="normal"><a href="#__codelineno-0-156">156</a></span>
<span class="normal"><a href="#__codelineno-0-157">157</a></span>
<span class="normal"><a href="#__codelineno-0-158">158</a></span>
<span class="normal"><a href="#__codelineno-0-159">159</a></span>
<span class="normal"><a href="#__codelineno-0-160">160</a></span>
<span class="normal"><a href="#__codelineno-0-161">161</a></span>
<span class="normal"><a href="#__codelineno-0-162">162</a></span>
<span class="normal"><a href="#__codelineno-0-163">163</a></span>
<span class="normal"><a href="#__codelineno-0-164">164</a></span>
<span class="normal"><a href="#__codelineno-0-165">165</a></span>
<span class="normal"><a href="#__codelineno-0-166">166</a></span>
<span class="normal"><a href="#__codelineno-0-167">167</a></span>
<span class="normal"><a href="#__codelineno-0-168">168</a></span>
<span class="normal"><a href="#__codelineno-0-169">169</a></span>
<span class="normal"><a href="#__codelineno-0-170">170</a></span>
<span class="normal"><a href="#__codelineno-0-171">171</a></span>
<span class="normal"><a href="#__codelineno-0-172">172</a></span>
<span class="normal"><a href="#__codelineno-0-173">173</a></span>
<span class="normal"><a href="#__codelineno-0-174">174</a></span>
<span class="normal"><a href="#__codelineno-0-175">175</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-143" name="__codelineno-0-143"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">add_user_local</span><span class="p">(</span>
<a id="__codelineno-0-144" name="__codelineno-0-144"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-145" name="__codelineno-0-145"></a>    <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-146" name="__codelineno-0-146"></a>    <span class="n">config</span><span class="p">:</span> <span class="n">Config</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-147" name="__codelineno-0-147"></a><span class="p">):</span>
<a id="__codelineno-0-148" name="__codelineno-0-148"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-149" name="__codelineno-0-149"></a><span class="sd">    Add a user to the UserManager.</span>
<a id="__codelineno-0-150" name="__codelineno-0-150"></a>
<a id="__codelineno-0-151" name="__codelineno-0-151"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-152" name="__codelineno-0-152"></a><span class="sd">        user_id (str): Required. The unique identifier for the user.</span>
<a id="__codelineno-0-153" name="__codelineno-0-153"></a><span class="sd">        config (Config): Required. The config for the user.</span>
<a id="__codelineno-0-154" name="__codelineno-0-154"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-155" name="__codelineno-0-155"></a>
<a id="__codelineno-0-156" name="__codelineno-0-156"></a>    <span class="c1"># add user if it doesn&#39;t exist</span>
<a id="__codelineno-0-157" name="__codelineno-0-157"></a>    <span class="k">if</span> <span class="n">user_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">users</span><span class="p">:</span>
<a id="__codelineno-0-158" name="__codelineno-0-158"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">users</span><span class="p">[</span><span class="n">user_id</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-159" name="__codelineno-0-159"></a>
<a id="__codelineno-0-160" name="__codelineno-0-160"></a>        <span class="n">fe_config</span> <span class="o">=</span> <span class="k">await</span> <span class="n">load_frontend_config_from_file</span><span class="p">(</span><span class="n">user_id</span><span class="p">,</span> <span class="n">logger</span><span class="p">)</span>
<a id="__codelineno-0-161" name="__codelineno-0-161"></a>
<a id="__codelineno-0-162" name="__codelineno-0-162"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">users</span><span class="p">[</span><span class="n">user_id</span><span class="p">][</span><span class="s2">&quot;frontend_config&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fe_config</span>
<a id="__codelineno-0-163" name="__codelineno-0-163"></a>
<a id="__codelineno-0-164" name="__codelineno-0-164"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">users</span><span class="p">[</span><span class="n">user_id</span><span class="p">][</span><span class="s2">&quot;tree_manager&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">TreeManager</span><span class="p">(</span>
<a id="__codelineno-0-165" name="__codelineno-0-165"></a>            <span class="n">user_id</span><span class="o">=</span><span class="n">user_id</span><span class="p">,</span>
<a id="__codelineno-0-166" name="__codelineno-0-166"></a>            <span class="n">config</span><span class="o">=</span><span class="n">config</span><span class="p">,</span>
<a id="__codelineno-0-167" name="__codelineno-0-167"></a>            <span class="n">tree_timeout</span><span class="o">=</span><span class="n">fe_config</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;tree_timeout&quot;</span><span class="p">],</span>
<a id="__codelineno-0-168" name="__codelineno-0-168"></a>        <span class="p">)</span>
<a id="__codelineno-0-169" name="__codelineno-0-169"></a>
<a id="__codelineno-0-170" name="__codelineno-0-170"></a>        <span class="c1"># client manager starts with env variables, when config is updated, api keys are updated</span>
<a id="__codelineno-0-171" name="__codelineno-0-171"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">users</span><span class="p">[</span><span class="n">user_id</span><span class="p">][</span><span class="s2">&quot;client_manager&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ClientManager</span><span class="p">(</span>
<a id="__codelineno-0-172" name="__codelineno-0-172"></a>            <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">,</span>
<a id="__codelineno-0-173" name="__codelineno-0-173"></a>            <span class="n">client_timeout</span><span class="o">=</span><span class="n">fe_config</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;client_timeout&quot;</span><span class="p">],</span>
<a id="__codelineno-0-174" name="__codelineno-0-174"></a>            <span class="n">settings</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">users</span><span class="p">[</span><span class="n">user_id</span><span class="p">][</span><span class="s2">&quot;tree_manager&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">settings</span><span class="p">,</span>
<a id="__codelineno-0-175" name="__codelineno-0-175"></a>        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="elysia.api.services.user.UserManager.check_all_trees_timeout" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">check_all_trees_timeout</span><span class="p">()</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Check all trees in all TreeManagers across all users and remove any that have not been active in the last tree_timeout.</p>


            <details class="quote">
              <summary>Source code in <code>elysia/api/services/user.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-215">215</a></span>
<span class="normal"><a href="#__codelineno-0-216">216</a></span>
<span class="normal"><a href="#__codelineno-0-217">217</a></span>
<span class="normal"><a href="#__codelineno-0-218">218</a></span>
<span class="normal"><a href="#__codelineno-0-219">219</a></span>
<span class="normal"><a href="#__codelineno-0-220">220</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-215" name="__codelineno-0-215"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">check_all_trees_timeout</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-216" name="__codelineno-0-216"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-217" name="__codelineno-0-217"></a><span class="sd">    Check all trees in all TreeManagers across all users and remove any that have not been active in the last tree_timeout.</span>
<a id="__codelineno-0-218" name="__codelineno-0-218"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-219" name="__codelineno-0-219"></a>    <span class="k">for</span> <span class="n">user_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">users</span><span class="p">:</span>
<a id="__codelineno-0-220" name="__codelineno-0-220"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">users</span><span class="p">[</span><span class="n">user_id</span><span class="p">][</span><span class="s2">&quot;tree_manager&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">check_all_trees_timeout</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="elysia.api.services.user.UserManager.check_all_users_timeout" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">check_all_users_timeout</span><span class="p">()</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Check all users in the UserManager and remove any that have not been active in the last user_timeout.</p>


            <details class="quote">
              <summary>Source code in <code>elysia/api/services/user.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-246">246</a></span>
<span class="normal"><a href="#__codelineno-0-247">247</a></span>
<span class="normal"><a href="#__codelineno-0-248">248</a></span>
<span class="normal"><a href="#__codelineno-0-249">249</a></span>
<span class="normal"><a href="#__codelineno-0-250">250</a></span>
<span class="normal"><a href="#__codelineno-0-251">251</a></span>
<span class="normal"><a href="#__codelineno-0-252">252</a></span>
<span class="normal"><a href="#__codelineno-0-253">253</a></span>
<span class="normal"><a href="#__codelineno-0-254">254</a></span>
<span class="normal"><a href="#__codelineno-0-255">255</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-246" name="__codelineno-0-246"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">check_all_users_timeout</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-247" name="__codelineno-0-247"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-248" name="__codelineno-0-248"></a><span class="sd">    Check all users in the UserManager and remove any that have not been active in the last user_timeout.</span>
<a id="__codelineno-0-249" name="__codelineno-0-249"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-250" name="__codelineno-0-250"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_timeout</span> <span class="o">==</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">minutes</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
<a id="__codelineno-0-251" name="__codelineno-0-251"></a>        <span class="k">return</span>
<a id="__codelineno-0-252" name="__codelineno-0-252"></a>
<a id="__codelineno-0-253" name="__codelineno-0-253"></a>    <span class="k">for</span> <span class="n">user_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">users</span><span class="p">:</span>
<a id="__codelineno-0-254" name="__codelineno-0-254"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_user_timeout</span><span class="p">(</span><span class="n">user_id</span><span class="p">):</span>
<a id="__codelineno-0-255" name="__codelineno-0-255"></a>            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">users</span><span class="p">[</span><span class="n">user_id</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="elysia.api.services.user.UserManager.check_restart_clients" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">check_restart_clients</span><span class="p">()</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Check all clients in all ClientManagers across all users and run the restart_client() method (for sync and async clients).
The restart_client() methods will check if the client has been inactive for the last client_timeout minutes (set in init).</p>


            <details class="quote">
              <summary>Source code in <code>elysia/api/services/user.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-257">257</a></span>
<span class="normal"><a href="#__codelineno-0-258">258</a></span>
<span class="normal"><a href="#__codelineno-0-259">259</a></span>
<span class="normal"><a href="#__codelineno-0-260">260</a></span>
<span class="normal"><a href="#__codelineno-0-261">261</a></span>
<span class="normal"><a href="#__codelineno-0-262">262</a></span>
<span class="normal"><a href="#__codelineno-0-263">263</a></span>
<span class="normal"><a href="#__codelineno-0-264">264</a></span>
<span class="normal"><a href="#__codelineno-0-265">265</a></span>
<span class="normal"><a href="#__codelineno-0-266">266</a></span>
<span class="normal"><a href="#__codelineno-0-267">267</a></span>
<span class="normal"><a href="#__codelineno-0-268">268</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-257" name="__codelineno-0-257"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">check_restart_clients</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-258" name="__codelineno-0-258"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-259" name="__codelineno-0-259"></a><span class="sd">    Check all clients in all ClientManagers across all users and run the restart_client() method (for sync and async clients).</span>
<a id="__codelineno-0-260" name="__codelineno-0-260"></a><span class="sd">    The restart_client() methods will check if the client has been inactive for the last client_timeout minutes (set in init).</span>
<a id="__codelineno-0-261" name="__codelineno-0-261"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-262" name="__codelineno-0-262"></a>    <span class="k">for</span> <span class="n">user_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">users</span><span class="p">:</span>
<a id="__codelineno-0-263" name="__codelineno-0-263"></a>        <span class="k">if</span> <span class="p">(</span>
<a id="__codelineno-0-264" name="__codelineno-0-264"></a>            <span class="s2">&quot;client_manager&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">users</span><span class="p">[</span><span class="n">user_id</span><span class="p">]</span>
<a id="__codelineno-0-265" name="__codelineno-0-265"></a>            <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">users</span><span class="p">[</span><span class="n">user_id</span><span class="p">][</span><span class="s2">&quot;client_manager&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">is_client</span>
<a id="__codelineno-0-266" name="__codelineno-0-266"></a>        <span class="p">):</span>
<a id="__codelineno-0-267" name="__codelineno-0-267"></a>            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">users</span><span class="p">[</span><span class="n">user_id</span><span class="p">][</span><span class="s2">&quot;client_manager&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">restart_client</span><span class="p">()</span>
<a id="__codelineno-0-268" name="__codelineno-0-268"></a>            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">users</span><span class="p">[</span><span class="n">user_id</span><span class="p">][</span><span class="s2">&quot;client_manager&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">restart_async_client</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="elysia.api.services.user.UserManager.check_tree_exists_weaviate" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">check_tree_exists_weaviate</span><span class="p">(</span><span class="n">user_id</span><span class="p">,</span> <span class="n">conversation_id</span><span class="p">,</span> <span class="n">wcd_url</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">wcd_api_key</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Check if a tree exists in a Weaviate instance (set in the frontend config).</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>user_id</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Required. The unique identifier for the user stored in the UserManager.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>conversation_id</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Required. The unique identifier for the conversation for the user.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>wcd_url</code>
            </td>
            <td>
                  <code><span title="str">str</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Required. The URL of the Weaviate Cloud Database instance used to save the tree.
Defaults to the value of the <code>wcd_url</code> setting in the frontend config.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>wcd_api_key</code>
            </td>
            <td>
                  <code><span title="str">str</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Required. The API key for the Weaviate Cloud Database instance used to save the tree.
Defaults to the value of the <code>wcd_api_key</code> setting in the frontend config.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True if the tree exists in the Weaviate instance, False otherwise.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>elysia/api/services/user.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-340">340</a></span>
<span class="normal"><a href="#__codelineno-0-341">341</a></span>
<span class="normal"><a href="#__codelineno-0-342">342</a></span>
<span class="normal"><a href="#__codelineno-0-343">343</a></span>
<span class="normal"><a href="#__codelineno-0-344">344</a></span>
<span class="normal"><a href="#__codelineno-0-345">345</a></span>
<span class="normal"><a href="#__codelineno-0-346">346</a></span>
<span class="normal"><a href="#__codelineno-0-347">347</a></span>
<span class="normal"><a href="#__codelineno-0-348">348</a></span>
<span class="normal"><a href="#__codelineno-0-349">349</a></span>
<span class="normal"><a href="#__codelineno-0-350">350</a></span>
<span class="normal"><a href="#__codelineno-0-351">351</a></span>
<span class="normal"><a href="#__codelineno-0-352">352</a></span>
<span class="normal"><a href="#__codelineno-0-353">353</a></span>
<span class="normal"><a href="#__codelineno-0-354">354</a></span>
<span class="normal"><a href="#__codelineno-0-355">355</a></span>
<span class="normal"><a href="#__codelineno-0-356">356</a></span>
<span class="normal"><a href="#__codelineno-0-357">357</a></span>
<span class="normal"><a href="#__codelineno-0-358">358</a></span>
<span class="normal"><a href="#__codelineno-0-359">359</a></span>
<span class="normal"><a href="#__codelineno-0-360">360</a></span>
<span class="normal"><a href="#__codelineno-0-361">361</a></span>
<span class="normal"><a href="#__codelineno-0-362">362</a></span>
<span class="normal"><a href="#__codelineno-0-363">363</a></span>
<span class="normal"><a href="#__codelineno-0-364">364</a></span>
<span class="normal"><a href="#__codelineno-0-365">365</a></span>
<span class="normal"><a href="#__codelineno-0-366">366</a></span>
<span class="normal"><a href="#__codelineno-0-367">367</a></span>
<span class="normal"><a href="#__codelineno-0-368">368</a></span>
<span class="normal"><a href="#__codelineno-0-369">369</a></span>
<span class="normal"><a href="#__codelineno-0-370">370</a></span>
<span class="normal"><a href="#__codelineno-0-371">371</a></span>
<span class="normal"><a href="#__codelineno-0-372">372</a></span>
<span class="normal"><a href="#__codelineno-0-373">373</a></span>
<span class="normal"><a href="#__codelineno-0-374">374</a></span>
<span class="normal"><a href="#__codelineno-0-375">375</a></span>
<span class="normal"><a href="#__codelineno-0-376">376</a></span>
<span class="normal"><a href="#__codelineno-0-377">377</a></span>
<span class="normal"><a href="#__codelineno-0-378">378</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-340" name="__codelineno-0-340"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">check_tree_exists_weaviate</span><span class="p">(</span>
<a id="__codelineno-0-341" name="__codelineno-0-341"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-342" name="__codelineno-0-342"></a>    <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-343" name="__codelineno-0-343"></a>    <span class="n">conversation_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-344" name="__codelineno-0-344"></a>    <span class="n">wcd_url</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-345" name="__codelineno-0-345"></a>    <span class="n">wcd_api_key</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-346" name="__codelineno-0-346"></a><span class="p">):</span>
<a id="__codelineno-0-347" name="__codelineno-0-347"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-348" name="__codelineno-0-348"></a><span class="sd">    Check if a tree exists in a Weaviate instance (set in the frontend config).</span>
<a id="__codelineno-0-349" name="__codelineno-0-349"></a>
<a id="__codelineno-0-350" name="__codelineno-0-350"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-351" name="__codelineno-0-351"></a><span class="sd">        user_id (str): Required. The unique identifier for the user stored in the UserManager.</span>
<a id="__codelineno-0-352" name="__codelineno-0-352"></a><span class="sd">        conversation_id (str): Required. The unique identifier for the conversation for the user.</span>
<a id="__codelineno-0-353" name="__codelineno-0-353"></a><span class="sd">        wcd_url (str | None): Required. The URL of the Weaviate Cloud Database instance used to save the tree.</span>
<a id="__codelineno-0-354" name="__codelineno-0-354"></a><span class="sd">            Defaults to the value of the `wcd_url` setting in the frontend config.</span>
<a id="__codelineno-0-355" name="__codelineno-0-355"></a><span class="sd">        wcd_api_key (str | None): Required. The API key for the Weaviate Cloud Database instance used to save the tree.</span>
<a id="__codelineno-0-356" name="__codelineno-0-356"></a><span class="sd">            Defaults to the value of the `wcd_api_key` setting in the frontend config.</span>
<a id="__codelineno-0-357" name="__codelineno-0-357"></a>
<a id="__codelineno-0-358" name="__codelineno-0-358"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-359" name="__codelineno-0-359"></a><span class="sd">        (bool): True if the tree exists in the Weaviate instance, False otherwise.</span>
<a id="__codelineno-0-360" name="__codelineno-0-360"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-361" name="__codelineno-0-361"></a>
<a id="__codelineno-0-362" name="__codelineno-0-362"></a>    <span class="n">local_user</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_user_local</span><span class="p">(</span><span class="n">user_id</span><span class="p">)</span>
<a id="__codelineno-0-363" name="__codelineno-0-363"></a>    <span class="n">tree_manager</span><span class="p">:</span> <span class="n">TreeManager</span> <span class="o">=</span> <span class="n">local_user</span><span class="p">[</span><span class="s2">&quot;tree_manager&quot;</span><span class="p">]</span>
<a id="__codelineno-0-364" name="__codelineno-0-364"></a>
<a id="__codelineno-0-365" name="__codelineno-0-365"></a>    <span class="k">if</span> <span class="n">wcd_url</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">wcd_api_key</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-366" name="__codelineno-0-366"></a>        <span class="n">save_location_client_manager</span> <span class="o">=</span> <span class="n">local_user</span><span class="p">[</span>
<a id="__codelineno-0-367" name="__codelineno-0-367"></a>            <span class="s2">&quot;frontend_config&quot;</span>
<a id="__codelineno-0-368" name="__codelineno-0-368"></a>        <span class="p">]</span><span class="o">.</span><span class="n">save_location_client_manager</span>
<a id="__codelineno-0-369" name="__codelineno-0-369"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-370" name="__codelineno-0-370"></a>        <span class="n">save_location_client_manager</span> <span class="o">=</span> <span class="n">ClientManager</span><span class="p">(</span>
<a id="__codelineno-0-371" name="__codelineno-0-371"></a>            <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">,</span>
<a id="__codelineno-0-372" name="__codelineno-0-372"></a>            <span class="n">wcd_url</span><span class="o">=</span><span class="n">wcd_url</span><span class="p">,</span>
<a id="__codelineno-0-373" name="__codelineno-0-373"></a>            <span class="n">wcd_api_key</span><span class="o">=</span><span class="n">wcd_api_key</span><span class="p">,</span>
<a id="__codelineno-0-374" name="__codelineno-0-374"></a>        <span class="p">)</span>
<a id="__codelineno-0-375" name="__codelineno-0-375"></a>
<a id="__codelineno-0-376" name="__codelineno-0-376"></a>    <span class="k">return</span> <span class="k">await</span> <span class="n">tree_manager</span><span class="o">.</span><span class="n">check_tree_exists_weaviate</span><span class="p">(</span>
<a id="__codelineno-0-377" name="__codelineno-0-377"></a>        <span class="n">conversation_id</span><span class="p">,</span> <span class="n">save_location_client_manager</span>
<a id="__codelineno-0-378" name="__codelineno-0-378"></a>    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="elysia.api.services.user.UserManager.check_user_timeout" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">check_user_timeout</span><span class="p">(</span><span class="n">user_id</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Check if a user has been idle for the last user_timeout.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>user_id</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The user ID which contains the user.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True if the user has been idle for the last user_timeout, False otherwise.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>elysia/api/services/user.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-222">222</a></span>
<span class="normal"><a href="#__codelineno-0-223">223</a></span>
<span class="normal"><a href="#__codelineno-0-224">224</a></span>
<span class="normal"><a href="#__codelineno-0-225">225</a></span>
<span class="normal"><a href="#__codelineno-0-226">226</a></span>
<span class="normal"><a href="#__codelineno-0-227">227</a></span>
<span class="normal"><a href="#__codelineno-0-228">228</a></span>
<span class="normal"><a href="#__codelineno-0-229">229</a></span>
<span class="normal"><a href="#__codelineno-0-230">230</a></span>
<span class="normal"><a href="#__codelineno-0-231">231</a></span>
<span class="normal"><a href="#__codelineno-0-232">232</a></span>
<span class="normal"><a href="#__codelineno-0-233">233</a></span>
<span class="normal"><a href="#__codelineno-0-234">234</a></span>
<span class="normal"><a href="#__codelineno-0-235">235</a></span>
<span class="normal"><a href="#__codelineno-0-236">236</a></span>
<span class="normal"><a href="#__codelineno-0-237">237</a></span>
<span class="normal"><a href="#__codelineno-0-238">238</a></span>
<span class="normal"><a href="#__codelineno-0-239">239</a></span>
<span class="normal"><a href="#__codelineno-0-240">240</a></span>
<span class="normal"><a href="#__codelineno-0-241">241</a></span>
<span class="normal"><a href="#__codelineno-0-242">242</a></span>
<span class="normal"><a href="#__codelineno-0-243">243</a></span>
<span class="normal"><a href="#__codelineno-0-244">244</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-222" name="__codelineno-0-222"></a><span class="k">def</span><span class="w"> </span><span class="nf">check_user_timeout</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-0-223" name="__codelineno-0-223"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-224" name="__codelineno-0-224"></a><span class="sd">    Check if a user has been idle for the last user_timeout.</span>
<a id="__codelineno-0-225" name="__codelineno-0-225"></a>
<a id="__codelineno-0-226" name="__codelineno-0-226"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-227" name="__codelineno-0-227"></a><span class="sd">        user_id (str): The user ID which contains the user.</span>
<a id="__codelineno-0-228" name="__codelineno-0-228"></a>
<a id="__codelineno-0-229" name="__codelineno-0-229"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-230" name="__codelineno-0-230"></a><span class="sd">        (bool): True if the user has been idle for the last user_timeout, False otherwise.</span>
<a id="__codelineno-0-231" name="__codelineno-0-231"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-232" name="__codelineno-0-232"></a>    <span class="c1"># if user not found, return True</span>
<a id="__codelineno-0-233" name="__codelineno-0-233"></a>    <span class="k">if</span> <span class="n">user_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">users</span><span class="p">:</span>
<a id="__codelineno-0-234" name="__codelineno-0-234"></a>        <span class="k">return</span> <span class="kc">True</span>
<a id="__codelineno-0-235" name="__codelineno-0-235"></a>
<a id="__codelineno-0-236" name="__codelineno-0-236"></a>    <span class="c1"># Remove any trees that have not been active in the last user_timeout</span>
<a id="__codelineno-0-237" name="__codelineno-0-237"></a>    <span class="c1"># if (</span>
<a id="__codelineno-0-238" name="__codelineno-0-238"></a>    <span class="c1">#     &quot;last_request&quot; in self.users[user_id]</span>
<a id="__codelineno-0-239" name="__codelineno-0-239"></a>    <span class="c1">#     and datetime.datetime.now() - self.users[user_id][&quot;last_request&quot;]</span>
<a id="__codelineno-0-240" name="__codelineno-0-240"></a>    <span class="c1">#     &gt; self.user_timeout</span>
<a id="__codelineno-0-241" name="__codelineno-0-241"></a>    <span class="c1"># ):</span>
<a id="__codelineno-0-242" name="__codelineno-0-242"></a>    <span class="c1">#     return True</span>
<a id="__codelineno-0-243" name="__codelineno-0-243"></a>
<a id="__codelineno-0-244" name="__codelineno-0-244"></a>    <span class="k">return</span> <span class="kc">False</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="elysia.api.services.user.UserManager.close_all_clients" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">close_all_clients</span><span class="p">()</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Close all clients in all ClientManagers across all users.</p>


            <details class="quote">
              <summary>Source code in <code>elysia/api/services/user.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-270">270</a></span>
<span class="normal"><a href="#__codelineno-0-271">271</a></span>
<span class="normal"><a href="#__codelineno-0-272">272</a></span>
<span class="normal"><a href="#__codelineno-0-273">273</a></span>
<span class="normal"><a href="#__codelineno-0-274">274</a></span>
<span class="normal"><a href="#__codelineno-0-275">275</a></span>
<span class="normal"><a href="#__codelineno-0-276">276</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-270" name="__codelineno-0-270"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">close_all_clients</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-271" name="__codelineno-0-271"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-272" name="__codelineno-0-272"></a><span class="sd">    Close all clients in all ClientManagers across all users.</span>
<a id="__codelineno-0-273" name="__codelineno-0-273"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-274" name="__codelineno-0-274"></a>    <span class="k">for</span> <span class="n">user_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">users</span><span class="p">:</span>
<a id="__codelineno-0-275" name="__codelineno-0-275"></a>        <span class="k">if</span> <span class="s2">&quot;client_manager&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">users</span><span class="p">[</span><span class="n">user_id</span><span class="p">]:</span>
<a id="__codelineno-0-276" name="__codelineno-0-276"></a>            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">users</span><span class="p">[</span><span class="n">user_id</span><span class="p">][</span><span class="s2">&quot;client_manager&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">close_clients</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="elysia.api.services.user.UserManager.delete_tree" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">delete_tree</span><span class="p">(</span><span class="n">user_id</span><span class="p">,</span> <span class="n">conversation_id</span><span class="p">,</span> <span class="n">wcd_url</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">wcd_api_key</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Delete a saved tree from a Weaviate instance (set in the frontend config).
Also delete the tree from the local tree manager.
This is a wrapper for the TreeManager.delete_tree_weaviate() method and the TreeManager.delete_tree_local() method.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>user_id</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Required. The unique identifier for the user stored in the UserManager.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>conversation_id</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Required. The unique identifier for the conversation for the user.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>wcd_url</code>
            </td>
            <td>
                  <code><span title="str">str</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Required. The URL of the Weaviate Cloud Database instance used to save the tree.
Defaults to the value of the <code>wcd_url</code> setting in the frontend config.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>wcd_api_key</code>
            </td>
            <td>
                  <code><span title="str">str</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Required. The API key for the Weaviate Cloud Database instance used to save the tree.
Defaults to the value of the <code>wcd_api_key</code> setting in the frontend config.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>elysia/api/services/user.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-422">422</a></span>
<span class="normal"><a href="#__codelineno-0-423">423</a></span>
<span class="normal"><a href="#__codelineno-0-424">424</a></span>
<span class="normal"><a href="#__codelineno-0-425">425</a></span>
<span class="normal"><a href="#__codelineno-0-426">426</a></span>
<span class="normal"><a href="#__codelineno-0-427">427</a></span>
<span class="normal"><a href="#__codelineno-0-428">428</a></span>
<span class="normal"><a href="#__codelineno-0-429">429</a></span>
<span class="normal"><a href="#__codelineno-0-430">430</a></span>
<span class="normal"><a href="#__codelineno-0-431">431</a></span>
<span class="normal"><a href="#__codelineno-0-432">432</a></span>
<span class="normal"><a href="#__codelineno-0-433">433</a></span>
<span class="normal"><a href="#__codelineno-0-434">434</a></span>
<span class="normal"><a href="#__codelineno-0-435">435</a></span>
<span class="normal"><a href="#__codelineno-0-436">436</a></span>
<span class="normal"><a href="#__codelineno-0-437">437</a></span>
<span class="normal"><a href="#__codelineno-0-438">438</a></span>
<span class="normal"><a href="#__codelineno-0-439">439</a></span>
<span class="normal"><a href="#__codelineno-0-440">440</a></span>
<span class="normal"><a href="#__codelineno-0-441">441</a></span>
<span class="normal"><a href="#__codelineno-0-442">442</a></span>
<span class="normal"><a href="#__codelineno-0-443">443</a></span>
<span class="normal"><a href="#__codelineno-0-444">444</a></span>
<span class="normal"><a href="#__codelineno-0-445">445</a></span>
<span class="normal"><a href="#__codelineno-0-446">446</a></span>
<span class="normal"><a href="#__codelineno-0-447">447</a></span>
<span class="normal"><a href="#__codelineno-0-448">448</a></span>
<span class="normal"><a href="#__codelineno-0-449">449</a></span>
<span class="normal"><a href="#__codelineno-0-450">450</a></span>
<span class="normal"><a href="#__codelineno-0-451">451</a></span>
<span class="normal"><a href="#__codelineno-0-452">452</a></span>
<span class="normal"><a href="#__codelineno-0-453">453</a></span>
<span class="normal"><a href="#__codelineno-0-454">454</a></span>
<span class="normal"><a href="#__codelineno-0-455">455</a></span>
<span class="normal"><a href="#__codelineno-0-456">456</a></span>
<span class="normal"><a href="#__codelineno-0-457">457</a></span>
<span class="normal"><a href="#__codelineno-0-458">458</a></span>
<span class="normal"><a href="#__codelineno-0-459">459</a></span>
<span class="normal"><a href="#__codelineno-0-460">460</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-422" name="__codelineno-0-422"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">delete_tree</span><span class="p">(</span>
<a id="__codelineno-0-423" name="__codelineno-0-423"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-424" name="__codelineno-0-424"></a>    <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-425" name="__codelineno-0-425"></a>    <span class="n">conversation_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-426" name="__codelineno-0-426"></a>    <span class="n">wcd_url</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-427" name="__codelineno-0-427"></a>    <span class="n">wcd_api_key</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-428" name="__codelineno-0-428"></a><span class="p">):</span>
<a id="__codelineno-0-429" name="__codelineno-0-429"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-430" name="__codelineno-0-430"></a><span class="sd">    Delete a saved tree from a Weaviate instance (set in the frontend config).</span>
<a id="__codelineno-0-431" name="__codelineno-0-431"></a><span class="sd">    Also delete the tree from the local tree manager.</span>
<a id="__codelineno-0-432" name="__codelineno-0-432"></a><span class="sd">    This is a wrapper for the TreeManager.delete_tree_weaviate() method and the TreeManager.delete_tree_local() method.</span>
<a id="__codelineno-0-433" name="__codelineno-0-433"></a>
<a id="__codelineno-0-434" name="__codelineno-0-434"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-435" name="__codelineno-0-435"></a><span class="sd">        user_id (str): Required. The unique identifier for the user stored in the UserManager.</span>
<a id="__codelineno-0-436" name="__codelineno-0-436"></a><span class="sd">        conversation_id (str): Required. The unique identifier for the conversation for the user.</span>
<a id="__codelineno-0-437" name="__codelineno-0-437"></a><span class="sd">        wcd_url (str | None): Required. The URL of the Weaviate Cloud Database instance used to save the tree.</span>
<a id="__codelineno-0-438" name="__codelineno-0-438"></a><span class="sd">            Defaults to the value of the `wcd_url` setting in the frontend config.</span>
<a id="__codelineno-0-439" name="__codelineno-0-439"></a><span class="sd">        wcd_api_key (str | None): Required. The API key for the Weaviate Cloud Database instance used to save the tree.</span>
<a id="__codelineno-0-440" name="__codelineno-0-440"></a><span class="sd">            Defaults to the value of the `wcd_api_key` setting in the frontend config.</span>
<a id="__codelineno-0-441" name="__codelineno-0-441"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-442" name="__codelineno-0-442"></a>
<a id="__codelineno-0-443" name="__codelineno-0-443"></a>    <span class="n">local_user</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_user_local</span><span class="p">(</span><span class="n">user_id</span><span class="p">)</span>
<a id="__codelineno-0-444" name="__codelineno-0-444"></a>    <span class="n">tree_manager</span><span class="p">:</span> <span class="n">TreeManager</span> <span class="o">=</span> <span class="n">local_user</span><span class="p">[</span><span class="s2">&quot;tree_manager&quot;</span><span class="p">]</span>
<a id="__codelineno-0-445" name="__codelineno-0-445"></a>
<a id="__codelineno-0-446" name="__codelineno-0-446"></a>    <span class="k">if</span> <span class="n">wcd_url</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">wcd_api_key</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-447" name="__codelineno-0-447"></a>        <span class="n">save_location_client_manager</span> <span class="o">=</span> <span class="n">local_user</span><span class="p">[</span>
<a id="__codelineno-0-448" name="__codelineno-0-448"></a>            <span class="s2">&quot;frontend_config&quot;</span>
<a id="__codelineno-0-449" name="__codelineno-0-449"></a>        <span class="p">]</span><span class="o">.</span><span class="n">save_location_client_manager</span>
<a id="__codelineno-0-450" name="__codelineno-0-450"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-451" name="__codelineno-0-451"></a>        <span class="n">save_location_client_manager</span> <span class="o">=</span> <span class="n">ClientManager</span><span class="p">(</span>
<a id="__codelineno-0-452" name="__codelineno-0-452"></a>            <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">,</span>
<a id="__codelineno-0-453" name="__codelineno-0-453"></a>            <span class="n">wcd_url</span><span class="o">=</span><span class="n">wcd_url</span><span class="p">,</span>
<a id="__codelineno-0-454" name="__codelineno-0-454"></a>            <span class="n">wcd_api_key</span><span class="o">=</span><span class="n">wcd_api_key</span><span class="p">,</span>
<a id="__codelineno-0-455" name="__codelineno-0-455"></a>        <span class="p">)</span>
<a id="__codelineno-0-456" name="__codelineno-0-456"></a>
<a id="__codelineno-0-457" name="__codelineno-0-457"></a>    <span class="k">await</span> <span class="n">tree_manager</span><span class="o">.</span><span class="n">delete_tree_weaviate</span><span class="p">(</span>
<a id="__codelineno-0-458" name="__codelineno-0-458"></a>        <span class="n">conversation_id</span><span class="p">,</span> <span class="n">save_location_client_manager</span>
<a id="__codelineno-0-459" name="__codelineno-0-459"></a>    <span class="p">)</span>
<a id="__codelineno-0-460" name="__codelineno-0-460"></a>    <span class="n">tree_manager</span><span class="o">.</span><span class="n">delete_tree_local</span><span class="p">(</span><span class="n">conversation_id</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="elysia.api.services.user.UserManager.get_saved_trees" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_saved_trees</span><span class="p">(</span><span class="n">user_id</span><span class="p">,</span> <span class="n">wcd_url</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">wcd_api_key</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Get all saved trees from a Weaviate instance (set in the frontend config).</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>user_id</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Required. The unique identifier for the user stored in the UserManager.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>wcd_url</code>
            </td>
            <td>
                  <code><span title="str">str</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Required. The URL of the Weaviate Cloud Database instance used to save the tree.
Defaults to the value of the <code>wcd_url</code> setting in the frontend config.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>wcd_api_key</code>
            </td>
            <td>
                  <code><span title="str">str</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Required. The API key for the Weaviate Cloud Database instance used to save the tree.
Defaults to the value of the <code>wcd_api_key</code> setting in the frontend config.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A dictionary whose keys are the conversation IDs and whose values are dictionaries containing the title and last update time of the tree.
E.g.
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>{
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    &quot;12345678-XXX-YYYY-ZZZZ&quot;: {
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>        &quot;title&quot;: &quot;Query Request&quot;,
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>        &quot;last_update_time&quot;: &quot;2025-06-07T10:06:47.376000Z&quot;
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>    }
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>}
</code></pre></div></p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>elysia/api/services/user.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-462">462</a></span>
<span class="normal"><a href="#__codelineno-0-463">463</a></span>
<span class="normal"><a href="#__codelineno-0-464">464</a></span>
<span class="normal"><a href="#__codelineno-0-465">465</a></span>
<span class="normal"><a href="#__codelineno-0-466">466</a></span>
<span class="normal"><a href="#__codelineno-0-467">467</a></span>
<span class="normal"><a href="#__codelineno-0-468">468</a></span>
<span class="normal"><a href="#__codelineno-0-469">469</a></span>
<span class="normal"><a href="#__codelineno-0-470">470</a></span>
<span class="normal"><a href="#__codelineno-0-471">471</a></span>
<span class="normal"><a href="#__codelineno-0-472">472</a></span>
<span class="normal"><a href="#__codelineno-0-473">473</a></span>
<span class="normal"><a href="#__codelineno-0-474">474</a></span>
<span class="normal"><a href="#__codelineno-0-475">475</a></span>
<span class="normal"><a href="#__codelineno-0-476">476</a></span>
<span class="normal"><a href="#__codelineno-0-477">477</a></span>
<span class="normal"><a href="#__codelineno-0-478">478</a></span>
<span class="normal"><a href="#__codelineno-0-479">479</a></span>
<span class="normal"><a href="#__codelineno-0-480">480</a></span>
<span class="normal"><a href="#__codelineno-0-481">481</a></span>
<span class="normal"><a href="#__codelineno-0-482">482</a></span>
<span class="normal"><a href="#__codelineno-0-483">483</a></span>
<span class="normal"><a href="#__codelineno-0-484">484</a></span>
<span class="normal"><a href="#__codelineno-0-485">485</a></span>
<span class="normal"><a href="#__codelineno-0-486">486</a></span>
<span class="normal"><a href="#__codelineno-0-487">487</a></span>
<span class="normal"><a href="#__codelineno-0-488">488</a></span>
<span class="normal"><a href="#__codelineno-0-489">489</a></span>
<span class="normal"><a href="#__codelineno-0-490">490</a></span>
<span class="normal"><a href="#__codelineno-0-491">491</a></span>
<span class="normal"><a href="#__codelineno-0-492">492</a></span>
<span class="normal"><a href="#__codelineno-0-493">493</a></span>
<span class="normal"><a href="#__codelineno-0-494">494</a></span>
<span class="normal"><a href="#__codelineno-0-495">495</a></span>
<span class="normal"><a href="#__codelineno-0-496">496</a></span>
<span class="normal"><a href="#__codelineno-0-497">497</a></span>
<span class="normal"><a href="#__codelineno-0-498">498</a></span>
<span class="normal"><a href="#__codelineno-0-499">499</a></span>
<span class="normal"><a href="#__codelineno-0-500">500</a></span>
<span class="normal"><a href="#__codelineno-0-501">501</a></span>
<span class="normal"><a href="#__codelineno-0-502">502</a></span>
<span class="normal"><a href="#__codelineno-0-503">503</a></span>
<span class="normal"><a href="#__codelineno-0-504">504</a></span>
<span class="normal"><a href="#__codelineno-0-505">505</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-462" name="__codelineno-0-462"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">get_saved_trees</span><span class="p">(</span>
<a id="__codelineno-0-463" name="__codelineno-0-463"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-464" name="__codelineno-0-464"></a>    <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-465" name="__codelineno-0-465"></a>    <span class="n">wcd_url</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-466" name="__codelineno-0-466"></a>    <span class="n">wcd_api_key</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-467" name="__codelineno-0-467"></a><span class="p">):</span>
<a id="__codelineno-0-468" name="__codelineno-0-468"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-469" name="__codelineno-0-469"></a><span class="sd">    Get all saved trees from a Weaviate instance (set in the frontend config).</span>
<a id="__codelineno-0-470" name="__codelineno-0-470"></a>
<a id="__codelineno-0-471" name="__codelineno-0-471"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-472" name="__codelineno-0-472"></a><span class="sd">        user_id (str): Required. The unique identifier for the user stored in the UserManager.</span>
<a id="__codelineno-0-473" name="__codelineno-0-473"></a><span class="sd">        wcd_url (str | None): Required. The URL of the Weaviate Cloud Database instance used to save the tree.</span>
<a id="__codelineno-0-474" name="__codelineno-0-474"></a><span class="sd">            Defaults to the value of the `wcd_url` setting in the frontend config.</span>
<a id="__codelineno-0-475" name="__codelineno-0-475"></a><span class="sd">        wcd_api_key (str | None): Required. The API key for the Weaviate Cloud Database instance used to save the tree.</span>
<a id="__codelineno-0-476" name="__codelineno-0-476"></a><span class="sd">            Defaults to the value of the `wcd_api_key` setting in the frontend config.</span>
<a id="__codelineno-0-477" name="__codelineno-0-477"></a>
<a id="__codelineno-0-478" name="__codelineno-0-478"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-479" name="__codelineno-0-479"></a><span class="sd">        (dict): A dictionary whose keys are the conversation IDs and whose values are dictionaries containing the title and last update time of the tree.</span>
<a id="__codelineno-0-480" name="__codelineno-0-480"></a><span class="sd">            E.g.</span>
<a id="__codelineno-0-481" name="__codelineno-0-481"></a><span class="sd">            ```</span>
<a id="__codelineno-0-482" name="__codelineno-0-482"></a><span class="sd">            {</span>
<a id="__codelineno-0-483" name="__codelineno-0-483"></a><span class="sd">                &quot;12345678-XXX-YYYY-ZZZZ&quot;: {</span>
<a id="__codelineno-0-484" name="__codelineno-0-484"></a><span class="sd">                    &quot;title&quot;: &quot;Query Request&quot;,</span>
<a id="__codelineno-0-485" name="__codelineno-0-485"></a><span class="sd">                    &quot;last_update_time&quot;: &quot;2025-06-07T10:06:47.376000Z&quot;</span>
<a id="__codelineno-0-486" name="__codelineno-0-486"></a><span class="sd">                }</span>
<a id="__codelineno-0-487" name="__codelineno-0-487"></a><span class="sd">            }</span>
<a id="__codelineno-0-488" name="__codelineno-0-488"></a><span class="sd">            ```</span>
<a id="__codelineno-0-489" name="__codelineno-0-489"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-490" name="__codelineno-0-490"></a>    <span class="n">local_user</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_user_local</span><span class="p">(</span><span class="n">user_id</span><span class="p">)</span>
<a id="__codelineno-0-491" name="__codelineno-0-491"></a>
<a id="__codelineno-0-492" name="__codelineno-0-492"></a>    <span class="k">if</span> <span class="n">wcd_url</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">wcd_api_key</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-493" name="__codelineno-0-493"></a>        <span class="n">save_location_client_manager</span> <span class="o">=</span> <span class="n">local_user</span><span class="p">[</span>
<a id="__codelineno-0-494" name="__codelineno-0-494"></a>            <span class="s2">&quot;frontend_config&quot;</span>
<a id="__codelineno-0-495" name="__codelineno-0-495"></a>        <span class="p">]</span><span class="o">.</span><span class="n">save_location_client_manager</span>
<a id="__codelineno-0-496" name="__codelineno-0-496"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-497" name="__codelineno-0-497"></a>        <span class="n">save_location_client_manager</span> <span class="o">=</span> <span class="n">ClientManager</span><span class="p">(</span>
<a id="__codelineno-0-498" name="__codelineno-0-498"></a>            <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">,</span>
<a id="__codelineno-0-499" name="__codelineno-0-499"></a>            <span class="n">wcd_url</span><span class="o">=</span><span class="n">wcd_url</span><span class="p">,</span>
<a id="__codelineno-0-500" name="__codelineno-0-500"></a>            <span class="n">wcd_api_key</span><span class="o">=</span><span class="n">wcd_api_key</span><span class="p">,</span>
<a id="__codelineno-0-501" name="__codelineno-0-501"></a>        <span class="p">)</span>
<a id="__codelineno-0-502" name="__codelineno-0-502"></a>
<a id="__codelineno-0-503" name="__codelineno-0-503"></a>    <span class="k">return</span> <span class="k">await</span> <span class="n">get_saved_trees_weaviate</span><span class="p">(</span>
<a id="__codelineno-0-504" name="__codelineno-0-504"></a>        <span class="s2">&quot;ELYSIA_TREES__&quot;</span><span class="p">,</span> <span class="n">save_location_client_manager</span><span class="p">,</span> <span class="n">user_id</span>
<a id="__codelineno-0-505" name="__codelineno-0-505"></a>    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="elysia.api.services.user.UserManager.get_tree" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_tree</span><span class="p">(</span><span class="n">user_id</span><span class="p">,</span> <span class="n">conversation_id</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Get a tree for a user.
Will raise a ValueError if the user is not found, or the tree is not found.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>user_id</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Required. The unique identifier for the user.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>conversation_id</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Required. The unique identifier for the conversation.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="Tree (elysia.tree.tree.Tree)" href="../Tree/#elysia.tree.tree.Tree">Tree</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The tree.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>elysia/api/services/user.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-200">200</a></span>
<span class="normal"><a href="#__codelineno-0-201">201</a></span>
<span class="normal"><a href="#__codelineno-0-202">202</a></span>
<span class="normal"><a href="#__codelineno-0-203">203</a></span>
<span class="normal"><a href="#__codelineno-0-204">204</a></span>
<span class="normal"><a href="#__codelineno-0-205">205</a></span>
<span class="normal"><a href="#__codelineno-0-206">206</a></span>
<span class="normal"><a href="#__codelineno-0-207">207</a></span>
<span class="normal"><a href="#__codelineno-0-208">208</a></span>
<span class="normal"><a href="#__codelineno-0-209">209</a></span>
<span class="normal"><a href="#__codelineno-0-210">210</a></span>
<span class="normal"><a href="#__codelineno-0-211">211</a></span>
<span class="normal"><a href="#__codelineno-0-212">212</a></span>
<span class="normal"><a href="#__codelineno-0-213">213</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-200" name="__codelineno-0-200"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">get_tree</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">conversation_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-0-201" name="__codelineno-0-201"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-202" name="__codelineno-0-202"></a><span class="sd">    Get a tree for a user.</span>
<a id="__codelineno-0-203" name="__codelineno-0-203"></a><span class="sd">    Will raise a ValueError if the user is not found, or the tree is not found.</span>
<a id="__codelineno-0-204" name="__codelineno-0-204"></a>
<a id="__codelineno-0-205" name="__codelineno-0-205"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-206" name="__codelineno-0-206"></a><span class="sd">        user_id (str): Required. The unique identifier for the user.</span>
<a id="__codelineno-0-207" name="__codelineno-0-207"></a><span class="sd">        conversation_id (str): Required. The unique identifier for the conversation.</span>
<a id="__codelineno-0-208" name="__codelineno-0-208"></a>
<a id="__codelineno-0-209" name="__codelineno-0-209"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-210" name="__codelineno-0-210"></a><span class="sd">        (Tree): The tree.</span>
<a id="__codelineno-0-211" name="__codelineno-0-211"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-212" name="__codelineno-0-212"></a>    <span class="n">local_user</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_user_local</span><span class="p">(</span><span class="n">user_id</span><span class="p">)</span>
<a id="__codelineno-0-213" name="__codelineno-0-213"></a>    <span class="k">return</span> <span class="n">local_user</span><span class="p">[</span><span class="s2">&quot;tree_manager&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get_tree</span><span class="p">(</span><span class="n">conversation_id</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="elysia.api.services.user.UserManager.get_user_local" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_user_local</span><span class="p">(</span><span class="n">user_id</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Return a local user object.
Will raise a ValueError if the user is not found.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>user_id</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Required. The unique identifier for the user.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A local user object, containing a TreeManager ("tree_manager"),
Frontend Config ("frontend_config") and ClientManager ("client_manager").</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>elysia/api/services/user.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-177">177</a></span>
<span class="normal"><a href="#__codelineno-0-178">178</a></span>
<span class="normal"><a href="#__codelineno-0-179">179</a></span>
<span class="normal"><a href="#__codelineno-0-180">180</a></span>
<span class="normal"><a href="#__codelineno-0-181">181</a></span>
<span class="normal"><a href="#__codelineno-0-182">182</a></span>
<span class="normal"><a href="#__codelineno-0-183">183</a></span>
<span class="normal"><a href="#__codelineno-0-184">184</a></span>
<span class="normal"><a href="#__codelineno-0-185">185</a></span>
<span class="normal"><a href="#__codelineno-0-186">186</a></span>
<span class="normal"><a href="#__codelineno-0-187">187</a></span>
<span class="normal"><a href="#__codelineno-0-188">188</a></span>
<span class="normal"><a href="#__codelineno-0-189">189</a></span>
<span class="normal"><a href="#__codelineno-0-190">190</a></span>
<span class="normal"><a href="#__codelineno-0-191">191</a></span>
<span class="normal"><a href="#__codelineno-0-192">192</a></span>
<span class="normal"><a href="#__codelineno-0-193">193</a></span>
<span class="normal"><a href="#__codelineno-0-194">194</a></span>
<span class="normal"><a href="#__codelineno-0-195">195</a></span>
<span class="normal"><a href="#__codelineno-0-196">196</a></span>
<span class="normal"><a href="#__codelineno-0-197">197</a></span>
<span class="normal"><a href="#__codelineno-0-198">198</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-177" name="__codelineno-0-177"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">get_user_local</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-0-178" name="__codelineno-0-178"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-179" name="__codelineno-0-179"></a><span class="sd">    Return a local user object.</span>
<a id="__codelineno-0-180" name="__codelineno-0-180"></a><span class="sd">    Will raise a ValueError if the user is not found.</span>
<a id="__codelineno-0-181" name="__codelineno-0-181"></a>
<a id="__codelineno-0-182" name="__codelineno-0-182"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-183" name="__codelineno-0-183"></a><span class="sd">        user_id (str): Required. The unique identifier for the user.</span>
<a id="__codelineno-0-184" name="__codelineno-0-184"></a>
<a id="__codelineno-0-185" name="__codelineno-0-185"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-186" name="__codelineno-0-186"></a><span class="sd">        (dict): A local user object, containing a TreeManager (&quot;tree_manager&quot;),</span>
<a id="__codelineno-0-187" name="__codelineno-0-187"></a><span class="sd">            Frontend Config (&quot;frontend_config&quot;) and ClientManager (&quot;client_manager&quot;).</span>
<a id="__codelineno-0-188" name="__codelineno-0-188"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-189" name="__codelineno-0-189"></a>
<a id="__codelineno-0-190" name="__codelineno-0-190"></a>    <span class="k">if</span> <span class="n">user_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">users</span><span class="p">:</span>
<a id="__codelineno-0-191" name="__codelineno-0-191"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<a id="__codelineno-0-192" name="__codelineno-0-192"></a>            <span class="sa">f</span><span class="s2">&quot;User </span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2"> not found. Please initialise a user first (by calling `add_user_local`).&quot;</span>
<a id="__codelineno-0-193" name="__codelineno-0-193"></a>        <span class="p">)</span>
<a id="__codelineno-0-194" name="__codelineno-0-194"></a>
<a id="__codelineno-0-195" name="__codelineno-0-195"></a>    <span class="c1"># update last request (adds last_request to user)</span>
<a id="__codelineno-0-196" name="__codelineno-0-196"></a>    <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_user_last_request</span><span class="p">(</span><span class="n">user_id</span><span class="p">)</span>
<a id="__codelineno-0-197" name="__codelineno-0-197"></a>
<a id="__codelineno-0-198" name="__codelineno-0-198"></a>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">users</span><span class="p">[</span><span class="n">user_id</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="elysia.api.services.user.UserManager.initialise_tree" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">initialise_tree</span><span class="p">(</span><span class="n">user_id</span><span class="p">,</span> <span class="n">conversation_id</span><span class="p">,</span> <span class="n">low_memory</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Initialises a tree for a user for an existing user at user_id.
Requires a user to already exist in the UserManager, via <code>add_user_local</code>.
This is a wrapper for the TreeManager.add_tree() method.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>user_id</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Required. The unique identifier for the user.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>conversation_id</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Required. The unique identifier for a new conversation within the tree manager.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>low_memory</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional. Whether to use low memory mode for the tree.
Controls the LM history being saved in the tree, and some other variables.
Defaults to False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>elysia/api/services/user.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-278">278</a></span>
<span class="normal"><a href="#__codelineno-0-279">279</a></span>
<span class="normal"><a href="#__codelineno-0-280">280</a></span>
<span class="normal"><a href="#__codelineno-0-281">281</a></span>
<span class="normal"><a href="#__codelineno-0-282">282</a></span>
<span class="normal"><a href="#__codelineno-0-283">283</a></span>
<span class="normal"><a href="#__codelineno-0-284">284</a></span>
<span class="normal"><a href="#__codelineno-0-285">285</a></span>
<span class="normal"><a href="#__codelineno-0-286">286</a></span>
<span class="normal"><a href="#__codelineno-0-287">287</a></span>
<span class="normal"><a href="#__codelineno-0-288">288</a></span>
<span class="normal"><a href="#__codelineno-0-289">289</a></span>
<span class="normal"><a href="#__codelineno-0-290">290</a></span>
<span class="normal"><a href="#__codelineno-0-291">291</a></span>
<span class="normal"><a href="#__codelineno-0-292">292</a></span>
<span class="normal"><a href="#__codelineno-0-293">293</a></span>
<span class="normal"><a href="#__codelineno-0-294">294</a></span>
<span class="normal"><a href="#__codelineno-0-295">295</a></span>
<span class="normal"><a href="#__codelineno-0-296">296</a></span>
<span class="normal"><a href="#__codelineno-0-297">297</a></span>
<span class="normal"><a href="#__codelineno-0-298">298</a></span>
<span class="normal"><a href="#__codelineno-0-299">299</a></span>
<span class="normal"><a href="#__codelineno-0-300">300</a></span>
<span class="normal"><a href="#__codelineno-0-301">301</a></span>
<span class="normal"><a href="#__codelineno-0-302">302</a></span>
<span class="normal"><a href="#__codelineno-0-303">303</a></span>
<span class="normal"><a href="#__codelineno-0-304">304</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-278" name="__codelineno-0-278"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">initialise_tree</span><span class="p">(</span>
<a id="__codelineno-0-279" name="__codelineno-0-279"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-280" name="__codelineno-0-280"></a>    <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-281" name="__codelineno-0-281"></a>    <span class="n">conversation_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-282" name="__codelineno-0-282"></a>    <span class="n">low_memory</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-283" name="__codelineno-0-283"></a><span class="p">):</span>
<a id="__codelineno-0-284" name="__codelineno-0-284"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-285" name="__codelineno-0-285"></a><span class="sd">    Initialises a tree for a user for an existing user at user_id.</span>
<a id="__codelineno-0-286" name="__codelineno-0-286"></a><span class="sd">    Requires a user to already exist in the UserManager, via `add_user_local`.</span>
<a id="__codelineno-0-287" name="__codelineno-0-287"></a><span class="sd">    This is a wrapper for the TreeManager.add_tree() method.</span>
<a id="__codelineno-0-288" name="__codelineno-0-288"></a>
<a id="__codelineno-0-289" name="__codelineno-0-289"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-290" name="__codelineno-0-290"></a><span class="sd">        user_id (str): Required. The unique identifier for the user.</span>
<a id="__codelineno-0-291" name="__codelineno-0-291"></a><span class="sd">        conversation_id (str): Required. The unique identifier for a new conversation within the tree manager.</span>
<a id="__codelineno-0-292" name="__codelineno-0-292"></a><span class="sd">        low_memory (bool): Optional. Whether to use low memory mode for the tree.</span>
<a id="__codelineno-0-293" name="__codelineno-0-293"></a><span class="sd">            Controls the LM history being saved in the tree, and some other variables.</span>
<a id="__codelineno-0-294" name="__codelineno-0-294"></a><span class="sd">            Defaults to False.</span>
<a id="__codelineno-0-295" name="__codelineno-0-295"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-296" name="__codelineno-0-296"></a>    <span class="c1"># self.add_user_local(user_id)</span>
<a id="__codelineno-0-297" name="__codelineno-0-297"></a>    <span class="n">local_user</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_user_local</span><span class="p">(</span><span class="n">user_id</span><span class="p">)</span>
<a id="__codelineno-0-298" name="__codelineno-0-298"></a>    <span class="n">tree_manager</span><span class="p">:</span> <span class="n">TreeManager</span> <span class="o">=</span> <span class="n">local_user</span><span class="p">[</span><span class="s2">&quot;tree_manager&quot;</span><span class="p">]</span>
<a id="__codelineno-0-299" name="__codelineno-0-299"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">tree_manager</span><span class="o">.</span><span class="n">tree_exists</span><span class="p">(</span><span class="n">conversation_id</span><span class="p">):</span>
<a id="__codelineno-0-300" name="__codelineno-0-300"></a>        <span class="n">tree_manager</span><span class="o">.</span><span class="n">add_tree</span><span class="p">(</span>
<a id="__codelineno-0-301" name="__codelineno-0-301"></a>            <span class="n">conversation_id</span><span class="p">,</span>
<a id="__codelineno-0-302" name="__codelineno-0-302"></a>            <span class="n">low_memory</span><span class="p">,</span>
<a id="__codelineno-0-303" name="__codelineno-0-303"></a>        <span class="p">)</span>
<a id="__codelineno-0-304" name="__codelineno-0-304"></a>    <span class="k">return</span> <span class="n">tree_manager</span><span class="o">.</span><span class="n">get_tree</span><span class="p">(</span><span class="n">conversation_id</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="elysia.api.services.user.UserManager.load_tree" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">load_tree</span><span class="p">(</span><span class="n">user_id</span><span class="p">,</span> <span class="n">conversation_id</span><span class="p">,</span> <span class="n">wcd_url</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">wcd_api_key</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Load a tree from a Weaviate instance (set in the frontend config).
This is a wrapper for the TreeManager.load_tree_weaviate() method.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>user_id</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Required. The unique identifier for the user stored in the UserManager.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>conversation_id</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Required. The unique identifier for the conversation for the user.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>wcd_url</code>
            </td>
            <td>
                  <code><span title="str">str</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Required. The URL of the Weaviate Cloud Database instance used to save the tree.
Defaults to the value of the <code>wcd_url</code> setting in the frontend config.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>wcd_api_key</code>
            </td>
            <td>
                  <code><span title="str">str</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Required. The API key for the Weaviate Cloud Database instance used to save the tree.
Defaults to the value of the <code>wcd_api_key</code> setting in the frontend config.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="list">list</span>[<span title="dict">dict</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A list of dictionaries, each containing a frontend payload that was used to generate the tree.
The list is ordered by the time the payload was originally sent to the frontend (at the time it was saved).</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>elysia/api/services/user.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-380">380</a></span>
<span class="normal"><a href="#__codelineno-0-381">381</a></span>
<span class="normal"><a href="#__codelineno-0-382">382</a></span>
<span class="normal"><a href="#__codelineno-0-383">383</a></span>
<span class="normal"><a href="#__codelineno-0-384">384</a></span>
<span class="normal"><a href="#__codelineno-0-385">385</a></span>
<span class="normal"><a href="#__codelineno-0-386">386</a></span>
<span class="normal"><a href="#__codelineno-0-387">387</a></span>
<span class="normal"><a href="#__codelineno-0-388">388</a></span>
<span class="normal"><a href="#__codelineno-0-389">389</a></span>
<span class="normal"><a href="#__codelineno-0-390">390</a></span>
<span class="normal"><a href="#__codelineno-0-391">391</a></span>
<span class="normal"><a href="#__codelineno-0-392">392</a></span>
<span class="normal"><a href="#__codelineno-0-393">393</a></span>
<span class="normal"><a href="#__codelineno-0-394">394</a></span>
<span class="normal"><a href="#__codelineno-0-395">395</a></span>
<span class="normal"><a href="#__codelineno-0-396">396</a></span>
<span class="normal"><a href="#__codelineno-0-397">397</a></span>
<span class="normal"><a href="#__codelineno-0-398">398</a></span>
<span class="normal"><a href="#__codelineno-0-399">399</a></span>
<span class="normal"><a href="#__codelineno-0-400">400</a></span>
<span class="normal"><a href="#__codelineno-0-401">401</a></span>
<span class="normal"><a href="#__codelineno-0-402">402</a></span>
<span class="normal"><a href="#__codelineno-0-403">403</a></span>
<span class="normal"><a href="#__codelineno-0-404">404</a></span>
<span class="normal"><a href="#__codelineno-0-405">405</a></span>
<span class="normal"><a href="#__codelineno-0-406">406</a></span>
<span class="normal"><a href="#__codelineno-0-407">407</a></span>
<span class="normal"><a href="#__codelineno-0-408">408</a></span>
<span class="normal"><a href="#__codelineno-0-409">409</a></span>
<span class="normal"><a href="#__codelineno-0-410">410</a></span>
<span class="normal"><a href="#__codelineno-0-411">411</a></span>
<span class="normal"><a href="#__codelineno-0-412">412</a></span>
<span class="normal"><a href="#__codelineno-0-413">413</a></span>
<span class="normal"><a href="#__codelineno-0-414">414</a></span>
<span class="normal"><a href="#__codelineno-0-415">415</a></span>
<span class="normal"><a href="#__codelineno-0-416">416</a></span>
<span class="normal"><a href="#__codelineno-0-417">417</a></span>
<span class="normal"><a href="#__codelineno-0-418">418</a></span>
<span class="normal"><a href="#__codelineno-0-419">419</a></span>
<span class="normal"><a href="#__codelineno-0-420">420</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-380" name="__codelineno-0-380"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">load_tree</span><span class="p">(</span>
<a id="__codelineno-0-381" name="__codelineno-0-381"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-382" name="__codelineno-0-382"></a>    <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-383" name="__codelineno-0-383"></a>    <span class="n">conversation_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-384" name="__codelineno-0-384"></a>    <span class="n">wcd_url</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-385" name="__codelineno-0-385"></a>    <span class="n">wcd_api_key</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-386" name="__codelineno-0-386"></a><span class="p">):</span>
<a id="__codelineno-0-387" name="__codelineno-0-387"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-388" name="__codelineno-0-388"></a><span class="sd">    Load a tree from a Weaviate instance (set in the frontend config).</span>
<a id="__codelineno-0-389" name="__codelineno-0-389"></a><span class="sd">    This is a wrapper for the TreeManager.load_tree_weaviate() method.</span>
<a id="__codelineno-0-390" name="__codelineno-0-390"></a>
<a id="__codelineno-0-391" name="__codelineno-0-391"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-392" name="__codelineno-0-392"></a><span class="sd">        user_id (str): Required. The unique identifier for the user stored in the UserManager.</span>
<a id="__codelineno-0-393" name="__codelineno-0-393"></a><span class="sd">        conversation_id (str): Required. The unique identifier for the conversation for the user.</span>
<a id="__codelineno-0-394" name="__codelineno-0-394"></a><span class="sd">        wcd_url (str | None): Required. The URL of the Weaviate Cloud Database instance used to save the tree.</span>
<a id="__codelineno-0-395" name="__codelineno-0-395"></a><span class="sd">            Defaults to the value of the `wcd_url` setting in the frontend config.</span>
<a id="__codelineno-0-396" name="__codelineno-0-396"></a><span class="sd">        wcd_api_key (str | None): Required. The API key for the Weaviate Cloud Database instance used to save the tree.</span>
<a id="__codelineno-0-397" name="__codelineno-0-397"></a><span class="sd">            Defaults to the value of the `wcd_api_key` setting in the frontend config.</span>
<a id="__codelineno-0-398" name="__codelineno-0-398"></a>
<a id="__codelineno-0-399" name="__codelineno-0-399"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-400" name="__codelineno-0-400"></a><span class="sd">        (list[dict]): A list of dictionaries, each containing a frontend payload that was used to generate the tree.</span>
<a id="__codelineno-0-401" name="__codelineno-0-401"></a><span class="sd">            The list is ordered by the time the payload was originally sent to the frontend (at the time it was saved).</span>
<a id="__codelineno-0-402" name="__codelineno-0-402"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-403" name="__codelineno-0-403"></a>
<a id="__codelineno-0-404" name="__codelineno-0-404"></a>    <span class="n">local_user</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_user_local</span><span class="p">(</span><span class="n">user_id</span><span class="p">)</span>
<a id="__codelineno-0-405" name="__codelineno-0-405"></a>    <span class="n">tree_manager</span><span class="p">:</span> <span class="n">TreeManager</span> <span class="o">=</span> <span class="n">local_user</span><span class="p">[</span><span class="s2">&quot;tree_manager&quot;</span><span class="p">]</span>
<a id="__codelineno-0-406" name="__codelineno-0-406"></a>
<a id="__codelineno-0-407" name="__codelineno-0-407"></a>    <span class="k">if</span> <span class="n">wcd_url</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">wcd_api_key</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-408" name="__codelineno-0-408"></a>        <span class="n">save_location_client_manager</span> <span class="o">=</span> <span class="n">local_user</span><span class="p">[</span>
<a id="__codelineno-0-409" name="__codelineno-0-409"></a>            <span class="s2">&quot;frontend_config&quot;</span>
<a id="__codelineno-0-410" name="__codelineno-0-410"></a>        <span class="p">]</span><span class="o">.</span><span class="n">save_location_client_manager</span>
<a id="__codelineno-0-411" name="__codelineno-0-411"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-412" name="__codelineno-0-412"></a>        <span class="n">save_location_client_manager</span> <span class="o">=</span> <span class="n">ClientManager</span><span class="p">(</span>
<a id="__codelineno-0-413" name="__codelineno-0-413"></a>            <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">,</span>
<a id="__codelineno-0-414" name="__codelineno-0-414"></a>            <span class="n">wcd_url</span><span class="o">=</span><span class="n">wcd_url</span><span class="p">,</span>
<a id="__codelineno-0-415" name="__codelineno-0-415"></a>            <span class="n">wcd_api_key</span><span class="o">=</span><span class="n">wcd_api_key</span><span class="p">,</span>
<a id="__codelineno-0-416" name="__codelineno-0-416"></a>        <span class="p">)</span>
<a id="__codelineno-0-417" name="__codelineno-0-417"></a>
<a id="__codelineno-0-418" name="__codelineno-0-418"></a>    <span class="k">return</span> <span class="k">await</span> <span class="n">tree_manager</span><span class="o">.</span><span class="n">load_tree_weaviate</span><span class="p">(</span>
<a id="__codelineno-0-419" name="__codelineno-0-419"></a>        <span class="n">conversation_id</span><span class="p">,</span> <span class="n">save_location_client_manager</span>
<a id="__codelineno-0-420" name="__codelineno-0-420"></a>    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="elysia.api.services.user.UserManager.process_tree" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">process_tree</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">user_id</span><span class="p">,</span> <span class="n">conversation_id</span><span class="p">,</span> <span class="n">query_id</span><span class="p">,</span> <span class="n">training_route</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">collection_names</span><span class="o">=</span><span class="p">[],</span> <span class="n">save_trees_to_weaviate</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">wcd_url</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">wcd_api_key</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Wrapper for the TreeManager.process_tree() method.
Which itself is a wrapper for the Tree.async_run() method.
This is an async generator which yields results from the tree.async_run() method.
Automatically sends error payloads if the user or tree has been timed out.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>query</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Required. The user input/prompt to process in the decision tree.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>user_id</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Required. The unique identifier for the user.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>conversation_id</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Required. The conversation ID which contains the tree.
This should be the same conversation ID as the one used to initialise the tree (see <code>initialise_tree</code>).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>query_id</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Required. A unique identifier for the query.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>training_route</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional. The training route, a string of the form "tool1/tool2/tool1" etc.
See the <code>tree.async_run()</code> method for more details.</p>
              </div>
            </td>
            <td>
                  <code>&#39;&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>collection_names</code>
            </td>
            <td>
                  <code><span title="list">list</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional. A list of collection names to use in the query.
If not supplied, all collections will be used.</p>
              </div>
            </td>
            <td>
                  <code>[]</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>save_trees_to_weaviate</code>
            </td>
            <td>
                  <code><span title="bool">bool</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional. Whether to save the trees to a Weaviate instance,
after the process_tree() method has finished.
Defaults to the value of the <code>save_trees_to_weaviate</code> setting in the frontend config.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>wcd_url</code>
            </td>
            <td>
                  <code><span title="str">str</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Required. The URL of the Weaviate Cloud Database instance used to save the tree.
Defaults to the value of the <code>wcd_url</code> setting in the frontend config.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>wcd_api_key</code>
            </td>
            <td>
                  <code><span title="str">str</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Required. The API key for the Weaviate Cloud Database instance used to save the tree.
Defaults to the value of the <code>wcd_api_key</code> setting in the frontend config.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>elysia/api/services/user.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-517">517</a></span>
<span class="normal"><a href="#__codelineno-0-518">518</a></span>
<span class="normal"><a href="#__codelineno-0-519">519</a></span>
<span class="normal"><a href="#__codelineno-0-520">520</a></span>
<span class="normal"><a href="#__codelineno-0-521">521</a></span>
<span class="normal"><a href="#__codelineno-0-522">522</a></span>
<span class="normal"><a href="#__codelineno-0-523">523</a></span>
<span class="normal"><a href="#__codelineno-0-524">524</a></span>
<span class="normal"><a href="#__codelineno-0-525">525</a></span>
<span class="normal"><a href="#__codelineno-0-526">526</a></span>
<span class="normal"><a href="#__codelineno-0-527">527</a></span>
<span class="normal"><a href="#__codelineno-0-528">528</a></span>
<span class="normal"><a href="#__codelineno-0-529">529</a></span>
<span class="normal"><a href="#__codelineno-0-530">530</a></span>
<span class="normal"><a href="#__codelineno-0-531">531</a></span>
<span class="normal"><a href="#__codelineno-0-532">532</a></span>
<span class="normal"><a href="#__codelineno-0-533">533</a></span>
<span class="normal"><a href="#__codelineno-0-534">534</a></span>
<span class="normal"><a href="#__codelineno-0-535">535</a></span>
<span class="normal"><a href="#__codelineno-0-536">536</a></span>
<span class="normal"><a href="#__codelineno-0-537">537</a></span>
<span class="normal"><a href="#__codelineno-0-538">538</a></span>
<span class="normal"><a href="#__codelineno-0-539">539</a></span>
<span class="normal"><a href="#__codelineno-0-540">540</a></span>
<span class="normal"><a href="#__codelineno-0-541">541</a></span>
<span class="normal"><a href="#__codelineno-0-542">542</a></span>
<span class="normal"><a href="#__codelineno-0-543">543</a></span>
<span class="normal"><a href="#__codelineno-0-544">544</a></span>
<span class="normal"><a href="#__codelineno-0-545">545</a></span>
<span class="normal"><a href="#__codelineno-0-546">546</a></span>
<span class="normal"><a href="#__codelineno-0-547">547</a></span>
<span class="normal"><a href="#__codelineno-0-548">548</a></span>
<span class="normal"><a href="#__codelineno-0-549">549</a></span>
<span class="normal"><a href="#__codelineno-0-550">550</a></span>
<span class="normal"><a href="#__codelineno-0-551">551</a></span>
<span class="normal"><a href="#__codelineno-0-552">552</a></span>
<span class="normal"><a href="#__codelineno-0-553">553</a></span>
<span class="normal"><a href="#__codelineno-0-554">554</a></span>
<span class="normal"><a href="#__codelineno-0-555">555</a></span>
<span class="normal"><a href="#__codelineno-0-556">556</a></span>
<span class="normal"><a href="#__codelineno-0-557">557</a></span>
<span class="normal"><a href="#__codelineno-0-558">558</a></span>
<span class="normal"><a href="#__codelineno-0-559">559</a></span>
<span class="normal"><a href="#__codelineno-0-560">560</a></span>
<span class="normal"><a href="#__codelineno-0-561">561</a></span>
<span class="normal"><a href="#__codelineno-0-562">562</a></span>
<span class="normal"><a href="#__codelineno-0-563">563</a></span>
<span class="normal"><a href="#__codelineno-0-564">564</a></span>
<span class="normal"><a href="#__codelineno-0-565">565</a></span>
<span class="normal"><a href="#__codelineno-0-566">566</a></span>
<span class="normal"><a href="#__codelineno-0-567">567</a></span>
<span class="normal"><a href="#__codelineno-0-568">568</a></span>
<span class="normal"><a href="#__codelineno-0-569">569</a></span>
<span class="normal"><a href="#__codelineno-0-570">570</a></span>
<span class="normal"><a href="#__codelineno-0-571">571</a></span>
<span class="normal"><a href="#__codelineno-0-572">572</a></span>
<span class="normal"><a href="#__codelineno-0-573">573</a></span>
<span class="normal"><a href="#__codelineno-0-574">574</a></span>
<span class="normal"><a href="#__codelineno-0-575">575</a></span>
<span class="normal"><a href="#__codelineno-0-576">576</a></span>
<span class="normal"><a href="#__codelineno-0-577">577</a></span>
<span class="normal"><a href="#__codelineno-0-578">578</a></span>
<span class="normal"><a href="#__codelineno-0-579">579</a></span>
<span class="normal"><a href="#__codelineno-0-580">580</a></span>
<span class="normal"><a href="#__codelineno-0-581">581</a></span>
<span class="normal"><a href="#__codelineno-0-582">582</a></span>
<span class="normal"><a href="#__codelineno-0-583">583</a></span>
<span class="normal"><a href="#__codelineno-0-584">584</a></span>
<span class="normal"><a href="#__codelineno-0-585">585</a></span>
<span class="normal"><a href="#__codelineno-0-586">586</a></span>
<span class="normal"><a href="#__codelineno-0-587">587</a></span>
<span class="normal"><a href="#__codelineno-0-588">588</a></span>
<span class="normal"><a href="#__codelineno-0-589">589</a></span>
<span class="normal"><a href="#__codelineno-0-590">590</a></span>
<span class="normal"><a href="#__codelineno-0-591">591</a></span>
<span class="normal"><a href="#__codelineno-0-592">592</a></span>
<span class="normal"><a href="#__codelineno-0-593">593</a></span>
<span class="normal"><a href="#__codelineno-0-594">594</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-517" name="__codelineno-0-517"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">process_tree</span><span class="p">(</span>
<a id="__codelineno-0-518" name="__codelineno-0-518"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-519" name="__codelineno-0-519"></a>    <span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-520" name="__codelineno-0-520"></a>    <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-521" name="__codelineno-0-521"></a>    <span class="n">conversation_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-522" name="__codelineno-0-522"></a>    <span class="n">query_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-523" name="__codelineno-0-523"></a>    <span class="n">training_route</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
<a id="__codelineno-0-524" name="__codelineno-0-524"></a>    <span class="n">collection_names</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[],</span>
<a id="__codelineno-0-525" name="__codelineno-0-525"></a>    <span class="n">save_trees_to_weaviate</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-526" name="__codelineno-0-526"></a>    <span class="n">wcd_url</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-527" name="__codelineno-0-527"></a>    <span class="n">wcd_api_key</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-528" name="__codelineno-0-528"></a><span class="p">):</span>
<a id="__codelineno-0-529" name="__codelineno-0-529"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-530" name="__codelineno-0-530"></a><span class="sd">    Wrapper for the TreeManager.process_tree() method.</span>
<a id="__codelineno-0-531" name="__codelineno-0-531"></a><span class="sd">    Which itself is a wrapper for the Tree.async_run() method.</span>
<a id="__codelineno-0-532" name="__codelineno-0-532"></a><span class="sd">    This is an async generator which yields results from the tree.async_run() method.</span>
<a id="__codelineno-0-533" name="__codelineno-0-533"></a><span class="sd">    Automatically sends error payloads if the user or tree has been timed out.</span>
<a id="__codelineno-0-534" name="__codelineno-0-534"></a>
<a id="__codelineno-0-535" name="__codelineno-0-535"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-536" name="__codelineno-0-536"></a><span class="sd">        query (str): Required. The user input/prompt to process in the decision tree.</span>
<a id="__codelineno-0-537" name="__codelineno-0-537"></a><span class="sd">        user_id (str): Required. The unique identifier for the user.</span>
<a id="__codelineno-0-538" name="__codelineno-0-538"></a><span class="sd">        conversation_id (str): Required. The conversation ID which contains the tree.</span>
<a id="__codelineno-0-539" name="__codelineno-0-539"></a><span class="sd">            This should be the same conversation ID as the one used to initialise the tree (see `initialise_tree`).</span>
<a id="__codelineno-0-540" name="__codelineno-0-540"></a><span class="sd">        query_id (str): Required. A unique identifier for the query.</span>
<a id="__codelineno-0-541" name="__codelineno-0-541"></a><span class="sd">        training_route (str): Optional. The training route, a string of the form &quot;tool1/tool2/tool1&quot; etc.</span>
<a id="__codelineno-0-542" name="__codelineno-0-542"></a><span class="sd">            See the `tree.async_run()` method for more details.</span>
<a id="__codelineno-0-543" name="__codelineno-0-543"></a><span class="sd">        collection_names (list[str]): Optional. A list of collection names to use in the query.</span>
<a id="__codelineno-0-544" name="__codelineno-0-544"></a><span class="sd">            If not supplied, all collections will be used.</span>
<a id="__codelineno-0-545" name="__codelineno-0-545"></a><span class="sd">        save_trees_to_weaviate (bool | None): Optional. Whether to save the trees to a Weaviate instance,</span>
<a id="__codelineno-0-546" name="__codelineno-0-546"></a><span class="sd">            after the process_tree() method has finished.</span>
<a id="__codelineno-0-547" name="__codelineno-0-547"></a><span class="sd">            Defaults to the value of the `save_trees_to_weaviate` setting in the frontend config.</span>
<a id="__codelineno-0-548" name="__codelineno-0-548"></a><span class="sd">        wcd_url (str | None): Required. The URL of the Weaviate Cloud Database instance used to save the tree.</span>
<a id="__codelineno-0-549" name="__codelineno-0-549"></a><span class="sd">            Defaults to the value of the `wcd_url` setting in the frontend config.</span>
<a id="__codelineno-0-550" name="__codelineno-0-550"></a><span class="sd">        wcd_api_key (str | None): Required. The API key for the Weaviate Cloud Database instance used to save the tree.</span>
<a id="__codelineno-0-551" name="__codelineno-0-551"></a><span class="sd">            Defaults to the value of the `wcd_api_key` setting in the frontend config.</span>
<a id="__codelineno-0-552" name="__codelineno-0-552"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-553" name="__codelineno-0-553"></a>
<a id="__codelineno-0-554" name="__codelineno-0-554"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_user_timeout</span><span class="p">(</span><span class="n">user_id</span><span class="p">):</span>
<a id="__codelineno-0-555" name="__codelineno-0-555"></a>        <span class="n">user_timeout_error</span> <span class="o">=</span> <span class="n">UserTimeoutError</span><span class="p">()</span>
<a id="__codelineno-0-556" name="__codelineno-0-556"></a>        <span class="n">error_payload</span> <span class="o">=</span> <span class="k">await</span> <span class="n">user_timeout_error</span><span class="o">.</span><span class="n">to_frontend</span><span class="p">(</span>
<a id="__codelineno-0-557" name="__codelineno-0-557"></a>            <span class="n">user_id</span><span class="p">,</span> <span class="n">conversation_id</span><span class="p">,</span> <span class="n">query_id</span>
<a id="__codelineno-0-558" name="__codelineno-0-558"></a>        <span class="p">)</span>
<a id="__codelineno-0-559" name="__codelineno-0-559"></a>        <span class="k">yield</span> <span class="n">error_payload</span>
<a id="__codelineno-0-560" name="__codelineno-0-560"></a>        <span class="k">return</span>
<a id="__codelineno-0-561" name="__codelineno-0-561"></a>
<a id="__codelineno-0-562" name="__codelineno-0-562"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_tree_timeout</span><span class="p">(</span><span class="n">user_id</span><span class="p">,</span> <span class="n">conversation_id</span><span class="p">):</span>
<a id="__codelineno-0-563" name="__codelineno-0-563"></a>        <span class="k">if</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_tree_exists_weaviate</span><span class="p">(</span><span class="n">user_id</span><span class="p">,</span> <span class="n">conversation_id</span><span class="p">):</span>
<a id="__codelineno-0-564" name="__codelineno-0-564"></a>            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_tree</span><span class="p">(</span><span class="n">user_id</span><span class="p">,</span> <span class="n">conversation_id</span><span class="p">)</span>
<a id="__codelineno-0-565" name="__codelineno-0-565"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-566" name="__codelineno-0-566"></a>            <span class="n">tree_timeout_error</span> <span class="o">=</span> <span class="n">TreeTimeoutError</span><span class="p">()</span>
<a id="__codelineno-0-567" name="__codelineno-0-567"></a>            <span class="n">error_payload</span> <span class="o">=</span> <span class="k">await</span> <span class="n">tree_timeout_error</span><span class="o">.</span><span class="n">to_frontend</span><span class="p">(</span>
<a id="__codelineno-0-568" name="__codelineno-0-568"></a>                <span class="n">user_id</span><span class="p">,</span> <span class="n">conversation_id</span><span class="p">,</span> <span class="n">query_id</span>
<a id="__codelineno-0-569" name="__codelineno-0-569"></a>            <span class="p">)</span>
<a id="__codelineno-0-570" name="__codelineno-0-570"></a>            <span class="k">yield</span> <span class="n">error_payload</span>
<a id="__codelineno-0-571" name="__codelineno-0-571"></a>            <span class="k">return</span>
<a id="__codelineno-0-572" name="__codelineno-0-572"></a>
<a id="__codelineno-0-573" name="__codelineno-0-573"></a>    <span class="n">local_user</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_user_local</span><span class="p">(</span><span class="n">user_id</span><span class="p">)</span>
<a id="__codelineno-0-574" name="__codelineno-0-574"></a>    <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_user_last_request</span><span class="p">(</span><span class="n">user_id</span><span class="p">)</span>
<a id="__codelineno-0-575" name="__codelineno-0-575"></a>
<a id="__codelineno-0-576" name="__codelineno-0-576"></a>    <span class="n">tree_manager</span><span class="p">:</span> <span class="n">TreeManager</span> <span class="o">=</span> <span class="n">local_user</span><span class="p">[</span><span class="s2">&quot;tree_manager&quot;</span><span class="p">]</span>
<a id="__codelineno-0-577" name="__codelineno-0-577"></a>
<a id="__codelineno-0-578" name="__codelineno-0-578"></a>    <span class="k">async</span> <span class="k">for</span> <span class="n">yielded_result</span> <span class="ow">in</span> <span class="n">tree_manager</span><span class="o">.</span><span class="n">process_tree</span><span class="p">(</span>
<a id="__codelineno-0-579" name="__codelineno-0-579"></a>        <span class="n">query</span><span class="p">,</span>
<a id="__codelineno-0-580" name="__codelineno-0-580"></a>        <span class="n">conversation_id</span><span class="p">,</span>
<a id="__codelineno-0-581" name="__codelineno-0-581"></a>        <span class="n">query_id</span><span class="p">,</span>
<a id="__codelineno-0-582" name="__codelineno-0-582"></a>        <span class="n">training_route</span><span class="p">,</span>
<a id="__codelineno-0-583" name="__codelineno-0-583"></a>        <span class="n">collection_names</span><span class="p">,</span>
<a id="__codelineno-0-584" name="__codelineno-0-584"></a>        <span class="n">local_user</span><span class="p">[</span><span class="s2">&quot;client_manager&quot;</span><span class="p">],</span>
<a id="__codelineno-0-585" name="__codelineno-0-585"></a>    <span class="p">):</span>
<a id="__codelineno-0-586" name="__codelineno-0-586"></a>        <span class="k">yield</span> <span class="n">yielded_result</span>
<a id="__codelineno-0-587" name="__codelineno-0-587"></a>        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_user_last_request</span><span class="p">(</span><span class="n">user_id</span><span class="p">)</span>
<a id="__codelineno-0-588" name="__codelineno-0-588"></a>
<a id="__codelineno-0-589" name="__codelineno-0-589"></a>    <span class="k">if</span> <span class="n">save_trees_to_weaviate</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-590" name="__codelineno-0-590"></a>        <span class="n">frontend_config</span><span class="p">:</span> <span class="n">FrontendConfig</span> <span class="o">=</span> <span class="n">local_user</span><span class="p">[</span><span class="s2">&quot;frontend_config&quot;</span><span class="p">]</span>
<a id="__codelineno-0-591" name="__codelineno-0-591"></a>        <span class="n">save_trees_to_weaviate</span> <span class="o">=</span> <span class="n">frontend_config</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;save_trees_to_weaviate&quot;</span><span class="p">]</span>
<a id="__codelineno-0-592" name="__codelineno-0-592"></a>
<a id="__codelineno-0-593" name="__codelineno-0-593"></a>    <span class="k">if</span> <span class="n">save_trees_to_weaviate</span><span class="p">:</span>
<a id="__codelineno-0-594" name="__codelineno-0-594"></a>        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">save_tree</span><span class="p">(</span><span class="n">user_id</span><span class="p">,</span> <span class="n">conversation_id</span><span class="p">,</span> <span class="n">wcd_url</span><span class="p">,</span> <span class="n">wcd_api_key</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="elysia.api.services.user.UserManager.save_tree" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">save_tree</span><span class="p">(</span><span class="n">user_id</span><span class="p">,</span> <span class="n">conversation_id</span><span class="p">,</span> <span class="n">wcd_url</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">wcd_api_key</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Save a tree to a Weaviate instance (set in the frontend config).
This is a wrapper for the TreeManager.save_tree_weaviate() method.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>user_id</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Required. The unique identifier for the user stored in the UserManager.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>conversation_id</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Required. The unique identifier for the conversation for the user.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>elysia/api/services/user.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-306">306</a></span>
<span class="normal"><a href="#__codelineno-0-307">307</a></span>
<span class="normal"><a href="#__codelineno-0-308">308</a></span>
<span class="normal"><a href="#__codelineno-0-309">309</a></span>
<span class="normal"><a href="#__codelineno-0-310">310</a></span>
<span class="normal"><a href="#__codelineno-0-311">311</a></span>
<span class="normal"><a href="#__codelineno-0-312">312</a></span>
<span class="normal"><a href="#__codelineno-0-313">313</a></span>
<span class="normal"><a href="#__codelineno-0-314">314</a></span>
<span class="normal"><a href="#__codelineno-0-315">315</a></span>
<span class="normal"><a href="#__codelineno-0-316">316</a></span>
<span class="normal"><a href="#__codelineno-0-317">317</a></span>
<span class="normal"><a href="#__codelineno-0-318">318</a></span>
<span class="normal"><a href="#__codelineno-0-319">319</a></span>
<span class="normal"><a href="#__codelineno-0-320">320</a></span>
<span class="normal"><a href="#__codelineno-0-321">321</a></span>
<span class="normal"><a href="#__codelineno-0-322">322</a></span>
<span class="normal"><a href="#__codelineno-0-323">323</a></span>
<span class="normal"><a href="#__codelineno-0-324">324</a></span>
<span class="normal"><a href="#__codelineno-0-325">325</a></span>
<span class="normal"><a href="#__codelineno-0-326">326</a></span>
<span class="normal"><a href="#__codelineno-0-327">327</a></span>
<span class="normal"><a href="#__codelineno-0-328">328</a></span>
<span class="normal"><a href="#__codelineno-0-329">329</a></span>
<span class="normal"><a href="#__codelineno-0-330">330</a></span>
<span class="normal"><a href="#__codelineno-0-331">331</a></span>
<span class="normal"><a href="#__codelineno-0-332">332</a></span>
<span class="normal"><a href="#__codelineno-0-333">333</a></span>
<span class="normal"><a href="#__codelineno-0-334">334</a></span>
<span class="normal"><a href="#__codelineno-0-335">335</a></span>
<span class="normal"><a href="#__codelineno-0-336">336</a></span>
<span class="normal"><a href="#__codelineno-0-337">337</a></span>
<span class="normal"><a href="#__codelineno-0-338">338</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-306" name="__codelineno-0-306"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">save_tree</span><span class="p">(</span>
<a id="__codelineno-0-307" name="__codelineno-0-307"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-308" name="__codelineno-0-308"></a>    <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-309" name="__codelineno-0-309"></a>    <span class="n">conversation_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-310" name="__codelineno-0-310"></a>    <span class="n">wcd_url</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-311" name="__codelineno-0-311"></a>    <span class="n">wcd_api_key</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-312" name="__codelineno-0-312"></a><span class="p">):</span>
<a id="__codelineno-0-313" name="__codelineno-0-313"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-314" name="__codelineno-0-314"></a><span class="sd">    Save a tree to a Weaviate instance (set in the frontend config).</span>
<a id="__codelineno-0-315" name="__codelineno-0-315"></a><span class="sd">    This is a wrapper for the TreeManager.save_tree_weaviate() method.</span>
<a id="__codelineno-0-316" name="__codelineno-0-316"></a>
<a id="__codelineno-0-317" name="__codelineno-0-317"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-318" name="__codelineno-0-318"></a><span class="sd">        user_id (str): Required. The unique identifier for the user stored in the UserManager.</span>
<a id="__codelineno-0-319" name="__codelineno-0-319"></a><span class="sd">        conversation_id (str): Required. The unique identifier for the conversation for the user.</span>
<a id="__codelineno-0-320" name="__codelineno-0-320"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-321" name="__codelineno-0-321"></a>
<a id="__codelineno-0-322" name="__codelineno-0-322"></a>    <span class="n">local_user</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_user_local</span><span class="p">(</span><span class="n">user_id</span><span class="p">)</span>
<a id="__codelineno-0-323" name="__codelineno-0-323"></a>    <span class="n">tree_manager</span><span class="p">:</span> <span class="n">TreeManager</span> <span class="o">=</span> <span class="n">local_user</span><span class="p">[</span><span class="s2">&quot;tree_manager&quot;</span><span class="p">]</span>
<a id="__codelineno-0-324" name="__codelineno-0-324"></a>
<a id="__codelineno-0-325" name="__codelineno-0-325"></a>    <span class="k">if</span> <span class="n">wcd_url</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">wcd_api_key</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-326" name="__codelineno-0-326"></a>        <span class="n">save_location_client_manager</span> <span class="o">=</span> <span class="n">local_user</span><span class="p">[</span>
<a id="__codelineno-0-327" name="__codelineno-0-327"></a>            <span class="s2">&quot;frontend_config&quot;</span>
<a id="__codelineno-0-328" name="__codelineno-0-328"></a>        <span class="p">]</span><span class="o">.</span><span class="n">save_location_client_manager</span>
<a id="__codelineno-0-329" name="__codelineno-0-329"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-330" name="__codelineno-0-330"></a>        <span class="n">save_location_client_manager</span> <span class="o">=</span> <span class="n">ClientManager</span><span class="p">(</span>
<a id="__codelineno-0-331" name="__codelineno-0-331"></a>            <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">,</span>
<a id="__codelineno-0-332" name="__codelineno-0-332"></a>            <span class="n">wcd_url</span><span class="o">=</span><span class="n">wcd_url</span><span class="p">,</span>
<a id="__codelineno-0-333" name="__codelineno-0-333"></a>            <span class="n">wcd_api_key</span><span class="o">=</span><span class="n">wcd_api_key</span><span class="p">,</span>
<a id="__codelineno-0-334" name="__codelineno-0-334"></a>        <span class="p">)</span>
<a id="__codelineno-0-335" name="__codelineno-0-335"></a>
<a id="__codelineno-0-336" name="__codelineno-0-336"></a>    <span class="k">await</span> <span class="n">tree_manager</span><span class="o">.</span><span class="n">save_tree_weaviate</span><span class="p">(</span>
<a id="__codelineno-0-337" name="__codelineno-0-337"></a>        <span class="n">conversation_id</span><span class="p">,</span> <span class="n">save_location_client_manager</span>
<a id="__codelineno-0-338" name="__codelineno-0-338"></a>    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<a id="elysia.api.services.tree"></a>
    <div class="doc doc-contents first">










  <div class="doc doc-children">









<div class="doc doc-object doc-class">



<h2 id="elysia.api.services.tree.TreeManager" class="doc doc-heading">
            <code>TreeManager</code>


</h2>


    <div class="doc doc-contents ">


        <p>Manages trees (different conversations) for a single user.
Designed to be used with the Elysia API, or a manager for multiple Elysia decision trees.</p>
<p>You can initialise the TreeManager with particular config options.
Or, upon adding a tree, you can set a specific style, description and end goal for that tree.</p>
<p>Each tree has separate elements: the tree itself, the last request time, and the asyncio event.</p>








              <details class="quote">
                <summary>Source code in <code>elysia/api/services/tree.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-19"> 19</a></span>
<span class="normal"><a href="#__codelineno-0-20"> 20</a></span>
<span class="normal"><a href="#__codelineno-0-21"> 21</a></span>
<span class="normal"><a href="#__codelineno-0-22"> 22</a></span>
<span class="normal"><a href="#__codelineno-0-23"> 23</a></span>
<span class="normal"><a href="#__codelineno-0-24"> 24</a></span>
<span class="normal"><a href="#__codelineno-0-25"> 25</a></span>
<span class="normal"><a href="#__codelineno-0-26"> 26</a></span>
<span class="normal"><a href="#__codelineno-0-27"> 27</a></span>
<span class="normal"><a href="#__codelineno-0-28"> 28</a></span>
<span class="normal"><a href="#__codelineno-0-29"> 29</a></span>
<span class="normal"><a href="#__codelineno-0-30"> 30</a></span>
<span class="normal"><a href="#__codelineno-0-31"> 31</a></span>
<span class="normal"><a href="#__codelineno-0-32"> 32</a></span>
<span class="normal"><a href="#__codelineno-0-33"> 33</a></span>
<span class="normal"><a href="#__codelineno-0-34"> 34</a></span>
<span class="normal"><a href="#__codelineno-0-35"> 35</a></span>
<span class="normal"><a href="#__codelineno-0-36"> 36</a></span>
<span class="normal"><a href="#__codelineno-0-37"> 37</a></span>
<span class="normal"><a href="#__codelineno-0-38"> 38</a></span>
<span class="normal"><a href="#__codelineno-0-39"> 39</a></span>
<span class="normal"><a href="#__codelineno-0-40"> 40</a></span>
<span class="normal"><a href="#__codelineno-0-41"> 41</a></span>
<span class="normal"><a href="#__codelineno-0-42"> 42</a></span>
<span class="normal"><a href="#__codelineno-0-43"> 43</a></span>
<span class="normal"><a href="#__codelineno-0-44"> 44</a></span>
<span class="normal"><a href="#__codelineno-0-45"> 45</a></span>
<span class="normal"><a href="#__codelineno-0-46"> 46</a></span>
<span class="normal"><a href="#__codelineno-0-47"> 47</a></span>
<span class="normal"><a href="#__codelineno-0-48"> 48</a></span>
<span class="normal"><a href="#__codelineno-0-49"> 49</a></span>
<span class="normal"><a href="#__codelineno-0-50"> 50</a></span>
<span class="normal"><a href="#__codelineno-0-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-0-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-0-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-0-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-0-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-0-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-0-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-0-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-0-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-0-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-0-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-0-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-0-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-0-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-0-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-0-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-0-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-0-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-0-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-0-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-0-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-0-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-0-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-0-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-0-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-0-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-0-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-0-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-0-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-0-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-0-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-0-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-0-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-0-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-0-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-0-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-0-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-0-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-0-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-0-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-0-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span>
<span class="normal"><a href="#__codelineno-0-149">149</a></span>
<span class="normal"><a href="#__codelineno-0-150">150</a></span>
<span class="normal"><a href="#__codelineno-0-151">151</a></span>
<span class="normal"><a href="#__codelineno-0-152">152</a></span>
<span class="normal"><a href="#__codelineno-0-153">153</a></span>
<span class="normal"><a href="#__codelineno-0-154">154</a></span>
<span class="normal"><a href="#__codelineno-0-155">155</a></span>
<span class="normal"><a href="#__codelineno-0-156">156</a></span>
<span class="normal"><a href="#__codelineno-0-157">157</a></span>
<span class="normal"><a href="#__codelineno-0-158">158</a></span>
<span class="normal"><a href="#__codelineno-0-159">159</a></span>
<span class="normal"><a href="#__codelineno-0-160">160</a></span>
<span class="normal"><a href="#__codelineno-0-161">161</a></span>
<span class="normal"><a href="#__codelineno-0-162">162</a></span>
<span class="normal"><a href="#__codelineno-0-163">163</a></span>
<span class="normal"><a href="#__codelineno-0-164">164</a></span>
<span class="normal"><a href="#__codelineno-0-165">165</a></span>
<span class="normal"><a href="#__codelineno-0-166">166</a></span>
<span class="normal"><a href="#__codelineno-0-167">167</a></span>
<span class="normal"><a href="#__codelineno-0-168">168</a></span>
<span class="normal"><a href="#__codelineno-0-169">169</a></span>
<span class="normal"><a href="#__codelineno-0-170">170</a></span>
<span class="normal"><a href="#__codelineno-0-171">171</a></span>
<span class="normal"><a href="#__codelineno-0-172">172</a></span>
<span class="normal"><a href="#__codelineno-0-173">173</a></span>
<span class="normal"><a href="#__codelineno-0-174">174</a></span>
<span class="normal"><a href="#__codelineno-0-175">175</a></span>
<span class="normal"><a href="#__codelineno-0-176">176</a></span>
<span class="normal"><a href="#__codelineno-0-177">177</a></span>
<span class="normal"><a href="#__codelineno-0-178">178</a></span>
<span class="normal"><a href="#__codelineno-0-179">179</a></span>
<span class="normal"><a href="#__codelineno-0-180">180</a></span>
<span class="normal"><a href="#__codelineno-0-181">181</a></span>
<span class="normal"><a href="#__codelineno-0-182">182</a></span>
<span class="normal"><a href="#__codelineno-0-183">183</a></span>
<span class="normal"><a href="#__codelineno-0-184">184</a></span>
<span class="normal"><a href="#__codelineno-0-185">185</a></span>
<span class="normal"><a href="#__codelineno-0-186">186</a></span>
<span class="normal"><a href="#__codelineno-0-187">187</a></span>
<span class="normal"><a href="#__codelineno-0-188">188</a></span>
<span class="normal"><a href="#__codelineno-0-189">189</a></span>
<span class="normal"><a href="#__codelineno-0-190">190</a></span>
<span class="normal"><a href="#__codelineno-0-191">191</a></span>
<span class="normal"><a href="#__codelineno-0-192">192</a></span>
<span class="normal"><a href="#__codelineno-0-193">193</a></span>
<span class="normal"><a href="#__codelineno-0-194">194</a></span>
<span class="normal"><a href="#__codelineno-0-195">195</a></span>
<span class="normal"><a href="#__codelineno-0-196">196</a></span>
<span class="normal"><a href="#__codelineno-0-197">197</a></span>
<span class="normal"><a href="#__codelineno-0-198">198</a></span>
<span class="normal"><a href="#__codelineno-0-199">199</a></span>
<span class="normal"><a href="#__codelineno-0-200">200</a></span>
<span class="normal"><a href="#__codelineno-0-201">201</a></span>
<span class="normal"><a href="#__codelineno-0-202">202</a></span>
<span class="normal"><a href="#__codelineno-0-203">203</a></span>
<span class="normal"><a href="#__codelineno-0-204">204</a></span>
<span class="normal"><a href="#__codelineno-0-205">205</a></span>
<span class="normal"><a href="#__codelineno-0-206">206</a></span>
<span class="normal"><a href="#__codelineno-0-207">207</a></span>
<span class="normal"><a href="#__codelineno-0-208">208</a></span>
<span class="normal"><a href="#__codelineno-0-209">209</a></span>
<span class="normal"><a href="#__codelineno-0-210">210</a></span>
<span class="normal"><a href="#__codelineno-0-211">211</a></span>
<span class="normal"><a href="#__codelineno-0-212">212</a></span>
<span class="normal"><a href="#__codelineno-0-213">213</a></span>
<span class="normal"><a href="#__codelineno-0-214">214</a></span>
<span class="normal"><a href="#__codelineno-0-215">215</a></span>
<span class="normal"><a href="#__codelineno-0-216">216</a></span>
<span class="normal"><a href="#__codelineno-0-217">217</a></span>
<span class="normal"><a href="#__codelineno-0-218">218</a></span>
<span class="normal"><a href="#__codelineno-0-219">219</a></span>
<span class="normal"><a href="#__codelineno-0-220">220</a></span>
<span class="normal"><a href="#__codelineno-0-221">221</a></span>
<span class="normal"><a href="#__codelineno-0-222">222</a></span>
<span class="normal"><a href="#__codelineno-0-223">223</a></span>
<span class="normal"><a href="#__codelineno-0-224">224</a></span>
<span class="normal"><a href="#__codelineno-0-225">225</a></span>
<span class="normal"><a href="#__codelineno-0-226">226</a></span>
<span class="normal"><a href="#__codelineno-0-227">227</a></span>
<span class="normal"><a href="#__codelineno-0-228">228</a></span>
<span class="normal"><a href="#__codelineno-0-229">229</a></span>
<span class="normal"><a href="#__codelineno-0-230">230</a></span>
<span class="normal"><a href="#__codelineno-0-231">231</a></span>
<span class="normal"><a href="#__codelineno-0-232">232</a></span>
<span class="normal"><a href="#__codelineno-0-233">233</a></span>
<span class="normal"><a href="#__codelineno-0-234">234</a></span>
<span class="normal"><a href="#__codelineno-0-235">235</a></span>
<span class="normal"><a href="#__codelineno-0-236">236</a></span>
<span class="normal"><a href="#__codelineno-0-237">237</a></span>
<span class="normal"><a href="#__codelineno-0-238">238</a></span>
<span class="normal"><a href="#__codelineno-0-239">239</a></span>
<span class="normal"><a href="#__codelineno-0-240">240</a></span>
<span class="normal"><a href="#__codelineno-0-241">241</a></span>
<span class="normal"><a href="#__codelineno-0-242">242</a></span>
<span class="normal"><a href="#__codelineno-0-243">243</a></span>
<span class="normal"><a href="#__codelineno-0-244">244</a></span>
<span class="normal"><a href="#__codelineno-0-245">245</a></span>
<span class="normal"><a href="#__codelineno-0-246">246</a></span>
<span class="normal"><a href="#__codelineno-0-247">247</a></span>
<span class="normal"><a href="#__codelineno-0-248">248</a></span>
<span class="normal"><a href="#__codelineno-0-249">249</a></span>
<span class="normal"><a href="#__codelineno-0-250">250</a></span>
<span class="normal"><a href="#__codelineno-0-251">251</a></span>
<span class="normal"><a href="#__codelineno-0-252">252</a></span>
<span class="normal"><a href="#__codelineno-0-253">253</a></span>
<span class="normal"><a href="#__codelineno-0-254">254</a></span>
<span class="normal"><a href="#__codelineno-0-255">255</a></span>
<span class="normal"><a href="#__codelineno-0-256">256</a></span>
<span class="normal"><a href="#__codelineno-0-257">257</a></span>
<span class="normal"><a href="#__codelineno-0-258">258</a></span>
<span class="normal"><a href="#__codelineno-0-259">259</a></span>
<span class="normal"><a href="#__codelineno-0-260">260</a></span>
<span class="normal"><a href="#__codelineno-0-261">261</a></span>
<span class="normal"><a href="#__codelineno-0-262">262</a></span>
<span class="normal"><a href="#__codelineno-0-263">263</a></span>
<span class="normal"><a href="#__codelineno-0-264">264</a></span>
<span class="normal"><a href="#__codelineno-0-265">265</a></span>
<span class="normal"><a href="#__codelineno-0-266">266</a></span>
<span class="normal"><a href="#__codelineno-0-267">267</a></span>
<span class="normal"><a href="#__codelineno-0-268">268</a></span>
<span class="normal"><a href="#__codelineno-0-269">269</a></span>
<span class="normal"><a href="#__codelineno-0-270">270</a></span>
<span class="normal"><a href="#__codelineno-0-271">271</a></span>
<span class="normal"><a href="#__codelineno-0-272">272</a></span>
<span class="normal"><a href="#__codelineno-0-273">273</a></span>
<span class="normal"><a href="#__codelineno-0-274">274</a></span>
<span class="normal"><a href="#__codelineno-0-275">275</a></span>
<span class="normal"><a href="#__codelineno-0-276">276</a></span>
<span class="normal"><a href="#__codelineno-0-277">277</a></span>
<span class="normal"><a href="#__codelineno-0-278">278</a></span>
<span class="normal"><a href="#__codelineno-0-279">279</a></span>
<span class="normal"><a href="#__codelineno-0-280">280</a></span>
<span class="normal"><a href="#__codelineno-0-281">281</a></span>
<span class="normal"><a href="#__codelineno-0-282">282</a></span>
<span class="normal"><a href="#__codelineno-0-283">283</a></span>
<span class="normal"><a href="#__codelineno-0-284">284</a></span>
<span class="normal"><a href="#__codelineno-0-285">285</a></span>
<span class="normal"><a href="#__codelineno-0-286">286</a></span>
<span class="normal"><a href="#__codelineno-0-287">287</a></span>
<span class="normal"><a href="#__codelineno-0-288">288</a></span>
<span class="normal"><a href="#__codelineno-0-289">289</a></span>
<span class="normal"><a href="#__codelineno-0-290">290</a></span>
<span class="normal"><a href="#__codelineno-0-291">291</a></span>
<span class="normal"><a href="#__codelineno-0-292">292</a></span>
<span class="normal"><a href="#__codelineno-0-293">293</a></span>
<span class="normal"><a href="#__codelineno-0-294">294</a></span>
<span class="normal"><a href="#__codelineno-0-295">295</a></span>
<span class="normal"><a href="#__codelineno-0-296">296</a></span>
<span class="normal"><a href="#__codelineno-0-297">297</a></span>
<span class="normal"><a href="#__codelineno-0-298">298</a></span>
<span class="normal"><a href="#__codelineno-0-299">299</a></span>
<span class="normal"><a href="#__codelineno-0-300">300</a></span>
<span class="normal"><a href="#__codelineno-0-301">301</a></span>
<span class="normal"><a href="#__codelineno-0-302">302</a></span>
<span class="normal"><a href="#__codelineno-0-303">303</a></span>
<span class="normal"><a href="#__codelineno-0-304">304</a></span>
<span class="normal"><a href="#__codelineno-0-305">305</a></span>
<span class="normal"><a href="#__codelineno-0-306">306</a></span>
<span class="normal"><a href="#__codelineno-0-307">307</a></span>
<span class="normal"><a href="#__codelineno-0-308">308</a></span>
<span class="normal"><a href="#__codelineno-0-309">309</a></span>
<span class="normal"><a href="#__codelineno-0-310">310</a></span>
<span class="normal"><a href="#__codelineno-0-311">311</a></span>
<span class="normal"><a href="#__codelineno-0-312">312</a></span>
<span class="normal"><a href="#__codelineno-0-313">313</a></span>
<span class="normal"><a href="#__codelineno-0-314">314</a></span>
<span class="normal"><a href="#__codelineno-0-315">315</a></span>
<span class="normal"><a href="#__codelineno-0-316">316</a></span>
<span class="normal"><a href="#__codelineno-0-317">317</a></span>
<span class="normal"><a href="#__codelineno-0-318">318</a></span>
<span class="normal"><a href="#__codelineno-0-319">319</a></span>
<span class="normal"><a href="#__codelineno-0-320">320</a></span>
<span class="normal"><a href="#__codelineno-0-321">321</a></span>
<span class="normal"><a href="#__codelineno-0-322">322</a></span>
<span class="normal"><a href="#__codelineno-0-323">323</a></span>
<span class="normal"><a href="#__codelineno-0-324">324</a></span>
<span class="normal"><a href="#__codelineno-0-325">325</a></span>
<span class="normal"><a href="#__codelineno-0-326">326</a></span>
<span class="normal"><a href="#__codelineno-0-327">327</a></span>
<span class="normal"><a href="#__codelineno-0-328">328</a></span>
<span class="normal"><a href="#__codelineno-0-329">329</a></span>
<span class="normal"><a href="#__codelineno-0-330">330</a></span>
<span class="normal"><a href="#__codelineno-0-331">331</a></span>
<span class="normal"><a href="#__codelineno-0-332">332</a></span>
<span class="normal"><a href="#__codelineno-0-333">333</a></span>
<span class="normal"><a href="#__codelineno-0-334">334</a></span>
<span class="normal"><a href="#__codelineno-0-335">335</a></span>
<span class="normal"><a href="#__codelineno-0-336">336</a></span>
<span class="normal"><a href="#__codelineno-0-337">337</a></span>
<span class="normal"><a href="#__codelineno-0-338">338</a></span>
<span class="normal"><a href="#__codelineno-0-339">339</a></span>
<span class="normal"><a href="#__codelineno-0-340">340</a></span>
<span class="normal"><a href="#__codelineno-0-341">341</a></span>
<span class="normal"><a href="#__codelineno-0-342">342</a></span>
<span class="normal"><a href="#__codelineno-0-343">343</a></span>
<span class="normal"><a href="#__codelineno-0-344">344</a></span>
<span class="normal"><a href="#__codelineno-0-345">345</a></span>
<span class="normal"><a href="#__codelineno-0-346">346</a></span>
<span class="normal"><a href="#__codelineno-0-347">347</a></span>
<span class="normal"><a href="#__codelineno-0-348">348</a></span>
<span class="normal"><a href="#__codelineno-0-349">349</a></span>
<span class="normal"><a href="#__codelineno-0-350">350</a></span>
<span class="normal"><a href="#__codelineno-0-351">351</a></span>
<span class="normal"><a href="#__codelineno-0-352">352</a></span>
<span class="normal"><a href="#__codelineno-0-353">353</a></span>
<span class="normal"><a href="#__codelineno-0-354">354</a></span>
<span class="normal"><a href="#__codelineno-0-355">355</a></span>
<span class="normal"><a href="#__codelineno-0-356">356</a></span>
<span class="normal"><a href="#__codelineno-0-357">357</a></span>
<span class="normal"><a href="#__codelineno-0-358">358</a></span>
<span class="normal"><a href="#__codelineno-0-359">359</a></span>
<span class="normal"><a href="#__codelineno-0-360">360</a></span>
<span class="normal"><a href="#__codelineno-0-361">361</a></span>
<span class="normal"><a href="#__codelineno-0-362">362</a></span>
<span class="normal"><a href="#__codelineno-0-363">363</a></span>
<span class="normal"><a href="#__codelineno-0-364">364</a></span>
<span class="normal"><a href="#__codelineno-0-365">365</a></span>
<span class="normal"><a href="#__codelineno-0-366">366</a></span>
<span class="normal"><a href="#__codelineno-0-367">367</a></span>
<span class="normal"><a href="#__codelineno-0-368">368</a></span>
<span class="normal"><a href="#__codelineno-0-369">369</a></span>
<span class="normal"><a href="#__codelineno-0-370">370</a></span>
<span class="normal"><a href="#__codelineno-0-371">371</a></span>
<span class="normal"><a href="#__codelineno-0-372">372</a></span>
<span class="normal"><a href="#__codelineno-0-373">373</a></span>
<span class="normal"><a href="#__codelineno-0-374">374</a></span>
<span class="normal"><a href="#__codelineno-0-375">375</a></span>
<span class="normal"><a href="#__codelineno-0-376">376</a></span>
<span class="normal"><a href="#__codelineno-0-377">377</a></span>
<span class="normal"><a href="#__codelineno-0-378">378</a></span>
<span class="normal"><a href="#__codelineno-0-379">379</a></span>
<span class="normal"><a href="#__codelineno-0-380">380</a></span>
<span class="normal"><a href="#__codelineno-0-381">381</a></span>
<span class="normal"><a href="#__codelineno-0-382">382</a></span>
<span class="normal"><a href="#__codelineno-0-383">383</a></span>
<span class="normal"><a href="#__codelineno-0-384">384</a></span>
<span class="normal"><a href="#__codelineno-0-385">385</a></span>
<span class="normal"><a href="#__codelineno-0-386">386</a></span>
<span class="normal"><a href="#__codelineno-0-387">387</a></span>
<span class="normal"><a href="#__codelineno-0-388">388</a></span>
<span class="normal"><a href="#__codelineno-0-389">389</a></span>
<span class="normal"><a href="#__codelineno-0-390">390</a></span>
<span class="normal"><a href="#__codelineno-0-391">391</a></span>
<span class="normal"><a href="#__codelineno-0-392">392</a></span>
<span class="normal"><a href="#__codelineno-0-393">393</a></span>
<span class="normal"><a href="#__codelineno-0-394">394</a></span>
<span class="normal"><a href="#__codelineno-0-395">395</a></span>
<span class="normal"><a href="#__codelineno-0-396">396</a></span>
<span class="normal"><a href="#__codelineno-0-397">397</a></span>
<span class="normal"><a href="#__codelineno-0-398">398</a></span>
<span class="normal"><a href="#__codelineno-0-399">399</a></span>
<span class="normal"><a href="#__codelineno-0-400">400</a></span>
<span class="normal"><a href="#__codelineno-0-401">401</a></span>
<span class="normal"><a href="#__codelineno-0-402">402</a></span>
<span class="normal"><a href="#__codelineno-0-403">403</a></span>
<span class="normal"><a href="#__codelineno-0-404">404</a></span>
<span class="normal"><a href="#__codelineno-0-405">405</a></span>
<span class="normal"><a href="#__codelineno-0-406">406</a></span>
<span class="normal"><a href="#__codelineno-0-407">407</a></span>
<span class="normal"><a href="#__codelineno-0-408">408</a></span>
<span class="normal"><a href="#__codelineno-0-409">409</a></span>
<span class="normal"><a href="#__codelineno-0-410">410</a></span>
<span class="normal"><a href="#__codelineno-0-411">411</a></span>
<span class="normal"><a href="#__codelineno-0-412">412</a></span>
<span class="normal"><a href="#__codelineno-0-413">413</a></span>
<span class="normal"><a href="#__codelineno-0-414">414</a></span>
<span class="normal"><a href="#__codelineno-0-415">415</a></span>
<span class="normal"><a href="#__codelineno-0-416">416</a></span>
<span class="normal"><a href="#__codelineno-0-417">417</a></span>
<span class="normal"><a href="#__codelineno-0-418">418</a></span>
<span class="normal"><a href="#__codelineno-0-419">419</a></span>
<span class="normal"><a href="#__codelineno-0-420">420</a></span>
<span class="normal"><a href="#__codelineno-0-421">421</a></span>
<span class="normal"><a href="#__codelineno-0-422">422</a></span>
<span class="normal"><a href="#__codelineno-0-423">423</a></span>
<span class="normal"><a href="#__codelineno-0-424">424</a></span>
<span class="normal"><a href="#__codelineno-0-425">425</a></span>
<span class="normal"><a href="#__codelineno-0-426">426</a></span>
<span class="normal"><a href="#__codelineno-0-427">427</a></span>
<span class="normal"><a href="#__codelineno-0-428">428</a></span>
<span class="normal"><a href="#__codelineno-0-429">429</a></span>
<span class="normal"><a href="#__codelineno-0-430">430</a></span>
<span class="normal"><a href="#__codelineno-0-431">431</a></span>
<span class="normal"><a href="#__codelineno-0-432">432</a></span>
<span class="normal"><a href="#__codelineno-0-433">433</a></span>
<span class="normal"><a href="#__codelineno-0-434">434</a></span>
<span class="normal"><a href="#__codelineno-0-435">435</a></span>
<span class="normal"><a href="#__codelineno-0-436">436</a></span>
<span class="normal"><a href="#__codelineno-0-437">437</a></span>
<span class="normal"><a href="#__codelineno-0-438">438</a></span>
<span class="normal"><a href="#__codelineno-0-439">439</a></span>
<span class="normal"><a href="#__codelineno-0-440">440</a></span>
<span class="normal"><a href="#__codelineno-0-441">441</a></span>
<span class="normal"><a href="#__codelineno-0-442">442</a></span>
<span class="normal"><a href="#__codelineno-0-443">443</a></span>
<span class="normal"><a href="#__codelineno-0-444">444</a></span>
<span class="normal"><a href="#__codelineno-0-445">445</a></span>
<span class="normal"><a href="#__codelineno-0-446">446</a></span>
<span class="normal"><a href="#__codelineno-0-447">447</a></span>
<span class="normal"><a href="#__codelineno-0-448">448</a></span>
<span class="normal"><a href="#__codelineno-0-449">449</a></span>
<span class="normal"><a href="#__codelineno-0-450">450</a></span>
<span class="normal"><a href="#__codelineno-0-451">451</a></span>
<span class="normal"><a href="#__codelineno-0-452">452</a></span>
<span class="normal"><a href="#__codelineno-0-453">453</a></span>
<span class="normal"><a href="#__codelineno-0-454">454</a></span>
<span class="normal"><a href="#__codelineno-0-455">455</a></span>
<span class="normal"><a href="#__codelineno-0-456">456</a></span>
<span class="normal"><a href="#__codelineno-0-457">457</a></span>
<span class="normal"><a href="#__codelineno-0-458">458</a></span>
<span class="normal"><a href="#__codelineno-0-459">459</a></span>
<span class="normal"><a href="#__codelineno-0-460">460</a></span>
<span class="normal"><a href="#__codelineno-0-461">461</a></span>
<span class="normal"><a href="#__codelineno-0-462">462</a></span>
<span class="normal"><a href="#__codelineno-0-463">463</a></span>
<span class="normal"><a href="#__codelineno-0-464">464</a></span>
<span class="normal"><a href="#__codelineno-0-465">465</a></span>
<span class="normal"><a href="#__codelineno-0-466">466</a></span>
<span class="normal"><a href="#__codelineno-0-467">467</a></span>
<span class="normal"><a href="#__codelineno-0-468">468</a></span>
<span class="normal"><a href="#__codelineno-0-469">469</a></span>
<span class="normal"><a href="#__codelineno-0-470">470</a></span>
<span class="normal"><a href="#__codelineno-0-471">471</a></span>
<span class="normal"><a href="#__codelineno-0-472">472</a></span>
<span class="normal"><a href="#__codelineno-0-473">473</a></span>
<span class="normal"><a href="#__codelineno-0-474">474</a></span>
<span class="normal"><a href="#__codelineno-0-475">475</a></span>
<span class="normal"><a href="#__codelineno-0-476">476</a></span>
<span class="normal"><a href="#__codelineno-0-477">477</a></span>
<span class="normal"><a href="#__codelineno-0-478">478</a></span>
<span class="normal"><a href="#__codelineno-0-479">479</a></span>
<span class="normal"><a href="#__codelineno-0-480">480</a></span>
<span class="normal"><a href="#__codelineno-0-481">481</a></span>
<span class="normal"><a href="#__codelineno-0-482">482</a></span>
<span class="normal"><a href="#__codelineno-0-483">483</a></span>
<span class="normal"><a href="#__codelineno-0-484">484</a></span>
<span class="normal"><a href="#__codelineno-0-485">485</a></span>
<span class="normal"><a href="#__codelineno-0-486">486</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-19" name="__codelineno-0-19"></a><span class="k">class</span><span class="w"> </span><span class="nc">TreeManager</span><span class="p">:</span>
<a id="__codelineno-0-20" name="__codelineno-0-20"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-21" name="__codelineno-0-21"></a><span class="sd">    Manages trees (different conversations) for a single user.</span>
<a id="__codelineno-0-22" name="__codelineno-0-22"></a><span class="sd">    Designed to be used with the Elysia API, or a manager for multiple Elysia decision trees.</span>
<a id="__codelineno-0-23" name="__codelineno-0-23"></a>
<a id="__codelineno-0-24" name="__codelineno-0-24"></a><span class="sd">    You can initialise the TreeManager with particular config options.</span>
<a id="__codelineno-0-25" name="__codelineno-0-25"></a><span class="sd">    Or, upon adding a tree, you can set a specific style, description and end goal for that tree.</span>
<a id="__codelineno-0-26" name="__codelineno-0-26"></a>
<a id="__codelineno-0-27" name="__codelineno-0-27"></a><span class="sd">    Each tree has separate elements: the tree itself, the last request time, and the asyncio event.</span>
<a id="__codelineno-0-28" name="__codelineno-0-28"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-29" name="__codelineno-0-29"></a>
<a id="__codelineno-0-30" name="__codelineno-0-30"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
<a id="__codelineno-0-31" name="__codelineno-0-31"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-32" name="__codelineno-0-32"></a>        <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-33" name="__codelineno-0-33"></a>        <span class="n">config</span><span class="p">:</span> <span class="n">Config</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-34" name="__codelineno-0-34"></a>        <span class="n">tree_timeout</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-35" name="__codelineno-0-35"></a>    <span class="p">):</span>
<a id="__codelineno-0-36" name="__codelineno-0-36"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-37" name="__codelineno-0-37"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-38" name="__codelineno-0-38"></a><span class="sd">            user_id (str): Required. A unique identifier for the user being managed within this TreeManager.</span>
<a id="__codelineno-0-39" name="__codelineno-0-39"></a><span class="sd">            config (Config | None): Optional. A config for all trees managed by this TreeManager.</span>
<a id="__codelineno-0-40" name="__codelineno-0-40"></a><span class="sd">                Defaults to a new config with default settings.</span>
<a id="__codelineno-0-41" name="__codelineno-0-41"></a><span class="sd">                If `settings` is not provided, it will be set to the default settings (smart_setup).</span>
<a id="__codelineno-0-42" name="__codelineno-0-42"></a><span class="sd">            tree_timeout (datetime.timedelta | int | None): Optional. A timeout for all trees managed by this TreeManager.</span>
<a id="__codelineno-0-43" name="__codelineno-0-43"></a><span class="sd">                Defaults to the value of the `TREE_TIMEOUT` environment variable.</span>
<a id="__codelineno-0-44" name="__codelineno-0-44"></a><span class="sd">                If an integer is passed, it will be interpreted as minutes.</span>
<a id="__codelineno-0-45" name="__codelineno-0-45"></a><span class="sd">                If set to 0, trees will not be automatically removed.</span>
<a id="__codelineno-0-46" name="__codelineno-0-46"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-47" name="__codelineno-0-47"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">trees</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-48" name="__codelineno-0-48"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">user_id</span> <span class="o">=</span> <span class="n">user_id</span>
<a id="__codelineno-0-49" name="__codelineno-0-49"></a>
<a id="__codelineno-0-50" name="__codelineno-0-50"></a>        <span class="k">if</span> <span class="n">tree_timeout</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-51" name="__codelineno-0-51"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">tree_timeout</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span>
<a id="__codelineno-0-52" name="__codelineno-0-52"></a>                <span class="n">minutes</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;TREE_TIMEOUT&quot;</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<a id="__codelineno-0-53" name="__codelineno-0-53"></a>            <span class="p">)</span>
<a id="__codelineno-0-54" name="__codelineno-0-54"></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tree_timeout</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
<a id="__codelineno-0-55" name="__codelineno-0-55"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">tree_timeout</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">minutes</span><span class="o">=</span><span class="n">tree_timeout</span><span class="p">)</span>
<a id="__codelineno-0-56" name="__codelineno-0-56"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-57" name="__codelineno-0-57"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">tree_timeout</span> <span class="o">=</span> <span class="n">tree_timeout</span>
<a id="__codelineno-0-58" name="__codelineno-0-58"></a>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a>        <span class="k">if</span> <span class="n">config</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">()</span>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="n">config</span>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">settings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">settings</span>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">update_config</span><span class="p">(</span>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a>        <span class="n">conversation_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-69" name="__codelineno-0-69"></a>        <span class="n">config_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a>        <span class="n">config_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a>        <span class="n">settings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a>        <span class="n">style</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a>        <span class="n">agent_description</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-74" name="__codelineno-0-74"></a>        <span class="n">end_goal</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a>        <span class="n">branch_initialisation</span><span class="p">:</span> <span class="n">BranchInitType</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a>    <span class="p">):</span>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a>        <span class="k">if</span> <span class="n">config_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-78" name="__codelineno-0-78"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">config_id</span>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a>        <span class="k">if</span> <span class="n">config_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">config_name</span>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a>        <span class="k">if</span> <span class="n">settings</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">conversation_id</span><span class="o">=</span><span class="n">conversation_id</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">settings</span><span class="p">)</span>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a>        <span class="k">if</span> <span class="n">style</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">change_style</span><span class="p">(</span><span class="n">style</span><span class="p">,</span> <span class="n">conversation_id</span><span class="p">)</span>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a>        <span class="k">if</span> <span class="n">agent_description</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">change_agent_description</span><span class="p">(</span><span class="n">agent_description</span><span class="p">,</span> <span class="n">conversation_id</span><span class="p">)</span>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a>        <span class="k">if</span> <span class="n">end_goal</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">change_end_goal</span><span class="p">(</span><span class="n">end_goal</span><span class="p">,</span> <span class="n">conversation_id</span><span class="p">)</span>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a>        <span class="k">if</span> <span class="n">branch_initialisation</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">change_branch_initialisation</span><span class="p">(</span><span class="n">branch_initialisation</span><span class="p">,</span> <span class="n">conversation_id</span><span class="p">)</span>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">add_tree</span><span class="p">(</span>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a>        <span class="n">conversation_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a>        <span class="n">low_memory</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a>    <span class="p">):</span>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a><span class="sd">        Add a tree to the TreeManager.</span>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a><span class="sd">        The decision tree can be initialised with specific config options, such as style, agent description and end goal.</span>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a><span class="sd">        As well as a Settings object, which chooses options such as the LLM models, API keys and more.</span>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a><span class="sd">            conversation_id (str): Required. A unique identifier for the conversation.</span>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a><span class="sd">            low_memory (bool): Optional. Whether to use low memory mode for the tree.</span>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a><span class="sd">                Controls the LM history being saved in the tree, and some other variables.</span>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a><span class="sd">                Defaults to False.</span>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a>
<a id="__codelineno-0-115" name="__codelineno-0-115"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">tree_exists</span><span class="p">(</span><span class="n">conversation_id</span><span class="p">):</span>
<a id="__codelineno-0-116" name="__codelineno-0-116"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">trees</span><span class="p">[</span><span class="n">conversation_id</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a>                <span class="s2">&quot;tree&quot;</span><span class="p">:</span> <span class="n">Tree</span><span class="p">(</span>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a>                    <span class="n">conversation_id</span><span class="o">=</span><span class="n">conversation_id</span><span class="p">,</span>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a>                    <span class="n">user_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">user_id</span><span class="p">,</span>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a>                    <span class="n">settings</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">,</span>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a>                    <span class="n">style</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">style</span><span class="p">,</span>
<a id="__codelineno-0-122" name="__codelineno-0-122"></a>                    <span class="n">agent_description</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">agent_description</span><span class="p">,</span>
<a id="__codelineno-0-123" name="__codelineno-0-123"></a>                    <span class="n">end_goal</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">end_goal</span><span class="p">,</span>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a>                    <span class="n">branch_initialisation</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">branch_initialisation</span><span class="p">,</span>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a>                    <span class="n">low_memory</span><span class="o">=</span><span class="n">low_memory</span><span class="p">,</span>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a>                    <span class="n">use_elysia_collections</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">use_elysia_collections</span><span class="p">,</span>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a>                <span class="p">),</span>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a>                <span class="s2">&quot;last_request&quot;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(),</span>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a>                <span class="s2">&quot;event&quot;</span><span class="p">:</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">Event</span><span class="p">(),</span>
<a id="__codelineno-0-130" name="__codelineno-0-130"></a>            <span class="p">}</span>
<a id="__codelineno-0-131" name="__codelineno-0-131"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">trees</span><span class="p">[</span><span class="n">conversation_id</span><span class="p">][</span><span class="s2">&quot;event&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>
<a id="__codelineno-0-132" name="__codelineno-0-132"></a>
<a id="__codelineno-0-133" name="__codelineno-0-133"></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">save_tree_weaviate</span><span class="p">(</span>
<a id="__codelineno-0-134" name="__codelineno-0-134"></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">conversation_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">client_manager</span><span class="p">:</span> <span class="n">ClientManager</span>
<a id="__codelineno-0-135" name="__codelineno-0-135"></a>    <span class="p">):</span>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-137" name="__codelineno-0-137"></a><span class="sd">        Save a tree to Weaviate to collection ELYSIA_TREES__.</span>
<a id="__codelineno-0-138" name="__codelineno-0-138"></a><span class="sd">        Creates the collection if it doesn&#39;t exist.</span>
<a id="__codelineno-0-139" name="__codelineno-0-139"></a>
<a id="__codelineno-0-140" name="__codelineno-0-140"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-141" name="__codelineno-0-141"></a><span class="sd">            conversation_id (str): The conversation ID which contains the tree.</span>
<a id="__codelineno-0-142" name="__codelineno-0-142"></a><span class="sd">            client_manager (ClientManager): The client manager to use for the tree.</span>
<a id="__codelineno-0-143" name="__codelineno-0-143"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-144" name="__codelineno-0-144"></a>        <span class="n">tree</span><span class="p">:</span> <span class="n">Tree</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_tree</span><span class="p">(</span><span class="n">conversation_id</span><span class="p">)</span>
<a id="__codelineno-0-145" name="__codelineno-0-145"></a>        <span class="k">await</span> <span class="n">tree</span><span class="o">.</span><span class="n">export_to_weaviate</span><span class="p">(</span><span class="s2">&quot;ELYSIA_TREES__&quot;</span><span class="p">,</span> <span class="n">client_manager</span><span class="p">)</span>
<a id="__codelineno-0-146" name="__codelineno-0-146"></a>
<a id="__codelineno-0-147" name="__codelineno-0-147"></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">check_tree_exists_weaviate</span><span class="p">(</span>
<a id="__codelineno-0-148" name="__codelineno-0-148"></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">conversation_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">client_manager</span><span class="p">:</span> <span class="n">ClientManager</span>
<a id="__codelineno-0-149" name="__codelineno-0-149"></a>    <span class="p">):</span>
<a id="__codelineno-0-150" name="__codelineno-0-150"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-151" name="__codelineno-0-151"></a><span class="sd">        Check if a tree exists in a Weaviate instance.</span>
<a id="__codelineno-0-152" name="__codelineno-0-152"></a><span class="sd">        The collection ELYSIA_TREES__ must exist, returns False if it doesn&#39;t.</span>
<a id="__codelineno-0-153" name="__codelineno-0-153"></a>
<a id="__codelineno-0-154" name="__codelineno-0-154"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-155" name="__codelineno-0-155"></a><span class="sd">            conversation_id (str): The conversation ID which contains the tree.</span>
<a id="__codelineno-0-156" name="__codelineno-0-156"></a><span class="sd">            client_manager (ClientManager): The client manager to use for the tree.</span>
<a id="__codelineno-0-157" name="__codelineno-0-157"></a>
<a id="__codelineno-0-158" name="__codelineno-0-158"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-159" name="__codelineno-0-159"></a><span class="sd">            (bool): True if the tree exists in the Weaviate instance, False otherwise.</span>
<a id="__codelineno-0-160" name="__codelineno-0-160"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-161" name="__codelineno-0-161"></a>        <span class="k">async</span> <span class="k">with</span> <span class="n">client_manager</span><span class="o">.</span><span class="n">connect_to_async_client</span><span class="p">()</span> <span class="k">as</span> <span class="n">client</span><span class="p">:</span>
<a id="__codelineno-0-162" name="__codelineno-0-162"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="k">await</span> <span class="n">client</span><span class="o">.</span><span class="n">collections</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s2">&quot;ELYSIA_TREES__&quot;</span><span class="p">):</span>
<a id="__codelineno-0-163" name="__codelineno-0-163"></a>                <span class="k">return</span> <span class="kc">False</span>
<a id="__codelineno-0-164" name="__codelineno-0-164"></a>
<a id="__codelineno-0-165" name="__codelineno-0-165"></a>            <span class="n">collection</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">collections</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;ELYSIA_TREES__&quot;</span><span class="p">)</span>
<a id="__codelineno-0-166" name="__codelineno-0-166"></a>            <span class="n">uuid</span> <span class="o">=</span> <span class="n">generate_uuid5</span><span class="p">(</span><span class="n">conversation_id</span><span class="p">)</span>
<a id="__codelineno-0-167" name="__codelineno-0-167"></a>            <span class="k">return</span> <span class="k">await</span> <span class="n">collection</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">uuid</span><span class="p">)</span>
<a id="__codelineno-0-168" name="__codelineno-0-168"></a>
<a id="__codelineno-0-169" name="__codelineno-0-169"></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">load_tree_weaviate</span><span class="p">(</span>
<a id="__codelineno-0-170" name="__codelineno-0-170"></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">conversation_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">client_manager</span><span class="p">:</span> <span class="n">ClientManager</span>
<a id="__codelineno-0-171" name="__codelineno-0-171"></a>    <span class="p">):</span>
<a id="__codelineno-0-172" name="__codelineno-0-172"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-173" name="__codelineno-0-173"></a><span class="sd">        Load a tree from Weaviate.</span>
<a id="__codelineno-0-174" name="__codelineno-0-174"></a><span class="sd">        The conversation ID from the loaded tree is placed into the tree manager</span>
<a id="__codelineno-0-175" name="__codelineno-0-175"></a><span class="sd">        (possibly overwriting an existing tree with the same conversation ID).</span>
<a id="__codelineno-0-176" name="__codelineno-0-176"></a><span class="sd">        Then the tree itself is not returned - instead the list of frontend payloads</span>
<a id="__codelineno-0-177" name="__codelineno-0-177"></a><span class="sd">        that were yielded to the frontend by the tree is returned.</span>
<a id="__codelineno-0-178" name="__codelineno-0-178"></a>
<a id="__codelineno-0-179" name="__codelineno-0-179"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-180" name="__codelineno-0-180"></a><span class="sd">            conversation_id (str): The conversation ID which contains the tree.</span>
<a id="__codelineno-0-181" name="__codelineno-0-181"></a><span class="sd">            client_manager (ClientManager): The client manager to use for the tree.</span>
<a id="__codelineno-0-182" name="__codelineno-0-182"></a>
<a id="__codelineno-0-183" name="__codelineno-0-183"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-184" name="__codelineno-0-184"></a><span class="sd">            (list): A list of dictionaries, each containing a frontend payload that was used to generate the tree.</span>
<a id="__codelineno-0-185" name="__codelineno-0-185"></a><span class="sd">                The list is ordered by the time the payload was originally sent to the frontend (at the time it was saved).</span>
<a id="__codelineno-0-186" name="__codelineno-0-186"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-187" name="__codelineno-0-187"></a>        <span class="n">tree</span> <span class="o">=</span> <span class="k">await</span> <span class="n">Tree</span><span class="o">.</span><span class="n">import_from_weaviate</span><span class="p">(</span>
<a id="__codelineno-0-188" name="__codelineno-0-188"></a>            <span class="s2">&quot;ELYSIA_TREES__&quot;</span><span class="p">,</span> <span class="n">conversation_id</span><span class="p">,</span> <span class="n">client_manager</span>
<a id="__codelineno-0-189" name="__codelineno-0-189"></a>        <span class="p">)</span>
<a id="__codelineno-0-190" name="__codelineno-0-190"></a>        <span class="k">if</span> <span class="n">conversation_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">trees</span><span class="p">:</span>
<a id="__codelineno-0-191" name="__codelineno-0-191"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">trees</span><span class="p">[</span><span class="n">conversation_id</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-192" name="__codelineno-0-192"></a>                <span class="s2">&quot;tree&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-193" name="__codelineno-0-193"></a>                <span class="s2">&quot;event&quot;</span><span class="p">:</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">Event</span><span class="p">(),</span>
<a id="__codelineno-0-194" name="__codelineno-0-194"></a>                <span class="s2">&quot;last_request&quot;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(),</span>
<a id="__codelineno-0-195" name="__codelineno-0-195"></a>            <span class="p">}</span>
<a id="__codelineno-0-196" name="__codelineno-0-196"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">trees</span><span class="p">[</span><span class="n">conversation_id</span><span class="p">][</span><span class="s2">&quot;tree&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tree</span>
<a id="__codelineno-0-197" name="__codelineno-0-197"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">trees</span><span class="p">[</span><span class="n">conversation_id</span><span class="p">][</span><span class="s2">&quot;event&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>
<a id="__codelineno-0-198" name="__codelineno-0-198"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">update_tree_last_request</span><span class="p">(</span><span class="n">conversation_id</span><span class="p">)</span>
<a id="__codelineno-0-199" name="__codelineno-0-199"></a>        <span class="k">return</span> <span class="n">tree</span><span class="o">.</span><span class="n">returner</span><span class="o">.</span><span class="n">store</span>
<a id="__codelineno-0-200" name="__codelineno-0-200"></a>
<a id="__codelineno-0-201" name="__codelineno-0-201"></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">delete_tree_weaviate</span><span class="p">(</span>
<a id="__codelineno-0-202" name="__codelineno-0-202"></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">conversation_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">client_manager</span><span class="p">:</span> <span class="n">ClientManager</span>
<a id="__codelineno-0-203" name="__codelineno-0-203"></a>    <span class="p">):</span>
<a id="__codelineno-0-204" name="__codelineno-0-204"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-205" name="__codelineno-0-205"></a><span class="sd">        Delete a tree from the stored trees in Weaviate.</span>
<a id="__codelineno-0-206" name="__codelineno-0-206"></a>
<a id="__codelineno-0-207" name="__codelineno-0-207"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-208" name="__codelineno-0-208"></a><span class="sd">            conversation_id (str): The conversation ID of the tree to be deleted.</span>
<a id="__codelineno-0-209" name="__codelineno-0-209"></a><span class="sd">            client_manager (ClientManager): The client manager pointing to the Weaviate instance containing the tree.</span>
<a id="__codelineno-0-210" name="__codelineno-0-210"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-211" name="__codelineno-0-211"></a>        <span class="k">await</span> <span class="n">delete_tree_from_weaviate</span><span class="p">(</span>
<a id="__codelineno-0-212" name="__codelineno-0-212"></a>            <span class="n">conversation_id</span><span class="p">,</span> <span class="s2">&quot;ELYSIA_TREES__&quot;</span><span class="p">,</span> <span class="n">client_manager</span>
<a id="__codelineno-0-213" name="__codelineno-0-213"></a>        <span class="p">)</span>
<a id="__codelineno-0-214" name="__codelineno-0-214"></a>
<a id="__codelineno-0-215" name="__codelineno-0-215"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">delete_tree_local</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">conversation_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-0-216" name="__codelineno-0-216"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-217" name="__codelineno-0-217"></a><span class="sd">        Delete a tree from the TreeManager.</span>
<a id="__codelineno-0-218" name="__codelineno-0-218"></a>
<a id="__codelineno-0-219" name="__codelineno-0-219"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-220" name="__codelineno-0-220"></a><span class="sd">            conversation_id (str): The conversation ID of the tree to be deleted.</span>
<a id="__codelineno-0-221" name="__codelineno-0-221"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-222" name="__codelineno-0-222"></a>        <span class="k">if</span> <span class="n">conversation_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">trees</span><span class="p">:</span>
<a id="__codelineno-0-223" name="__codelineno-0-223"></a>            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">trees</span><span class="p">[</span><span class="n">conversation_id</span><span class="p">]</span>
<a id="__codelineno-0-224" name="__codelineno-0-224"></a>
<a id="__codelineno-0-225" name="__codelineno-0-225"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">tree_exists</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">conversation_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-0-226" name="__codelineno-0-226"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-227" name="__codelineno-0-227"></a><span class="sd">        Check if a tree exists in the TreeManager.</span>
<a id="__codelineno-0-228" name="__codelineno-0-228"></a>
<a id="__codelineno-0-229" name="__codelineno-0-229"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-230" name="__codelineno-0-230"></a><span class="sd">            conversation_id (str): The conversation ID which may contain the tree.</span>
<a id="__codelineno-0-231" name="__codelineno-0-231"></a>
<a id="__codelineno-0-232" name="__codelineno-0-232"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-233" name="__codelineno-0-233"></a><span class="sd">            (bool): True if the tree exists, False otherwise.</span>
<a id="__codelineno-0-234" name="__codelineno-0-234"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-235" name="__codelineno-0-235"></a>        <span class="k">return</span> <span class="n">conversation_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">trees</span>
<a id="__codelineno-0-236" name="__codelineno-0-236"></a>
<a id="__codelineno-0-237" name="__codelineno-0-237"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_tree</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">conversation_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-0-238" name="__codelineno-0-238"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-239" name="__codelineno-0-239"></a><span class="sd">        Get a tree from the TreeManager.</span>
<a id="__codelineno-0-240" name="__codelineno-0-240"></a><span class="sd">        Will raise a ValueError if the tree is not found.</span>
<a id="__codelineno-0-241" name="__codelineno-0-241"></a>
<a id="__codelineno-0-242" name="__codelineno-0-242"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-243" name="__codelineno-0-243"></a><span class="sd">            conversation_id (str): The conversation ID which contains the tree.</span>
<a id="__codelineno-0-244" name="__codelineno-0-244"></a>
<a id="__codelineno-0-245" name="__codelineno-0-245"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-246" name="__codelineno-0-246"></a><span class="sd">            (Tree): The tree associated with the conversation ID.</span>
<a id="__codelineno-0-247" name="__codelineno-0-247"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-248" name="__codelineno-0-248"></a>        <span class="k">if</span> <span class="n">conversation_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">trees</span><span class="p">:</span>
<a id="__codelineno-0-249" name="__codelineno-0-249"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<a id="__codelineno-0-250" name="__codelineno-0-250"></a>                <span class="sa">f</span><span class="s2">&quot;Tree </span><span class="si">{</span><span class="n">conversation_id</span><span class="si">}</span><span class="s2"> not found. Please initialise a tree first (by calling `add_tree`).&quot;</span>
<a id="__codelineno-0-251" name="__codelineno-0-251"></a>            <span class="p">)</span>
<a id="__codelineno-0-252" name="__codelineno-0-252"></a>
<a id="__codelineno-0-253" name="__codelineno-0-253"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">trees</span><span class="p">[</span><span class="n">conversation_id</span><span class="p">][</span><span class="s2">&quot;tree&quot;</span><span class="p">]</span>
<a id="__codelineno-0-254" name="__codelineno-0-254"></a>
<a id="__codelineno-0-255" name="__codelineno-0-255"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">conversation_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-0-256" name="__codelineno-0-256"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-257" name="__codelineno-0-257"></a><span class="sd">        Get the asyncio.Event for a tree in the TreeManager.</span>
<a id="__codelineno-0-258" name="__codelineno-0-258"></a><span class="sd">        This is cleared when the tree is processing, and set when the tree is idle.</span>
<a id="__codelineno-0-259" name="__codelineno-0-259"></a><span class="sd">        This is used to block the API from sending multiple requests to the tree at once.</span>
<a id="__codelineno-0-260" name="__codelineno-0-260"></a>
<a id="__codelineno-0-261" name="__codelineno-0-261"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-262" name="__codelineno-0-262"></a><span class="sd">            conversation_id (str): The conversation ID which contains the tree.</span>
<a id="__codelineno-0-263" name="__codelineno-0-263"></a>
<a id="__codelineno-0-264" name="__codelineno-0-264"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-265" name="__codelineno-0-265"></a><span class="sd">            (asyncio.Event): The event for the tree.</span>
<a id="__codelineno-0-266" name="__codelineno-0-266"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-267" name="__codelineno-0-267"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">trees</span><span class="p">[</span><span class="n">conversation_id</span><span class="p">][</span><span class="s2">&quot;event&quot;</span><span class="p">]</span>
<a id="__codelineno-0-268" name="__codelineno-0-268"></a>
<a id="__codelineno-0-269" name="__codelineno-0-269"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">configure</span><span class="p">(</span>
<a id="__codelineno-0-270" name="__codelineno-0-270"></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">conversation_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">replace</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span>
<a id="__codelineno-0-271" name="__codelineno-0-271"></a>    <span class="p">):</span>
<a id="__codelineno-0-272" name="__codelineno-0-272"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-273" name="__codelineno-0-273"></a><span class="sd">        Configure the settings for a tree in the TreeManager.</span>
<a id="__codelineno-0-274" name="__codelineno-0-274"></a>
<a id="__codelineno-0-275" name="__codelineno-0-275"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-276" name="__codelineno-0-276"></a><span class="sd">            conversation_id (str | None): The conversation ID which contains the tree.</span>
<a id="__codelineno-0-277" name="__codelineno-0-277"></a><span class="sd">            replace (bool): Whether to override the current settings with the new settings.</span>
<a id="__codelineno-0-278" name="__codelineno-0-278"></a><span class="sd">                When this is True, all existing settings are removed, and only the new settings are used.</span>
<a id="__codelineno-0-279" name="__codelineno-0-279"></a><span class="sd">                Defaults to False.</span>
<a id="__codelineno-0-280" name="__codelineno-0-280"></a><span class="sd">            **kwargs (Any): The keyword arguments to pass to the Settings.configure() method.</span>
<a id="__codelineno-0-281" name="__codelineno-0-281"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-282" name="__codelineno-0-282"></a>        <span class="k">if</span> <span class="n">conversation_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-283" name="__codelineno-0-283"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">replace</span><span class="o">=</span><span class="n">replace</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<a id="__codelineno-0-284" name="__codelineno-0-284"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">settings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span>
<a id="__codelineno-0-285" name="__codelineno-0-285"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-286" name="__codelineno-0-286"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">get_tree</span><span class="p">(</span><span class="n">conversation_id</span><span class="p">)</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">replace</span><span class="o">=</span><span class="n">replace</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<a id="__codelineno-0-287" name="__codelineno-0-287"></a>
<a id="__codelineno-0-288" name="__codelineno-0-288"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">change_style</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">style</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">conversation_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-0-289" name="__codelineno-0-289"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-290" name="__codelineno-0-290"></a><span class="sd">        Change the style for a tree in the TreeManager.</span>
<a id="__codelineno-0-291" name="__codelineno-0-291"></a><span class="sd">        Or change the global style for all trees (if conversation_id is not supplied).</span>
<a id="__codelineno-0-292" name="__codelineno-0-292"></a><span class="sd">        And applies these changes to current trees with default settings.</span>
<a id="__codelineno-0-293" name="__codelineno-0-293"></a>
<a id="__codelineno-0-294" name="__codelineno-0-294"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-295" name="__codelineno-0-295"></a><span class="sd">            style (str): The new style for the tree.</span>
<a id="__codelineno-0-296" name="__codelineno-0-296"></a><span class="sd">            conversation_id (str | None): Optional. The conversation ID which contains the tree.</span>
<a id="__codelineno-0-297" name="__codelineno-0-297"></a><span class="sd">                If not supplied, the style will be changed on all trees.</span>
<a id="__codelineno-0-298" name="__codelineno-0-298"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-299" name="__codelineno-0-299"></a>        <span class="k">if</span> <span class="n">conversation_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-300" name="__codelineno-0-300"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">style</span> <span class="o">=</span> <span class="n">style</span>
<a id="__codelineno-0-301" name="__codelineno-0-301"></a>            <span class="k">for</span> <span class="n">conversation_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">trees</span><span class="p">:</span>
<a id="__codelineno-0-302" name="__codelineno-0-302"></a>                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">trees</span><span class="p">[</span><span class="n">conversation_id</span><span class="p">][</span><span class="s2">&quot;tree&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">_config_modified</span><span class="p">:</span>
<a id="__codelineno-0-303" name="__codelineno-0-303"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">trees</span><span class="p">[</span><span class="n">conversation_id</span><span class="p">][</span><span class="s2">&quot;tree&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">change_style</span><span class="p">(</span><span class="n">style</span><span class="p">)</span>
<a id="__codelineno-0-304" name="__codelineno-0-304"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">trees</span><span class="p">[</span><span class="n">conversation_id</span><span class="p">][</span><span class="s2">&quot;tree&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">_config_modified</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-305" name="__codelineno-0-305"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-306" name="__codelineno-0-306"></a>            <span class="k">if</span> <span class="n">conversation_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">trees</span><span class="p">:</span>
<a id="__codelineno-0-307" name="__codelineno-0-307"></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Tree </span><span class="si">{</span><span class="n">conversation_id</span><span class="si">}</span><span class="s2"> not found&quot;</span><span class="p">)</span>
<a id="__codelineno-0-308" name="__codelineno-0-308"></a>
<a id="__codelineno-0-309" name="__codelineno-0-309"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">trees</span><span class="p">[</span><span class="n">conversation_id</span><span class="p">][</span><span class="s2">&quot;tree&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">change_style</span><span class="p">(</span><span class="n">style</span><span class="p">)</span>
<a id="__codelineno-0-310" name="__codelineno-0-310"></a>
<a id="__codelineno-0-311" name="__codelineno-0-311"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">change_agent_description</span><span class="p">(</span>
<a id="__codelineno-0-312" name="__codelineno-0-312"></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">agent_description</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">conversation_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-313" name="__codelineno-0-313"></a>    <span class="p">):</span>
<a id="__codelineno-0-314" name="__codelineno-0-314"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-315" name="__codelineno-0-315"></a><span class="sd">        Change the agent description for a tree in the TreeManager.</span>
<a id="__codelineno-0-316" name="__codelineno-0-316"></a><span class="sd">        Or change the global agent description for all trees (if conversation_id is not supplied).</span>
<a id="__codelineno-0-317" name="__codelineno-0-317"></a><span class="sd">        And applies these changes to current trees with default settings.</span>
<a id="__codelineno-0-318" name="__codelineno-0-318"></a>
<a id="__codelineno-0-319" name="__codelineno-0-319"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-320" name="__codelineno-0-320"></a><span class="sd">            agent_description (str): The new agent description for the tree.</span>
<a id="__codelineno-0-321" name="__codelineno-0-321"></a><span class="sd">            conversation_id (str | None): Optional. The conversation ID which contains the tree.</span>
<a id="__codelineno-0-322" name="__codelineno-0-322"></a><span class="sd">                If not supplied, the agent description will be changed on all trees.</span>
<a id="__codelineno-0-323" name="__codelineno-0-323"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-324" name="__codelineno-0-324"></a>        <span class="k">if</span> <span class="n">conversation_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-325" name="__codelineno-0-325"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">agent_description</span> <span class="o">=</span> <span class="n">agent_description</span>
<a id="__codelineno-0-326" name="__codelineno-0-326"></a>            <span class="k">for</span> <span class="n">conversation_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">trees</span><span class="p">:</span>
<a id="__codelineno-0-327" name="__codelineno-0-327"></a>                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">trees</span><span class="p">[</span><span class="n">conversation_id</span><span class="p">][</span><span class="s2">&quot;tree&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">_config_modified</span><span class="p">:</span>
<a id="__codelineno-0-328" name="__codelineno-0-328"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">trees</span><span class="p">[</span><span class="n">conversation_id</span><span class="p">][</span><span class="s2">&quot;tree&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">change_agent_description</span><span class="p">(</span>
<a id="__codelineno-0-329" name="__codelineno-0-329"></a>                        <span class="n">agent_description</span>
<a id="__codelineno-0-330" name="__codelineno-0-330"></a>                    <span class="p">)</span>
<a id="__codelineno-0-331" name="__codelineno-0-331"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">trees</span><span class="p">[</span><span class="n">conversation_id</span><span class="p">][</span><span class="s2">&quot;tree&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">_config_modified</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-332" name="__codelineno-0-332"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-333" name="__codelineno-0-333"></a>            <span class="k">if</span> <span class="n">conversation_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">trees</span><span class="p">:</span>
<a id="__codelineno-0-334" name="__codelineno-0-334"></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Tree </span><span class="si">{</span><span class="n">conversation_id</span><span class="si">}</span><span class="s2"> not found&quot;</span><span class="p">)</span>
<a id="__codelineno-0-335" name="__codelineno-0-335"></a>
<a id="__codelineno-0-336" name="__codelineno-0-336"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">trees</span><span class="p">[</span><span class="n">conversation_id</span><span class="p">][</span><span class="s2">&quot;tree&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">change_agent_description</span><span class="p">(</span>
<a id="__codelineno-0-337" name="__codelineno-0-337"></a>                <span class="n">agent_description</span>
<a id="__codelineno-0-338" name="__codelineno-0-338"></a>            <span class="p">)</span>
<a id="__codelineno-0-339" name="__codelineno-0-339"></a>
<a id="__codelineno-0-340" name="__codelineno-0-340"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">change_end_goal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">end_goal</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">conversation_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-0-341" name="__codelineno-0-341"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-342" name="__codelineno-0-342"></a><span class="sd">        Change the end goal for a tree in the TreeManager.</span>
<a id="__codelineno-0-343" name="__codelineno-0-343"></a><span class="sd">        Or change the global end goal for all trees (if conversation_id is not supplied).</span>
<a id="__codelineno-0-344" name="__codelineno-0-344"></a><span class="sd">        And applies these changes to current trees with default settings.</span>
<a id="__codelineno-0-345" name="__codelineno-0-345"></a>
<a id="__codelineno-0-346" name="__codelineno-0-346"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-347" name="__codelineno-0-347"></a><span class="sd">            end_goal (str): The new end goal for the tree.</span>
<a id="__codelineno-0-348" name="__codelineno-0-348"></a><span class="sd">            conversation_id (str | None): Optional. The conversation ID which contains the tree.</span>
<a id="__codelineno-0-349" name="__codelineno-0-349"></a><span class="sd">                If not supplied, the end goal will be changed on all trees.</span>
<a id="__codelineno-0-350" name="__codelineno-0-350"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-351" name="__codelineno-0-351"></a>        <span class="k">if</span> <span class="n">conversation_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-352" name="__codelineno-0-352"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">end_goal</span> <span class="o">=</span> <span class="n">end_goal</span>
<a id="__codelineno-0-353" name="__codelineno-0-353"></a>            <span class="k">for</span> <span class="n">conversation_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">trees</span><span class="p">:</span>
<a id="__codelineno-0-354" name="__codelineno-0-354"></a>                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">trees</span><span class="p">[</span><span class="n">conversation_id</span><span class="p">][</span><span class="s2">&quot;tree&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">_config_modified</span><span class="p">:</span>
<a id="__codelineno-0-355" name="__codelineno-0-355"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">trees</span><span class="p">[</span><span class="n">conversation_id</span><span class="p">][</span><span class="s2">&quot;tree&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">change_end_goal</span><span class="p">(</span><span class="n">end_goal</span><span class="p">)</span>
<a id="__codelineno-0-356" name="__codelineno-0-356"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">trees</span><span class="p">[</span><span class="n">conversation_id</span><span class="p">][</span><span class="s2">&quot;tree&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">_config_modified</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-357" name="__codelineno-0-357"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-358" name="__codelineno-0-358"></a>            <span class="k">if</span> <span class="n">conversation_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">trees</span><span class="p">:</span>
<a id="__codelineno-0-359" name="__codelineno-0-359"></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Tree </span><span class="si">{</span><span class="n">conversation_id</span><span class="si">}</span><span class="s2"> not found&quot;</span><span class="p">)</span>
<a id="__codelineno-0-360" name="__codelineno-0-360"></a>
<a id="__codelineno-0-361" name="__codelineno-0-361"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">trees</span><span class="p">[</span><span class="n">conversation_id</span><span class="p">][</span><span class="s2">&quot;tree&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">change_end_goal</span><span class="p">(</span><span class="n">end_goal</span><span class="p">)</span>
<a id="__codelineno-0-362" name="__codelineno-0-362"></a>
<a id="__codelineno-0-363" name="__codelineno-0-363"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">change_branch_initialisation</span><span class="p">(</span>
<a id="__codelineno-0-364" name="__codelineno-0-364"></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">branch_initialisation</span><span class="p">:</span> <span class="n">BranchInitType</span><span class="p">,</span> <span class="n">conversation_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-365" name="__codelineno-0-365"></a>    <span class="p">):</span>
<a id="__codelineno-0-366" name="__codelineno-0-366"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-367" name="__codelineno-0-367"></a><span class="sd">        Change the branch initialisation for a tree in the TreeManager.</span>
<a id="__codelineno-0-368" name="__codelineno-0-368"></a><span class="sd">        Or change the global branch initialisation for all trees (if conversation_id is not supplied).</span>
<a id="__codelineno-0-369" name="__codelineno-0-369"></a><span class="sd">        And applies these changes to current trees with default settings.</span>
<a id="__codelineno-0-370" name="__codelineno-0-370"></a>
<a id="__codelineno-0-371" name="__codelineno-0-371"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-372" name="__codelineno-0-372"></a><span class="sd">            branch_initialisation (str): The new branch initialisation for the tree.</span>
<a id="__codelineno-0-373" name="__codelineno-0-373"></a><span class="sd">            conversation_id (str | None): Optional. The conversation ID which contains the tree.</span>
<a id="__codelineno-0-374" name="__codelineno-0-374"></a><span class="sd">                If not supplied, the branch initialisation will be changed on all trees.</span>
<a id="__codelineno-0-375" name="__codelineno-0-375"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-376" name="__codelineno-0-376"></a>        <span class="k">if</span> <span class="n">conversation_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-377" name="__codelineno-0-377"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">branch_initialisation</span> <span class="o">=</span> <span class="n">branch_initialisation</span>
<a id="__codelineno-0-378" name="__codelineno-0-378"></a>            <span class="k">for</span> <span class="n">conversation_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">trees</span><span class="p">:</span>
<a id="__codelineno-0-379" name="__codelineno-0-379"></a>                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">trees</span><span class="p">[</span><span class="n">conversation_id</span><span class="p">][</span><span class="s2">&quot;tree&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">_config_modified</span><span class="p">:</span>
<a id="__codelineno-0-380" name="__codelineno-0-380"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">trees</span><span class="p">[</span><span class="n">conversation_id</span><span class="p">][</span><span class="s2">&quot;tree&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">set_branch_initialisation</span><span class="p">(</span>
<a id="__codelineno-0-381" name="__codelineno-0-381"></a>                        <span class="n">branch_initialisation</span>
<a id="__codelineno-0-382" name="__codelineno-0-382"></a>                    <span class="p">)</span>
<a id="__codelineno-0-383" name="__codelineno-0-383"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">trees</span><span class="p">[</span><span class="n">conversation_id</span><span class="p">][</span><span class="s2">&quot;tree&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">_config_modified</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-384" name="__codelineno-0-384"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-385" name="__codelineno-0-385"></a>            <span class="k">if</span> <span class="n">conversation_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">trees</span><span class="p">:</span>
<a id="__codelineno-0-386" name="__codelineno-0-386"></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Tree </span><span class="si">{</span><span class="n">conversation_id</span><span class="si">}</span><span class="s2"> not found&quot;</span><span class="p">)</span>
<a id="__codelineno-0-387" name="__codelineno-0-387"></a>
<a id="__codelineno-0-388" name="__codelineno-0-388"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">trees</span><span class="p">[</span><span class="n">conversation_id</span><span class="p">][</span><span class="s2">&quot;tree&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">set_branch_initialisation</span><span class="p">(</span>
<a id="__codelineno-0-389" name="__codelineno-0-389"></a>                <span class="n">branch_initialisation</span>
<a id="__codelineno-0-390" name="__codelineno-0-390"></a>            <span class="p">)</span>
<a id="__codelineno-0-391" name="__codelineno-0-391"></a>
<a id="__codelineno-0-392" name="__codelineno-0-392"></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">process_tree</span><span class="p">(</span>
<a id="__codelineno-0-393" name="__codelineno-0-393"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-394" name="__codelineno-0-394"></a>        <span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-395" name="__codelineno-0-395"></a>        <span class="n">conversation_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-396" name="__codelineno-0-396"></a>        <span class="n">query_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-397" name="__codelineno-0-397"></a>        <span class="n">training_route</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
<a id="__codelineno-0-398" name="__codelineno-0-398"></a>        <span class="n">collection_names</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[],</span>
<a id="__codelineno-0-399" name="__codelineno-0-399"></a>        <span class="n">client_manager</span><span class="p">:</span> <span class="n">ClientManager</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-400" name="__codelineno-0-400"></a>    <span class="p">):</span>
<a id="__codelineno-0-401" name="__codelineno-0-401"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-402" name="__codelineno-0-402"></a><span class="sd">        Process a tree in the TreeManager.</span>
<a id="__codelineno-0-403" name="__codelineno-0-403"></a><span class="sd">        This is an async generator which yields results from the tree.async_run() method.</span>
<a id="__codelineno-0-404" name="__codelineno-0-404"></a>
<a id="__codelineno-0-405" name="__codelineno-0-405"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-406" name="__codelineno-0-406"></a><span class="sd">            query (str): Required. The user input/prompt to process in the decision tree.</span>
<a id="__codelineno-0-407" name="__codelineno-0-407"></a><span class="sd">            conversation_id (str): Required. The conversation ID which contains the tree.</span>
<a id="__codelineno-0-408" name="__codelineno-0-408"></a><span class="sd">            query_id (str): Optional. A unique identifier for the query.</span>
<a id="__codelineno-0-409" name="__codelineno-0-409"></a><span class="sd">                If not supplied, a random UUID will be generated.</span>
<a id="__codelineno-0-410" name="__codelineno-0-410"></a><span class="sd">            training_route (str): Optional. The training route, a string of the form &quot;tool1/tool2/tool1&quot; etc.</span>
<a id="__codelineno-0-411" name="__codelineno-0-411"></a><span class="sd">                See the `tree.async_run()` method for more details.</span>
<a id="__codelineno-0-412" name="__codelineno-0-412"></a><span class="sd">            collection_names (list[str]): Optional. A list of collection names to use in the query.</span>
<a id="__codelineno-0-413" name="__codelineno-0-413"></a><span class="sd">                If not supplied, all collections will be used.</span>
<a id="__codelineno-0-414" name="__codelineno-0-414"></a><span class="sd">            client_manager (ClientManager | None): Optional. A client manager to use for the query.</span>
<a id="__codelineno-0-415" name="__codelineno-0-415"></a><span class="sd">                If not supplied, a new ClientManager will be created.</span>
<a id="__codelineno-0-416" name="__codelineno-0-416"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-417" name="__codelineno-0-417"></a>
<a id="__codelineno-0-418" name="__codelineno-0-418"></a>        <span class="k">if</span> <span class="n">query_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-419" name="__codelineno-0-419"></a>            <span class="n">query_id</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">())</span>
<a id="__codelineno-0-420" name="__codelineno-0-420"></a>
<a id="__codelineno-0-421" name="__codelineno-0-421"></a>        <span class="n">tree</span><span class="p">:</span> <span class="n">Tree</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_tree</span><span class="p">(</span><span class="n">conversation_id</span><span class="p">)</span>
<a id="__codelineno-0-422" name="__codelineno-0-422"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">update_tree_last_request</span><span class="p">(</span><span class="n">conversation_id</span><span class="p">)</span>
<a id="__codelineno-0-423" name="__codelineno-0-423"></a>
<a id="__codelineno-0-424" name="__codelineno-0-424"></a>        <span class="c1"># wait for the tree to be idle</span>
<a id="__codelineno-0-425" name="__codelineno-0-425"></a>        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">trees</span><span class="p">[</span><span class="n">conversation_id</span><span class="p">][</span><span class="s2">&quot;event&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>
<a id="__codelineno-0-426" name="__codelineno-0-426"></a>
<a id="__codelineno-0-427" name="__codelineno-0-427"></a>        <span class="c1"># clear the event, set it to working</span>
<a id="__codelineno-0-428" name="__codelineno-0-428"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">trees</span><span class="p">[</span><span class="n">conversation_id</span><span class="p">][</span><span class="s2">&quot;event&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
<a id="__codelineno-0-429" name="__codelineno-0-429"></a>
<a id="__codelineno-0-430" name="__codelineno-0-430"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-431" name="__codelineno-0-431"></a>            <span class="k">async</span> <span class="k">for</span> <span class="n">yielded_result</span> <span class="ow">in</span> <span class="n">tree</span><span class="o">.</span><span class="n">async_run</span><span class="p">(</span>
<a id="__codelineno-0-432" name="__codelineno-0-432"></a>                <span class="n">query</span><span class="p">,</span>
<a id="__codelineno-0-433" name="__codelineno-0-433"></a>                <span class="n">collection_names</span><span class="o">=</span><span class="n">collection_names</span><span class="p">,</span>
<a id="__codelineno-0-434" name="__codelineno-0-434"></a>                <span class="n">client_manager</span><span class="o">=</span><span class="n">client_manager</span><span class="p">,</span>
<a id="__codelineno-0-435" name="__codelineno-0-435"></a>                <span class="n">query_id</span><span class="o">=</span><span class="n">query_id</span><span class="p">,</span>
<a id="__codelineno-0-436" name="__codelineno-0-436"></a>                <span class="n">training_route</span><span class="o">=</span><span class="n">training_route</span><span class="p">,</span>
<a id="__codelineno-0-437" name="__codelineno-0-437"></a>                <span class="n">close_clients_after_completion</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-438" name="__codelineno-0-438"></a>            <span class="p">):</span>
<a id="__codelineno-0-439" name="__codelineno-0-439"></a>                <span class="k">yield</span> <span class="n">yielded_result</span>
<a id="__codelineno-0-440" name="__codelineno-0-440"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">update_tree_last_request</span><span class="p">(</span><span class="n">conversation_id</span><span class="p">)</span>
<a id="__codelineno-0-441" name="__codelineno-0-441"></a>
<a id="__codelineno-0-442" name="__codelineno-0-442"></a>        <span class="k">finally</span><span class="p">:</span>
<a id="__codelineno-0-443" name="__codelineno-0-443"></a>            <span class="c1"># set the event to idle</span>
<a id="__codelineno-0-444" name="__codelineno-0-444"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">trees</span><span class="p">[</span><span class="n">conversation_id</span><span class="p">][</span><span class="s2">&quot;event&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>
<a id="__codelineno-0-445" name="__codelineno-0-445"></a>
<a id="__codelineno-0-446" name="__codelineno-0-446"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">check_tree_timeout</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">conversation_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-0-447" name="__codelineno-0-447"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-448" name="__codelineno-0-448"></a><span class="sd">        Check if a tree has been idle for the last tree_timeout.</span>
<a id="__codelineno-0-449" name="__codelineno-0-449"></a>
<a id="__codelineno-0-450" name="__codelineno-0-450"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-451" name="__codelineno-0-451"></a><span class="sd">            conversation_id (str): The conversation ID which contains the tree.</span>
<a id="__codelineno-0-452" name="__codelineno-0-452"></a>
<a id="__codelineno-0-453" name="__codelineno-0-453"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-454" name="__codelineno-0-454"></a><span class="sd">            (bool): True if the tree has been idle for the last tree_timeout, False otherwise.</span>
<a id="__codelineno-0-455" name="__codelineno-0-455"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-456" name="__codelineno-0-456"></a>        <span class="c1"># if tree not found, return True</span>
<a id="__codelineno-0-457" name="__codelineno-0-457"></a>        <span class="k">if</span> <span class="n">conversation_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">trees</span><span class="p">:</span>
<a id="__codelineno-0-458" name="__codelineno-0-458"></a>            <span class="k">return</span> <span class="kc">True</span>
<a id="__codelineno-0-459" name="__codelineno-0-459"></a>
<a id="__codelineno-0-460" name="__codelineno-0-460"></a>        <span class="c1"># Remove any trees that have not been active in the last TREE_TIMEOUT minutes</span>
<a id="__codelineno-0-461" name="__codelineno-0-461"></a>        <span class="k">if</span> <span class="p">(</span>
<a id="__codelineno-0-462" name="__codelineno-0-462"></a>            <span class="s2">&quot;last_request&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">trees</span><span class="p">[</span><span class="n">conversation_id</span><span class="p">]</span>
<a id="__codelineno-0-463" name="__codelineno-0-463"></a>            <span class="ow">and</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">trees</span><span class="p">[</span><span class="n">conversation_id</span><span class="p">][</span><span class="s2">&quot;last_request&quot;</span><span class="p">]</span>
<a id="__codelineno-0-464" name="__codelineno-0-464"></a>            <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">tree_timeout</span>
<a id="__codelineno-0-465" name="__codelineno-0-465"></a>        <span class="p">):</span>
<a id="__codelineno-0-466" name="__codelineno-0-466"></a>            <span class="k">return</span> <span class="kc">True</span>
<a id="__codelineno-0-467" name="__codelineno-0-467"></a>
<a id="__codelineno-0-468" name="__codelineno-0-468"></a>        <span class="k">return</span> <span class="kc">False</span>
<a id="__codelineno-0-469" name="__codelineno-0-469"></a>
<a id="__codelineno-0-470" name="__codelineno-0-470"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">update_tree_last_request</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">conversation_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-0-471" name="__codelineno-0-471"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">trees</span><span class="p">[</span><span class="n">conversation_id</span><span class="p">][</span><span class="s2">&quot;last_request&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
<a id="__codelineno-0-472" name="__codelineno-0-472"></a>
<a id="__codelineno-0-473" name="__codelineno-0-473"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">check_all_trees_timeout</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-474" name="__codelineno-0-474"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-475" name="__codelineno-0-475"></a><span class="sd">        Check all trees in the TreeManager and remove any that have not been active in the last tree_timeout.</span>
<a id="__codelineno-0-476" name="__codelineno-0-476"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-477" name="__codelineno-0-477"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tree_timeout</span> <span class="o">==</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">minutes</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
<a id="__codelineno-0-478" name="__codelineno-0-478"></a>            <span class="k">return</span>
<a id="__codelineno-0-479" name="__codelineno-0-479"></a>
<a id="__codelineno-0-480" name="__codelineno-0-480"></a>        <span class="n">convs_to_remove</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-481" name="__codelineno-0-481"></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">conversation_id</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">trees</span><span class="p">):</span>
<a id="__codelineno-0-482" name="__codelineno-0-482"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_tree_timeout</span><span class="p">(</span><span class="n">conversation_id</span><span class="p">):</span>
<a id="__codelineno-0-483" name="__codelineno-0-483"></a>                <span class="n">convs_to_remove</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">conversation_id</span><span class="p">)</span>
<a id="__codelineno-0-484" name="__codelineno-0-484"></a>
<a id="__codelineno-0-485" name="__codelineno-0-485"></a>        <span class="k">for</span> <span class="n">conversation_id</span> <span class="ow">in</span> <span class="n">convs_to_remove</span><span class="p">:</span>
<a id="__codelineno-0-486" name="__codelineno-0-486"></a>            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">trees</span><span class="p">[</span><span class="n">conversation_id</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="elysia.api.services.tree.TreeManager.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">user_id</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">tree_timeout</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">



<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>user_id</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Required. A unique identifier for the user being managed within this TreeManager.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>config</code>
            </td>
            <td>
                  <code><span title="elysia.api.utils.config.Config">Config</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional. A config for all trees managed by this TreeManager.
Defaults to a new config with default settings.
If <code>settings</code> is not provided, it will be set to the default settings (smart_setup).</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>tree_timeout</code>
            </td>
            <td>
                  <code><span title="datetime.timedelta">timedelta</span> | <span title="int">int</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional. A timeout for all trees managed by this TreeManager.
Defaults to the value of the <code>TREE_TIMEOUT</code> environment variable.
If an integer is passed, it will be interpreted as minutes.
If set to 0, trees will not be automatically removed.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>elysia/api/services/tree.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-30">30</a></span>
<span class="normal"><a href="#__codelineno-0-31">31</a></span>
<span class="normal"><a href="#__codelineno-0-32">32</a></span>
<span class="normal"><a href="#__codelineno-0-33">33</a></span>
<span class="normal"><a href="#__codelineno-0-34">34</a></span>
<span class="normal"><a href="#__codelineno-0-35">35</a></span>
<span class="normal"><a href="#__codelineno-0-36">36</a></span>
<span class="normal"><a href="#__codelineno-0-37">37</a></span>
<span class="normal"><a href="#__codelineno-0-38">38</a></span>
<span class="normal"><a href="#__codelineno-0-39">39</a></span>
<span class="normal"><a href="#__codelineno-0-40">40</a></span>
<span class="normal"><a href="#__codelineno-0-41">41</a></span>
<span class="normal"><a href="#__codelineno-0-42">42</a></span>
<span class="normal"><a href="#__codelineno-0-43">43</a></span>
<span class="normal"><a href="#__codelineno-0-44">44</a></span>
<span class="normal"><a href="#__codelineno-0-45">45</a></span>
<span class="normal"><a href="#__codelineno-0-46">46</a></span>
<span class="normal"><a href="#__codelineno-0-47">47</a></span>
<span class="normal"><a href="#__codelineno-0-48">48</a></span>
<span class="normal"><a href="#__codelineno-0-49">49</a></span>
<span class="normal"><a href="#__codelineno-0-50">50</a></span>
<span class="normal"><a href="#__codelineno-0-51">51</a></span>
<span class="normal"><a href="#__codelineno-0-52">52</a></span>
<span class="normal"><a href="#__codelineno-0-53">53</a></span>
<span class="normal"><a href="#__codelineno-0-54">54</a></span>
<span class="normal"><a href="#__codelineno-0-55">55</a></span>
<span class="normal"><a href="#__codelineno-0-56">56</a></span>
<span class="normal"><a href="#__codelineno-0-57">57</a></span>
<span class="normal"><a href="#__codelineno-0-58">58</a></span>
<span class="normal"><a href="#__codelineno-0-59">59</a></span>
<span class="normal"><a href="#__codelineno-0-60">60</a></span>
<span class="normal"><a href="#__codelineno-0-61">61</a></span>
<span class="normal"><a href="#__codelineno-0-62">62</a></span>
<span class="normal"><a href="#__codelineno-0-63">63</a></span>
<span class="normal"><a href="#__codelineno-0-64">64</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-30" name="__codelineno-0-30"></a><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
<a id="__codelineno-0-31" name="__codelineno-0-31"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-32" name="__codelineno-0-32"></a>    <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-33" name="__codelineno-0-33"></a>    <span class="n">config</span><span class="p">:</span> <span class="n">Config</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-34" name="__codelineno-0-34"></a>    <span class="n">tree_timeout</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-35" name="__codelineno-0-35"></a><span class="p">):</span>
<a id="__codelineno-0-36" name="__codelineno-0-36"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-37" name="__codelineno-0-37"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-38" name="__codelineno-0-38"></a><span class="sd">        user_id (str): Required. A unique identifier for the user being managed within this TreeManager.</span>
<a id="__codelineno-0-39" name="__codelineno-0-39"></a><span class="sd">        config (Config | None): Optional. A config for all trees managed by this TreeManager.</span>
<a id="__codelineno-0-40" name="__codelineno-0-40"></a><span class="sd">            Defaults to a new config with default settings.</span>
<a id="__codelineno-0-41" name="__codelineno-0-41"></a><span class="sd">            If `settings` is not provided, it will be set to the default settings (smart_setup).</span>
<a id="__codelineno-0-42" name="__codelineno-0-42"></a><span class="sd">        tree_timeout (datetime.timedelta | int | None): Optional. A timeout for all trees managed by this TreeManager.</span>
<a id="__codelineno-0-43" name="__codelineno-0-43"></a><span class="sd">            Defaults to the value of the `TREE_TIMEOUT` environment variable.</span>
<a id="__codelineno-0-44" name="__codelineno-0-44"></a><span class="sd">            If an integer is passed, it will be interpreted as minutes.</span>
<a id="__codelineno-0-45" name="__codelineno-0-45"></a><span class="sd">            If set to 0, trees will not be automatically removed.</span>
<a id="__codelineno-0-46" name="__codelineno-0-46"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-47" name="__codelineno-0-47"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">trees</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-48" name="__codelineno-0-48"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">user_id</span> <span class="o">=</span> <span class="n">user_id</span>
<a id="__codelineno-0-49" name="__codelineno-0-49"></a>
<a id="__codelineno-0-50" name="__codelineno-0-50"></a>    <span class="k">if</span> <span class="n">tree_timeout</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-51" name="__codelineno-0-51"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">tree_timeout</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span>
<a id="__codelineno-0-52" name="__codelineno-0-52"></a>            <span class="n">minutes</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;TREE_TIMEOUT&quot;</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<a id="__codelineno-0-53" name="__codelineno-0-53"></a>        <span class="p">)</span>
<a id="__codelineno-0-54" name="__codelineno-0-54"></a>    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tree_timeout</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
<a id="__codelineno-0-55" name="__codelineno-0-55"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">tree_timeout</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">minutes</span><span class="o">=</span><span class="n">tree_timeout</span><span class="p">)</span>
<a id="__codelineno-0-56" name="__codelineno-0-56"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-57" name="__codelineno-0-57"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">tree_timeout</span> <span class="o">=</span> <span class="n">tree_timeout</span>
<a id="__codelineno-0-58" name="__codelineno-0-58"></a>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a>    <span class="k">if</span> <span class="n">config</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">()</span>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="n">config</span>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">settings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">settings</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="elysia.api.services.tree.TreeManager.add_tree" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">add_tree</span><span class="p">(</span><span class="n">conversation_id</span><span class="p">,</span> <span class="n">low_memory</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Add a tree to the TreeManager.
The decision tree can be initialised with specific config options, such as style, agent description and end goal.
As well as a Settings object, which chooses options such as the LLM models, API keys and more.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>conversation_id</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Required. A unique identifier for the conversation.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>low_memory</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional. Whether to use low memory mode for the tree.
Controls the LM history being saved in the tree, and some other variables.
Defaults to False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>elysia/api/services/tree.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-98" name="__codelineno-0-98"></a><span class="k">def</span><span class="w"> </span><span class="nf">add_tree</span><span class="p">(</span>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a>    <span class="n">conversation_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a>    <span class="n">low_memory</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a><span class="p">):</span>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a><span class="sd">    Add a tree to the TreeManager.</span>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a><span class="sd">    The decision tree can be initialised with specific config options, such as style, agent description and end goal.</span>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a><span class="sd">    As well as a Settings object, which chooses options such as the LLM models, API keys and more.</span>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a><span class="sd">        conversation_id (str): Required. A unique identifier for the conversation.</span>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a><span class="sd">        low_memory (bool): Optional. Whether to use low memory mode for the tree.</span>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a><span class="sd">            Controls the LM history being saved in the tree, and some other variables.</span>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a><span class="sd">            Defaults to False.</span>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a>
<a id="__codelineno-0-115" name="__codelineno-0-115"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">tree_exists</span><span class="p">(</span><span class="n">conversation_id</span><span class="p">):</span>
<a id="__codelineno-0-116" name="__codelineno-0-116"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">trees</span><span class="p">[</span><span class="n">conversation_id</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a>            <span class="s2">&quot;tree&quot;</span><span class="p">:</span> <span class="n">Tree</span><span class="p">(</span>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a>                <span class="n">conversation_id</span><span class="o">=</span><span class="n">conversation_id</span><span class="p">,</span>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a>                <span class="n">user_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">user_id</span><span class="p">,</span>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a>                <span class="n">settings</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">,</span>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a>                <span class="n">style</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">style</span><span class="p">,</span>
<a id="__codelineno-0-122" name="__codelineno-0-122"></a>                <span class="n">agent_description</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">agent_description</span><span class="p">,</span>
<a id="__codelineno-0-123" name="__codelineno-0-123"></a>                <span class="n">end_goal</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">end_goal</span><span class="p">,</span>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a>                <span class="n">branch_initialisation</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">branch_initialisation</span><span class="p">,</span>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a>                <span class="n">low_memory</span><span class="o">=</span><span class="n">low_memory</span><span class="p">,</span>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a>                <span class="n">use_elysia_collections</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">use_elysia_collections</span><span class="p">,</span>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a>            <span class="p">),</span>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a>            <span class="s2">&quot;last_request&quot;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(),</span>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a>            <span class="s2">&quot;event&quot;</span><span class="p">:</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">Event</span><span class="p">(),</span>
<a id="__codelineno-0-130" name="__codelineno-0-130"></a>        <span class="p">}</span>
<a id="__codelineno-0-131" name="__codelineno-0-131"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">trees</span><span class="p">[</span><span class="n">conversation_id</span><span class="p">][</span><span class="s2">&quot;event&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="elysia.api.services.tree.TreeManager.change_agent_description" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">change_agent_description</span><span class="p">(</span><span class="n">agent_description</span><span class="p">,</span> <span class="n">conversation_id</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Change the agent description for a tree in the TreeManager.
Or change the global agent description for all trees (if conversation_id is not supplied).
And applies these changes to current trees with default settings.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>agent_description</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The new agent description for the tree.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>conversation_id</code>
            </td>
            <td>
                  <code><span title="str">str</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional. The conversation ID which contains the tree.
If not supplied, the agent description will be changed on all trees.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>elysia/api/services/tree.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-311">311</a></span>
<span class="normal"><a href="#__codelineno-0-312">312</a></span>
<span class="normal"><a href="#__codelineno-0-313">313</a></span>
<span class="normal"><a href="#__codelineno-0-314">314</a></span>
<span class="normal"><a href="#__codelineno-0-315">315</a></span>
<span class="normal"><a href="#__codelineno-0-316">316</a></span>
<span class="normal"><a href="#__codelineno-0-317">317</a></span>
<span class="normal"><a href="#__codelineno-0-318">318</a></span>
<span class="normal"><a href="#__codelineno-0-319">319</a></span>
<span class="normal"><a href="#__codelineno-0-320">320</a></span>
<span class="normal"><a href="#__codelineno-0-321">321</a></span>
<span class="normal"><a href="#__codelineno-0-322">322</a></span>
<span class="normal"><a href="#__codelineno-0-323">323</a></span>
<span class="normal"><a href="#__codelineno-0-324">324</a></span>
<span class="normal"><a href="#__codelineno-0-325">325</a></span>
<span class="normal"><a href="#__codelineno-0-326">326</a></span>
<span class="normal"><a href="#__codelineno-0-327">327</a></span>
<span class="normal"><a href="#__codelineno-0-328">328</a></span>
<span class="normal"><a href="#__codelineno-0-329">329</a></span>
<span class="normal"><a href="#__codelineno-0-330">330</a></span>
<span class="normal"><a href="#__codelineno-0-331">331</a></span>
<span class="normal"><a href="#__codelineno-0-332">332</a></span>
<span class="normal"><a href="#__codelineno-0-333">333</a></span>
<span class="normal"><a href="#__codelineno-0-334">334</a></span>
<span class="normal"><a href="#__codelineno-0-335">335</a></span>
<span class="normal"><a href="#__codelineno-0-336">336</a></span>
<span class="normal"><a href="#__codelineno-0-337">337</a></span>
<span class="normal"><a href="#__codelineno-0-338">338</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-311" name="__codelineno-0-311"></a><span class="k">def</span><span class="w"> </span><span class="nf">change_agent_description</span><span class="p">(</span>
<a id="__codelineno-0-312" name="__codelineno-0-312"></a>    <span class="bp">self</span><span class="p">,</span> <span class="n">agent_description</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">conversation_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-313" name="__codelineno-0-313"></a><span class="p">):</span>
<a id="__codelineno-0-314" name="__codelineno-0-314"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-315" name="__codelineno-0-315"></a><span class="sd">    Change the agent description for a tree in the TreeManager.</span>
<a id="__codelineno-0-316" name="__codelineno-0-316"></a><span class="sd">    Or change the global agent description for all trees (if conversation_id is not supplied).</span>
<a id="__codelineno-0-317" name="__codelineno-0-317"></a><span class="sd">    And applies these changes to current trees with default settings.</span>
<a id="__codelineno-0-318" name="__codelineno-0-318"></a>
<a id="__codelineno-0-319" name="__codelineno-0-319"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-320" name="__codelineno-0-320"></a><span class="sd">        agent_description (str): The new agent description for the tree.</span>
<a id="__codelineno-0-321" name="__codelineno-0-321"></a><span class="sd">        conversation_id (str | None): Optional. The conversation ID which contains the tree.</span>
<a id="__codelineno-0-322" name="__codelineno-0-322"></a><span class="sd">            If not supplied, the agent description will be changed on all trees.</span>
<a id="__codelineno-0-323" name="__codelineno-0-323"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-324" name="__codelineno-0-324"></a>    <span class="k">if</span> <span class="n">conversation_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-325" name="__codelineno-0-325"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">agent_description</span> <span class="o">=</span> <span class="n">agent_description</span>
<a id="__codelineno-0-326" name="__codelineno-0-326"></a>        <span class="k">for</span> <span class="n">conversation_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">trees</span><span class="p">:</span>
<a id="__codelineno-0-327" name="__codelineno-0-327"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">trees</span><span class="p">[</span><span class="n">conversation_id</span><span class="p">][</span><span class="s2">&quot;tree&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">_config_modified</span><span class="p">:</span>
<a id="__codelineno-0-328" name="__codelineno-0-328"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">trees</span><span class="p">[</span><span class="n">conversation_id</span><span class="p">][</span><span class="s2">&quot;tree&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">change_agent_description</span><span class="p">(</span>
<a id="__codelineno-0-329" name="__codelineno-0-329"></a>                    <span class="n">agent_description</span>
<a id="__codelineno-0-330" name="__codelineno-0-330"></a>                <span class="p">)</span>
<a id="__codelineno-0-331" name="__codelineno-0-331"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">trees</span><span class="p">[</span><span class="n">conversation_id</span><span class="p">][</span><span class="s2">&quot;tree&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">_config_modified</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-332" name="__codelineno-0-332"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-333" name="__codelineno-0-333"></a>        <span class="k">if</span> <span class="n">conversation_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">trees</span><span class="p">:</span>
<a id="__codelineno-0-334" name="__codelineno-0-334"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Tree </span><span class="si">{</span><span class="n">conversation_id</span><span class="si">}</span><span class="s2"> not found&quot;</span><span class="p">)</span>
<a id="__codelineno-0-335" name="__codelineno-0-335"></a>
<a id="__codelineno-0-336" name="__codelineno-0-336"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">trees</span><span class="p">[</span><span class="n">conversation_id</span><span class="p">][</span><span class="s2">&quot;tree&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">change_agent_description</span><span class="p">(</span>
<a id="__codelineno-0-337" name="__codelineno-0-337"></a>            <span class="n">agent_description</span>
<a id="__codelineno-0-338" name="__codelineno-0-338"></a>        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="elysia.api.services.tree.TreeManager.change_branch_initialisation" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">change_branch_initialisation</span><span class="p">(</span><span class="n">branch_initialisation</span><span class="p">,</span> <span class="n">conversation_id</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Change the branch initialisation for a tree in the TreeManager.
Or change the global branch initialisation for all trees (if conversation_id is not supplied).
And applies these changes to current trees with default settings.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>branch_initialisation</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The new branch initialisation for the tree.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>conversation_id</code>
            </td>
            <td>
                  <code><span title="str">str</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional. The conversation ID which contains the tree.
If not supplied, the branch initialisation will be changed on all trees.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>elysia/api/services/tree.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-363">363</a></span>
<span class="normal"><a href="#__codelineno-0-364">364</a></span>
<span class="normal"><a href="#__codelineno-0-365">365</a></span>
<span class="normal"><a href="#__codelineno-0-366">366</a></span>
<span class="normal"><a href="#__codelineno-0-367">367</a></span>
<span class="normal"><a href="#__codelineno-0-368">368</a></span>
<span class="normal"><a href="#__codelineno-0-369">369</a></span>
<span class="normal"><a href="#__codelineno-0-370">370</a></span>
<span class="normal"><a href="#__codelineno-0-371">371</a></span>
<span class="normal"><a href="#__codelineno-0-372">372</a></span>
<span class="normal"><a href="#__codelineno-0-373">373</a></span>
<span class="normal"><a href="#__codelineno-0-374">374</a></span>
<span class="normal"><a href="#__codelineno-0-375">375</a></span>
<span class="normal"><a href="#__codelineno-0-376">376</a></span>
<span class="normal"><a href="#__codelineno-0-377">377</a></span>
<span class="normal"><a href="#__codelineno-0-378">378</a></span>
<span class="normal"><a href="#__codelineno-0-379">379</a></span>
<span class="normal"><a href="#__codelineno-0-380">380</a></span>
<span class="normal"><a href="#__codelineno-0-381">381</a></span>
<span class="normal"><a href="#__codelineno-0-382">382</a></span>
<span class="normal"><a href="#__codelineno-0-383">383</a></span>
<span class="normal"><a href="#__codelineno-0-384">384</a></span>
<span class="normal"><a href="#__codelineno-0-385">385</a></span>
<span class="normal"><a href="#__codelineno-0-386">386</a></span>
<span class="normal"><a href="#__codelineno-0-387">387</a></span>
<span class="normal"><a href="#__codelineno-0-388">388</a></span>
<span class="normal"><a href="#__codelineno-0-389">389</a></span>
<span class="normal"><a href="#__codelineno-0-390">390</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-363" name="__codelineno-0-363"></a><span class="k">def</span><span class="w"> </span><span class="nf">change_branch_initialisation</span><span class="p">(</span>
<a id="__codelineno-0-364" name="__codelineno-0-364"></a>    <span class="bp">self</span><span class="p">,</span> <span class="n">branch_initialisation</span><span class="p">:</span> <span class="n">BranchInitType</span><span class="p">,</span> <span class="n">conversation_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-365" name="__codelineno-0-365"></a><span class="p">):</span>
<a id="__codelineno-0-366" name="__codelineno-0-366"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-367" name="__codelineno-0-367"></a><span class="sd">    Change the branch initialisation for a tree in the TreeManager.</span>
<a id="__codelineno-0-368" name="__codelineno-0-368"></a><span class="sd">    Or change the global branch initialisation for all trees (if conversation_id is not supplied).</span>
<a id="__codelineno-0-369" name="__codelineno-0-369"></a><span class="sd">    And applies these changes to current trees with default settings.</span>
<a id="__codelineno-0-370" name="__codelineno-0-370"></a>
<a id="__codelineno-0-371" name="__codelineno-0-371"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-372" name="__codelineno-0-372"></a><span class="sd">        branch_initialisation (str): The new branch initialisation for the tree.</span>
<a id="__codelineno-0-373" name="__codelineno-0-373"></a><span class="sd">        conversation_id (str | None): Optional. The conversation ID which contains the tree.</span>
<a id="__codelineno-0-374" name="__codelineno-0-374"></a><span class="sd">            If not supplied, the branch initialisation will be changed on all trees.</span>
<a id="__codelineno-0-375" name="__codelineno-0-375"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-376" name="__codelineno-0-376"></a>    <span class="k">if</span> <span class="n">conversation_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-377" name="__codelineno-0-377"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">branch_initialisation</span> <span class="o">=</span> <span class="n">branch_initialisation</span>
<a id="__codelineno-0-378" name="__codelineno-0-378"></a>        <span class="k">for</span> <span class="n">conversation_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">trees</span><span class="p">:</span>
<a id="__codelineno-0-379" name="__codelineno-0-379"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">trees</span><span class="p">[</span><span class="n">conversation_id</span><span class="p">][</span><span class="s2">&quot;tree&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">_config_modified</span><span class="p">:</span>
<a id="__codelineno-0-380" name="__codelineno-0-380"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">trees</span><span class="p">[</span><span class="n">conversation_id</span><span class="p">][</span><span class="s2">&quot;tree&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">set_branch_initialisation</span><span class="p">(</span>
<a id="__codelineno-0-381" name="__codelineno-0-381"></a>                    <span class="n">branch_initialisation</span>
<a id="__codelineno-0-382" name="__codelineno-0-382"></a>                <span class="p">)</span>
<a id="__codelineno-0-383" name="__codelineno-0-383"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">trees</span><span class="p">[</span><span class="n">conversation_id</span><span class="p">][</span><span class="s2">&quot;tree&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">_config_modified</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-384" name="__codelineno-0-384"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-385" name="__codelineno-0-385"></a>        <span class="k">if</span> <span class="n">conversation_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">trees</span><span class="p">:</span>
<a id="__codelineno-0-386" name="__codelineno-0-386"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Tree </span><span class="si">{</span><span class="n">conversation_id</span><span class="si">}</span><span class="s2"> not found&quot;</span><span class="p">)</span>
<a id="__codelineno-0-387" name="__codelineno-0-387"></a>
<a id="__codelineno-0-388" name="__codelineno-0-388"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">trees</span><span class="p">[</span><span class="n">conversation_id</span><span class="p">][</span><span class="s2">&quot;tree&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">set_branch_initialisation</span><span class="p">(</span>
<a id="__codelineno-0-389" name="__codelineno-0-389"></a>            <span class="n">branch_initialisation</span>
<a id="__codelineno-0-390" name="__codelineno-0-390"></a>        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="elysia.api.services.tree.TreeManager.change_end_goal" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">change_end_goal</span><span class="p">(</span><span class="n">end_goal</span><span class="p">,</span> <span class="n">conversation_id</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Change the end goal for a tree in the TreeManager.
Or change the global end goal for all trees (if conversation_id is not supplied).
And applies these changes to current trees with default settings.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>end_goal</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The new end goal for the tree.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>conversation_id</code>
            </td>
            <td>
                  <code><span title="str">str</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional. The conversation ID which contains the tree.
If not supplied, the end goal will be changed on all trees.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>elysia/api/services/tree.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-340">340</a></span>
<span class="normal"><a href="#__codelineno-0-341">341</a></span>
<span class="normal"><a href="#__codelineno-0-342">342</a></span>
<span class="normal"><a href="#__codelineno-0-343">343</a></span>
<span class="normal"><a href="#__codelineno-0-344">344</a></span>
<span class="normal"><a href="#__codelineno-0-345">345</a></span>
<span class="normal"><a href="#__codelineno-0-346">346</a></span>
<span class="normal"><a href="#__codelineno-0-347">347</a></span>
<span class="normal"><a href="#__codelineno-0-348">348</a></span>
<span class="normal"><a href="#__codelineno-0-349">349</a></span>
<span class="normal"><a href="#__codelineno-0-350">350</a></span>
<span class="normal"><a href="#__codelineno-0-351">351</a></span>
<span class="normal"><a href="#__codelineno-0-352">352</a></span>
<span class="normal"><a href="#__codelineno-0-353">353</a></span>
<span class="normal"><a href="#__codelineno-0-354">354</a></span>
<span class="normal"><a href="#__codelineno-0-355">355</a></span>
<span class="normal"><a href="#__codelineno-0-356">356</a></span>
<span class="normal"><a href="#__codelineno-0-357">357</a></span>
<span class="normal"><a href="#__codelineno-0-358">358</a></span>
<span class="normal"><a href="#__codelineno-0-359">359</a></span>
<span class="normal"><a href="#__codelineno-0-360">360</a></span>
<span class="normal"><a href="#__codelineno-0-361">361</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-340" name="__codelineno-0-340"></a><span class="k">def</span><span class="w"> </span><span class="nf">change_end_goal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">end_goal</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">conversation_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-0-341" name="__codelineno-0-341"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-342" name="__codelineno-0-342"></a><span class="sd">    Change the end goal for a tree in the TreeManager.</span>
<a id="__codelineno-0-343" name="__codelineno-0-343"></a><span class="sd">    Or change the global end goal for all trees (if conversation_id is not supplied).</span>
<a id="__codelineno-0-344" name="__codelineno-0-344"></a><span class="sd">    And applies these changes to current trees with default settings.</span>
<a id="__codelineno-0-345" name="__codelineno-0-345"></a>
<a id="__codelineno-0-346" name="__codelineno-0-346"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-347" name="__codelineno-0-347"></a><span class="sd">        end_goal (str): The new end goal for the tree.</span>
<a id="__codelineno-0-348" name="__codelineno-0-348"></a><span class="sd">        conversation_id (str | None): Optional. The conversation ID which contains the tree.</span>
<a id="__codelineno-0-349" name="__codelineno-0-349"></a><span class="sd">            If not supplied, the end goal will be changed on all trees.</span>
<a id="__codelineno-0-350" name="__codelineno-0-350"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-351" name="__codelineno-0-351"></a>    <span class="k">if</span> <span class="n">conversation_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-352" name="__codelineno-0-352"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">end_goal</span> <span class="o">=</span> <span class="n">end_goal</span>
<a id="__codelineno-0-353" name="__codelineno-0-353"></a>        <span class="k">for</span> <span class="n">conversation_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">trees</span><span class="p">:</span>
<a id="__codelineno-0-354" name="__codelineno-0-354"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">trees</span><span class="p">[</span><span class="n">conversation_id</span><span class="p">][</span><span class="s2">&quot;tree&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">_config_modified</span><span class="p">:</span>
<a id="__codelineno-0-355" name="__codelineno-0-355"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">trees</span><span class="p">[</span><span class="n">conversation_id</span><span class="p">][</span><span class="s2">&quot;tree&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">change_end_goal</span><span class="p">(</span><span class="n">end_goal</span><span class="p">)</span>
<a id="__codelineno-0-356" name="__codelineno-0-356"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">trees</span><span class="p">[</span><span class="n">conversation_id</span><span class="p">][</span><span class="s2">&quot;tree&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">_config_modified</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-357" name="__codelineno-0-357"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-358" name="__codelineno-0-358"></a>        <span class="k">if</span> <span class="n">conversation_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">trees</span><span class="p">:</span>
<a id="__codelineno-0-359" name="__codelineno-0-359"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Tree </span><span class="si">{</span><span class="n">conversation_id</span><span class="si">}</span><span class="s2"> not found&quot;</span><span class="p">)</span>
<a id="__codelineno-0-360" name="__codelineno-0-360"></a>
<a id="__codelineno-0-361" name="__codelineno-0-361"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">trees</span><span class="p">[</span><span class="n">conversation_id</span><span class="p">][</span><span class="s2">&quot;tree&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">change_end_goal</span><span class="p">(</span><span class="n">end_goal</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="elysia.api.services.tree.TreeManager.change_style" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">change_style</span><span class="p">(</span><span class="n">style</span><span class="p">,</span> <span class="n">conversation_id</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Change the style for a tree in the TreeManager.
Or change the global style for all trees (if conversation_id is not supplied).
And applies these changes to current trees with default settings.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>style</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The new style for the tree.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>conversation_id</code>
            </td>
            <td>
                  <code><span title="str">str</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional. The conversation ID which contains the tree.
If not supplied, the style will be changed on all trees.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>elysia/api/services/tree.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-288">288</a></span>
<span class="normal"><a href="#__codelineno-0-289">289</a></span>
<span class="normal"><a href="#__codelineno-0-290">290</a></span>
<span class="normal"><a href="#__codelineno-0-291">291</a></span>
<span class="normal"><a href="#__codelineno-0-292">292</a></span>
<span class="normal"><a href="#__codelineno-0-293">293</a></span>
<span class="normal"><a href="#__codelineno-0-294">294</a></span>
<span class="normal"><a href="#__codelineno-0-295">295</a></span>
<span class="normal"><a href="#__codelineno-0-296">296</a></span>
<span class="normal"><a href="#__codelineno-0-297">297</a></span>
<span class="normal"><a href="#__codelineno-0-298">298</a></span>
<span class="normal"><a href="#__codelineno-0-299">299</a></span>
<span class="normal"><a href="#__codelineno-0-300">300</a></span>
<span class="normal"><a href="#__codelineno-0-301">301</a></span>
<span class="normal"><a href="#__codelineno-0-302">302</a></span>
<span class="normal"><a href="#__codelineno-0-303">303</a></span>
<span class="normal"><a href="#__codelineno-0-304">304</a></span>
<span class="normal"><a href="#__codelineno-0-305">305</a></span>
<span class="normal"><a href="#__codelineno-0-306">306</a></span>
<span class="normal"><a href="#__codelineno-0-307">307</a></span>
<span class="normal"><a href="#__codelineno-0-308">308</a></span>
<span class="normal"><a href="#__codelineno-0-309">309</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-288" name="__codelineno-0-288"></a><span class="k">def</span><span class="w"> </span><span class="nf">change_style</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">style</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">conversation_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-0-289" name="__codelineno-0-289"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-290" name="__codelineno-0-290"></a><span class="sd">    Change the style for a tree in the TreeManager.</span>
<a id="__codelineno-0-291" name="__codelineno-0-291"></a><span class="sd">    Or change the global style for all trees (if conversation_id is not supplied).</span>
<a id="__codelineno-0-292" name="__codelineno-0-292"></a><span class="sd">    And applies these changes to current trees with default settings.</span>
<a id="__codelineno-0-293" name="__codelineno-0-293"></a>
<a id="__codelineno-0-294" name="__codelineno-0-294"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-295" name="__codelineno-0-295"></a><span class="sd">        style (str): The new style for the tree.</span>
<a id="__codelineno-0-296" name="__codelineno-0-296"></a><span class="sd">        conversation_id (str | None): Optional. The conversation ID which contains the tree.</span>
<a id="__codelineno-0-297" name="__codelineno-0-297"></a><span class="sd">            If not supplied, the style will be changed on all trees.</span>
<a id="__codelineno-0-298" name="__codelineno-0-298"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-299" name="__codelineno-0-299"></a>    <span class="k">if</span> <span class="n">conversation_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-300" name="__codelineno-0-300"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">style</span> <span class="o">=</span> <span class="n">style</span>
<a id="__codelineno-0-301" name="__codelineno-0-301"></a>        <span class="k">for</span> <span class="n">conversation_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">trees</span><span class="p">:</span>
<a id="__codelineno-0-302" name="__codelineno-0-302"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">trees</span><span class="p">[</span><span class="n">conversation_id</span><span class="p">][</span><span class="s2">&quot;tree&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">_config_modified</span><span class="p">:</span>
<a id="__codelineno-0-303" name="__codelineno-0-303"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">trees</span><span class="p">[</span><span class="n">conversation_id</span><span class="p">][</span><span class="s2">&quot;tree&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">change_style</span><span class="p">(</span><span class="n">style</span><span class="p">)</span>
<a id="__codelineno-0-304" name="__codelineno-0-304"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">trees</span><span class="p">[</span><span class="n">conversation_id</span><span class="p">][</span><span class="s2">&quot;tree&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">_config_modified</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-305" name="__codelineno-0-305"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-306" name="__codelineno-0-306"></a>        <span class="k">if</span> <span class="n">conversation_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">trees</span><span class="p">:</span>
<a id="__codelineno-0-307" name="__codelineno-0-307"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Tree </span><span class="si">{</span><span class="n">conversation_id</span><span class="si">}</span><span class="s2"> not found&quot;</span><span class="p">)</span>
<a id="__codelineno-0-308" name="__codelineno-0-308"></a>
<a id="__codelineno-0-309" name="__codelineno-0-309"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">trees</span><span class="p">[</span><span class="n">conversation_id</span><span class="p">][</span><span class="s2">&quot;tree&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">change_style</span><span class="p">(</span><span class="n">style</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="elysia.api.services.tree.TreeManager.check_all_trees_timeout" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">check_all_trees_timeout</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Check all trees in the TreeManager and remove any that have not been active in the last tree_timeout.</p>


            <details class="quote">
              <summary>Source code in <code>elysia/api/services/tree.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-473">473</a></span>
<span class="normal"><a href="#__codelineno-0-474">474</a></span>
<span class="normal"><a href="#__codelineno-0-475">475</a></span>
<span class="normal"><a href="#__codelineno-0-476">476</a></span>
<span class="normal"><a href="#__codelineno-0-477">477</a></span>
<span class="normal"><a href="#__codelineno-0-478">478</a></span>
<span class="normal"><a href="#__codelineno-0-479">479</a></span>
<span class="normal"><a href="#__codelineno-0-480">480</a></span>
<span class="normal"><a href="#__codelineno-0-481">481</a></span>
<span class="normal"><a href="#__codelineno-0-482">482</a></span>
<span class="normal"><a href="#__codelineno-0-483">483</a></span>
<span class="normal"><a href="#__codelineno-0-484">484</a></span>
<span class="normal"><a href="#__codelineno-0-485">485</a></span>
<span class="normal"><a href="#__codelineno-0-486">486</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-473" name="__codelineno-0-473"></a><span class="k">def</span><span class="w"> </span><span class="nf">check_all_trees_timeout</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-474" name="__codelineno-0-474"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-475" name="__codelineno-0-475"></a><span class="sd">    Check all trees in the TreeManager and remove any that have not been active in the last tree_timeout.</span>
<a id="__codelineno-0-476" name="__codelineno-0-476"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-477" name="__codelineno-0-477"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tree_timeout</span> <span class="o">==</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">minutes</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
<a id="__codelineno-0-478" name="__codelineno-0-478"></a>        <span class="k">return</span>
<a id="__codelineno-0-479" name="__codelineno-0-479"></a>
<a id="__codelineno-0-480" name="__codelineno-0-480"></a>    <span class="n">convs_to_remove</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-481" name="__codelineno-0-481"></a>    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">conversation_id</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">trees</span><span class="p">):</span>
<a id="__codelineno-0-482" name="__codelineno-0-482"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_tree_timeout</span><span class="p">(</span><span class="n">conversation_id</span><span class="p">):</span>
<a id="__codelineno-0-483" name="__codelineno-0-483"></a>            <span class="n">convs_to_remove</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">conversation_id</span><span class="p">)</span>
<a id="__codelineno-0-484" name="__codelineno-0-484"></a>
<a id="__codelineno-0-485" name="__codelineno-0-485"></a>    <span class="k">for</span> <span class="n">conversation_id</span> <span class="ow">in</span> <span class="n">convs_to_remove</span><span class="p">:</span>
<a id="__codelineno-0-486" name="__codelineno-0-486"></a>        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">trees</span><span class="p">[</span><span class="n">conversation_id</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="elysia.api.services.tree.TreeManager.check_tree_exists_weaviate" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">check_tree_exists_weaviate</span><span class="p">(</span><span class="n">conversation_id</span><span class="p">,</span> <span class="n">client_manager</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Check if a tree exists in a Weaviate instance.
The collection ELYSIA_TREES__ must exist, returns False if it doesn't.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>conversation_id</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The conversation ID which contains the tree.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>client_manager</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="ClientManager (elysia.util.client.ClientManager)" href="../Client/#elysia.util.client.ClientManager">ClientManager</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The client manager to use for the tree.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True if the tree exists in the Weaviate instance, False otherwise.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>elysia/api/services/tree.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span>
<span class="normal"><a href="#__codelineno-0-149">149</a></span>
<span class="normal"><a href="#__codelineno-0-150">150</a></span>
<span class="normal"><a href="#__codelineno-0-151">151</a></span>
<span class="normal"><a href="#__codelineno-0-152">152</a></span>
<span class="normal"><a href="#__codelineno-0-153">153</a></span>
<span class="normal"><a href="#__codelineno-0-154">154</a></span>
<span class="normal"><a href="#__codelineno-0-155">155</a></span>
<span class="normal"><a href="#__codelineno-0-156">156</a></span>
<span class="normal"><a href="#__codelineno-0-157">157</a></span>
<span class="normal"><a href="#__codelineno-0-158">158</a></span>
<span class="normal"><a href="#__codelineno-0-159">159</a></span>
<span class="normal"><a href="#__codelineno-0-160">160</a></span>
<span class="normal"><a href="#__codelineno-0-161">161</a></span>
<span class="normal"><a href="#__codelineno-0-162">162</a></span>
<span class="normal"><a href="#__codelineno-0-163">163</a></span>
<span class="normal"><a href="#__codelineno-0-164">164</a></span>
<span class="normal"><a href="#__codelineno-0-165">165</a></span>
<span class="normal"><a href="#__codelineno-0-166">166</a></span>
<span class="normal"><a href="#__codelineno-0-167">167</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-147" name="__codelineno-0-147"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">check_tree_exists_weaviate</span><span class="p">(</span>
<a id="__codelineno-0-148" name="__codelineno-0-148"></a>    <span class="bp">self</span><span class="p">,</span> <span class="n">conversation_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">client_manager</span><span class="p">:</span> <span class="n">ClientManager</span>
<a id="__codelineno-0-149" name="__codelineno-0-149"></a><span class="p">):</span>
<a id="__codelineno-0-150" name="__codelineno-0-150"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-151" name="__codelineno-0-151"></a><span class="sd">    Check if a tree exists in a Weaviate instance.</span>
<a id="__codelineno-0-152" name="__codelineno-0-152"></a><span class="sd">    The collection ELYSIA_TREES__ must exist, returns False if it doesn&#39;t.</span>
<a id="__codelineno-0-153" name="__codelineno-0-153"></a>
<a id="__codelineno-0-154" name="__codelineno-0-154"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-155" name="__codelineno-0-155"></a><span class="sd">        conversation_id (str): The conversation ID which contains the tree.</span>
<a id="__codelineno-0-156" name="__codelineno-0-156"></a><span class="sd">        client_manager (ClientManager): The client manager to use for the tree.</span>
<a id="__codelineno-0-157" name="__codelineno-0-157"></a>
<a id="__codelineno-0-158" name="__codelineno-0-158"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-159" name="__codelineno-0-159"></a><span class="sd">        (bool): True if the tree exists in the Weaviate instance, False otherwise.</span>
<a id="__codelineno-0-160" name="__codelineno-0-160"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-161" name="__codelineno-0-161"></a>    <span class="k">async</span> <span class="k">with</span> <span class="n">client_manager</span><span class="o">.</span><span class="n">connect_to_async_client</span><span class="p">()</span> <span class="k">as</span> <span class="n">client</span><span class="p">:</span>
<a id="__codelineno-0-162" name="__codelineno-0-162"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="k">await</span> <span class="n">client</span><span class="o">.</span><span class="n">collections</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s2">&quot;ELYSIA_TREES__&quot;</span><span class="p">):</span>
<a id="__codelineno-0-163" name="__codelineno-0-163"></a>            <span class="k">return</span> <span class="kc">False</span>
<a id="__codelineno-0-164" name="__codelineno-0-164"></a>
<a id="__codelineno-0-165" name="__codelineno-0-165"></a>        <span class="n">collection</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">collections</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;ELYSIA_TREES__&quot;</span><span class="p">)</span>
<a id="__codelineno-0-166" name="__codelineno-0-166"></a>        <span class="n">uuid</span> <span class="o">=</span> <span class="n">generate_uuid5</span><span class="p">(</span><span class="n">conversation_id</span><span class="p">)</span>
<a id="__codelineno-0-167" name="__codelineno-0-167"></a>        <span class="k">return</span> <span class="k">await</span> <span class="n">collection</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">uuid</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="elysia.api.services.tree.TreeManager.check_tree_timeout" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">check_tree_timeout</span><span class="p">(</span><span class="n">conversation_id</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Check if a tree has been idle for the last tree_timeout.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>conversation_id</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The conversation ID which contains the tree.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True if the tree has been idle for the last tree_timeout, False otherwise.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>elysia/api/services/tree.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-446">446</a></span>
<span class="normal"><a href="#__codelineno-0-447">447</a></span>
<span class="normal"><a href="#__codelineno-0-448">448</a></span>
<span class="normal"><a href="#__codelineno-0-449">449</a></span>
<span class="normal"><a href="#__codelineno-0-450">450</a></span>
<span class="normal"><a href="#__codelineno-0-451">451</a></span>
<span class="normal"><a href="#__codelineno-0-452">452</a></span>
<span class="normal"><a href="#__codelineno-0-453">453</a></span>
<span class="normal"><a href="#__codelineno-0-454">454</a></span>
<span class="normal"><a href="#__codelineno-0-455">455</a></span>
<span class="normal"><a href="#__codelineno-0-456">456</a></span>
<span class="normal"><a href="#__codelineno-0-457">457</a></span>
<span class="normal"><a href="#__codelineno-0-458">458</a></span>
<span class="normal"><a href="#__codelineno-0-459">459</a></span>
<span class="normal"><a href="#__codelineno-0-460">460</a></span>
<span class="normal"><a href="#__codelineno-0-461">461</a></span>
<span class="normal"><a href="#__codelineno-0-462">462</a></span>
<span class="normal"><a href="#__codelineno-0-463">463</a></span>
<span class="normal"><a href="#__codelineno-0-464">464</a></span>
<span class="normal"><a href="#__codelineno-0-465">465</a></span>
<span class="normal"><a href="#__codelineno-0-466">466</a></span>
<span class="normal"><a href="#__codelineno-0-467">467</a></span>
<span class="normal"><a href="#__codelineno-0-468">468</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-446" name="__codelineno-0-446"></a><span class="k">def</span><span class="w"> </span><span class="nf">check_tree_timeout</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">conversation_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-0-447" name="__codelineno-0-447"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-448" name="__codelineno-0-448"></a><span class="sd">    Check if a tree has been idle for the last tree_timeout.</span>
<a id="__codelineno-0-449" name="__codelineno-0-449"></a>
<a id="__codelineno-0-450" name="__codelineno-0-450"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-451" name="__codelineno-0-451"></a><span class="sd">        conversation_id (str): The conversation ID which contains the tree.</span>
<a id="__codelineno-0-452" name="__codelineno-0-452"></a>
<a id="__codelineno-0-453" name="__codelineno-0-453"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-454" name="__codelineno-0-454"></a><span class="sd">        (bool): True if the tree has been idle for the last tree_timeout, False otherwise.</span>
<a id="__codelineno-0-455" name="__codelineno-0-455"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-456" name="__codelineno-0-456"></a>    <span class="c1"># if tree not found, return True</span>
<a id="__codelineno-0-457" name="__codelineno-0-457"></a>    <span class="k">if</span> <span class="n">conversation_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">trees</span><span class="p">:</span>
<a id="__codelineno-0-458" name="__codelineno-0-458"></a>        <span class="k">return</span> <span class="kc">True</span>
<a id="__codelineno-0-459" name="__codelineno-0-459"></a>
<a id="__codelineno-0-460" name="__codelineno-0-460"></a>    <span class="c1"># Remove any trees that have not been active in the last TREE_TIMEOUT minutes</span>
<a id="__codelineno-0-461" name="__codelineno-0-461"></a>    <span class="k">if</span> <span class="p">(</span>
<a id="__codelineno-0-462" name="__codelineno-0-462"></a>        <span class="s2">&quot;last_request&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">trees</span><span class="p">[</span><span class="n">conversation_id</span><span class="p">]</span>
<a id="__codelineno-0-463" name="__codelineno-0-463"></a>        <span class="ow">and</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">trees</span><span class="p">[</span><span class="n">conversation_id</span><span class="p">][</span><span class="s2">&quot;last_request&quot;</span><span class="p">]</span>
<a id="__codelineno-0-464" name="__codelineno-0-464"></a>        <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">tree_timeout</span>
<a id="__codelineno-0-465" name="__codelineno-0-465"></a>    <span class="p">):</span>
<a id="__codelineno-0-466" name="__codelineno-0-466"></a>        <span class="k">return</span> <span class="kc">True</span>
<a id="__codelineno-0-467" name="__codelineno-0-467"></a>
<a id="__codelineno-0-468" name="__codelineno-0-468"></a>    <span class="k">return</span> <span class="kc">False</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="elysia.api.services.tree.TreeManager.configure" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">configure</span><span class="p">(</span><span class="n">conversation_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Configure the settings for a tree in the TreeManager.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>conversation_id</code>
            </td>
            <td>
                  <code><span title="str">str</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The conversation ID which contains the tree.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>replace</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to override the current settings with the new settings.
When this is True, all existing settings are removed, and only the new settings are used.
Defaults to False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>**kwargs</code>
            </td>
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The keyword arguments to pass to the Settings.configure() method.</p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>elysia/api/services/tree.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-269">269</a></span>
<span class="normal"><a href="#__codelineno-0-270">270</a></span>
<span class="normal"><a href="#__codelineno-0-271">271</a></span>
<span class="normal"><a href="#__codelineno-0-272">272</a></span>
<span class="normal"><a href="#__codelineno-0-273">273</a></span>
<span class="normal"><a href="#__codelineno-0-274">274</a></span>
<span class="normal"><a href="#__codelineno-0-275">275</a></span>
<span class="normal"><a href="#__codelineno-0-276">276</a></span>
<span class="normal"><a href="#__codelineno-0-277">277</a></span>
<span class="normal"><a href="#__codelineno-0-278">278</a></span>
<span class="normal"><a href="#__codelineno-0-279">279</a></span>
<span class="normal"><a href="#__codelineno-0-280">280</a></span>
<span class="normal"><a href="#__codelineno-0-281">281</a></span>
<span class="normal"><a href="#__codelineno-0-282">282</a></span>
<span class="normal"><a href="#__codelineno-0-283">283</a></span>
<span class="normal"><a href="#__codelineno-0-284">284</a></span>
<span class="normal"><a href="#__codelineno-0-285">285</a></span>
<span class="normal"><a href="#__codelineno-0-286">286</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-269" name="__codelineno-0-269"></a><span class="k">def</span><span class="w"> </span><span class="nf">configure</span><span class="p">(</span>
<a id="__codelineno-0-270" name="__codelineno-0-270"></a>    <span class="bp">self</span><span class="p">,</span> <span class="n">conversation_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">replace</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span>
<a id="__codelineno-0-271" name="__codelineno-0-271"></a><span class="p">):</span>
<a id="__codelineno-0-272" name="__codelineno-0-272"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-273" name="__codelineno-0-273"></a><span class="sd">    Configure the settings for a tree in the TreeManager.</span>
<a id="__codelineno-0-274" name="__codelineno-0-274"></a>
<a id="__codelineno-0-275" name="__codelineno-0-275"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-276" name="__codelineno-0-276"></a><span class="sd">        conversation_id (str | None): The conversation ID which contains the tree.</span>
<a id="__codelineno-0-277" name="__codelineno-0-277"></a><span class="sd">        replace (bool): Whether to override the current settings with the new settings.</span>
<a id="__codelineno-0-278" name="__codelineno-0-278"></a><span class="sd">            When this is True, all existing settings are removed, and only the new settings are used.</span>
<a id="__codelineno-0-279" name="__codelineno-0-279"></a><span class="sd">            Defaults to False.</span>
<a id="__codelineno-0-280" name="__codelineno-0-280"></a><span class="sd">        **kwargs (Any): The keyword arguments to pass to the Settings.configure() method.</span>
<a id="__codelineno-0-281" name="__codelineno-0-281"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-282" name="__codelineno-0-282"></a>    <span class="k">if</span> <span class="n">conversation_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-283" name="__codelineno-0-283"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">replace</span><span class="o">=</span><span class="n">replace</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<a id="__codelineno-0-284" name="__codelineno-0-284"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">settings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span>
<a id="__codelineno-0-285" name="__codelineno-0-285"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-286" name="__codelineno-0-286"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">get_tree</span><span class="p">(</span><span class="n">conversation_id</span><span class="p">)</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">replace</span><span class="o">=</span><span class="n">replace</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="elysia.api.services.tree.TreeManager.delete_tree_local" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">delete_tree_local</span><span class="p">(</span><span class="n">conversation_id</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Delete a tree from the TreeManager.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>conversation_id</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The conversation ID of the tree to be deleted.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>elysia/api/services/tree.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-215">215</a></span>
<span class="normal"><a href="#__codelineno-0-216">216</a></span>
<span class="normal"><a href="#__codelineno-0-217">217</a></span>
<span class="normal"><a href="#__codelineno-0-218">218</a></span>
<span class="normal"><a href="#__codelineno-0-219">219</a></span>
<span class="normal"><a href="#__codelineno-0-220">220</a></span>
<span class="normal"><a href="#__codelineno-0-221">221</a></span>
<span class="normal"><a href="#__codelineno-0-222">222</a></span>
<span class="normal"><a href="#__codelineno-0-223">223</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-215" name="__codelineno-0-215"></a><span class="k">def</span><span class="w"> </span><span class="nf">delete_tree_local</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">conversation_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-0-216" name="__codelineno-0-216"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-217" name="__codelineno-0-217"></a><span class="sd">    Delete a tree from the TreeManager.</span>
<a id="__codelineno-0-218" name="__codelineno-0-218"></a>
<a id="__codelineno-0-219" name="__codelineno-0-219"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-220" name="__codelineno-0-220"></a><span class="sd">        conversation_id (str): The conversation ID of the tree to be deleted.</span>
<a id="__codelineno-0-221" name="__codelineno-0-221"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-222" name="__codelineno-0-222"></a>    <span class="k">if</span> <span class="n">conversation_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">trees</span><span class="p">:</span>
<a id="__codelineno-0-223" name="__codelineno-0-223"></a>        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">trees</span><span class="p">[</span><span class="n">conversation_id</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="elysia.api.services.tree.TreeManager.delete_tree_weaviate" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">delete_tree_weaviate</span><span class="p">(</span><span class="n">conversation_id</span><span class="p">,</span> <span class="n">client_manager</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Delete a tree from the stored trees in Weaviate.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>conversation_id</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The conversation ID of the tree to be deleted.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>client_manager</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="ClientManager (elysia.util.client.ClientManager)" href="../Client/#elysia.util.client.ClientManager">ClientManager</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The client manager pointing to the Weaviate instance containing the tree.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>elysia/api/services/tree.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-201">201</a></span>
<span class="normal"><a href="#__codelineno-0-202">202</a></span>
<span class="normal"><a href="#__codelineno-0-203">203</a></span>
<span class="normal"><a href="#__codelineno-0-204">204</a></span>
<span class="normal"><a href="#__codelineno-0-205">205</a></span>
<span class="normal"><a href="#__codelineno-0-206">206</a></span>
<span class="normal"><a href="#__codelineno-0-207">207</a></span>
<span class="normal"><a href="#__codelineno-0-208">208</a></span>
<span class="normal"><a href="#__codelineno-0-209">209</a></span>
<span class="normal"><a href="#__codelineno-0-210">210</a></span>
<span class="normal"><a href="#__codelineno-0-211">211</a></span>
<span class="normal"><a href="#__codelineno-0-212">212</a></span>
<span class="normal"><a href="#__codelineno-0-213">213</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-201" name="__codelineno-0-201"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">delete_tree_weaviate</span><span class="p">(</span>
<a id="__codelineno-0-202" name="__codelineno-0-202"></a>    <span class="bp">self</span><span class="p">,</span> <span class="n">conversation_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">client_manager</span><span class="p">:</span> <span class="n">ClientManager</span>
<a id="__codelineno-0-203" name="__codelineno-0-203"></a><span class="p">):</span>
<a id="__codelineno-0-204" name="__codelineno-0-204"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-205" name="__codelineno-0-205"></a><span class="sd">    Delete a tree from the stored trees in Weaviate.</span>
<a id="__codelineno-0-206" name="__codelineno-0-206"></a>
<a id="__codelineno-0-207" name="__codelineno-0-207"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-208" name="__codelineno-0-208"></a><span class="sd">        conversation_id (str): The conversation ID of the tree to be deleted.</span>
<a id="__codelineno-0-209" name="__codelineno-0-209"></a><span class="sd">        client_manager (ClientManager): The client manager pointing to the Weaviate instance containing the tree.</span>
<a id="__codelineno-0-210" name="__codelineno-0-210"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-211" name="__codelineno-0-211"></a>    <span class="k">await</span> <span class="n">delete_tree_from_weaviate</span><span class="p">(</span>
<a id="__codelineno-0-212" name="__codelineno-0-212"></a>        <span class="n">conversation_id</span><span class="p">,</span> <span class="s2">&quot;ELYSIA_TREES__&quot;</span><span class="p">,</span> <span class="n">client_manager</span>
<a id="__codelineno-0-213" name="__codelineno-0-213"></a>    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="elysia.api.services.tree.TreeManager.get_event" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_event</span><span class="p">(</span><span class="n">conversation_id</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Get the asyncio.Event for a tree in the TreeManager.
This is cleared when the tree is processing, and set when the tree is idle.
This is used to block the API from sending multiple requests to the tree at once.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>conversation_id</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The conversation ID which contains the tree.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="asyncio.Event">Event</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The event for the tree.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>elysia/api/services/tree.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-255">255</a></span>
<span class="normal"><a href="#__codelineno-0-256">256</a></span>
<span class="normal"><a href="#__codelineno-0-257">257</a></span>
<span class="normal"><a href="#__codelineno-0-258">258</a></span>
<span class="normal"><a href="#__codelineno-0-259">259</a></span>
<span class="normal"><a href="#__codelineno-0-260">260</a></span>
<span class="normal"><a href="#__codelineno-0-261">261</a></span>
<span class="normal"><a href="#__codelineno-0-262">262</a></span>
<span class="normal"><a href="#__codelineno-0-263">263</a></span>
<span class="normal"><a href="#__codelineno-0-264">264</a></span>
<span class="normal"><a href="#__codelineno-0-265">265</a></span>
<span class="normal"><a href="#__codelineno-0-266">266</a></span>
<span class="normal"><a href="#__codelineno-0-267">267</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-255" name="__codelineno-0-255"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">conversation_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-0-256" name="__codelineno-0-256"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-257" name="__codelineno-0-257"></a><span class="sd">    Get the asyncio.Event for a tree in the TreeManager.</span>
<a id="__codelineno-0-258" name="__codelineno-0-258"></a><span class="sd">    This is cleared when the tree is processing, and set when the tree is idle.</span>
<a id="__codelineno-0-259" name="__codelineno-0-259"></a><span class="sd">    This is used to block the API from sending multiple requests to the tree at once.</span>
<a id="__codelineno-0-260" name="__codelineno-0-260"></a>
<a id="__codelineno-0-261" name="__codelineno-0-261"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-262" name="__codelineno-0-262"></a><span class="sd">        conversation_id (str): The conversation ID which contains the tree.</span>
<a id="__codelineno-0-263" name="__codelineno-0-263"></a>
<a id="__codelineno-0-264" name="__codelineno-0-264"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-265" name="__codelineno-0-265"></a><span class="sd">        (asyncio.Event): The event for the tree.</span>
<a id="__codelineno-0-266" name="__codelineno-0-266"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-267" name="__codelineno-0-267"></a>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">trees</span><span class="p">[</span><span class="n">conversation_id</span><span class="p">][</span><span class="s2">&quot;event&quot;</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="elysia.api.services.tree.TreeManager.get_tree" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_tree</span><span class="p">(</span><span class="n">conversation_id</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Get a tree from the TreeManager.
Will raise a ValueError if the tree is not found.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>conversation_id</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The conversation ID which contains the tree.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="Tree (elysia.tree.tree.Tree)" href="../Tree/#elysia.tree.tree.Tree">Tree</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The tree associated with the conversation ID.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>elysia/api/services/tree.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-237">237</a></span>
<span class="normal"><a href="#__codelineno-0-238">238</a></span>
<span class="normal"><a href="#__codelineno-0-239">239</a></span>
<span class="normal"><a href="#__codelineno-0-240">240</a></span>
<span class="normal"><a href="#__codelineno-0-241">241</a></span>
<span class="normal"><a href="#__codelineno-0-242">242</a></span>
<span class="normal"><a href="#__codelineno-0-243">243</a></span>
<span class="normal"><a href="#__codelineno-0-244">244</a></span>
<span class="normal"><a href="#__codelineno-0-245">245</a></span>
<span class="normal"><a href="#__codelineno-0-246">246</a></span>
<span class="normal"><a href="#__codelineno-0-247">247</a></span>
<span class="normal"><a href="#__codelineno-0-248">248</a></span>
<span class="normal"><a href="#__codelineno-0-249">249</a></span>
<span class="normal"><a href="#__codelineno-0-250">250</a></span>
<span class="normal"><a href="#__codelineno-0-251">251</a></span>
<span class="normal"><a href="#__codelineno-0-252">252</a></span>
<span class="normal"><a href="#__codelineno-0-253">253</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-237" name="__codelineno-0-237"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_tree</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">conversation_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-0-238" name="__codelineno-0-238"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-239" name="__codelineno-0-239"></a><span class="sd">    Get a tree from the TreeManager.</span>
<a id="__codelineno-0-240" name="__codelineno-0-240"></a><span class="sd">    Will raise a ValueError if the tree is not found.</span>
<a id="__codelineno-0-241" name="__codelineno-0-241"></a>
<a id="__codelineno-0-242" name="__codelineno-0-242"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-243" name="__codelineno-0-243"></a><span class="sd">        conversation_id (str): The conversation ID which contains the tree.</span>
<a id="__codelineno-0-244" name="__codelineno-0-244"></a>
<a id="__codelineno-0-245" name="__codelineno-0-245"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-246" name="__codelineno-0-246"></a><span class="sd">        (Tree): The tree associated with the conversation ID.</span>
<a id="__codelineno-0-247" name="__codelineno-0-247"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-248" name="__codelineno-0-248"></a>    <span class="k">if</span> <span class="n">conversation_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">trees</span><span class="p">:</span>
<a id="__codelineno-0-249" name="__codelineno-0-249"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<a id="__codelineno-0-250" name="__codelineno-0-250"></a>            <span class="sa">f</span><span class="s2">&quot;Tree </span><span class="si">{</span><span class="n">conversation_id</span><span class="si">}</span><span class="s2"> not found. Please initialise a tree first (by calling `add_tree`).&quot;</span>
<a id="__codelineno-0-251" name="__codelineno-0-251"></a>        <span class="p">)</span>
<a id="__codelineno-0-252" name="__codelineno-0-252"></a>
<a id="__codelineno-0-253" name="__codelineno-0-253"></a>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">trees</span><span class="p">[</span><span class="n">conversation_id</span><span class="p">][</span><span class="s2">&quot;tree&quot;</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="elysia.api.services.tree.TreeManager.load_tree_weaviate" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">load_tree_weaviate</span><span class="p">(</span><span class="n">conversation_id</span><span class="p">,</span> <span class="n">client_manager</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Load a tree from Weaviate.
The conversation ID from the loaded tree is placed into the tree manager
(possibly overwriting an existing tree with the same conversation ID).
Then the tree itself is not returned - instead the list of frontend payloads
that were yielded to the frontend by the tree is returned.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>conversation_id</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The conversation ID which contains the tree.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>client_manager</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="ClientManager (elysia.util.client.ClientManager)" href="../Client/#elysia.util.client.ClientManager">ClientManager</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The client manager to use for the tree.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="list">list</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A list of dictionaries, each containing a frontend payload that was used to generate the tree.
The list is ordered by the time the payload was originally sent to the frontend (at the time it was saved).</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>elysia/api/services/tree.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-169">169</a></span>
<span class="normal"><a href="#__codelineno-0-170">170</a></span>
<span class="normal"><a href="#__codelineno-0-171">171</a></span>
<span class="normal"><a href="#__codelineno-0-172">172</a></span>
<span class="normal"><a href="#__codelineno-0-173">173</a></span>
<span class="normal"><a href="#__codelineno-0-174">174</a></span>
<span class="normal"><a href="#__codelineno-0-175">175</a></span>
<span class="normal"><a href="#__codelineno-0-176">176</a></span>
<span class="normal"><a href="#__codelineno-0-177">177</a></span>
<span class="normal"><a href="#__codelineno-0-178">178</a></span>
<span class="normal"><a href="#__codelineno-0-179">179</a></span>
<span class="normal"><a href="#__codelineno-0-180">180</a></span>
<span class="normal"><a href="#__codelineno-0-181">181</a></span>
<span class="normal"><a href="#__codelineno-0-182">182</a></span>
<span class="normal"><a href="#__codelineno-0-183">183</a></span>
<span class="normal"><a href="#__codelineno-0-184">184</a></span>
<span class="normal"><a href="#__codelineno-0-185">185</a></span>
<span class="normal"><a href="#__codelineno-0-186">186</a></span>
<span class="normal"><a href="#__codelineno-0-187">187</a></span>
<span class="normal"><a href="#__codelineno-0-188">188</a></span>
<span class="normal"><a href="#__codelineno-0-189">189</a></span>
<span class="normal"><a href="#__codelineno-0-190">190</a></span>
<span class="normal"><a href="#__codelineno-0-191">191</a></span>
<span class="normal"><a href="#__codelineno-0-192">192</a></span>
<span class="normal"><a href="#__codelineno-0-193">193</a></span>
<span class="normal"><a href="#__codelineno-0-194">194</a></span>
<span class="normal"><a href="#__codelineno-0-195">195</a></span>
<span class="normal"><a href="#__codelineno-0-196">196</a></span>
<span class="normal"><a href="#__codelineno-0-197">197</a></span>
<span class="normal"><a href="#__codelineno-0-198">198</a></span>
<span class="normal"><a href="#__codelineno-0-199">199</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-169" name="__codelineno-0-169"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">load_tree_weaviate</span><span class="p">(</span>
<a id="__codelineno-0-170" name="__codelineno-0-170"></a>    <span class="bp">self</span><span class="p">,</span> <span class="n">conversation_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">client_manager</span><span class="p">:</span> <span class="n">ClientManager</span>
<a id="__codelineno-0-171" name="__codelineno-0-171"></a><span class="p">):</span>
<a id="__codelineno-0-172" name="__codelineno-0-172"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-173" name="__codelineno-0-173"></a><span class="sd">    Load a tree from Weaviate.</span>
<a id="__codelineno-0-174" name="__codelineno-0-174"></a><span class="sd">    The conversation ID from the loaded tree is placed into the tree manager</span>
<a id="__codelineno-0-175" name="__codelineno-0-175"></a><span class="sd">    (possibly overwriting an existing tree with the same conversation ID).</span>
<a id="__codelineno-0-176" name="__codelineno-0-176"></a><span class="sd">    Then the tree itself is not returned - instead the list of frontend payloads</span>
<a id="__codelineno-0-177" name="__codelineno-0-177"></a><span class="sd">    that were yielded to the frontend by the tree is returned.</span>
<a id="__codelineno-0-178" name="__codelineno-0-178"></a>
<a id="__codelineno-0-179" name="__codelineno-0-179"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-180" name="__codelineno-0-180"></a><span class="sd">        conversation_id (str): The conversation ID which contains the tree.</span>
<a id="__codelineno-0-181" name="__codelineno-0-181"></a><span class="sd">        client_manager (ClientManager): The client manager to use for the tree.</span>
<a id="__codelineno-0-182" name="__codelineno-0-182"></a>
<a id="__codelineno-0-183" name="__codelineno-0-183"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-184" name="__codelineno-0-184"></a><span class="sd">        (list): A list of dictionaries, each containing a frontend payload that was used to generate the tree.</span>
<a id="__codelineno-0-185" name="__codelineno-0-185"></a><span class="sd">            The list is ordered by the time the payload was originally sent to the frontend (at the time it was saved).</span>
<a id="__codelineno-0-186" name="__codelineno-0-186"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-187" name="__codelineno-0-187"></a>    <span class="n">tree</span> <span class="o">=</span> <span class="k">await</span> <span class="n">Tree</span><span class="o">.</span><span class="n">import_from_weaviate</span><span class="p">(</span>
<a id="__codelineno-0-188" name="__codelineno-0-188"></a>        <span class="s2">&quot;ELYSIA_TREES__&quot;</span><span class="p">,</span> <span class="n">conversation_id</span><span class="p">,</span> <span class="n">client_manager</span>
<a id="__codelineno-0-189" name="__codelineno-0-189"></a>    <span class="p">)</span>
<a id="__codelineno-0-190" name="__codelineno-0-190"></a>    <span class="k">if</span> <span class="n">conversation_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">trees</span><span class="p">:</span>
<a id="__codelineno-0-191" name="__codelineno-0-191"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">trees</span><span class="p">[</span><span class="n">conversation_id</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-192" name="__codelineno-0-192"></a>            <span class="s2">&quot;tree&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-193" name="__codelineno-0-193"></a>            <span class="s2">&quot;event&quot;</span><span class="p">:</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">Event</span><span class="p">(),</span>
<a id="__codelineno-0-194" name="__codelineno-0-194"></a>            <span class="s2">&quot;last_request&quot;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(),</span>
<a id="__codelineno-0-195" name="__codelineno-0-195"></a>        <span class="p">}</span>
<a id="__codelineno-0-196" name="__codelineno-0-196"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">trees</span><span class="p">[</span><span class="n">conversation_id</span><span class="p">][</span><span class="s2">&quot;tree&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tree</span>
<a id="__codelineno-0-197" name="__codelineno-0-197"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">trees</span><span class="p">[</span><span class="n">conversation_id</span><span class="p">][</span><span class="s2">&quot;event&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>
<a id="__codelineno-0-198" name="__codelineno-0-198"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">update_tree_last_request</span><span class="p">(</span><span class="n">conversation_id</span><span class="p">)</span>
<a id="__codelineno-0-199" name="__codelineno-0-199"></a>    <span class="k">return</span> <span class="n">tree</span><span class="o">.</span><span class="n">returner</span><span class="o">.</span><span class="n">store</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="elysia.api.services.tree.TreeManager.process_tree" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">process_tree</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">conversation_id</span><span class="p">,</span> <span class="n">query_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">training_route</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">collection_names</span><span class="o">=</span><span class="p">[],</span> <span class="n">client_manager</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Process a tree in the TreeManager.
This is an async generator which yields results from the tree.async_run() method.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>query</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Required. The user input/prompt to process in the decision tree.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>conversation_id</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Required. The conversation ID which contains the tree.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>query_id</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional. A unique identifier for the query.
If not supplied, a random UUID will be generated.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>training_route</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional. The training route, a string of the form "tool1/tool2/tool1" etc.
See the <code>tree.async_run()</code> method for more details.</p>
              </div>
            </td>
            <td>
                  <code>&#39;&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>collection_names</code>
            </td>
            <td>
                  <code><span title="list">list</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional. A list of collection names to use in the query.
If not supplied, all collections will be used.</p>
              </div>
            </td>
            <td>
                  <code>[]</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>client_manager</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="ClientManager (elysia.util.client.ClientManager)" href="../Client/#elysia.util.client.ClientManager">ClientManager</a> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional. A client manager to use for the query.
If not supplied, a new ClientManager will be created.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>elysia/api/services/tree.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-392">392</a></span>
<span class="normal"><a href="#__codelineno-0-393">393</a></span>
<span class="normal"><a href="#__codelineno-0-394">394</a></span>
<span class="normal"><a href="#__codelineno-0-395">395</a></span>
<span class="normal"><a href="#__codelineno-0-396">396</a></span>
<span class="normal"><a href="#__codelineno-0-397">397</a></span>
<span class="normal"><a href="#__codelineno-0-398">398</a></span>
<span class="normal"><a href="#__codelineno-0-399">399</a></span>
<span class="normal"><a href="#__codelineno-0-400">400</a></span>
<span class="normal"><a href="#__codelineno-0-401">401</a></span>
<span class="normal"><a href="#__codelineno-0-402">402</a></span>
<span class="normal"><a href="#__codelineno-0-403">403</a></span>
<span class="normal"><a href="#__codelineno-0-404">404</a></span>
<span class="normal"><a href="#__codelineno-0-405">405</a></span>
<span class="normal"><a href="#__codelineno-0-406">406</a></span>
<span class="normal"><a href="#__codelineno-0-407">407</a></span>
<span class="normal"><a href="#__codelineno-0-408">408</a></span>
<span class="normal"><a href="#__codelineno-0-409">409</a></span>
<span class="normal"><a href="#__codelineno-0-410">410</a></span>
<span class="normal"><a href="#__codelineno-0-411">411</a></span>
<span class="normal"><a href="#__codelineno-0-412">412</a></span>
<span class="normal"><a href="#__codelineno-0-413">413</a></span>
<span class="normal"><a href="#__codelineno-0-414">414</a></span>
<span class="normal"><a href="#__codelineno-0-415">415</a></span>
<span class="normal"><a href="#__codelineno-0-416">416</a></span>
<span class="normal"><a href="#__codelineno-0-417">417</a></span>
<span class="normal"><a href="#__codelineno-0-418">418</a></span>
<span class="normal"><a href="#__codelineno-0-419">419</a></span>
<span class="normal"><a href="#__codelineno-0-420">420</a></span>
<span class="normal"><a href="#__codelineno-0-421">421</a></span>
<span class="normal"><a href="#__codelineno-0-422">422</a></span>
<span class="normal"><a href="#__codelineno-0-423">423</a></span>
<span class="normal"><a href="#__codelineno-0-424">424</a></span>
<span class="normal"><a href="#__codelineno-0-425">425</a></span>
<span class="normal"><a href="#__codelineno-0-426">426</a></span>
<span class="normal"><a href="#__codelineno-0-427">427</a></span>
<span class="normal"><a href="#__codelineno-0-428">428</a></span>
<span class="normal"><a href="#__codelineno-0-429">429</a></span>
<span class="normal"><a href="#__codelineno-0-430">430</a></span>
<span class="normal"><a href="#__codelineno-0-431">431</a></span>
<span class="normal"><a href="#__codelineno-0-432">432</a></span>
<span class="normal"><a href="#__codelineno-0-433">433</a></span>
<span class="normal"><a href="#__codelineno-0-434">434</a></span>
<span class="normal"><a href="#__codelineno-0-435">435</a></span>
<span class="normal"><a href="#__codelineno-0-436">436</a></span>
<span class="normal"><a href="#__codelineno-0-437">437</a></span>
<span class="normal"><a href="#__codelineno-0-438">438</a></span>
<span class="normal"><a href="#__codelineno-0-439">439</a></span>
<span class="normal"><a href="#__codelineno-0-440">440</a></span>
<span class="normal"><a href="#__codelineno-0-441">441</a></span>
<span class="normal"><a href="#__codelineno-0-442">442</a></span>
<span class="normal"><a href="#__codelineno-0-443">443</a></span>
<span class="normal"><a href="#__codelineno-0-444">444</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-392" name="__codelineno-0-392"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">process_tree</span><span class="p">(</span>
<a id="__codelineno-0-393" name="__codelineno-0-393"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-394" name="__codelineno-0-394"></a>    <span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-395" name="__codelineno-0-395"></a>    <span class="n">conversation_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-396" name="__codelineno-0-396"></a>    <span class="n">query_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-397" name="__codelineno-0-397"></a>    <span class="n">training_route</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
<a id="__codelineno-0-398" name="__codelineno-0-398"></a>    <span class="n">collection_names</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[],</span>
<a id="__codelineno-0-399" name="__codelineno-0-399"></a>    <span class="n">client_manager</span><span class="p">:</span> <span class="n">ClientManager</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-400" name="__codelineno-0-400"></a><span class="p">):</span>
<a id="__codelineno-0-401" name="__codelineno-0-401"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-402" name="__codelineno-0-402"></a><span class="sd">    Process a tree in the TreeManager.</span>
<a id="__codelineno-0-403" name="__codelineno-0-403"></a><span class="sd">    This is an async generator which yields results from the tree.async_run() method.</span>
<a id="__codelineno-0-404" name="__codelineno-0-404"></a>
<a id="__codelineno-0-405" name="__codelineno-0-405"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-406" name="__codelineno-0-406"></a><span class="sd">        query (str): Required. The user input/prompt to process in the decision tree.</span>
<a id="__codelineno-0-407" name="__codelineno-0-407"></a><span class="sd">        conversation_id (str): Required. The conversation ID which contains the tree.</span>
<a id="__codelineno-0-408" name="__codelineno-0-408"></a><span class="sd">        query_id (str): Optional. A unique identifier for the query.</span>
<a id="__codelineno-0-409" name="__codelineno-0-409"></a><span class="sd">            If not supplied, a random UUID will be generated.</span>
<a id="__codelineno-0-410" name="__codelineno-0-410"></a><span class="sd">        training_route (str): Optional. The training route, a string of the form &quot;tool1/tool2/tool1&quot; etc.</span>
<a id="__codelineno-0-411" name="__codelineno-0-411"></a><span class="sd">            See the `tree.async_run()` method for more details.</span>
<a id="__codelineno-0-412" name="__codelineno-0-412"></a><span class="sd">        collection_names (list[str]): Optional. A list of collection names to use in the query.</span>
<a id="__codelineno-0-413" name="__codelineno-0-413"></a><span class="sd">            If not supplied, all collections will be used.</span>
<a id="__codelineno-0-414" name="__codelineno-0-414"></a><span class="sd">        client_manager (ClientManager | None): Optional. A client manager to use for the query.</span>
<a id="__codelineno-0-415" name="__codelineno-0-415"></a><span class="sd">            If not supplied, a new ClientManager will be created.</span>
<a id="__codelineno-0-416" name="__codelineno-0-416"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-417" name="__codelineno-0-417"></a>
<a id="__codelineno-0-418" name="__codelineno-0-418"></a>    <span class="k">if</span> <span class="n">query_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-419" name="__codelineno-0-419"></a>        <span class="n">query_id</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">())</span>
<a id="__codelineno-0-420" name="__codelineno-0-420"></a>
<a id="__codelineno-0-421" name="__codelineno-0-421"></a>    <span class="n">tree</span><span class="p">:</span> <span class="n">Tree</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_tree</span><span class="p">(</span><span class="n">conversation_id</span><span class="p">)</span>
<a id="__codelineno-0-422" name="__codelineno-0-422"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">update_tree_last_request</span><span class="p">(</span><span class="n">conversation_id</span><span class="p">)</span>
<a id="__codelineno-0-423" name="__codelineno-0-423"></a>
<a id="__codelineno-0-424" name="__codelineno-0-424"></a>    <span class="c1"># wait for the tree to be idle</span>
<a id="__codelineno-0-425" name="__codelineno-0-425"></a>    <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">trees</span><span class="p">[</span><span class="n">conversation_id</span><span class="p">][</span><span class="s2">&quot;event&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>
<a id="__codelineno-0-426" name="__codelineno-0-426"></a>
<a id="__codelineno-0-427" name="__codelineno-0-427"></a>    <span class="c1"># clear the event, set it to working</span>
<a id="__codelineno-0-428" name="__codelineno-0-428"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">trees</span><span class="p">[</span><span class="n">conversation_id</span><span class="p">][</span><span class="s2">&quot;event&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
<a id="__codelineno-0-429" name="__codelineno-0-429"></a>
<a id="__codelineno-0-430" name="__codelineno-0-430"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-431" name="__codelineno-0-431"></a>        <span class="k">async</span> <span class="k">for</span> <span class="n">yielded_result</span> <span class="ow">in</span> <span class="n">tree</span><span class="o">.</span><span class="n">async_run</span><span class="p">(</span>
<a id="__codelineno-0-432" name="__codelineno-0-432"></a>            <span class="n">query</span><span class="p">,</span>
<a id="__codelineno-0-433" name="__codelineno-0-433"></a>            <span class="n">collection_names</span><span class="o">=</span><span class="n">collection_names</span><span class="p">,</span>
<a id="__codelineno-0-434" name="__codelineno-0-434"></a>            <span class="n">client_manager</span><span class="o">=</span><span class="n">client_manager</span><span class="p">,</span>
<a id="__codelineno-0-435" name="__codelineno-0-435"></a>            <span class="n">query_id</span><span class="o">=</span><span class="n">query_id</span><span class="p">,</span>
<a id="__codelineno-0-436" name="__codelineno-0-436"></a>            <span class="n">training_route</span><span class="o">=</span><span class="n">training_route</span><span class="p">,</span>
<a id="__codelineno-0-437" name="__codelineno-0-437"></a>            <span class="n">close_clients_after_completion</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-438" name="__codelineno-0-438"></a>        <span class="p">):</span>
<a id="__codelineno-0-439" name="__codelineno-0-439"></a>            <span class="k">yield</span> <span class="n">yielded_result</span>
<a id="__codelineno-0-440" name="__codelineno-0-440"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">update_tree_last_request</span><span class="p">(</span><span class="n">conversation_id</span><span class="p">)</span>
<a id="__codelineno-0-441" name="__codelineno-0-441"></a>
<a id="__codelineno-0-442" name="__codelineno-0-442"></a>    <span class="k">finally</span><span class="p">:</span>
<a id="__codelineno-0-443" name="__codelineno-0-443"></a>        <span class="c1"># set the event to idle</span>
<a id="__codelineno-0-444" name="__codelineno-0-444"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">trees</span><span class="p">[</span><span class="n">conversation_id</span><span class="p">][</span><span class="s2">&quot;event&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="elysia.api.services.tree.TreeManager.save_tree_weaviate" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">save_tree_weaviate</span><span class="p">(</span><span class="n">conversation_id</span><span class="p">,</span> <span class="n">client_manager</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Save a tree to Weaviate to collection ELYSIA_TREES__.
Creates the collection if it doesn't exist.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>conversation_id</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The conversation ID which contains the tree.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>client_manager</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="ClientManager (elysia.util.client.ClientManager)" href="../Client/#elysia.util.client.ClientManager">ClientManager</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The client manager to use for the tree.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>elysia/api/services/tree.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-133" name="__codelineno-0-133"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">save_tree_weaviate</span><span class="p">(</span>
<a id="__codelineno-0-134" name="__codelineno-0-134"></a>    <span class="bp">self</span><span class="p">,</span> <span class="n">conversation_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">client_manager</span><span class="p">:</span> <span class="n">ClientManager</span>
<a id="__codelineno-0-135" name="__codelineno-0-135"></a><span class="p">):</span>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-137" name="__codelineno-0-137"></a><span class="sd">    Save a tree to Weaviate to collection ELYSIA_TREES__.</span>
<a id="__codelineno-0-138" name="__codelineno-0-138"></a><span class="sd">    Creates the collection if it doesn&#39;t exist.</span>
<a id="__codelineno-0-139" name="__codelineno-0-139"></a>
<a id="__codelineno-0-140" name="__codelineno-0-140"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-141" name="__codelineno-0-141"></a><span class="sd">        conversation_id (str): The conversation ID which contains the tree.</span>
<a id="__codelineno-0-142" name="__codelineno-0-142"></a><span class="sd">        client_manager (ClientManager): The client manager to use for the tree.</span>
<a id="__codelineno-0-143" name="__codelineno-0-143"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-144" name="__codelineno-0-144"></a>    <span class="n">tree</span><span class="p">:</span> <span class="n">Tree</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_tree</span><span class="p">(</span><span class="n">conversation_id</span><span class="p">)</span>
<a id="__codelineno-0-145" name="__codelineno-0-145"></a>    <span class="k">await</span> <span class="n">tree</span><span class="o">.</span><span class="n">export_to_weaviate</span><span class="p">(</span><span class="s2">&quot;ELYSIA_TREES__&quot;</span><span class="p">,</span> <span class="n">client_manager</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="elysia.api.services.tree.TreeManager.tree_exists" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">tree_exists</span><span class="p">(</span><span class="n">conversation_id</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Check if a tree exists in the TreeManager.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>conversation_id</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The conversation ID which may contain the tree.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True if the tree exists, False otherwise.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>elysia/api/services/tree.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-225">225</a></span>
<span class="normal"><a href="#__codelineno-0-226">226</a></span>
<span class="normal"><a href="#__codelineno-0-227">227</a></span>
<span class="normal"><a href="#__codelineno-0-228">228</a></span>
<span class="normal"><a href="#__codelineno-0-229">229</a></span>
<span class="normal"><a href="#__codelineno-0-230">230</a></span>
<span class="normal"><a href="#__codelineno-0-231">231</a></span>
<span class="normal"><a href="#__codelineno-0-232">232</a></span>
<span class="normal"><a href="#__codelineno-0-233">233</a></span>
<span class="normal"><a href="#__codelineno-0-234">234</a></span>
<span class="normal"><a href="#__codelineno-0-235">235</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-225" name="__codelineno-0-225"></a><span class="k">def</span><span class="w"> </span><span class="nf">tree_exists</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">conversation_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-0-226" name="__codelineno-0-226"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-227" name="__codelineno-0-227"></a><span class="sd">    Check if a tree exists in the TreeManager.</span>
<a id="__codelineno-0-228" name="__codelineno-0-228"></a>
<a id="__codelineno-0-229" name="__codelineno-0-229"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-230" name="__codelineno-0-230"></a><span class="sd">        conversation_id (str): The conversation ID which may contain the tree.</span>
<a id="__codelineno-0-231" name="__codelineno-0-231"></a>
<a id="__codelineno-0-232" name="__codelineno-0-232"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-233" name="__codelineno-0-233"></a><span class="sd">        (bool): True if the tree exists, False otherwise.</span>
<a id="__codelineno-0-234" name="__codelineno-0-234"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-235" name="__codelineno-0-235"></a>    <span class="k">return</span> <span class="n">conversation_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">trees</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>







  
  






                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        
<div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/weaviate/elysia" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://github.com/weaviate/elysia-frontend" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://github.com/dannyjameswilliams" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M202.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1M496 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2m-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3m-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://github.com/thomashacker" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M202.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1M496 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2m-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3m-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://www.linkedin.com/in/dannyjameswilliams/" target="_blank" rel="noopener" title="www.linkedin.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3M135.4 416H69V202.2h66.5V416zM102.2 96a38.5 38.5 0 1 1 0 77 38.5 38.5 0 1 1 0-77m282.1 320h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://www.linkedin.com/in/edwardschmuhl/" target="_blank" rel="noopener" title="www.linkedin.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3M135.4 416H69V202.2h66.5V416zM102.2 96a38.5 38.5 0 1 1 0 77 38.5 38.5 0 1 1 0-77m282.1 320h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.tabs", "navigation.sections", "toc.integrate", "navigation.top", "search.suggest", "search.highlight", "content.tabs.link", "content.code.annotation", "content.code.copy"], "search": "../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.92b07e13.min.js"></script>
      
        <script src="../../javascripts/mathjax.js"></script>
      
        <script src="https://unpkg.com/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>